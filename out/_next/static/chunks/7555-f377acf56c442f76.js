"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7555],{1652:function(e,t,r){r.d(t,{cP:function(){return i}});var a=r(77527);let i=(0,a.ZP)("div")(e=>{let{theme:t}=e;return{"& .rdw-editor-wrapper":{border:"1px solid ".concat(t.palette.divider),"& .rdw-editor-toolbar":{border:0,marginBottom:0,background:t.palette.background.paper,borderBottom:"1px solid ".concat(t.palette.divider),"& .rdw-fontsize-dropdown":{minWidth:50},"& .rdw-link-modal":{height:"auto"},"& .rdw-colorpicker-modal, & .rdw-link-modal, & .rdw-embedded-modal, & .rdw-emoji-modal, & .rdw-image-modal":{boxShadow:t.shadows[8],borderColor:t.palette.divider,backgroundColor:t.palette.background.paper},"& .rdw-dropdown-optionwrapper":{boxShadow:t.shadows[8],borderColor:t.palette.divider,backgroundColor:t.palette.background.paper,"& .rdw-dropdownoption-highlighted":{backgroundColor:t.palette.action.hover},"& .rdw-dropdownoption-active":{backgroundColor:t.palette.action.selected}},"& .rdw-option-wrapper, & .rdw-dropdown-wrapper":{borderRadius:"4px !important",borderColor:t.palette.divider,background:t.palette.background.paper,"& .rdw-dropdown-carettoopen":{left:"auto",right:"10%",borderTopColor:t.palette.text.disabled},"& .rdw-dropdown-carettoclose":{left:"auto",right:"10%",borderBottomColor:t.palette.text.disabled},..."dark"===t.palette.mode?{"& img":{filter:"invert(1)"}}:{},"&:hover":{boxShadow:"none",backgroundColor:"rgba(".concat(t.palette.customColors.main,", 0.08)")}},"& .rdw-embedded-modal-size-input, & .rdw-image-modal-size-input":{width:"60%",minHeight:30},"& .rdw-link-modal-input, & .rdw-embedded-modal-link-input, & .rdw-image-modal-url-input":{minHeight:38},"& .rdw-link-modal-input, & .rdw-embedded-modal-link-input, & .rdw-image-modal-url-input, & .rdw-embedded-modal-size-input, & .rdw-image-modal-size-input":{background:"none",padding:t.spacing(0,3.5),color:t.palette.text.primary,borderColor:t.palette.divider,borderRadius:t.shape.borderRadius,fontSize:t.typography.body1.fontSize,"&:focus":{borderColor:t.palette.primary.main},"&::placeholder, &:-ms-input-placeholder, &::-ms-input-placeholder":{color:t.palette.text.disabled}},"& .rdw-link-modal-btn, & .rdw-embedded-modal-btn, & .rdw-image-modal-btn":{border:0,lineHeight:1.71,borderRadius:"5px",letterSpacing:"0.3px",textTransform:"uppercase",fontWeight:t.typography.fontWeightMedium,"&:first-of-type:not([disabled])":{boxShadow:t.shadows[3],color:t.palette.primary.contrastText,backgroundColor:t.palette.primary.main,"&:hover":{boxShadow:t.shadows[4],backgroundColor:t.palette.primary.dark},"&:active":{boxShadow:t.shadows[3]}},"&:last-child":{boxShadow:t.shadows[3],color:t.palette.secondary.contrastText,backgroundColor:t.palette.secondary.main,"&:hover":{boxShadow:t.shadows[4],backgroundColor:t.palette.secondary.dark},"&:active":{boxShadow:t.shadows[3]}},"&[disabled]":{cursor:"default",boxShadow:"none",color:t.palette.text.disabled,backgroundColor:t.palette.action.disabledBackground}}},"& .rdw-editor-main":{cursor:"text",padding:"0 1rem",minHeight:"10rem",color:t.palette.text.primary,..."rtl"===t.direction?{"& .public-DraftStyleDefault-block":{direction:"ltr !important",textAlign:"left !important"}}:{}}}}});(0,a.ZP)("div")(()=>({"& .rdw-editor-wrapper":{display:"flex",flexDirection:"column-reverse"}})),(0,a.ZP)("div")(()=>({"& .rdw-editor-wrapper, & .rdw-editor-toolbar":{border:"0 !important"}}))},73138:function(e,t,r){r.d(t,{Z:function(){return l}});var a=r(85893),i=r(5152);let n=r.n(i)()(()=>r.e(6925).then(r.t.bind(r,35108,23)).then(e=>e.Editor),{loadableGenerated:{webpack:()=>[35108]},ssr:!1});var l=e=>(0,a.jsx)(n,{editorState:e.editorState,onEditorStateChange:t=>e.onEditorStateChange(t)})},33971:function(e,t,r){var a=r(85893),i=r(37958),n=r(73907),l=r(77527),o=r(52857),s=r(96788),d=r(90642),c=r(67294),u=r(52293),m=r(74538),p=r(86501),h=r(34273),x=r(22120),g=r(7879),v=r(76592),b=r(70360),w=r(46577),k=r(8863),Z=r(19827),f=r(65806),y=r(13539),j=r(21038);r(80135);var S=r(75673),C=r(1652),_=r(73138),D=r(9041);let P=(0,l.ZP)(d.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(6),justifyContent:"space-between"}});t.Z=e=>{var t,r,l;let{open:R,toggle:q,taskId:F,partId:z,part:I,task:L}=e,{user:B}=(0,h.a)(),{t:E}=(0,x.$G)(),[T,W]=c.useState(D.EditorState.createEmpty()),[A,G]=c.useState([]),[H,K]=c.useState(!1),[M,N]=c.useState({comment:"",file:""}),U=e=>G(t=>t.filter((t,r)=>r!==e)),Y=(e,t)=>G(r=>r.map((r,a)=>a===e?{...r,isLink:t,link:t?r.link:"",file:t?null:r.file}:r)),$=(e,t)=>G(r=>r.map((r,a)=>a===e?{...r,link:t}:r)),Q=(e,t)=>G(r=>r.map((r,a)=>a===e?{...r,file:t}:r));c.useEffect(()=>{R&&0===A.length&&G([{isLink:!1,link:"",file:null}])},[R]);let O=()=>{W(D.EditorState.createEmpty()),G([]),N({comment:"",file:""})},V=async()=>{if(!F){p.ZP.error(String(E("tasks.view.actions.toasts.taskRequired")||"Task id required"));return}let e=T.getCurrentContent().hasText(),t=A.some(e=>{var t;return e.isLink?!!(null===(t=e.link)||void 0===t?void 0:t.trim()):!!e.file});if(e)N(e=>({...e,comment:""}));else{N(e=>({...e,comment:String(E("tasks.view.actions.toasts.commentRequired")||"Comment is required")}));return}if(t)N(e=>({...e,file:""}));else{N(e=>({...e,file:String(E("tasks.view.actions.toasts.fileRequired")||"Attachment is required")}));return}try{if(K(!0),e&&await u.Do.post(m.Z.taskComment,{part:null!=z?z:null,author:null==B?void 0:B.id,text:T.getCurrentContent().getPlainText()}),t){let e=A.filter(e=>e.isLink?e.link.trim().length:!!e.file);if(!e.length){p.ZP.error(String(E("tasks.view.actions.toasts.fileRequired")||"Attachment is required"));return}for(let t of e){var r,a;let e=new FormData;e.append("title",""),e.append("link",t.isLink?t.link.trim():""),e.append("part",z?z.toString():""),e.append("uploaded_by",null!==(a=null==B?void 0:null===(r=B.id)||void 0===r?void 0:r.toString())&&void 0!==a?a:""),!t.isLink&&t.file&&e.append("file",t.file),await u.Do.postForm(m.Z.taskAttachment,e)}}await u.Do.patch(m.Z.taskPartById(null!=z?z:null),{status:"on_review",task:F}),p.ZP.success(String(E("tasks.view.actions.toasts.saved")||"Saved")),O(),q()}catch(e){console.error("Failed to submit combined from drawer",e),p.ZP.error(String(E("tasks.view.actions.toasts.saveError")||"Failed to save"))}finally{K(!1),O()}},J=async()=>{if(T.getCurrentContent().hasText())N(e=>({...e,comment:""}));else{N(e=>({...e,comment:String(E("tasks.view.actions.toasts.commentRequired")||"Comment is required")}));return}try{K(!0),await u.Do.patch(m.Z.taskPartById(null!=z?z:null),{status:"returned",task:F}),p.ZP.success(String(E("tasks.view.actions.toasts.resend")||"Resend"))}catch(e){console.error("Failed to resend combined",e),p.ZP.error(String(E("tasks.view.actions.toasts.resendError")||"Failed to resend"))}finally{K(!1),O(),q()}},X=async()=>{if(T.getCurrentContent().hasText())N(e=>({...e,comment:""}));else{N(e=>({...e,comment:String(E("tasks.view.actions.toasts.commentRequired")||"Comment is required")}));return}try{K(!0),await u.Do.patch(m.Z.taskPartById(null!=z?z:null),{status:"cancelled",task:F}),p.ZP.success(String(E("tasks.view.actions.toasts.cancel")||"Cancel"))}catch(e){console.error("Failed to cancel combined",e)}finally{K(!1),O(),q()}},ee=async()=>{if(T.getCurrentContent().hasText())N(e=>({...e,comment:""}));else{N(e=>({...e,comment:String(E("tasks.view.actions.toasts.commentRequired")||"Comment is required")}));return}try{K(!0),await u.Do.patch(m.Z.taskPartById(null!=z?z:null),{status:"done",task:F}),p.ZP.success(String(E("tasks.view.actions.toasts.done")||"Done"))}catch(e){console.error("Failed to complete combined",e)}finally{K(!1),O(),q()}};return(0,a.jsxs)(i.ZP,{open:R,anchor:"right",variant:"temporary",onClose:q,sx:{"& .MuiDrawer-paper":{width:[420,760]}},ModalProps:{keepMounted:!0},children:[(0,a.jsxs)(P,{children:[(0,a.jsx)(s.Z,{variant:"h5",children:String(E("tasks.view.actions.drawerTitle")||"Send / Execute")}),(0,a.jsx)(o.Z,{size:"small",onClick:q,sx:{p:"0.375rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:e=>"rgba(".concat(e.palette.customColors.main,", 0.16)")}},children:(0,a.jsx)(S.Z,{icon:"tabler:x",fontSize:"1.25rem"})})]}),(0,a.jsx)(d.Z,{sx:{p:e=>e.spacing(0,6,6)},children:(0,a.jsxs)(d.Z,{children:[(null==B?void 0:B.id)===(null==I?void 0:null===(t=I.assignee_detail)||void 0===t?void 0:t.id)&&z&&((null==I?void 0:I.status)==="new"||(null==I?void 0:I.status)==="in_progress"||(null==I?void 0:I.status)==="returned")&&(0,a.jsxs)(d.Z,{sx:{my:2,display:"flex",flexDirection:"column",gap:2},children:[(0,a.jsx)(s.Z,{variant:"subtitle2",children:String(E("tasks.view.actions.attachmentDialog.title")||"")}),(0,a.jsxs)(v.Z,{size:"small",children:[(0,a.jsx)(b.Z,{children:(0,a.jsxs)(w.Z,{children:[(0,a.jsx)(k.Z,{children:String(E("common.file")||"File")}),(0,a.jsx)(k.Z,{align:"right",children:String(E("common.actions")||"Actions")})]})}),(0,a.jsx)(Z.Z,{children:A.map((e,t)=>(0,a.jsxs)(w.Z,{children:[(0,a.jsxs)(k.Z,{sx:{width:"90%"},children:[(0,a.jsx)(f.Z,{control:(0,a.jsx)(y.Z,{checked:e.isLink,onChange:e=>Y(t,e.target.checked)}),label:e.isLink?"Link":"File"}),e.isLink?(0,a.jsx)(g.Z,{fullWidth:!0,size:"small",label:String(E("common.link",{defaultValue:"Link"})),value:e.link,onChange:e=>$(t,e.target.value)}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.Z,{component:"label",variant:"outlined",size:"small",startIcon:(0,a.jsx)(S.Z,{icon:"tabler:upload"}),children:[String(E("tasks.view.actions.attachmentDialog.chooseFile")||"Choose file"),(0,a.jsx)("input",{hidden:!0,type:"file",onChange:e=>{var r;return Q(t,(null===(r=e.target.files)||void 0===r?void 0:r[0])||null)}})]}),(0,a.jsx)(s.Z,{variant:"caption",sx:{display:"block",mt:1},color:"text.secondary",children:e.file?e.file.name:String(E("tasks.view.actions.attachmentDialog.noFileSelected")||"No file selected")})]})]}),(0,a.jsx)(k.Z,{align:"right",children:(0,a.jsx)(j.Z,{title:String(E("common.delete")||"Delete"),children:(0,a.jsx)(o.Z,{size:"small",color:"error",onClick:()=>U(t),children:(0,a.jsx)(S.Z,{icon:"mdi:delete"})})})})]},t))})]}),(0,a.jsx)(d.Z,{children:(0,a.jsx)(n.Z,{variant:"text",size:"small",startIcon:(0,a.jsx)(S.Z,{icon:"mdi:plus"}),onClick:()=>G(e=>[...e,{isLink:!1,link:"",file:null}]),children:String(E("tasks.view.actions.attachmentDialog.addRow")||"Add file")})}),M.file?(0,a.jsx)(s.Z,{color:"error",variant:"caption",sx:{mb:1},children:M.file}):null]}),(0,a.jsxs)(C.cP,{children:[(0,a.jsx)("div",{style:{marginBottom:8,fontWeight:500},children:String(E("commands.form.basis"))}),(0,a.jsx)(_.Z,{editorState:T,onEditorStateChange:e=>{W(e)}}),(0,a.jsx)(s.Z,{color:"error",variant:"caption",sx:{mb:1},children:M.comment})]}),(null==B?void 0:B.id)==(null==I?void 0:null===(r=I.assignee_detail)||void 0===r?void 0:r.id)&&z&&((null==I?void 0:I.status)==="new"||(null==I?void 0:I.status)==="in_progress"||(null==I?void 0:I.status)==="returned")&&(0,a.jsxs)(d.Z,{sx:{display:"flex",gap:2,mt:20},children:[(0,a.jsx)(n.Z,{variant:"contained",onClick:V,disabled:H,children:String(E("tasks.view.actions.drawer.executeCombined")||"Bajarish")}),(0,a.jsx)(n.Z,{variant:"outlined",color:"secondary",onClick:()=>O(),disabled:H,children:String(E("common.clear")||"Clear")})]}),(null==B?void 0:B.id)===(null==L?void 0:null===(l=L.signed_by_detail)||void 0===l?void 0:l.id)&&z&&(null==I?void 0:I.status)!=="new"&&(null==I?void 0:I.status)!=="in_progress"&&(null==I?void 0:I.status)!=="returned"&&(0,a.jsxs)(d.Z,{sx:{display:"flex",flexWrap:"wrap",gap:2,mt:20},children:[(0,a.jsx)(n.Z,{variant:"contained",color:"warning",onClick:J,disabled:H,children:String(E("tasks.view.actions.resendForReview")||"Resend for review")}),(0,a.jsx)(n.Z,{variant:"contained",color:"error",onClick:X,disabled:H,children:String(E("tasks.view.actions.cancel")||String(E("common.cancel"))||"Cancel")}),(0,a.jsx)(n.Z,{variant:"contained",onClick:ee,disabled:H,children:String(E("tasks.view.actions.done")||"Done")})]})]})})]})}},15822:function(e,t,r){r.d(t,{Z:function(){return L}});var a=r(85893),i=r(67294),n=r(84166),l=r(14934),o=r(96788),s=r(60762),d=r(71919),c=r(90642),u=r(81873),m=r(47407),p=r(19304),h=r(21038),x=r(52857),g=r(87590),v=r(32200),b=r(61769),w=r(56912),k=r(21201),Z=r(30202),f=r(33934),y=r(98029),j=r(75673),S=r(52293),C=r(74538),_=r(22120),D=r(30381),P=r.n(D);let R=e=>{let t=(e.file||"").trim(),r=(e.link||"").trim();if(!t&&!r)return"Fayl #".concat(e.id);try{let e=(t||r).split("?")[0],a=e.split("/");return decodeURIComponent(a[a.length-1]||e)}catch(e){return t||r}},q=e=>{let t=(e||"").toLowerCase().split("?")[0],r=t.split(".").pop();return r&&r!==t?r:""},F=e=>{switch(e){case"pdf":return"tabler:file-type-pdf";case"doc":case"docx":return"tabler:file-type-doc";case"xls":case"xlsx":return"tabler:file-type-xls";case"ppt":case"pptx":return"tabler:file-type-ppt";case"png":case"jpg":case"jpeg":case"webp":case"gif":return"tabler:photo";case"zip":case"rar":case"7z":return"tabler:archive";default:return"tabler:file"}},z=e=>{let t=(e.link||"").trim(),r=(e.file||"").trim();return t||r||"#"},I=e=>(e.link||"").trim()&&!(e.file||"").trim()?"tabler:link":F(q(String(e.file||e.link||"")));function L(e){let{taskId:t,partId:r,isCompact:D}=e,{t:F}=(0,_.$G)(),L=(0,Z.NL)(),{data:B}=(0,f.a)({queryKey:["task-part",r],queryFn:async()=>(await S.Do.get(C.Z.taskPartById(r))).data,enabled:!!r}),E=null==B?void 0:B.status,{data:T,isLoading:W,isError:A}=(0,f.a)({queryKey:["task-attachments",t,void 0===r?"all":r],queryFn:async()=>{let e={task:t,limit:50};return void 0!==r&&(e.part=null===r?"":r),(await S.Do.get(C.Z.taskAttachment,e)).data||{results:[]}},enabled:!!t||!!r,staleTime:1e4}),G=(0,y.D)({mutationFn:e=>S.Do.delete(C.Z.taskAttachmentById(e)),onSuccess:()=>{L.invalidateQueries({queryKey:["task-attachments",t,void 0===r?"all":r]})}}),H=(null==T?void 0:T.results)||[];return W?(0,a.jsxs)(n.Z,{spacing:2,children:[(0,a.jsx)(l.Z,{variant:"text",width:"30%"}),(0,a.jsx)(l.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,a.jsx)(l.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,a.jsx)(l.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}})]}):A?(0,a.jsx)(o.Z,{variant:"body2",color:"error",children:String(F("tasks.view.attachments.loadError"))}):H.length?D?(0,a.jsx)(s.Z,{variant:"outlined",sx:{mb:2},children:(0,a.jsx)(d.Z,{sx:{py:"0.75rem !important"},children:(0,a.jsxs)(n.Z,{direction:"row",spacing:3,alignItems:"center",flexWrap:"wrap",useFlexGap:!0,children:[(0,a.jsxs)(o.Z,{variant:"subtitle2",sx:{mr:2},children:[String(F("tasks.view.attachments.title")),":"]}),H.map(e=>{let t=R(e),r=I(e),i=z(e);return(0,a.jsx)(u.Z,{icon:(0,a.jsx)(j.Z,{icon:r}),label:t,component:"a",href:i,target:"_blank",clickable:!0,size:"small",variant:"outlined",color:"primary"},e.id)})]})})}):(0,a.jsx)(s.Z,{children:(0,a.jsxs)(d.Z,{children:[(0,a.jsxs)(c.Z,{sx:{mb:2,display:"flex",alignItems:"center",justifyContent:"space-between",gap:2},children:[(0,a.jsx)(o.Z,{variant:"subtitle2",children:String(F("tasks.view.attachments.title"))}),(0,a.jsx)(u.Z,{size:"small",color:"info",label:String(F("tasks.view.attachments.count",{count:H.length}))})]}),(0,a.jsx)(m.Z,{disablePadding:!0,children:H.map((e,t)=>{var r,l,s;let d=R(e),c=I(e),m=e.created_time||e.created_at||e.updated_time||e.updated_at,Z=m?P()(m).format("DD.MM.YYYY HH:mm"):"",f=(null===(r=e.uploaded_by_detail)||void 0===r?void 0:r.fullname)||(null===(l=e.created_by_detail)||void 0===l?void 0:l.fullname)||("number"==typeof e.uploaded_by?"#".concat(e.uploaded_by):"number"==typeof e.created_by?"#".concat(e.created_by):""),y=z(e);return(0,a.jsxs)(i.Fragment,{children:[(0,a.jsxs)(p.ZP,{disableGutters:!0,secondaryAction:(0,a.jsxs)(n.Z,{direction:"row",spacing:1,children:[y&&"#"!==y?(0,a.jsx)(h.Z,{title:String(F("tasks.view.attachments.openOrDownload")),children:(0,a.jsx)(x.Z,{component:"a",href:y,target:"_blank",rel:"noreferrer",children:(0,a.jsx)(j.Z,{icon:"tabler:download"})})}):null,"returned"===E?(0,a.jsx)(h.Z,{title:String(F("tasks.view.attachments.delete")),children:(0,a.jsx)(x.Z,{onClick:()=>G.mutate(e.id),disabled:G.isPending,color:"error",children:(0,a.jsx)(j.Z,{icon:"tabler:trash"})})}):null]}),sx:{py:1.25,px:1,borderRadius:2,"&:hover":{backgroundColor:e=>e.palette.action.hover}},children:[(0,a.jsx)(g.Z,{children:(0,a.jsx)(k.Z,{variant:"rounded",sx:{width:40,height:40,bgcolor:e=>e.palette.action.selected,color:"text.primary"},children:(0,a.jsx)(j.Z,{icon:c})})}),(0,a.jsx)(v.Z,{primary:(0,a.jsxs)(n.Z,{direction:"row",spacing:1,sx:{alignItems:"center",flexWrap:"wrap",rowGap:1},children:[y&&"#"!==y?(0,a.jsx)(b.Z,{href:y,target:"_blank",rel:"noreferrer",underline:"hover",color:"inherit",children:(0,a.jsx)(o.Z,{variant:"subtitle2",sx:{fontWeight:600},children:d})}):(0,a.jsx)(o.Z,{variant:"subtitle2",sx:{fontWeight:600},children:d}),(()=>{let t=q(String(e.file||e.link||""));return t?(0,a.jsx)(u.Z,{size:"small",variant:"outlined",label:t.toUpperCase()}):null})(),e.part?(0,a.jsx)(u.Z,{size:"small",variant:"outlined",label:String(F("tasks.view.attachments.partLabel",{id:e.part}))}):null]}),secondary:(0,a.jsxs)(n.Z,{direction:"row",spacing:1,sx:{alignItems:"center",flexWrap:"wrap",rowGap:.5},children:[Z?(0,a.jsx)(o.Z,{variant:"caption",color:"text.secondary",children:Z}):null,f?(0,a.jsx)(o.Z,{variant:"caption",color:"text.secondary",children:String(F("tasks.view.attachments.uploader",{name:f}))}):null]})})]}),t<H.length-1?(0,a.jsx)(w.Z,{sx:{my:1}}):null]},null!==(s=e.id)&&void 0!==s?s:t)})})]})}):D?null:(0,a.jsx)(s.Z,{children:(0,a.jsx)(d.Z,{children:(0,a.jsx)(c.Z,{sx:{py:2},children:(0,a.jsx)(o.Z,{variant:"body2",color:"text.secondary",children:String(F("tasks.view.attachments.empty"))})})})})}},96145:function(e,t,r){r.d(t,{Z:function(){return D}});var a=r(85893),i=r(67294),n=r(84166),l=r(14934),o=r(96788),s=r(60762),d=r(71919),c=r(90642),u=r(81873),m=r(47407),p=r(19304),h=r(21038),x=r(52857),g=r(87590),v=r(21201),b=r(32200),w=r(56912),k=r(30202),Z=r(33934),f=r(98029),y=r(75673),j=r(52293),S=r(74538),C=r(22120);let _=e=>{var t,r;let a=(e||"").trim();if(!a)return"?";let i=a.split(" ").filter(Boolean);return(((null===(t=i[0])||void 0===t?void 0:t[0])||"")+((null===(r=i[1])||void 0===r?void 0:r[0])||"")).toUpperCase()||a[0].toUpperCase()};function D(e){let{taskId:t,partId:r}=e,{t:D}=(0,C.$G)(),P=(0,k.NL)(),{data:R}=(0,Z.a)({queryKey:["task-part",r],queryFn:async()=>(await j.Do.get(S.Z.taskPartById(r))).data,enabled:!!r}),q=null==R?void 0:R.status,{data:F,isLoading:z,isError:I}=(0,Z.a)({queryKey:["task-comments",t,null!=r?r:null],queryFn:async()=>{let e={task:null!=t?t:"",limit:50};return null!=r&&(e.part=r),(await j.Do.get(S.Z.taskComment,e)).data||{results:[]}},enabled:!!t||!!r,staleTime:1e4}),L=(0,f.D)({mutationFn:e=>j.Do.delete(S.Z.taskCommentById(e)),onSuccess:()=>{P.invalidateQueries({queryKey:["task-comments",t,null!=r?r:null]})}}),B=(null==F?void 0:F.results)||[];return z?(0,a.jsxs)(n.Z,{spacing:2,children:[(0,a.jsx)(l.Z,{variant:"text",width:"25%"}),(0,a.jsx)(l.Z,{variant:"rectangular",height:72,sx:{borderRadius:2}}),(0,a.jsx)(l.Z,{variant:"rectangular",height:72,sx:{borderRadius:2}}),(0,a.jsx)(l.Z,{variant:"rectangular",height:72,sx:{borderRadius:2}})]}):I?(0,a.jsx)(o.Z,{variant:"body2",color:"error",children:String(D("tasks.view.comments.loadError"))}):B.length?(0,a.jsx)(s.Z,{children:(0,a.jsxs)(d.Z,{children:[(0,a.jsxs)(c.Z,{sx:{mb:2,display:"flex",alignItems:"center",justifyContent:"space-between",gap:2},children:[(0,a.jsx)(o.Z,{variant:"subtitle2",children:String(D("tasks.view.comments.title"))}),(0,a.jsx)(u.Z,{size:"small",color:"info",label:String(D("tasks.view.comments.count",{count:B.length}))})]}),(0,a.jsx)(m.Z,{disablePadding:!0,children:B.map((e,t)=>{var r,l;let s=e.created_at?new Date(e.created_at).toLocaleString():"",d=e.is_system?String(D("tasks.view.comments.system")):"".concat(null===(r=e.author_detail)||void 0===r?void 0:r.fullname);return(0,a.jsxs)(i.Fragment,{children:[(0,a.jsxs)(p.ZP,{disableGutters:!0,alignItems:"flex-start",secondaryAction:"returned"===q?(0,a.jsx)(h.Z,{title:String(D("tasks.view.comments.delete")),children:(0,a.jsx)(x.Z,{onClick:()=>L.mutate(e.id),disabled:L.isPending,color:"error",children:(0,a.jsx)(y.Z,{icon:"tabler:trash"})})}):null,sx:{py:1.25,px:1,borderRadius:2,"&:hover":{backgroundColor:e=>e.palette.action.hover}},children:[(0,a.jsx)(g.Z,{children:(0,a.jsx)(v.Z,{sx:{width:40,height:40,bgcolor:t=>e.is_system?t.palette.grey[200]:t.palette.primary.light,color:t=>e.is_system?t.palette.text.primary:t.palette.primary.contrastText},children:e.is_system?(0,a.jsx)(y.Z,{icon:"tabler:settings"}):_(d)})}),(0,a.jsx)(b.Z,{primary:(0,a.jsxs)(n.Z,{direction:"row",spacing:1,sx:{alignItems:"center",flexWrap:"wrap",rowGap:1},children:[(0,a.jsx)(o.Z,{variant:"subtitle2",sx:{fontWeight:700},children:d}),e.is_system?(0,a.jsx)(u.Z,{size:"small",color:"default",variant:"outlined",label:String(D("tasks.view.comments.system"))}):null,e.part?(0,a.jsx)(u.Z,{size:"small",variant:"outlined",label:String(D("tasks.view.comments.partLabel",{id:e.part}))}):null,s?(0,a.jsxs)(o.Z,{variant:"caption",sx:{color:"text.disabled"},children:["• ",s]}):null]}),secondary:(0,a.jsx)(o.Z,{variant:"body2",color:"text.secondary",sx:{mt:.5,whiteSpace:"pre-wrap",wordBreak:"break-word"},children:e.text||"—"})})]}),t<B.length-1?(0,a.jsx)(w.Z,{sx:{my:1}}):null]},null!==(l=e.id)&&void 0!==l?l:t)})})]})}):(0,a.jsx)(s.Z,{children:(0,a.jsx)(d.Z,{children:(0,a.jsx)(o.Z,{variant:"body2",color:"text.secondary",children:String(D("tasks.view.comments.empty"))})})})}}}]);