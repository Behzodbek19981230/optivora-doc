(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7749],{94487:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tasks/view/[id]",function(){return a(82090)}])},7879:function(e,t,a){"use strict";var n=a(85893),i=a(67294),r=a(77527),s=a(40492);let l=(0,r.ZP)(s.Z)(e=>{let{theme:t}=e;return{alignItems:"flex-start","& .MuiInputLabel-root":{transform:"none",lineHeight:1.154,position:"relative",marginBottom:t.spacing(1),fontSize:t.typography.body2.fontSize,color:"".concat(t.palette.text.primary," !important")},"& .MuiInputBase-root":{borderRadius:8,backgroundColor:"transparent !important",border:"1px solid rgba(".concat(t.palette.customColors.main,", 0.2)"),transition:t.transitions.create(["border-color","box-shadow"],{duration:t.transitions.duration.shorter}),"&:not(.Mui-focused):not(.Mui-disabled):not(.Mui-error):hover":{borderColor:"rgba(".concat(t.palette.customColors.main,", 0.28)")},"&:before, &:after":{display:"none"},"&.MuiInputBase-sizeSmall":{borderRadius:6},"&.Mui-error":{borderColor:t.palette.error.main},"&.Mui-focused":{boxShadow:t.shadows[2],"& .MuiInputBase-input:not(.MuiInputBase-readOnly):not([readonly])::placeholder":{transform:"translateX(4px)"},"&.MuiInputBase-colorPrimary":{borderColor:t.palette.primary.main},"&.MuiInputBase-colorSecondary":{borderColor:t.palette.secondary.main},"&.MuiInputBase-colorInfo":{borderColor:t.palette.info.main},"&.MuiInputBase-colorSuccess":{borderColor:t.palette.success.main},"&.MuiInputBase-colorWarning":{borderColor:t.palette.warning.main},"&.MuiInputBase-colorError":{borderColor:t.palette.error.main},"&.Mui-error":{borderColor:t.palette.error.main}},"&.Mui-disabled":{backgroundColor:"".concat(t.palette.action.selected," !important")},"& .MuiInputAdornment-root":{marginTop:"0 !important"}},"& .MuiInputBase-input":{color:t.palette.text.secondary,"&:not(textarea)":{padding:"15.5px 13px"},"&:not(textarea).MuiInputBase-inputSizeSmall":{padding:"7.5px 13px"},"&:not(.MuiInputBase-readOnly):not([readonly])::placeholder":{transition:t.transitions.create(["opacity","transform"],{duration:t.transitions.duration.shorter})},"&.MuiInputBase-inputAdornedStart:not(.MuiAutocomplete-input)":{paddingLeft:0},"&.MuiInputBase-inputAdornedEnd:not(.MuiAutocomplete-input)":{paddingRight:0}},"& .MuiFormHelperText-root":{lineHeight:1.154,margin:t.spacing(1,0,0),color:t.palette.text.secondary,fontSize:t.typography.body2.fontSize,"&.Mui-error":{color:t.palette.error.main}},"& .MuiSelect-select:focus, & .MuiNativeSelect-select:focus":{backgroundColor:"transparent"},"& .MuiSelect-filled .MuiChip-root":{height:22},"& .MuiAutocomplete-input":{paddingLeft:"6px !important",paddingTop:"7.5px !important",paddingBottom:"7.5px !important","&.MuiInputBase-inputSizeSmall":{paddingLeft:"6px !important",paddingTop:"2.5px !important",paddingBottom:"2.5px !important"}},"& .MuiAutocomplete-inputRoot":{paddingTop:"8px !important",paddingLeft:"8px !important",paddingBottom:"8px !important","&:not(.MuiInputBase-sizeSmall).MuiInputBase-adornedStart":{paddingLeft:"13px !important"},"&.MuiInputBase-sizeSmall":{paddingTop:"5px !important",paddingLeft:"5px !important",paddingBottom:"5px !important","& .MuiAutocomplete-tag":{margin:2,height:22}}},"& .MuiInputBase-multiline":{padding:"15.25px 13px","&.MuiInputBase-sizeSmall":{padding:"7.25px 13px"},"& textarea.MuiInputBase-inputSizeSmall:placeholder-shown":{overflowX:"hidden"}},"& + .react-datepicker__close-icon":{top:11,"&:after":{fontSize:"1.6rem !important"}}}}),o=(0,i.forwardRef)((e,t)=>{let{size:a="small",InputLabelProps:i,...r}=e;return(0,n.jsx)(l,{size:a,inputRef:t,...r,variant:"filled",InputLabelProps:{...i,shrink:!0}})});t.Z=o},69447:function(e,t,a){"use strict";var n=a(85893),i=a(18745),r=a(17494),s=a(2339),l=a(17643);let o=e=>{let{sx:t,skin:a,color:o,variant:d}=e,c=(0,i.Z)(),u=(0,s.Z)(),p={primary:{boxShadow:"none",color:c.palette.primary.main,backgroundColor:u.primaryLight.backgroundColor},secondary:{boxShadow:"none",color:c.palette.secondary.main,backgroundColor:u.secondaryLight.backgroundColor},success:{boxShadow:"none",color:c.palette.success.main,backgroundColor:u.successLight.backgroundColor},error:{boxShadow:"none",color:c.palette.error.main,backgroundColor:u.errorLight.backgroundColor},warning:{boxShadow:"none",color:c.palette.warning.main,backgroundColor:u.warningLight.backgroundColor},info:{boxShadow:"none",color:c.palette.info.main,backgroundColor:u.infoLight.backgroundColor},grey:{boxShadow:"none",color:c.palette.grey[500],backgroundColor:(0,l.E)(c.palette.grey[500],.12)}};return(0,n.jsx)(r.Z,{...e,sx:o&&"light"===a&&"filled"===d?Object.assign(p[o],t):t})};o.defaultProps={color:"grey",variant:"filled"},t.Z=o},58898:function(e,t,a){"use strict";var n=a(18745),i=a(86501);t.Z=()=>{let e=(0,n.Z)();return{success:(t,a)=>i.ZP.success(t,{style:{paddingInline:"10px",paddingBlock:"6px",color:e.palette.success.main,border:"1px solid ".concat(e.palette.success.main)},iconTheme:{primary:e.palette.success.main,secondary:e.palette.success.contrastText},...a}),error:(t,a)=>i.ZP.error(t,{style:{paddingInline:"10px",paddingBlock:"6px",color:e.palette.error.main,border:"1px solid ".concat(e.palette.error.main)},iconTheme:{primary:e.palette.error.main,secondary:e.palette.getContrastText(e.palette.error.main)},...a}),info:(t,a)=>(0,i.ZP)(t,{style:{padding:"16px",color:e.palette.info.main,border:"1px solid ".concat(e.palette.info.main)},iconTheme:{primary:e.palette.info.main,secondary:e.palette.getContrastText(e.palette.info.main)},...a})}}},1652:function(e,t,a){"use strict";a.d(t,{cP:function(){return i}});var n=a(77527);let i=(0,n.ZP)("div")(e=>{let{theme:t}=e;return{"& .rdw-editor-wrapper":{border:"1px solid ".concat(t.palette.divider),"& .rdw-editor-toolbar":{border:0,marginBottom:0,background:t.palette.background.paper,borderBottom:"1px solid ".concat(t.palette.divider),"& .rdw-fontsize-dropdown":{minWidth:50},"& .rdw-link-modal":{height:"auto"},"& .rdw-colorpicker-modal, & .rdw-link-modal, & .rdw-embedded-modal, & .rdw-emoji-modal, & .rdw-image-modal":{boxShadow:t.shadows[8],borderColor:t.palette.divider,backgroundColor:t.palette.background.paper},"& .rdw-dropdown-optionwrapper":{boxShadow:t.shadows[8],borderColor:t.palette.divider,backgroundColor:t.palette.background.paper,"& .rdw-dropdownoption-highlighted":{backgroundColor:t.palette.action.hover},"& .rdw-dropdownoption-active":{backgroundColor:t.palette.action.selected}},"& .rdw-option-wrapper, & .rdw-dropdown-wrapper":{borderRadius:"4px !important",borderColor:t.palette.divider,background:t.palette.background.paper,"& .rdw-dropdown-carettoopen":{left:"auto",right:"10%",borderTopColor:t.palette.text.disabled},"& .rdw-dropdown-carettoclose":{left:"auto",right:"10%",borderBottomColor:t.palette.text.disabled},..."dark"===t.palette.mode?{"& img":{filter:"invert(1)"}}:{},"&:hover":{boxShadow:"none",backgroundColor:"rgba(".concat(t.palette.customColors.main,", 0.08)")}},"& .rdw-embedded-modal-size-input, & .rdw-image-modal-size-input":{width:"60%",minHeight:30},"& .rdw-link-modal-input, & .rdw-embedded-modal-link-input, & .rdw-image-modal-url-input":{minHeight:38},"& .rdw-link-modal-input, & .rdw-embedded-modal-link-input, & .rdw-image-modal-url-input, & .rdw-embedded-modal-size-input, & .rdw-image-modal-size-input":{background:"none",padding:t.spacing(0,3.5),color:t.palette.text.primary,borderColor:t.palette.divider,borderRadius:t.shape.borderRadius,fontSize:t.typography.body1.fontSize,"&:focus":{borderColor:t.palette.primary.main},"&::placeholder, &:-ms-input-placeholder, &::-ms-input-placeholder":{color:t.palette.text.disabled}},"& .rdw-link-modal-btn, & .rdw-embedded-modal-btn, & .rdw-image-modal-btn":{border:0,lineHeight:1.71,borderRadius:"5px",letterSpacing:"0.3px",textTransform:"uppercase",fontWeight:t.typography.fontWeightMedium,"&:first-of-type:not([disabled])":{boxShadow:t.shadows[3],color:t.palette.primary.contrastText,backgroundColor:t.palette.primary.main,"&:hover":{boxShadow:t.shadows[4],backgroundColor:t.palette.primary.dark},"&:active":{boxShadow:t.shadows[3]}},"&:last-child":{boxShadow:t.shadows[3],color:t.palette.secondary.contrastText,backgroundColor:t.palette.secondary.main,"&:hover":{boxShadow:t.shadows[4],backgroundColor:t.palette.secondary.dark},"&:active":{boxShadow:t.shadows[3]}},"&[disabled]":{cursor:"default",boxShadow:"none",color:t.palette.text.disabled,backgroundColor:t.palette.action.disabledBackground}}},"& .rdw-editor-main":{cursor:"text",padding:"0 1rem",minHeight:"10rem",color:t.palette.text.primary,..."rtl"===t.direction?{"& .public-DraftStyleDefault-block":{direction:"ltr !important",textAlign:"left !important"}}:{}}}}});(0,n.ZP)("div")(()=>({"& .rdw-editor-wrapper":{display:"flex",flexDirection:"column-reverse"}})),(0,n.ZP)("div")(()=>({"& .rdw-editor-wrapper, & .rdw-editor-toolbar":{border:"0 !important"}}))},74538:function(e,t){"use strict";let a=e=>Array.isArray(e)?e[0]:null==e?"":String(e);t.Z={login:"/auth/token",logout:"/auth/logout",me:"/user-view",companyProfile:"/company-profile",companyProfileById:e=>"/company-profile/".concat(a(e)),companyProfileFields:"/company-profile/fields",country:"/country/",district:"/district",districtById:e=>"/district/".concat(a(e),"/"),region:"/region/",regionById:e=>"/region/".concat(a(e),"/"),countryById:e=>"/country/".concat(a(e),"/"),countryFields:"/country/fields/",command:"/command/",commandById:e=>"/command/".concat(a(e)),industries:"/industry",industryById:e=>"/industry/".concat(a(e)),industryFields:"/industry/fields",users:"/user",userById:e=>"/user/".concat(a(e)),equipmentCategories:"/equipment-category",equipmentCategoryById:e=>"/equipment-category/".concat(a(e)),services:"/service",serviceById:e=>"/service/".concat(a(e)),partners:"/partner",partnerById:e=>"/partner/".concat(a(e)),company:"/company/",companyById:e=>"/company/".concat(a(e)),replyLetter:"/reply-letter/",replyLetterById:e=>"/reply-letter/".concat(a(e)),replyLetterFile:"/reply-letter-file/",replyLetterFileById:e=>"/reply-letter-file/".concat(a(e)),documents:"/documents/",documentById:e=>"/documents/".concat(a(e)),documentForm:"/document-form/",documentFormById:e=>"/document-form/".concat(a(e)),listOfMagazine:"/list-of-magazine/",listOfMagazineById:e=>"/list-of-magazine/".concat(a(e)),task:"/task/",taskById:e=>"/task/".concat(a(e)),taskPart:"/task-part/",taskPartById:e=>"/task-part/".concat(a(e)),taskEvent:"/task-event/",taskEventById:e=>"/task-event/".concat(a(e)),taskComment:"/task-comment/",taskCommentById:e=>"/task-comment/".concat(a(e)),taskAttachment:"/task-attachment/",taskAttachmentById:e=>"/task-attachment/".concat(a(e)),department:"/department/",departmentById:e=>"/department/".concat(a(e)),position:"/position/",positionById:e=>"/position/".concat(a(e)),projects:"/project",projectById:e=>"/project/".concat(a(e)),projectDeliverables:"/project-deliverable",projectDeliverableById:e=>"/project-deliverable/".concat(a(e)),projectImages:"/project-image",projectImageById:e=>"/project-image/".concat(a(e)),stats:"/stats",statById:e=>"/stats/".concat(a(e)),faqs:"/faq",faqById:e=>"/faq/".concat(a(e)),inquiries:"/inquiry",inquiryById:e=>"/inquiry/".concat(a(e)),downloads:"/command-file/",downloadById:e=>"/command-file/".concat(a(e)),news:"/news-post",newsById:e=>"/news-post/".concat(a(e)),testimonials:"/testimonial",testimonialById:e=>"/testimonial/".concat(a(e)),ourWork:"/our-work",ourWorkById:e=>"/our-work/".concat(a(e)),applicationApprovedByID:e=>"/application-approved/".concat(a(e)),limitData:"/limit-data"}},33251:function(e,t,a){"use strict";a.d(t,{z:function(){return s}});var n=a(30202),i=a(33934),r=a(52293);let s=function(e){var t,a;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=(0,n.NL)(),o=["list",e,s],d=Object.fromEntries(Object.entries(s).filter(e=>{let[,t]=e;return void 0!==t})),{data:c,isLoading:u,error:p}=(0,i.a)({queryKey:o,queryFn:async()=>{var t,a,n;let i=(await r.Do.get(e,d)).data,s=Array.isArray(i)?i:null!==(a=null==i?void 0:i.results)&&void 0!==a?a:[],l=Array.isArray(i)?s.length:null!==(n=null==i?void 0:null===(t=i.pagination)||void 0===t?void 0:t.total)&&void 0!==n?n:s.length;return{items:s,total:l}},staleTime:3e4});return{data:null!==(t=null==c?void 0:c.items)&&void 0!==t?t:[],total:null!==(a=null==c?void 0:c.total)&&void 0!==a?a:0,loading:u,error:p,mutate:()=>{l.invalidateQueries({queryKey:o})}}}},82090:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return eF}});var n=a(85893),i=a(67294),r=a(11163),s=a(90642),l=a(68573),o=a(60762),d=a(71919),c=a(84166),u=a(96788),p=a(51015),m=a(81873),x=a(43374),h=a(28907),g=a(41664),v=a.n(g),j=a(75673),b=a(74538),f=a(52293),y=a(56912),w=a(33453),k=a(92365),Z=a(40110),S=a(46070),_=a(96727),C=a(76592),I=a(70360),P=a(46577),B=a(8863),N=a(19827),z=a(22120);function D(e){let{parts:t,selectedPartId:a,setSelectedPartId:i,onDelete:r,onEdit:s}=e,{t:l}=(0,z.$G)(),p=e=>{switch(e){case"new":default:return"default";case"in_progress":return"info";case"on_review":case"returned":return"warning";case"done":return"success";case"cancelled":return"error"}},x=e=>{if(!e)return"—";let t="documents.status.".concat(e.split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")),a=String(l(t));return a===t?e:a};return(0,n.jsx)(o.Z,{children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d.Z,{children:(0,n.jsxs)(c.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[(0,n.jsx)(u.Z,{variant:"subtitle2",children:String(l("tasks.view.parts.title"))}),(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:String(l("tasks.view.parts.count",{count:t.length}))})]})}),t.length?(0,n.jsxs)(C.Z,{size:"small",sx:{"& .MuiTableCell-root":{py:1}},children:[(0,n.jsx)(I.Z,{children:(0,n.jsxs)(P.Z,{children:[(0,n.jsx)(B.Z,{children:String(l("tasks.view.parts.table.title"))}),(0,n.jsx)(B.Z,{children:String(l("tasks.view.parts.table.status"))}),(0,n.jsx)(B.Z,{children:String(l("tasks.view.parts.table.department"))}),(0,n.jsx)(B.Z,{children:String(l("tasks.view.parts.table.assignee"))}),(0,n.jsx)(B.Z,{children:String(l("tasks.view.parts.table.start"))}),(0,n.jsx)(B.Z,{children:String(l("tasks.view.parts.table.end"))})]})}),(0,n.jsx)(N.Z,{children:t.map(e=>{var t,r;let s=a===e.id;return(0,n.jsxs)(P.Z,{hover:!0,selected:s,onClick:()=>i(e.id),sx:{cursor:"pointer"},children:[(0,n.jsxs)(B.Z,{children:[(0,n.jsx)(c.Z,{direction:"row",spacing:1,alignItems:"center",children:(0,n.jsx)(u.Z,{variant:"body2",sx:{fontWeight:600},children:e.title||String(l("tasks.view.parts.partFallbackTitle",{id:e.id}))})}),!!e.note&&(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:e.note})]}),(0,n.jsx)(B.Z,{children:(0,n.jsx)(m.Z,{size:"small",label:x(e.status),color:p(e.status),variant:"outlined"})}),(0,n.jsx)(B.Z,{children:(null===(t=e.department_detail)||void 0===t?void 0:t.name)||e.department}),(0,n.jsx)(B.Z,{children:(null===(r=e.assignee_detail)||void 0===r?void 0:r.fullname)||e.assignee}),(0,n.jsx)(B.Z,{children:e.start_date||"—"}),(0,n.jsx)(B.Z,{children:e.end_date||"—"})]},e.id)})})]}):(0,n.jsx)(d.Z,{children:(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(l("tasks.view.parts.empty"))})})]})})}var M=a(30202),F=a(33934),T=a(14934),A=a(47407),q=a(19304),R=a(21038),W=a(52857),V=a(87590),E=a(32200),L=a(61769),O=a(21201);let G=e=>{let t=(e.title||"").trim();if(t)return t;let a=(e.file||"").trim();if(!a)return"Fayl #".concat(e.id);try{let e=a.split("?")[0],t=e.split("/");return decodeURIComponent(t[t.length-1]||e)}catch(e){return a}},H=e=>{let t=(e||"").toLowerCase().split("?")[0],a=t.split(".").pop();return a&&a!==t?a:""},K=e=>{switch(e){case"pdf":return"tabler:file-type-pdf";case"doc":case"docx":return"tabler:file-type-doc";case"xls":case"xlsx":return"tabler:file-type-xls";case"ppt":case"pptx":return"tabler:file-type-ppt";case"png":case"jpg":case"jpeg":case"webp":case"gif":return"tabler:photo";case"zip":case"rar":case"7z":return"tabler:archive";default:return"tabler:file"}};function Y(e){let{taskId:t,partId:a,isCompact:r}=e,{t:l}=(0,z.$G)(),{data:p,isLoading:x,isError:h}=(0,F.a)({queryKey:["task-attachments",t,void 0===a?"all":a],queryFn:async()=>{let e={task:t,perPage:50};return void 0!==a&&(e.part=null===a?"":a),(await f.Do.get(b.Z.taskAttachment,e)).data||{results:[]}},enabled:!!t||!!a,staleTime:1e4}),g=(null==p?void 0:p.results)||[];return x?(0,n.jsxs)(c.Z,{spacing:2,children:[(0,n.jsx)(T.Z,{variant:"text",width:"30%"}),(0,n.jsx)(T.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,n.jsx)(T.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,n.jsx)(T.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}})]}):h?(0,n.jsx)(u.Z,{variant:"body2",color:"error",children:String(l("tasks.view.attachments.loadError"))}):g.length?r?(0,n.jsx)(o.Z,{variant:"outlined",sx:{mb:2},children:(0,n.jsx)(d.Z,{sx:{py:"0.75rem !important"},children:(0,n.jsxs)(c.Z,{direction:"row",spacing:3,alignItems:"center",flexWrap:"wrap",useFlexGap:!0,children:[(0,n.jsxs)(u.Z,{variant:"subtitle2",sx:{mr:2},children:[String(l("tasks.view.attachments.title")),":"]}),g.map(e=>{let t=G(e),a=K(H(e.file||e.title)),i=e.file||"#";return(0,n.jsx)(m.Z,{icon:(0,n.jsx)(j.Z,{icon:a}),label:t,component:"a",href:i,target:"_blank",clickable:!0,size:"small",variant:"outlined",color:"primary"},e.id)})]})})}):(0,n.jsx)(o.Z,{children:(0,n.jsxs)(d.Z,{children:[(0,n.jsxs)(s.Z,{sx:{mb:2,display:"flex",alignItems:"center",justifyContent:"space-between",gap:2},children:[(0,n.jsx)(u.Z,{variant:"subtitle2",children:String(l("tasks.view.attachments.title"))}),(0,n.jsx)(m.Z,{size:"small",color:"info",label:String(l("tasks.view.attachments.count",{count:g.length}))})]}),(0,n.jsx)(A.Z,{disablePadding:!0,children:g.map((e,t)=>{var a;let r=G(e),s=H(e.file||e.title),o=K(s),d=e.created_at?new Date(e.created_at).toLocaleString():"",p=e.file||"#";return(0,n.jsxs)(i.Fragment,{children:[(0,n.jsxs)(q.ZP,{disableGutters:!0,secondaryAction:p&&"#"!==p?(0,n.jsx)(R.Z,{title:String(l("tasks.view.attachments.openOrDownload")),children:(0,n.jsx)(W.Z,{component:"a",href:p,target:"_blank",rel:"noreferrer",children:(0,n.jsx)(j.Z,{icon:"tabler:download"})})}):null,sx:{py:1.25,px:1,borderRadius:2,"&:hover":{backgroundColor:e=>e.palette.action.hover}},children:[(0,n.jsx)(V.Z,{children:(0,n.jsx)(O.Z,{variant:"rounded",sx:{width:40,height:40,bgcolor:e=>e.palette.action.selected,color:"text.primary"},children:(0,n.jsx)(j.Z,{icon:o})})}),(0,n.jsx)(E.Z,{primary:(0,n.jsxs)(c.Z,{direction:"row",spacing:1,sx:{alignItems:"center",flexWrap:"wrap",rowGap:1},children:[p&&"#"!==p?(0,n.jsx)(L.Z,{href:p,target:"_blank",rel:"noreferrer",underline:"hover",color:"inherit",children:(0,n.jsx)(u.Z,{variant:"subtitle2",sx:{fontWeight:600},children:r})}):(0,n.jsx)(u.Z,{variant:"subtitle2",sx:{fontWeight:600},children:r}),s?(0,n.jsx)(m.Z,{size:"small",variant:"outlined",label:s.toUpperCase()}):null,e.part?(0,n.jsx)(m.Z,{size:"small",variant:"outlined",label:String(l("tasks.view.attachments.partLabel",{id:e.part}))}):null]}),secondary:(0,n.jsxs)(c.Z,{direction:"row",spacing:1,sx:{alignItems:"center",flexWrap:"wrap",rowGap:.5},children:[d?(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:d}):null,"number"==typeof e.uploaded_by?(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:String(l("tasks.view.attachments.uploader",{id:e.uploaded_by}))}):null]})})]}),t<g.length-1?(0,n.jsx)(y.Z,{sx:{my:1}}):null]},null!==(a=e.id)&&void 0!==a?a:t)})})]})}):r?null:(0,n.jsx)(o.Z,{children:(0,n.jsx)(d.Z,{children:(0,n.jsx)(s.Z,{sx:{py:2},children:(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(l("tasks.view.attachments.empty"))})})})})}let Q=e=>{var t,a;let n=(e||"").trim();if(!n)return"?";let i=n.split(" ").filter(Boolean);return(((null===(t=i[0])||void 0===t?void 0:t[0])||"")+((null===(a=i[1])||void 0===a?void 0:a[0])||"")).toUpperCase()||n[0].toUpperCase()};function $(e){let{taskId:t,partId:a}=e,{t:r}=(0,z.$G)(),{data:l,isLoading:p,isError:x}=(0,F.a)({queryKey:["task-comments",t,null!=a?a:null],queryFn:async()=>{let e={task:null!=t?t:"",perPage:50};return null!=a&&(e.part=a),(await f.Do.get(b.Z.taskComment,e)).data||{results:[]}},enabled:!!t||!!a,staleTime:1e4}),h=(null==l?void 0:l.results)||[];return p?(0,n.jsxs)(c.Z,{spacing:2,children:[(0,n.jsx)(T.Z,{variant:"text",width:"25%"}),(0,n.jsx)(T.Z,{variant:"rectangular",height:72,sx:{borderRadius:2}}),(0,n.jsx)(T.Z,{variant:"rectangular",height:72,sx:{borderRadius:2}}),(0,n.jsx)(T.Z,{variant:"rectangular",height:72,sx:{borderRadius:2}})]}):x?(0,n.jsx)(u.Z,{variant:"body2",color:"error",children:String(r("tasks.view.comments.loadError"))}):h.length?(0,n.jsx)(o.Z,{children:(0,n.jsxs)(d.Z,{children:[(0,n.jsxs)(s.Z,{sx:{mb:2,display:"flex",alignItems:"center",justifyContent:"space-between",gap:2},children:[(0,n.jsx)(u.Z,{variant:"subtitle2",children:String(r("tasks.view.comments.title"))}),(0,n.jsx)(m.Z,{size:"small",color:"info",label:String(r("tasks.view.comments.count",{count:h.length}))})]}),(0,n.jsx)(A.Z,{disablePadding:!0,children:h.map((e,t)=>{var a,s;let l=e.created_at?new Date(e.created_at).toLocaleString():"",o=e.is_system?String(r("tasks.view.comments.system")):"".concat(null===(a=e.author_detail)||void 0===a?void 0:a.fullname);return(0,n.jsxs)(i.Fragment,{children:[(0,n.jsxs)(q.ZP,{disableGutters:!0,alignItems:"flex-start",sx:{py:1.25,px:1,borderRadius:2,"&:hover":{backgroundColor:e=>e.palette.action.hover}},children:[(0,n.jsx)(V.Z,{children:(0,n.jsx)(O.Z,{sx:{width:40,height:40,bgcolor:t=>e.is_system?t.palette.grey[200]:t.palette.primary.light,color:t=>e.is_system?t.palette.text.primary:t.palette.primary.contrastText},children:e.is_system?(0,n.jsx)(j.Z,{icon:"tabler:settings"}):Q(o)})}),(0,n.jsx)(E.Z,{primary:(0,n.jsxs)(c.Z,{direction:"row",spacing:1,sx:{alignItems:"center",flexWrap:"wrap",rowGap:1},children:[(0,n.jsx)(u.Z,{variant:"subtitle2",sx:{fontWeight:700},children:o}),e.is_system?(0,n.jsx)(m.Z,{size:"small",color:"default",variant:"outlined",label:String(r("tasks.view.comments.system"))}):null,e.part?(0,n.jsx)(m.Z,{size:"small",variant:"outlined",label:String(r("tasks.view.comments.partLabel",{id:e.part}))}):null,l?(0,n.jsxs)(u.Z,{variant:"caption",sx:{color:"text.disabled"},children:["• ",l]}):null]}),secondary:(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",sx:{mt:.5,whiteSpace:"pre-wrap",wordBreak:"break-word"},children:e.text||"—"})})]}),t<h.length-1?(0,n.jsx)(y.Z,{sx:{my:1}}):null]},null!==(s=e.id)&&void 0!==s?s:t)})})]})}):(0,n.jsx)(o.Z,{children:(0,n.jsx)(d.Z,{children:(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(r("tasks.view.comments.empty"))})})})}var U=a(30381),J=a.n(U),X=a(7879),ee=a(33251),et=a(58898);function ea(e){var t,a,r,s,m,x;let{task:h,selectedPartId:g,setSelectedPartId:v}=e,{t:j}=(0,z.$G)(),C=(0,et.Z)(),I=(0,M.NL)(),{data:P}=(0,ee.z)(b.Z.department,{page:1,perPage:100}),{data:B}=(0,ee.z)(b.Z.users,{page:1,perPage:100,roles__name:"Performer"}),[N,T]=(0,i.useState)(null),[A,q]=(0,i.useState)({title:"",department:0,assignee:0,start_date:"",end_date:"",note:""}),R=null==h?void 0:h.id,{data:W}=(0,F.a)({queryKey:["task-parts",null!=R?R:"none"],enabled:!!R,queryFn:async()=>{let e=(await f.Do.get(b.Z.taskPart,{task:String(R),perPage:100})).data;return(null==e?void 0:e.results)||e||[]},initialData:[]}),V=async()=>{if(N&&R)try{await f.Do.put(b.Z.taskPartById(N.id),{...A,task:R}),C.success(String(j("common.saved"))),T(null),I.invalidateQueries({queryKey:["task-parts",R]})}catch(e){C.error((null==e?void 0:e.message)||String(j("errors.somethingWentWrong")))}},E=async e=>{if(window.confirm(String(j("common.confirmDelete"))))try{await f.Do.delete(b.Z.taskPartById(e)),C.success(String(j("common.deleted"))),I.invalidateQueries({queryKey:["task-parts",R]})}catch(e){C.error((null==e?void 0:e.message)||String(j("errors.somethingWentWrong")))}};if(!h)return(0,n.jsx)(o.Z,{children:(0,n.jsx)(d.Z,{children:(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(j("tasks.view.document.notFound"))})})});let L=e=>{let{label:t,value:a}=e;return(0,n.jsxs)(c.Z,{spacing:.75,children:[(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:t}),(0,n.jsx)(u.Z,{variant:"body2",sx:{wordBreak:"break-word"},children:null!=a?a:"—"})]})};return(0,n.jsxs)(l.ZP,{container:!0,spacing:4,children:[(0,n.jsx)(l.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(o.Z,{children:(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(u.Z,{variant:"subtitle1",sx:{mb:2},children:String(j("tasks.view.document.sections.main"))}),(0,n.jsxs)(l.ZP,{container:!0,spacing:3,children:[(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(L,{label:String(j("tasks.view.document.fields.company")),value:(null===(t=h.company_detail)||void 0===t?void 0:t.name)||h.company})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(L,{label:String(j("tasks.view.document.fields.department")),value:(null===(a=h.department_detail)||void 0===a?void 0:a.name)||h.department})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(L,{label:String(j("tasks.view.document.fields.taskForm")),value:(null===(r=h.task_form_detail)||void 0===r?void 0:r.name)||h.task_form})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(L,{label:String(j("tasks.view.document.fields.magazine")),value:(null===(s=h.list_of_magazine_detail)||void 0===s?void 0:s.name)||h.list_of_magazine})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(L,{label:String(j("tasks.view.document.fields.signedBy")),value:(null===(m=h.signed_by_detail)||void 0===m?void 0:m.fullname)||h.signed_by})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(L,{label:String(j("tasks.view.document.fields.responsiblePerson")),value:null!==(x=h.sending_respon_person)&&void 0!==x?x:"—"})})]})]})})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(o.Z,{children:(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(u.Z,{variant:"subtitle1",sx:{mb:2},children:String(j("tasks.view.document.sections.dates"))}),(0,n.jsxs)(l.ZP,{container:!0,spacing:3,children:[(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(L,{label:String(j("tasks.view.document.fields.startDate")),value:h.start_date})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(L,{label:String(j("tasks.view.document.fields.endDate")),value:h.end_date})})]}),(0,n.jsx)(y.Z,{sx:{my:3}}),(0,n.jsx)(u.Z,{variant:"subtitle1",sx:{mb:2},children:String(j("tasks.view.document.sections.system"))}),(0,n.jsxs)(l.ZP,{container:!0,spacing:3,children:[(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(L,{label:String(j("tasks.view.document.fields.createdAt")),value:J()(h.created_time).format("DD.MM.YYYY HH:mm")})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(L,{label:String(j("tasks.view.document.fields.createdBy")),value:h.created_by})})]})]})})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(Y,{taskId:h.id,partId:null,isCompact:!0})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(D,{parts:W,selectedPartId:g,setSelectedPartId:v,onDelete:E,onEdit:e=>{let t=W.find(t=>t.id===e);t&&(T(t),q({title:t.title,department:t.department,assignee:t.assignee,start_date:t.start_date,end_date:t.end_date,note:t.note}))}})}),g&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(Y,{taskId:null,partId:g})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)($,{taskId:null,partId:g})})]}),(0,n.jsxs)(w.Z,{open:!!N,onClose:()=>T(null),maxWidth:"sm",fullWidth:!0,children:[(0,n.jsx)(k.Z,{children:String(j("tasks.parts.dialog.title"))}),(0,n.jsx)(Z.Z,{children:(0,n.jsxs)(l.ZP,{container:!0,spacing:2,sx:{mt:1},children:[(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(X.Z,{fullWidth:!0,label:String(j("tasks.parts.form.title")),value:A.title,onChange:e=>q({...A,title:e.target.value})})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(S.Z,{fullWidth:!0,options:P||[],getOptionLabel:e=>e.name,value:(null==P?void 0:P.find(e=>e.id===A.department))||null,onChange:(e,t)=>q({...A,department:(null==t?void 0:t.id)||0}),renderInput:e=>(0,n.jsx)(X.Z,{...e,label:String(j("tasks.parts.form.department")),placeholder:String(j("common.selectPlaceholder"))})})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(S.Z,{fullWidth:!0,options:B||[],getOptionLabel:e=>e.fullname,value:(null==B?void 0:B.find(e=>e.id===A.assignee))||null,onChange:(e,t)=>q({...A,assignee:(null==t?void 0:t.id)||0}),renderInput:e=>(0,n.jsx)(X.Z,{...e,label:String(j("tasks.parts.form.assignee")),placeholder:String(j("common.selectPlaceholder"))})})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(X.Z,{fullWidth:!0,type:"date",label:String(j("tasks.parts.form.startDate")),value:A.start_date,onChange:e=>q({...A,start_date:e.target.value}),InputLabelProps:{shrink:!0}})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(X.Z,{fullWidth:!0,type:"date",label:String(j("tasks.parts.form.endDate")),value:A.end_date,onChange:e=>q({...A,end_date:e.target.value}),InputLabelProps:{shrink:!0}})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(X.Z,{fullWidth:!0,multiline:!0,rows:3,label:String(j("tasks.parts.form.note")),value:A.note,onChange:e=>q({...A,note:e.target.value})})})]})}),(0,n.jsxs)(_.Z,{children:[(0,n.jsx)(p.Z,{onClick:()=>T(null),children:String(j("common.cancel"))}),(0,n.jsx)(p.Z,{variant:"contained",onClick:V,children:String(j("common.save"))})]})]})]})}var en=a(34273),ei=a(1954);function er(e){var t,a,r,l,d,c,u,m,x,h,g,v,j,b,f,y,S,C,I,P,B,N,D,M,F,T;let{fullTask:A}=e,q=(0,i.useRef)(null),R=(0,i.useRef)(!1),{t:W}=(0,z.$G)(),[V,E]=(0,i.useState)(!1),L=Math.round(495.0251889168766),O=(0,i.useMemo)(()=>Math.min(.44080604534005036,L/1123),[1123,794,L,350]),G=e=>{if(!e)return"—";let t="documents.status.".concat(e.split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")),a=String(W(t));return a===t?e:a},H=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"—";let a=J()(e);return a.isValid()?a.format(t?"DD.MM.YYYY HH:mm":"DD.MM.YYYY"):"—"},K=()=>'\n    @page { size: A4; margin: 12mm; }\n    html, body { margin: 0; padding: 0; background: #fff; }\n    body { -webkit-print-color-adjust: exact; print-color-adjust: exact; color: #111827; font: 12pt/1.45 "Times New Roman", Times, serif; }\n\n    .print-paper{\n      width:210mm; min-height:297mm; box-sizing:border-box;\n      padding:14mm 12mm; margin:0 auto; background:#fff;\n    }\n\n    .doc-topline{ height: 6px; background: #0F172A; border-radius: 999px; margin-bottom: 10mm; }\n    .doc-header{ display:flex; align-items:center; justify-content:space-between; gap: 12mm; }\n    .doc-header-left{ display:flex; align-items:center; gap: 6mm; min-width: 50mm; }\n    .doc-logo{ width: 22mm; height: 22mm; object-fit: contain; }\n    .doc-company{ font-weight: 700; font-size: 18pt; text-align:center; flex:1; }\n    .doc-header-right{ min-width: 50mm; text-align:right; font-size: 11pt; color: #334155; }\n\n    .doc-subline{ border-top: 1px solid #CBD5E1; margin: 6mm 0 8mm; }\n\n    .section-title{ font-weight: 700; font-size: 13pt; margin: 0 0 3mm; }\n    .meta-grid{ display:grid; grid-template-columns: 1fr 1fr; gap: 3mm 10mm; margin-bottom: 8mm; }\n    .meta-row{ display:flex; gap: 4mm; }\n    .meta-label{ width: 40mm; font-weight: 700; color: #0F172A; }\n    .meta-value{ flex: 1; color: #111827; }\n\n    .note-box{ border: 1px solid #E2E8F0; border-radius: 6px; padding: 4mm; background: #F8FAFC; white-space: pre-wrap; }\n\n    table.parts-table{ width:100%; border-collapse: collapse; margin-top: 4mm; font-size: 11pt; }\n    .parts-table th, .parts-table td{ border: 1px solid #E2E8F0; padding: 3mm 2.5mm; vertical-align: top; }\n    .parts-table th{ background: #F1F5F9; color:#0F172A; font-weight:700; text-align:left; }\n    .parts-table td{ color:#111827; }\n    .muted{ color:#64748B; }\n\n    .doc-footer{ margin-top: 10mm; display:flex; justify-content:space-between; gap: 10mm; font-size: 10.5pt; color:#334155; }\n    .no-print, [data-no-print] { display: none !important; }\n  ',Y=e=>{let t=q.current;if(!t||R.current)return;R.current=!0;let a=t.querySelector(".print-paper"),n=a?a.innerHTML:t.innerHTML,i=null;try{i=window.open("","_blank","height=900,width=900")}catch(e){console.error("window.open failed",e)}if(!i){R.current=!1;return}try{i.opener=null}catch(e){}let r=K();try{i.document.open(),i.document.write('<!doctype html><html><head><meta charset="utf-8"><title>'.concat(String(W("tasks.view.document.header.overline",{defaultValue:"Document"})),"</title><style>").concat(r,'</style></head><body><div class="print-paper">').concat(n,"</div></body></html>")),i.document.close()}catch(e){console.error("Failed to write to print window",e);try{i.close()}catch(e){}R.current=!1;return}setTimeout(()=>{try{if(!i||i.closed)return;i.focus(),e&&i.print()}catch(e){console.error("Print failed",e)}finally{R.current=!1}},800)};return(0,n.jsx)(o.Z,{children:(0,n.jsxs)(s.Z,{ref:q,children:[(0,n.jsx)("style",{children:'\n          /* Screen preview shell (dialog) */\n          .doc-preview-shell{\n            padding: 14px 10px 16px;\n            background: radial-gradient(1200px 400px at 50% 0%, rgba(99,102,241,0.08), rgba(15,23,42,0) 60%),\n                        linear-gradient(180deg, rgba(15,23,42,0.02), rgba(15,23,42,0.06));\n            border-radius: 14px;\n            overflow: auto;\n          }\n          .print-paper{\n            box-sizing: border-box;\n            background: #fff;\n            border-radius: 10px;\n            box-shadow: 0 14px 32px rgba(15, 23, 42, 0.12), 0 2px 8px rgba(15, 23, 42, 0.06);\n            overflow: hidden;\n            border: 1px solid rgba(15, 23, 42, 0.08);\n            padding: 44px 42px;\n            color: #111827;\n            font: 14px/1.5 "Times New Roman", Times, serif;\n          }\n\n          .doc-topline{ height: 6px; background: #0F172A; border-radius: 999px; margin-bottom: 28px; }\n          .doc-header{ display:flex; align-items:center; justify-content:space-between; gap: 34px; }\n          .doc-header-left{ display:flex; align-items:center; gap: 16px; min-width: 180px; }\n          .doc-logo{ width: 64px; height: 64px; object-fit: contain; }\n          .doc-company{ font-weight: 700; font-size: 24px; text-align:center; flex:1; }\n          .doc-header-right{ min-width: 180px; text-align:right; font-size: 12px; color: #475569; }\n          .doc-subline{ border-top: 1px solid rgba(148, 163, 184, 0.55); margin: 18px 0 22px; }\n\n          .section-title{ font-weight: 700; font-size: 16px; margin: 0 0 8px; }\n          .meta-grid{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px 28px; margin-bottom: 18px; }\n          .meta-row{ display:flex; gap: 12px; }\n          .meta-label{ width: 140px; font-weight: 700; color: #0F172A; }\n          .meta-value{ flex:1; color: #111827; }\n          .note-box{ border: 1px solid rgba(148, 163, 184, 0.45); border-radius: 10px; padding: 12px; background: rgba(248, 250, 252, 1); white-space: pre-wrap; }\n\n          table.parts-table{ width:100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }\n          .parts-table th, .parts-table td{ border: 1px solid rgba(226, 232, 240, 1); padding: 9px 8px; vertical-align: top; }\n          .parts-table th{ background: rgba(241, 245, 249, 1); color:#0F172A; font-weight:700; text-align:left; }\n          .parts-table td{ color:#111827; }\n          .muted{ color:#64748B; }\n          .doc-footer{ margin-top: 22px; display:flex; justify-content:space-between; gap: 20px; font-size: 12px; color:#475569; }\n\n          /* Thumbnail */\n          .doc-thumb{\n            width:'.concat(350,"px;\n            height:").concat(L,"px;\n            border-radius: 12px;\n            overflow: hidden;\n            cursor: pointer;\n            position: relative;\n            background: rgba(15,23,42,0.03);\n            border: 1px solid rgba(15,23,42,0.10);\n            box-shadow: 0 10px 24px rgba(15, 23, 42, 0.10), 0 1px 6px rgba(15, 23, 42, 0.06);\n          }\n          .doc-thumb-overlay{\n            position:absolute;\n            inset:auto 6px 6px 6px;\n            display:flex;\n            align-items:center;\n            justify-content:space-between;\n            gap: 8px;\n            padding: 6px 8px;\n            border-radius: 10px;\n            background: rgba(15, 23, 42, 0.70);\n            color: #fff;\n            font: 12px/1.2 Arial, Helvetica, sans-serif;\n          }\n          .doc-thumb-overlay span{ opacity: 0.92; }\n        ")}),(0,n.jsxs)(s.Z,{sx:{p:2},children:[(0,n.jsxs)("div",{className:"doc-thumb",onClick:()=>E(!0),role:"button",tabIndex:0,children:[(0,n.jsx)("div",{style:{width:"".concat(794*O,"px"),height:"".concat(1123*O,"px")},children:(0,n.jsxs)("div",{className:"print-paper",style:{width:"".concat(794,"px"),minHeight:"".concat(1123,"px"),transform:"scale(".concat(O,")"),transformOrigin:"top left"},children:[(0,n.jsx)("div",{className:"doc-topline"}),(0,n.jsxs)("div",{className:"doc-header",children:[(0,n.jsx)("div",{className:"doc-header-left",children:(0,n.jsx)("img",{className:"doc-logo",src:"/logo.svg",alt:"Logo"})}),(0,n.jsx)("div",{className:"doc-company",children:(null==A?void 0:null===(a=A.task)||void 0===a?void 0:null===(t=a.company_detail)||void 0===t?void 0:t.name)||"—"}),(0,n.jsxs)("div",{className:"doc-header-right",children:[(0,n.jsx)("div",{className:"muted",children:String(W("tasks.view.document.fields.inputDocNumber",{defaultValue:"Incoming number"}))}),(0,n.jsxs)("div",{style:{fontWeight:700,color:"#0F172A"},children:["№",null!==(D=null==A?void 0:null===(r=A.task)||void 0===r?void 0:r.input_doc_number)&&void 0!==D?D:"—"]})]})]}),(0,n.jsx)("div",{className:"doc-subline"}),(0,n.jsx)("div",{className:"section-title",children:String(W("tasks.view.document.sections.main",{defaultValue:"Main information"}))}),(0,n.jsxs)("div",{className:"meta-grid",children:[(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(W("tasks.view.document.fields.signedBy",{defaultValue:"Signed by"}))}),(0,n.jsx)("div",{className:"meta-value",children:(null==A?void 0:null===(d=A.task)||void 0===d?void 0:null===(l=d.signed_by_detail)||void 0===l?void 0:l.fullname)||"—"})]}),(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(W("tasks.view.document.fields.signedDate",{defaultValue:"Signed date"}))}),(0,n.jsx)("div",{className:"meta-value",children:H(null==A?void 0:null===(c=A.task)||void 0===c?void 0:c.signed_date)})]}),(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(W("tasks.view.actions.partStatus",{defaultValue:"Status"}))}),(0,n.jsx)("div",{className:"meta-value",children:G(null==A?void 0:null===(u=A.task)||void 0===u?void 0:u.status)})]}),(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(W("tasks.view.actions.deadline",{defaultValue:"Deadline"}))}),(0,n.jsx)("div",{className:"meta-value",children:H(null==A?void 0:null===(m=A.task)||void 0===m?void 0:m.end_date)})]})]}),(0,n.jsx)("div",{className:"section-title",children:String(W("tasks.view.document.sections.note",{defaultValue:"Note"}))}),(0,n.jsx)("div",{className:"note-box",children:(null==A?void 0:null===(x=A.task)||void 0===x?void 0:x.note)||"—"}),(0,n.jsx)("div",{style:{height:18}}),(0,n.jsx)("div",{className:"section-title",children:String(W("tasks.view.document.sections.parts",{defaultValue:"Parts"}))}),(0,n.jsxs)("table",{className:"parts-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{style:{width:"18%"},children:String(W("tasks.view.parts.table.assignee",{defaultValue:"Assignee"}))}),(0,n.jsx)("th",{style:{width:"18%"},children:String(W("tasks.view.parts.table.department",{defaultValue:"Department"}))}),(0,n.jsx)("th",{style:{width:"12%"},children:String(W("tasks.view.document.fields.startDate",{defaultValue:"Start date"}))}),(0,n.jsx)("th",{style:{width:"12%"},children:String(W("tasks.view.document.fields.endDate",{defaultValue:"End date"}))}),(0,n.jsx)("th",{style:{width:"12%"},children:String(W("tasks.view.actions.partStatus",{defaultValue:"Status"}))}),(0,n.jsx)("th",{children:String(W("tasks.form.note",{defaultValue:"Note"}))})]})}),(0,n.jsx)("tbody",{children:((null==A?void 0:A.parts)||[]).map(e=>{var t,a;return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(null===(t=e.assignee_detail)||void 0===t?void 0:t.fullname)||"—"}),(0,n.jsx)("td",{children:(null===(a=e.department_detail)||void 0===a?void 0:a.name)||"—"}),(0,n.jsx)("td",{children:H(e.start_date)}),(0,n.jsx)("td",{children:H(e.end_date)}),(0,n.jsx)("td",{children:G(e.status)}),(0,n.jsx)("td",{children:e.note||"—"})]},e.id)})})]}),(0,n.jsxs)("div",{className:"doc-footer",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"muted",children:String(W("common.createdAt",{defaultValue:"Created at"}))}),(0,n.jsx)("div",{children:H(null==A?void 0:null===(h=A.task)||void 0===h?void 0:h.created_time,!0)})]}),(0,n.jsxs)("div",{style:{textAlign:"right"},children:[(0,n.jsx)("div",{className:"muted",children:String(W("tasks.view.document.header.overline",{defaultValue:"Document"}))}),(0,n.jsx)("div",{style:{fontWeight:700,color:"#0F172A"},children:String(W("tasks.view.document.header.fallbackTitle",{id:null!==(M=null==A?void 0:null===(g=A.task)||void 0===g?void 0:g.id)&&void 0!==M?M:"—",defaultValue:"Task #{{id}}"}))})]})]})]})}),(0,n.jsxs)("div",{className:"doc-thumb-overlay",children:[(0,n.jsx)("span",{children:String(W("tasks.view.document.actions.openPdf",{defaultValue:"Open PDF view"}))}),(0,n.jsx)(ei.JO,{icon:"tabler:zoom-in"})]})]}),(0,n.jsxs)(w.Z,{open:V,onClose:()=>E(!1),maxWidth:"lg",fullWidth:!0,children:[(0,n.jsx)(k.Z,{children:String(W("tasks.view.document.header.overline",{defaultValue:"Document"}))}),(0,n.jsx)(Z.Z,{dividers:!0,children:(0,n.jsx)(s.Z,{className:"doc-preview-shell",children:(0,n.jsx)(s.Z,{sx:{width:"".concat(Math.round(714.6),"px"),minHeight:"".concat(Math.round(1010.7),"px"),margin:"0 auto"},children:(0,n.jsx)("div",{style:{width:"".concat(714.6,"px"),minHeight:"".concat(1010.7,"px")},children:(0,n.jsxs)("div",{className:"print-paper",style:{width:"".concat(794,"px"),minHeight:"".concat(1123,"px"),transform:"scale(".concat(.9,")"),transformOrigin:"top left"},children:[(0,n.jsx)("div",{className:"doc-topline"}),(0,n.jsxs)("div",{className:"doc-header",children:[(0,n.jsx)("div",{className:"doc-header-left",children:(0,n.jsx)("img",{className:"doc-logo",src:"/logo.svg",alt:"Logo"})}),(0,n.jsx)("div",{className:"doc-company",children:(null==A?void 0:null===(j=A.task)||void 0===j?void 0:null===(v=j.company_detail)||void 0===v?void 0:v.name)||"—"}),(0,n.jsxs)("div",{className:"doc-header-right",children:[(0,n.jsx)("div",{className:"muted",children:String(W("tasks.view.document.fields.inputDocNumber",{defaultValue:"Incoming number"}))}),(0,n.jsxs)("div",{style:{fontWeight:700,color:"#0F172A"},children:["№",null!==(F=null==A?void 0:null===(b=A.task)||void 0===b?void 0:b.input_doc_number)&&void 0!==F?F:"—"]})]})]}),(0,n.jsx)("div",{className:"doc-subline"}),(0,n.jsx)("div",{className:"section-title",children:String(W("tasks.view.document.sections.main",{defaultValue:"Main information"}))}),(0,n.jsxs)("div",{className:"meta-grid",children:[(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(W("tasks.view.document.fields.signedBy",{defaultValue:"Signed by"}))}),(0,n.jsx)("div",{className:"meta-value",children:(null==A?void 0:null===(y=A.task)||void 0===y?void 0:null===(f=y.signed_by_detail)||void 0===f?void 0:f.fullname)||"—"})]}),(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(W("tasks.view.document.fields.signedDate",{defaultValue:"Signed date"}))}),(0,n.jsx)("div",{className:"meta-value",children:H(null==A?void 0:null===(S=A.task)||void 0===S?void 0:S.signed_date)})]}),(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(W("tasks.view.actions.partStatus",{defaultValue:"Status"}))}),(0,n.jsx)("div",{className:"meta-value",children:G(null==A?void 0:null===(C=A.task)||void 0===C?void 0:C.status)})]}),(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(W("tasks.view.actions.deadline",{defaultValue:"Deadline"}))}),(0,n.jsx)("div",{className:"meta-value",children:H(null==A?void 0:null===(I=A.task)||void 0===I?void 0:I.end_date)})]})]}),(0,n.jsx)("div",{className:"section-title",children:String(W("tasks.view.document.sections.note",{defaultValue:"Note"}))}),(0,n.jsx)("div",{className:"note-box",children:(null==A?void 0:null===(P=A.task)||void 0===P?void 0:P.note)||"—"}),(0,n.jsx)("div",{style:{height:18}}),(0,n.jsx)("div",{className:"section-title",children:String(W("tasks.view.document.sections.parts",{defaultValue:"Parts"}))}),(0,n.jsxs)("table",{className:"parts-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{style:{width:"18%"},children:String(W("tasks.view.parts.table.assignee",{defaultValue:"Assignee"}))}),(0,n.jsx)("th",{style:{width:"18%"},children:String(W("tasks.view.parts.table.department",{defaultValue:"Department"}))}),(0,n.jsx)("th",{style:{width:"12%"},children:String(W("tasks.view.document.fields.startDate",{defaultValue:"Start date"}))}),(0,n.jsx)("th",{style:{width:"12%"},children:String(W("tasks.view.document.fields.endDate",{defaultValue:"End date"}))}),(0,n.jsx)("th",{style:{width:"12%"},children:String(W("tasks.view.actions.partStatus",{defaultValue:"Status"}))}),(0,n.jsx)("th",{children:String(W("tasks.form.note",{defaultValue:"Note"}))})]})}),(0,n.jsx)("tbody",{children:((null==A?void 0:A.parts)||[]).map(e=>{var t,a;return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(null===(t=e.assignee_detail)||void 0===t?void 0:t.fullname)||"—"}),(0,n.jsx)("td",{children:(null===(a=e.department_detail)||void 0===a?void 0:a.name)||"—"}),(0,n.jsx)("td",{children:H(e.start_date)}),(0,n.jsx)("td",{children:H(e.end_date)}),(0,n.jsx)("td",{children:G(e.status)}),(0,n.jsx)("td",{children:e.note||"—"})]},e.id)})})]}),(0,n.jsxs)("div",{className:"doc-footer",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"muted",children:String(W("common.createdAt",{defaultValue:"Created at"}))}),(0,n.jsx)("div",{children:H(null==A?void 0:null===(B=A.task)||void 0===B?void 0:B.created_time,!0)})]}),(0,n.jsxs)("div",{style:{textAlign:"right"},children:[(0,n.jsx)("div",{className:"muted",children:String(W("tasks.view.document.header.overline",{defaultValue:"Document"}))}),(0,n.jsx)("div",{style:{fontWeight:700,color:"#0F172A"},children:String(W("tasks.view.document.header.fallbackTitle",{id:null!==(T=null==A?void 0:null===(N=A.task)||void 0===N?void 0:N.id)&&void 0!==T?T:"—",defaultValue:"Task #{{id}}"}))})]})]})]})})})})}),(0,n.jsxs)(_.Z,{children:[(0,n.jsx)(p.Z,{onClick:()=>Y(!1),startIcon:(0,n.jsx)(ei.JO,{icon:"tabler:file-type-pdf"}),children:String(W("tasks.view.document.actions.openPdf",{defaultValue:"Open PDF view"}))}),(0,n.jsx)(p.Z,{onClick:()=>Y(!0),variant:"contained",startIcon:(0,n.jsx)(ei.JO,{icon:"tabler:printer"}),children:String(W("tasks.view.document.actions.print",{defaultValue:"Print / Save as PDF"}))}),(0,n.jsx)(p.Z,{onClick:()=>E(!1),children:String(W("common.close",{defaultValue:"Close"}))})]})]})]})]})})}var es=a(37958),el=a(77527),eo=a(86501);a(80135);var ed=a(1652),ec=a(73138),eu=a(9041);let ep=(0,el.ZP)(s.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(6),justifyContent:"space-between"}});var em=e=>{var t,a,r;let{open:l,toggle:o,taskId:d,partId:c,part:m,task:x}=e,{user:h}=(0,en.a)(),{t:g}=(0,z.$G)(),[v,y]=i.useState(eu.EditorState.createEmpty()),[w,k]=i.useState([]),[Z,S]=i.useState(!1),[_,D]=i.useState({comment:"",file:""}),M=e=>k(t=>t.filter((t,a)=>a!==e)),F=(e,t)=>k(a=>a.map((a,n)=>n===e?{...a,title:t}:a)),T=(e,t)=>k(a=>a.map((a,n)=>n===e?{...a,file:t}:a));i.useEffect(()=>{l&&0===w.length&&k([{title:"",file:null}])},[l]);let A=()=>{y(eu.EditorState.createEmpty()),k([]),D({comment:"",file:""})},q=async()=>{if(!d){eo.ZP.error(String(g("tasks.view.actions.toasts.taskRequired")||"Task id required"));return}let e=v.getCurrentContent().hasText(),t=w.some(e=>e.file);if(e)D(e=>({...e,comment:""}));else{D(e=>({...e,comment:String(g("tasks.view.actions.toasts.commentRequired")||"Comment is required")}));return}if(t)D(e=>({...e,file:""}));else{D(e=>({...e,file:String(g("tasks.view.actions.toasts.fileRequired")||"File is required")}));return}try{if(S(!0),e&&await f.Do.post(b.Z.taskComment,{part:null!=c?c:null,author:null==h?void 0:h.id,text:v.getCurrentContent().getPlainText()}),t){let e=w.filter(e=>e.file&&e.title.trim().length);if(!e.length){eo.ZP.error(String(g("tasks.view.actions.toasts.fileAndTitleRequired")||"File and title are required"));return}for(let t of e){var a,n;let e=new FormData;t.file&&e.append("file",t.file),e.append("title",t.title.trim()),e.append("part",c?c.toString():""),e.append("uploaded_by",null!==(n=null==h?void 0:null===(a=h.id)||void 0===a?void 0:a.toString())&&void 0!==n?n:""),await f.Do.postForm(b.Z.taskAttachment,e)}}await f.Do.patch(b.Z.taskPartById(null!=c?c:null),{status:"on_review",task:d}),eo.ZP.success(String(g("tasks.view.actions.toasts.saved")||"Saved")),A(),o()}catch(e){console.error("Failed to submit combined from drawer",e),eo.ZP.error(String(g("tasks.view.actions.toasts.saveError")||"Failed to save"))}finally{S(!1),A()}},V=async()=>{if(v.getCurrentContent().hasText())D(e=>({...e,comment:""}));else{D(e=>({...e,comment:String(g("tasks.view.actions.toasts.commentRequired")||"Comment is required")}));return}try{S(!0),await f.Do.patch(b.Z.taskPartById(null!=c?c:null),{status:"returned",task:d}),eo.ZP.success(String(g("tasks.view.actions.toasts.resend")||"Resend"))}catch(e){console.error("Failed to resend combined",e),eo.ZP.error(String(g("tasks.view.actions.toasts.resendError")||"Failed to resend"))}finally{S(!1),A(),o()}},E=async()=>{if(v.getCurrentContent().hasText())D(e=>({...e,comment:""}));else{D(e=>({...e,comment:String(g("tasks.view.actions.toasts.commentRequired")||"Comment is required")}));return}try{S(!0),await f.Do.patch(b.Z.taskPartById(null!=c?c:null),{status:"cancelled",task:d}),eo.ZP.success(String(g("tasks.view.actions.toasts.cancel")||"Cancel"))}catch(e){console.error("Failed to cancel combined",e)}finally{S(!1),A(),o()}},L=async()=>{if(v.getCurrentContent().hasText())D(e=>({...e,comment:""}));else{D(e=>({...e,comment:String(g("tasks.view.actions.toasts.commentRequired")||"Comment is required")}));return}try{S(!0),await f.Do.patch(b.Z.taskPartById(null!=c?c:null),{status:"done",task:d}),eo.ZP.success(String(g("tasks.view.actions.toasts.done")||"Done"))}catch(e){console.error("Failed to complete combined",e)}finally{S(!1),A(),o()}};return(0,n.jsxs)(es.ZP,{open:l,anchor:"right",variant:"temporary",onClose:o,sx:{"& .MuiDrawer-paper":{width:[420,760]}},ModalProps:{keepMounted:!0},children:[(0,n.jsxs)(ep,{children:[(0,n.jsx)(u.Z,{variant:"h5",children:String(g("tasks.view.actions.drawerTitle")||"Send / Execute")}),(0,n.jsx)(W.Z,{size:"small",onClick:o,sx:{p:"0.375rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:e=>"rgba(".concat(e.palette.customColors.main,", 0.16)")}},children:(0,n.jsx)(j.Z,{icon:"tabler:x",fontSize:"1.25rem"})})]}),(0,n.jsx)(s.Z,{sx:{p:e=>e.spacing(0,6,6)},children:(0,n.jsxs)(s.Z,{children:[(null==h?void 0:h.id)===(null==m?void 0:null===(t=m.assignee_detail)||void 0===t?void 0:t.id)&&c&&((null==m?void 0:m.status)==="new"||(null==m?void 0:m.status)==="in_progress"||(null==m?void 0:m.status)==="returned")&&(0,n.jsxs)(s.Z,{sx:{my:2,display:"flex",flexDirection:"column",gap:2},children:[(0,n.jsx)(u.Z,{variant:"subtitle2",children:String(g("tasks.view.actions.attachmentDialog.title")||"")}),(0,n.jsxs)(C.Z,{size:"small",children:[(0,n.jsx)(I.Z,{children:(0,n.jsxs)(P.Z,{children:[(0,n.jsx)(B.Z,{children:String(g("common.title")||"Title")}),(0,n.jsx)(B.Z,{children:String(g("common.file")||"File")}),(0,n.jsx)(B.Z,{align:"right",children:String(g("common.actions")||"Actions")})]})}),(0,n.jsx)(N.Z,{children:w.map((e,t)=>(0,n.jsxs)(P.Z,{children:[(0,n.jsx)(B.Z,{sx:{width:"50%"},children:(0,n.jsx)(X.Z,{fullWidth:!0,size:"small",label:String(g("tasks.view.actions.attachmentDialog.titleLabel")||"Attachment title"),value:e.title,onChange:e=>F(t,e.target.value)})}),(0,n.jsxs)(B.Z,{sx:{width:"40%"},children:[(0,n.jsxs)(p.Z,{component:"label",variant:"outlined",size:"small",startIcon:(0,n.jsx)(j.Z,{icon:"tabler:upload"}),children:[String(g("tasks.view.actions.attachmentDialog.chooseFile")||"Choose file"),(0,n.jsx)("input",{hidden:!0,type:"file",onChange:e=>{var a;return T(t,(null===(a=e.target.files)||void 0===a?void 0:a[0])||null)}})]}),(0,n.jsx)(u.Z,{variant:"caption",sx:{display:"block",mt:1},color:"text.secondary",children:e.file?e.file.name:String(g("tasks.view.actions.attachmentDialog.noFileSelected")||"No file selected")})]}),(0,n.jsx)(B.Z,{align:"right",children:(0,n.jsx)(R.Z,{title:String(g("common.delete")||"Delete"),children:(0,n.jsx)(W.Z,{size:"small",color:"error",onClick:()=>M(t),children:(0,n.jsx)(j.Z,{icon:"mdi:delete"})})})})]},t))})]}),(0,n.jsx)(s.Z,{children:(0,n.jsx)(p.Z,{variant:"text",size:"small",startIcon:(0,n.jsx)(j.Z,{icon:"mdi:plus"}),onClick:()=>k(e=>[...e,{title:"",file:null}]),children:String(g("tasks.view.actions.attachmentDialog.addRow")||"Add file")})}),_.file?(0,n.jsx)(u.Z,{color:"error",variant:"caption",sx:{mb:1},children:_.file}):null]}),(0,n.jsxs)(ed.cP,{children:[(0,n.jsx)("div",{style:{marginBottom:8,fontWeight:500},children:String(g("commands.form.basis"))}),(0,n.jsx)(ec.Z,{editorState:v,onEditorStateChange:e=>{y(e)}}),(0,n.jsx)(u.Z,{color:"error",variant:"caption",sx:{mb:1},children:_.comment})]}),(null==h?void 0:h.id)==(null==m?void 0:null===(a=m.assignee_detail)||void 0===a?void 0:a.id)&&c&&((null==m?void 0:m.status)==="new"||(null==m?void 0:m.status)==="in_progress"||(null==m?void 0:m.status)==="returned")&&(0,n.jsxs)(s.Z,{sx:{display:"flex",gap:2,mt:20},children:[(0,n.jsx)(p.Z,{variant:"contained",onClick:q,disabled:Z,children:String(g("tasks.view.actions.drawer.executeCombined")||"Bajarish")}),(0,n.jsx)(p.Z,{variant:"outlined",color:"secondary",onClick:()=>A(),disabled:Z,children:String(g("common.clear")||"Clear")})]}),(null==h?void 0:h.id)===(null==x?void 0:null===(r=x.signed_by_detail)||void 0===r?void 0:r.id)&&c&&(null==m?void 0:m.status)!=="new"&&(null==m?void 0:m.status)!=="in_progress"&&(null==m?void 0:m.status)!=="returned"&&(0,n.jsxs)(s.Z,{sx:{display:"flex",flexWrap:"wrap",gap:2,mt:20},children:[(0,n.jsx)(p.Z,{variant:"contained",color:"warning",onClick:V,disabled:Z,children:String(g("tasks.view.actions.resendForReview")||"Resend for review")}),(0,n.jsx)(p.Z,{variant:"contained",color:"error",onClick:E,disabled:Z,children:String(g("tasks.view.actions.cancel")||String(g("common.cancel"))||"Cancel")}),(0,n.jsx)(p.Z,{variant:"contained",onClick:L,disabled:Z,children:String(g("tasks.view.actions.done")||"Done")})]})]})})]})},ex=a(25026),eh=a(93454);function eg(e){let{parts:t}=e,{t:a}=(0,z.$G)();return(0,n.jsxs)(ex.Z,{component:eh.Z,sx:{boxShadow:1},children:[(0,n.jsxs)(s.Z,{sx:{p:2,borderBottom:e=>"1px solid ".concat(e.palette.divider)},children:[(0,n.jsx)(u.Z,{variant:"subtitle1",children:String(a("tasks.view.parts.title")||"Parts")}),(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:String(a("tasks.view.parts.count",{count:(null==t?void 0:t.length)||0}))})]}),(0,n.jsxs)(C.Z,{size:"small",children:[(0,n.jsx)(I.Z,{children:(0,n.jsxs)(P.Z,{children:[(0,n.jsx)(B.Z,{children:(0,n.jsx)(u.Z,{variant:"body2",sx:{fontSize:10},children:String(a("tasks.view.parts.table.assignee")||"Assignee")})}),(0,n.jsx)(B.Z,{children:(0,n.jsx)(u.Z,{variant:"body2",sx:{fontSize:10},children:String(a("tasks.view.parts.table.start")||"Show date")})}),(0,n.jsx)(B.Z,{children:(0,n.jsx)(u.Z,{variant:"body2",sx:{fontSize:10},children:String(a("tasks.view.parts.table.status")||"Is show")})})]})}),(0,n.jsx)(N.Z,{children:t&&t.length?t.map(e=>{var t;return(0,n.jsxs)(P.Z,{hover:!0,children:[(0,n.jsx)(B.Z,{children:(0,n.jsx)(u.Z,{variant:"body2",sx:{fontSize:12},children:(null===(t=e.assignee_detail)||void 0===t?void 0:t.fullname)||"—"})}),(0,n.jsx)(B.Z,{sx:{fontSize:12},children:e.show_date?J()(e.show_date).format("DD.MM.YYYY"):"—"}),(0,n.jsx)(B.Z,{sx:{fontSize:12},children:e.show_date?(0,n.jsx)(ei.JO,{icon:"tabler:eye"}):(0,n.jsx)(ei.JO,{icon:"tabler:eye-off"})})]},e.id)}):(0,n.jsx)(P.Z,{children:(0,n.jsx)(B.Z,{colSpan:4,align:"center",children:(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(a("tasks.view.parts.empty")||"No parts")})})})})]})]})}var ev=e=>{var t,a;let{task:r,part:l,mutate:x}=e,{t:h}=(0,z.$G)(),{user:g}=(0,en.a)(),[v,j]=i.useState(!1),b=null==r?void 0:r.id,w=null==l?void 0:l.id,k=(0,M.NL)(),Z=async()=>{try{w&&(await k.invalidateQueries({queryKey:["task-part",w],refetchType:"active"}),await k.invalidateQueries({queryKey:["task-comments",w],refetchType:"active"}),await k.invalidateQueries({queryKey:["task-attachments",w],refetchType:"active"}),await k.invalidateQueries({queryKey:["/task/with-parts/by-id/",b],refetchType:"active"}),null==x||x()),b&&(await k.invalidateQueries({queryKey:["task-comments",b],refetchType:"active"}),await k.invalidateQueries({queryKey:["task-attachments",b],refetchType:"active"}),await k.invalidateQueries({queryKey:["/task/with-parts/by-id/",b],refetchType:"active"}),null==x||x())}catch(e){console.error("mutateAndRefresh failed",e)}},{data:S,isLoading:_}=(0,F.a)({queryKey:["/task/with-parts/by-id/",b],queryFn:async()=>{let e={task_id:Number(b)};return(await f.Do.post("/task/with-parts/by-id/",e)).data||{parts:[],task:{id:0,title:"",description:""}}},enabled:!!b,staleTime:1e4});return(0,n.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[_?(0,n.jsx)(T.Z,{variant:"rectangular",height:100}):S&&(0,n.jsx)(er,{fullTask:S}),(0,n.jsx)(o.Z,{children:(0,n.jsx)(d.Z,{children:(0,n.jsxs)(c.Z,{spacing:2,children:[(0,n.jsx)(u.Z,{variant:"subtitle1",children:String(h("tasks.view.actions.title"))}),(0,n.jsx)(y.Z,{}),w?(0,n.jsxs)(c.Z,{spacing:1,children:[(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:String(h("tasks.view.actions.selectedSection"))}),(0,n.jsx)(c.Z,{direction:"row",spacing:1,alignItems:"center",children:(0,n.jsx)(u.Z,{variant:"body2",children:(null==l?void 0:l.title)||String(h("common.notSet"))})}),(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:String(h("tasks.view.actions.partStatus"))}),(0,n.jsx)(c.Z,{direction:"row",spacing:1,alignItems:"center",children:(null==l?void 0:l.status)?(0,n.jsx)(m.Z,{size:"small",color:"info",variant:"outlined",label:(()=>{let e="documents.status.".concat(l.status.split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")),t=String(h(e));return t===e?l.status:t})()}):null}),(null==g?void 0:g.id)===(null==l?void 0:null===(t=l.assignee_detail)||void 0===t?void 0:t.id)&&w&&((null==l?void 0:l.status)==="new"||(null==l?void 0:l.status)==="in_progress"||(null==l?void 0:l.status)==="returned")&&(0,n.jsx)(p.Z,{size:"small",variant:"contained",onClick:()=>j(!0),children:String(h("tasks.view.actions.ensureExecution")||"Ensure execution")}),(null==g?void 0:g.id)===(null==r?void 0:null===(a=r.signed_by_detail)||void 0===a?void 0:a.id)&&w&&(null==l?void 0:l.status)==="on_review"&&(0,n.jsx)(p.Z,{size:"small",variant:"contained",onClick:()=>j(!0),children:String(h("tasks.view.actions.approve")||"Approve")})]}):(0,n.jsx)(c.Z,{spacing:.5,children:(0,n.jsx)(u.Z,{variant:"body2",children:String(h("tasks.view.actions.noPartSelected"))})})]})})}),(0,n.jsx)(eg,{parts:null==S?void 0:S.parts}),(0,n.jsx)(em,{open:v,toggle:()=>{j(!v),Z()},taskId:b?Number(b):void 0,partId:w?Number(w):void 0,part:l,task:r})]})},ej=a(36599),eb=a(87413),ef=a(9601),ey=a(72162),ew=a(17494),ek=a(51221);let eZ=(0,el.ZP)(ej.Z)({"& .MuiTimelineItem-root":{width:"100%","&:before":{display:"none"}}}),eS=e=>{switch(e){case"assigned":case"status_changed":return"info";case"part_created":case"task_created":return"primary";case"commented":case"file_added":case"part_returned":case"task_returned":return"warning";case"part_completed":case"task_completed":return"success";case"part_cancelled":case"task_cancelled":return"error";default:return"grey"}};function e_(e){let{id:t}=e,{t:a}=(0,z.$G)(),{data:i=[],isLoading:r}=(0,F.a)({queryKey:["task-events",t],queryFn:async()=>{var e;return(null===(e=(await f.Do.get(b.Z.taskEvent,{task:t,perPage:50})).data)||void 0===e?void 0:e.results)||[]},staleTime:1e4});return(0,n.jsx)(o.Z,{children:(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(u.Z,{variant:"subtitle2",sx:{mb:2},children:String(a("tasks.view.history.title"))}),r?(0,n.jsxs)(c.Z,{spacing:2,children:[(0,n.jsx)(T.Z,{variant:"text",width:"40%"}),(0,n.jsx)(T.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,n.jsx)(T.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,n.jsx)(T.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}})]}):i.length?(0,n.jsx)(eZ,{children:i.map(e=>{var t;return(0,n.jsxs)(eb.Z,{children:[(0,n.jsxs)(ef.Z,{children:[(0,n.jsx)(ew.Z,{color:eS(e.event_type),variant:"outlined"}),(0,n.jsx)(ek.Z,{})]}),(0,n.jsx)(ey.Z,{sx:{"& svg":{verticalAlign:"bottom",mx:4}},children:(0,n.jsxs)(s.Z,{sx:{mb:1.5,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsxs)(u.Z,{variant:"subtitle1",sx:{mr:2},children:[(null===(t=e.actor_detail)||void 0===t?void 0:t.fullname)||"—"," — ",e.message||e.event_type]}),(0,n.jsx)(u.Z,{variant:"caption",sx:{color:"text.disabled"},children:e.created_time?new Date(e.created_time).toLocaleString():""})]})})]},e.id)})}):(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(a("tasks.view.history.empty"))})]})})}var eC=a(89540),eI=a(69447),eP=a(54560);let eB=(0,el.ZP)(ej.Z)(e=>{let{theme:t}=e;return{"& .MuiTimelineItem-root:nth-of-type(even) .MuiTimelineContent-root":{textAlign:"left"},[t.breakpoints.down("md")]:{"& .MuiTimelineItem-root":{width:"100%","&:before":{display:"none"}}}}}),eN=e=>{switch(e){case"assigned":case"status_changed":return"info";case"part_created":case"task_created":return"primary";case"commented":case"file_added":case"part_returned":case"task_returned":return"warning";case"part_completed":case"task_completed":return"success";case"part_cancelled":case"task_cancelled":return"error";default:return"grey"}},ez=e=>{switch(e){case"assigned":return"tabler:user-check";case"part_created":return"tabler:subtask";case"file_added":return"tabler:paperclip";case"commented":return"tabler:message-circle";case"task_created":return"tabler:file-plus";case"status_changed":return"tabler:refresh";case"part_completed":case"task_completed":return"tabler:circle-check";case"part_returned":case"task_returned":return"tabler:arrow-back-up";case"part_cancelled":case"task_cancelled":return"tabler:circle-x";default:return"tabler:info-circle"}};var eD=e=>{let{id:t}=e,{t:a}=(0,z.$G)(),{data:i=[],isLoading:r}=(0,F.a)({queryKey:["task-events",t],queryFn:async()=>{var e;return(null===(e=(await f.Do.get(b.Z.taskEvent,{task:t,perPage:50})).data)||void 0===e?void 0:e.results)||[]},staleTime:1e4}),{settings:l}=(0,eP.r)(),p=(0,eC.Z)(e=>e.breakpoints.down("md")),{direction:x}=l;return r?(0,n.jsxs)(c.Z,{spacing:2,children:[(0,n.jsx)(T.Z,{variant:"text",width:"40%"}),(0,n.jsx)(T.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,n.jsx)(T.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,n.jsx)(T.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}})]}):(0,n.jsx)(o.Z,{children:(0,n.jsx)(d.Z,{children:(0,n.jsx)(eB,{position:p?"right":"alternate",children:i.length?i.map((e,t)=>{var a,i,r,l,o,d,p;let x=ez(e.event_type),h=eN(e.event_type),g=(null===(a=e.actor_detail)||void 0===a?void 0:a.fullname)||"—",v=e.message||e.event_type,b=e.created_time?new Date(e.created_time).toLocaleString():"";return(0,n.jsxs)(eb.Z,{children:[(0,n.jsxs)(ef.Z,{children:[(0,n.jsx)(eI.Z,{skin:"light",color:h,children:(0,n.jsx)(j.Z,{icon:x,fontSize:20})}),(0,n.jsx)(ek.Z,{})]}),(0,n.jsxs)(ey.Z,{sx:{"& svg":{verticalAlign:"bottom",mx:1}},children:[(0,n.jsxs)(s.Z,{sx:{mb:1,display:"flex",gap:2,flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsxs)(u.Z,{variant:"subtitle1",sx:{mr:2},children:[g," — ",v]}),(0,n.jsx)(u.Z,{variant:"caption",sx:{color:"text.disabled"},children:b})]}),(0,n.jsxs)(c.Z,{direction:"row",spacing:1,sx:{flexWrap:"wrap",rowGap:1},children:[(null===(i=e.part_detail)||void 0===i?void 0:i.title)?(0,n.jsx)(m.Z,{size:"small",label:"Qism: ".concat(e.part_detail.title)}):null,(null===(l=e.part_detail)||void 0===l?void 0:null===(r=l.department_detail)||void 0===r?void 0:r.name)?(0,n.jsx)(m.Z,{size:"small",label:"Bo'lim: ".concat(e.part_detail.department_detail.name)}):null,(null===(d=e.part_detail)||void 0===d?void 0:null===(o=d.assignee_detail)||void 0===o?void 0:o.fullname)?(0,n.jsx)(m.Z,{size:"small",label:"Ijrochi: ".concat(e.part_detail.assignee_detail.fullname)}):null,null]})]})]},null!==(p=e.id)&&void 0!==p?p:t)}):(0,n.jsx)(s.Z,{sx:{py:2},children:(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(a("tasks.view.process.empty"))})})})})})},eM=()=>{var e,t,a;let{t:g}=(0,z.$G)(),{id:y}=(0,r.useRouter)().query,[w,k]=(0,i.useState)(0),{user:Z}=(0,en.a)(),[S,_]=(0,i.useState)(void 0),{data:C,refetch:I}=(0,F.a)({queryKey:["task",y],enabled:!!y,queryFn:async()=>(await f.Do.get(b.Z.taskById(y))).data}),{data:P,refetch:B}=(0,F.a)({queryKey:["task-part",S],enabled:!!S,queryFn:async()=>(await f.Do.get(b.Z.taskPartById(S))).data});return(0,n.jsx)(s.Z,{children:(0,n.jsxs)(l.ZP,{container:!0,spacing:4,children:[(0,n.jsxs)(l.ZP,{item:!0,xs:12,md:8,lg:9,children:[(0,n.jsx)(o.Z,{children:(0,n.jsxs)(d.Z,{children:[(0,n.jsxs)(c.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,n.jsx)(u.Z,{variant:"h6",children:C?String(g("tasks.view.header.titleWithId",{id:C.id,name:C.name})):String(g("tasks.view.header.title"))}),(0,n.jsxs)(c.Z,{direction:"row",spacing:1,alignItems:"center",children:[["new","in_progress","on_review","returned"].includes(status)&&(null==Z?void 0:null===(e=Z.role_detail)||void 0===e?void 0:e.some(e=>"Performer"!==e.name))&&(0,n.jsx)(p.Z,{size:"small",variant:"outlined",component:v(),href:y?"/tasks/update/".concat(y):"#",disabled:!y,startIcon:(0,n.jsx)(j.Z,{icon:"mdi:pencil"}),children:String(g("common.edit"))}),(0,n.jsx)(m.Z,{label:String(g("tasks.view.header.status",{value:(e=>{if(!e)return"—";let t="documents.status.".concat(e.split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")),a=String(g(t));return a===t?e:a})(null==C?void 0:C.status)})),size:"small"}),(0,n.jsx)(m.Z,{label:String(g("tasks.view.header.priority",{value:(e=>{if(!e)return"—";let t="tasks.priority.".concat("orgently"===e?"orgently":"normal"===e?"ordinary":e),a=String(g(t));return a===t?e:a})(null==C?void 0:C.priority)})),size:"small"}),(0,n.jsx)(m.Z,{label:String(g("tasks.view.header.type",{value:(e=>{if(!e)return"—";let t="tasks.type.".concat(e),a=String(g(t));return a===t?e:a})(null==C?void 0:C.type)})),size:"small"}),(null==C?void 0:C.end_date)&&(0,n.jsx)(m.Z,{label:String(g("tasks.view.header.deadline",{value:C.end_date})),size:"small"})]})]}),(0,n.jsxs)(s.Z,{sx:{mt:1,display:"flex",gap:3,flexWrap:"wrap",alignItems:"center"},children:[(0,n.jsxs)(s.Z,{children:[(0,n.jsxs)(u.Z,{component:"span",sx:{fontWeight:700,mr:1},children:[String(g("tasks.view.document.fields.inputDocNumber")),":"]}),(0,n.jsx)(u.Z,{component:"span",children:null!==(t=null==C?void 0:C.input_doc_number)&&void 0!==t?t:"—"})]}),(0,n.jsxs)(s.Z,{children:[(0,n.jsxs)(u.Z,{component:"span",sx:{fontWeight:700,mr:1},children:[String(g("tasks.view.document.fields.outputDocNumber")),":"]}),(0,n.jsx)(u.Z,{component:"span",children:null!==(a=null==C?void 0:C.output_doc_number)&&void 0!==a?a:"—"})]})]}),(0,n.jsxs)(x.Z,{value:w,onChange:(e,t)=>k(t),sx:{mt:2},variant:"scrollable",scrollButtons:"auto",children:[(0,n.jsx)(h.Z,{label:String(g("tasks.view.tabs.document"))}),(0,n.jsx)(h.Z,{label:String(g("tasks.view.tabs.history"))}),(0,n.jsx)(h.Z,{label:String(g("tasks.view.tabs.process"))})]})]})}),(0,n.jsxs)(s.Z,{sx:{mt:3},children:[0===w&&(0,n.jsx)(ea,{task:C,selectedPartId:null!=S?S:void 0,setSelectedPartId:_}),1===w&&(0,n.jsx)(e_,{id:y}),2===w&&(0,n.jsx)(eD,{id:y})]})]}),(0,n.jsx)(l.ZP,{item:!0,xs:12,md:4,lg:3,children:(0,n.jsx)(ev,{task:C,part:P,mutate:()=>{I(),B()}})})]})})};function eF(){return(0,n.jsx)(eM,{})}},73138:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});var n=a(85893),i=a(5152);let r=a.n(i)()(()=>a.e(6925).then(a.t.bind(a,35108,23)).then(e=>e.Editor),{loadableGenerated:{webpack:()=>[35108]},ssr:!1});var s=e=>(0,n.jsx)(r,{editorState:e.editorState,onEditorStateChange:t=>e.onEditorStateChange(t)})}},function(e){e.O(0,[4885,2785,9084,3035,6437,1421,8833,958,2888,9774,179],function(){return e(e.s=94487)}),_N_E=e.O()}]);