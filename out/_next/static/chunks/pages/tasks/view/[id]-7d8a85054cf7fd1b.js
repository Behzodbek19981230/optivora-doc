(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7749],{94487:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tasks/view/[id]",function(){return a(96720)}])},25026:function(e,t,a){"use strict";a.d(t,{Z:function(){return g}});var n=a(87462),i=a(63366),s=a(67294),r=a(86010),l=a(94780),d=a(29567),o=a(77527),c=a(1588),u=a(34867);function m(e){return(0,u.Z)("MuiTableContainer",e)}(0,c.Z)("MuiTableContainer",["root"]);var x=a(85893);let h=["className","component"],p=e=>{let{classes:t}=e;return(0,l.Z)({root:["root"]},m,t)},v=(0,o.ZP)("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(e,t)=>t.root})({width:"100%",overflowX:"auto"});var g=s.forwardRef(function(e,t){let a=(0,d.Z)({props:e,name:"MuiTableContainer"}),{className:s,component:l="div"}=a,o=(0,i.Z)(a,h),c=(0,n.Z)({},a,{component:l}),u=p(c);return(0,x.jsx)(v,(0,n.Z)({ref:t,as:l,className:(0,r.Z)(u.root,s),ownerState:c},o))})},69447:function(e,t,a){"use strict";var n=a(85893),i=a(18745),s=a(17494),r=a(2339),l=a(17643);let d=e=>{let{sx:t,skin:a,color:d,variant:o}=e,c=(0,i.Z)(),u=(0,r.Z)(),m={primary:{boxShadow:"none",color:c.palette.primary.main,backgroundColor:u.primaryLight.backgroundColor},secondary:{boxShadow:"none",color:c.palette.secondary.main,backgroundColor:u.secondaryLight.backgroundColor},success:{boxShadow:"none",color:c.palette.success.main,backgroundColor:u.successLight.backgroundColor},error:{boxShadow:"none",color:c.palette.error.main,backgroundColor:u.errorLight.backgroundColor},warning:{boxShadow:"none",color:c.palette.warning.main,backgroundColor:u.warningLight.backgroundColor},info:{boxShadow:"none",color:c.palette.info.main,backgroundColor:u.infoLight.backgroundColor},grey:{boxShadow:"none",color:c.palette.grey[500],backgroundColor:(0,l.E)(c.palette.grey[500],.12)}};return(0,n.jsx)(s.Z,{...e,sx:d&&"light"===a&&"filled"===o?Object.assign(m[d],t):t})};d.defaultProps={color:"grey",variant:"filled"},t.Z=d},33251:function(e,t,a){"use strict";a.d(t,{z:function(){return r}});var n=a(30202),i=a(33934),s=a(52293);let r=function(e){var t,a;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=!(arguments.length>2)||void 0===arguments[2]||arguments[2],d=(0,n.NL)(),o=["list",e,r],c=Object.fromEntries(Object.entries(r).filter(e=>{let[,t]=e;return void 0!==t})),{data:u,isLoading:m,error:x}=(0,i.a)({queryKey:o,queryFn:async()=>{var t,a,n;let i=(await s.Do.get(e,c)).data,r=Array.isArray(i)?i:null!==(a=null==i?void 0:i.results)&&void 0!==a?a:[],l=Array.isArray(i)?r.length:null!==(n=null==i?void 0:null===(t=i.pagination)||void 0===t?void 0:t.total)&&void 0!==n?n:r.length;return{items:r,total:l}},enabled:l,staleTime:3e4});return{data:null!==(t=null==u?void 0:u.items)&&void 0!==t?t:[],total:null!==(a=null==u?void 0:u.total)&&void 0!==a?a:0,loading:m,error:x,mutate:()=>{d.invalidateQueries({queryKey:o})}}}},96720:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return e_}});var n=a(85893),i=a(67294),s=a(11163),r=a(90642),l=a(68573),d=a(60762),o=a(71919),c=a(84166),u=a(96788),m=a(73907),x=a(81873),h=a(43374),p=a(28907),v=a(41664),g=a.n(v),j=a(75673),f=a(74538),b=a(52293),w=a(56912),Z=a(33453),y=a(92365),k=a(40110),S=a(46070),_=a(96727),N=a(76592),D=a(70360),P=a(46577),C=a(8863),I=a(19827),z=a(21038),V=a(52857),M=a(22120),T=a(30381),Y=a.n(T),A=a(34273);function F(e){var t;let{parts:a,selectedPartId:i,setSelectedPartId:s,onDelete:r,onAdd:l}=e,{t:h}=(0,M.$G)(),{user:p}=(0,A.a)(),v=null==p?void 0:null===(t=p.role_detail)||void 0===t?void 0:t.some(e=>"Admin"===e.name),g=e=>{switch(e){case"new":case"cancelled":return"error";case"in_progress":return"primary";case"on_review":case"returned":return"warning";case"done":return"success";default:return"default"}},f=e=>{if(!e)return"—";let t="documents.status.".concat(e.split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")),a=String(h(t));return a===t?e:a};return(0,n.jsx)(d.Z,{children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.Z,{children:(0,n.jsxs)(c.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[(0,n.jsx)(u.Z,{variant:"subtitle2",children:String(h("tasks.view.parts.title"))}),(0,n.jsxs)(c.Z,{direction:"row",spacing:1,alignItems:"center",children:[(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:String(h("tasks.view.parts.count",{count:a.length}))}),v&&l&&(0,n.jsx)(m.Z,{variant:"contained",size:"small",startIcon:(0,n.jsx)(j.Z,{icon:"mdi:plus"}),onClick:l,children:String(h("common.add"))})]})]})}),a.length?(0,n.jsxs)(N.Z,{size:"small",sx:{"& .MuiTableCell-root":{py:1}},children:[(0,n.jsx)(D.Z,{children:(0,n.jsxs)(P.Z,{children:[(0,n.jsx)(C.Z,{children:String(h("tasks.view.parts.table.title"))}),(0,n.jsx)(C.Z,{children:String(h("tasks.view.parts.table.status"))}),(0,n.jsx)(C.Z,{children:String(h("tasks.view.parts.table.department"))}),(0,n.jsx)(C.Z,{children:String(h("tasks.view.parts.table.assignee"))}),(0,n.jsx)(C.Z,{children:String(h("tasks.view.parts.table.start"))}),(0,n.jsx)(C.Z,{children:String(h("tasks.view.parts.table.end"))}),v&&(0,n.jsx)(C.Z,{align:"right",children:String(h("common.actions"))})]})}),(0,n.jsx)(I.Z,{children:a.map(e=>{var t,a;let l=i===e.id;return(0,n.jsxs)(P.Z,{hover:!0,selected:l,onClick:()=>s(e.id),sx:{cursor:"pointer"},children:[(0,n.jsxs)(C.Z,{children:[(0,n.jsx)(c.Z,{direction:"row",spacing:1,alignItems:"center",children:(0,n.jsx)(u.Z,{variant:"body2",sx:{fontWeight:600},children:e.title||String(h("tasks.view.parts.partFallbackTitle",{id:e.id}))})}),!!e.note&&(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:e.note})]}),(0,n.jsx)(C.Z,{children:(0,n.jsx)(x.Z,{size:"small",label:f(e.status),color:g(e.status),variant:"outlined"})}),(0,n.jsx)(C.Z,{children:(null===(t=e.department_detail)||void 0===t?void 0:t.name)||e.department}),(0,n.jsx)(C.Z,{children:(null===(a=e.assignee_detail)||void 0===a?void 0:a.fullname)||e.assignee}),(0,n.jsx)(C.Z,{children:Y()(e.start_date).isValid()?Y()(e.start_date).format("DD.MM.YYYY HH:mm"):"—"}),(0,n.jsx)(C.Z,{children:Y()(e.end_date).isValid()?Y()(e.end_date).format("DD.MM.YYYY HH:mm"):"—"}),v&&(0,n.jsx)(C.Z,{align:"right",onClick:e=>e.stopPropagation(),children:(0,n.jsx)(c.Z,{direction:"row",spacing:1,justifyContent:"flex-end",children:(0,n.jsx)(z.Z,{title:String(h("common.delete")),children:(0,n.jsx)(V.Z,{size:"small",color:"error",onClick:()=>r(e.id),children:(0,n.jsx)(j.Z,{icon:"mdi:delete"})})})})})]},e.id)})})]}):(0,n.jsx)(o.Z,{children:(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(h("tasks.view.parts.empty"))})})]})})}var q=a(30202),W=a(33934),H=a(15822),E=a(96145),L=a(7879),O=a(33251),R=a(58898);let K=e=>String(e).padStart(2,"0"),B=e=>"".concat(e.getFullYear(),"-").concat(K(e.getMonth()+1),"-").concat(K(e.getDate()),"T").concat(K(e.getHours()),":").concat(K(e.getMinutes())),Q=e=>{if(!e)return null;if(/^\d{4}-\d{2}-\d{2}$/.test(e)){let[t,a,n]=e.split("-").map(Number);return new Date(t,(a||1)-1,n||1,0,0,0,0)}let t=new Date(e);return Number.isNaN(t.getTime())?null:t},G=e=>{let t=Q(e);return t?B(t):""},$=e=>{if(!e)return"—";let t=Y()(e);return t.isValid()?t.format("DD.MM.YYYY HH:mm"):String(e)};function J(e){var t,a,s,r,x,h,p;let{task:v,selectedPartId:g,setSelectedPartId:j}=e,{t:N}=(0,M.$G)(),{user:D}=(0,A.a)(),P=(0,R.Z)(),C=(0,q.NL)(),{data:I}=(0,O.z)(f.Z.department,{page:1,limit:100}),{data:z}=(0,O.z)(f.Z.users,{page:1,limit:100,roles__name:"Performer"}),[V,T]=(0,i.useState)(null),[K,B]=(0,i.useState)({title:"",department:0,assignee:0,start_date:"",end_date:"",note:""}),Q=null==v?void 0:v.id,{data:J}=(0,W.a)({queryKey:["task-parts",null!=Q?Q:"none"],enabled:!!Q,queryFn:async()=>{let e=(await b.Do.get(f.Z.taskPart,{task:String(Q),limit:100})).data;return(null==e?void 0:e.results)||e||[]},initialData:[]}),U=async()=>{if(V&&Q)try{await b.Do.put(f.Z.taskPartById(V.id),{...K,task:Q}),P.success(String(N("common.saved"))),T(null),C.invalidateQueries({queryKey:["task-parts",Q]})}catch(e){P.error((null==e?void 0:e.message)||String(N("errors.somethingWentWrong")))}},X=async e=>{if(window.confirm(String(N("common.confirmDelete"))))try{await b.Do.delete(f.Z.taskPartById(e)),P.success(String(N("common.deleted"))),C.invalidateQueries({queryKey:["task-parts",Q]})}catch(e){P.error((null==e?void 0:e.message)||String(N("errors.somethingWentWrong")))}},ee=async()=>{if(Q)try{let e={};if(K.title&&K.title.trim()||(e.title=String(N("errors.required"))),(!K.department||0>=Number(K.department))&&(e.department=String(N("errors.required"))),(!K.assignee||0>=Number(K.assignee))&&(e.assignee=String(N("errors.required"))),K.start_date||(e.start_date=String(N("errors.required"))),K.end_date||(e.end_date=String(N("errors.required"))),K.start_date&&K.end_date){let t=new Date(K.start_date);new Date(K.end_date)<t&&(e.end_date=String(N("errors.endAfterStart")))}if(K.note&&String(K.note).trim()||(e.note=String(N("errors.required"))),Object.keys(e).length>0){P.error(String(N("tasks.toast.partFormRequired")));return}await b.Do.post(f.Z.taskPart,{task:Q,title:K.title||"",department:K.department||0,assignee:K.assignee||0,start_date:Y()(K.start_date).format("YYYY-MM-DD HH:mm")||"",end_date:Y()(K.end_date).format("YYYY-MM-DD HH:mm")||"",status:"new",note:K.note||"",created_by:null==D?void 0:D.id}),P.success(String(N("tasks.toast.partCreated"))),T(null),C.invalidateQueries({queryKey:["task-parts",Q]})}catch(e){P.error((null==e?void 0:e.message)||String(N("errors.somethingWentWrong")))}};if(!v)return(0,n.jsx)(d.Z,{children:(0,n.jsx)(o.Z,{children:(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(N("tasks.view.document.notFound"))})})});let et=e=>{let{label:t,value:a}=e;return(0,n.jsxs)(c.Z,{spacing:.75,children:[(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:t}),(0,n.jsx)(u.Z,{variant:"body2",sx:{wordBreak:"break-word"},children:null!=a?a:"—"})]})};return(0,n.jsxs)(l.ZP,{container:!0,spacing:4,children:[(0,n.jsx)(l.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(d.Z,{children:(0,n.jsxs)(o.Z,{children:[(0,n.jsx)(u.Z,{variant:"subtitle1",sx:{mb:2},children:String(N("tasks.view.document.sections.main"))}),(0,n.jsxs)(l.ZP,{container:!0,spacing:3,children:[(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(et,{label:String(N("tasks.view.document.fields.company")),value:(null===(t=v.company_detail)||void 0===t?void 0:t.name)||v.company})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(et,{label:String(N("tasks.view.document.fields.department")),value:(null===(a=v.department_detail)||void 0===a?void 0:a.name)||v.department})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(et,{label:String(N("tasks.view.document.fields.taskForm")),value:(null===(s=v.task_form_detail)||void 0===s?void 0:s.name)||v.task_form})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(et,{label:String(N("tasks.view.document.fields.magazine")),value:(null===(r=v.list_of_magazine_detail)||void 0===r?void 0:r.name)||v.list_of_magazine})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(et,{label:String(N("tasks.view.document.fields.signedBy")),value:(null===(x=v.signed_by_detail)||void 0===x?void 0:x.fullname)||v.signed_by})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(et,{label:String(N("tasks.view.document.fields.responsiblePerson")),value:null!==(p=v.respon_person)&&void 0!==p?p:"—"})})]})]})})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(d.Z,{children:(0,n.jsxs)(o.Z,{children:[(0,n.jsx)(u.Z,{variant:"subtitle1",sx:{mb:2},children:String(N("tasks.view.document.sections.dates"))}),(0,n.jsxs)(l.ZP,{container:!0,spacing:3,children:[(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(et,{label:String(N("tasks.view.document.fields.startDate")),value:$(v.start_date)})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(et,{label:String(N("tasks.view.document.fields.endDate")),value:$(v.end_date)})})]}),(0,n.jsx)(w.Z,{sx:{my:3}}),(0,n.jsx)(u.Z,{variant:"subtitle1",sx:{mb:2},children:String(N("tasks.view.document.sections.system"))}),(0,n.jsxs)(l.ZP,{container:!0,spacing:3,children:[(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(et,{label:String(N("tasks.view.document.fields.createdAt")),value:Y()(v.created_time).format("DD.MM.YYYY HH:mm")})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(et,{label:String(N("tasks.view.document.fields.createdBy")),value:(null===(h=v.created_by_detail)||void 0===h?void 0:h.fullname)||v.created_by})})]})]})})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(H.Z,{taskId:v.id,partId:null,isCompact:!0})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(F,{parts:J||[],selectedPartId:g,setSelectedPartId:j,onDelete:X,onEdit:e=>{let t=J.find(t=>t.id===e);t&&(T(t),B({title:t.title,department:t.department,assignee:t.assignee,start_date:G(t.start_date),end_date:G(t.end_date),note:t.note}))},onAdd:()=>{T({}),B({title:"",department:0,assignee:0,start_date:"",end_date:"",note:""})},taskId:Q})}),g&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(H.Z,{taskId:null,partId:g})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(E.Z,{taskId:null,partId:g})})]}),(0,n.jsxs)(Z.Z,{open:!!V,onClose:()=>T(null),maxWidth:"sm",fullWidth:!0,children:[(0,n.jsx)(y.Z,{children:(null==V?void 0:V.id)?String(N("tasks.parts.dialog.editTitle")):String(N("tasks.parts.dialog.title"))}),(0,n.jsx)(k.Z,{children:(0,n.jsxs)(l.ZP,{container:!0,spacing:2,sx:{mt:1},children:[(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(L.Z,{fullWidth:!0,label:String(N("tasks.parts.form.title")),value:K.title,onChange:e=>B({...K,title:e.target.value})})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(S.Z,{fullWidth:!0,options:I||[],getOptionLabel:e=>e.name,value:(null==I?void 0:I.find(e=>e.id===K.department))||null,onChange:(e,t)=>B({...K,department:(null==t?void 0:t.id)||0}),renderInput:e=>(0,n.jsx)(L.Z,{...e,label:String(N("tasks.parts.form.department")),placeholder:String(N("common.selectPlaceholder"))})})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(S.Z,{fullWidth:!0,options:z||[],getOptionLabel:e=>e.fullname,value:(null==z?void 0:z.find(e=>e.id===K.assignee))||null,onChange:(e,t)=>B({...K,assignee:(null==t?void 0:t.id)||0}),renderInput:e=>(0,n.jsx)(L.Z,{...e,label:String(N("tasks.parts.form.assignee")),placeholder:String(N("common.selectPlaceholder"))})})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(L.Z,{fullWidth:!0,type:"datetime-local",label:String(N("tasks.parts.form.startDate")),value:K.start_date,onChange:e=>B({...K,start_date:e.target.value}),InputLabelProps:{shrink:!0}})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(L.Z,{fullWidth:!0,type:"datetime-local",label:String(N("tasks.parts.form.endDate")),value:K.end_date,onChange:e=>B({...K,end_date:e.target.value}),InputLabelProps:{shrink:!0}})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(L.Z,{fullWidth:!0,multiline:!0,rows:3,label:String(N("tasks.parts.form.note")),value:K.note,onChange:e=>B({...K,note:e.target.value})})})]})}),(0,n.jsxs)(_.Z,{children:[(0,n.jsx)(m.Z,{onClick:()=>T(null),children:String(N("common.cancel"))}),(0,n.jsx)(m.Z,{variant:"contained",onClick:(null==V?void 0:V.id)?U:ee,children:String(N("common.save"))})]})]})]})}var U=a(14934),X=a(1954);function ee(e){var t,a,s,l,o,c,u,x,h,p,v,g,j,f,b,w,S,N,D,P,C,I,z,V,T,A;let{fullTask:F}=e,q=(0,i.useRef)(null),W=(0,i.useRef)(!1),{t:H}=(0,M.$G)(),[E,L]=(0,i.useState)(!1),O=Math.round(495.0251889168766),R=(0,i.useMemo)(()=>Math.min(.44080604534005036,O/1123),[1123,794,O,350]),K=e=>{if(!e)return"—";let t="documents.status.".concat(e.split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")),a=String(H(t));return a===t?e:a},B=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"—";let a=Y()(e);return a.isValid()?a.format(t?"DD.MM.YYYY HH:mm":"DD.MM.YYYY"):"—"},Q=()=>'\n    @page { size: A4; margin: 12mm; }\n    html, body { margin: 0; padding: 0; background: #fff; }\n    body { -webkit-print-color-adjust: exact; print-color-adjust: exact; color: #111827; font: 12pt/1.45 "Times New Roman", Times, serif; }\n\n    .print-paper{\n      width:210mm; min-height:297mm; box-sizing:border-box;\n      padding:14mm 12mm; margin:0 auto; background:#fff;\n    }\n\n    .doc-topline{ height: 6px; background: #0F172A; border-radius: 999px; margin-bottom: 10mm; }\n    .doc-header{ display:flex; align-items:center; justify-content:space-between; gap: 12mm; }\n    .doc-header-left{ display:flex; align-items:center; gap: 6mm; min-width: 50mm; }\n    .doc-logo{ width: 22mm; height: 22mm; object-fit: contain; }\n    .doc-company{ font-weight: 700; font-size: 18pt; text-align:center; flex:1; }\n    .doc-header-right{ min-width: 50mm; text-align:right; font-size: 11pt; color: #334155; }\n\n    .doc-subline{ border-top: 1px solid #CBD5E1; margin: 6mm 0 8mm; }\n\n    .section-title{ font-weight: 700; font-size: 13pt; margin: 0 0 3mm; }\n    .meta-grid{ display:grid; grid-template-columns: 1fr 1fr; gap: 3mm 10mm; margin-bottom: 8mm; }\n    .meta-row{ display:flex; gap: 4mm; }\n    .meta-label{ width: 40mm; font-weight: 700; color: #0F172A; }\n    .meta-value{ flex: 1; color: #111827; }\n\n    .note-box{ border: 1px solid #E2E8F0; border-radius: 6px; padding: 4mm; background: #F8FAFC; white-space: pre-wrap; }\n\n    table.parts-table{ width:100%; border-collapse: collapse; margin-top: 4mm; font-size: 11pt; }\n    .parts-table th, .parts-table td{ border: 1px solid #E2E8F0; padding: 3mm 2.5mm; vertical-align: top; }\n    .parts-table th{ background: #F1F5F9; color:#0F172A; font-weight:700; text-align:left; }\n    .parts-table td{ color:#111827; }\n    .muted{ color:#64748B; }\n\n    .doc-footer{ margin-top: 10mm; display:flex; justify-content:space-between; gap: 10mm; font-size: 10.5pt; color:#334155; }\n    .no-print, [data-no-print] { display: none !important; }\n  ',G=e=>{let t=q.current;if(!t||W.current)return;W.current=!0;let a=t.querySelector(".print-paper"),n=a?a.innerHTML:t.innerHTML,i=null;try{i=window.open("","_blank","height=900,width=900")}catch(e){console.error("window.open failed",e)}if(!i){W.current=!1;return}try{i.opener=null}catch(e){}let s=Q();try{i.document.open(),i.document.write('<!doctype html><html><head><meta charset="utf-8"><title>'.concat(String(H("tasks.view.document.header.overline",{defaultValue:"Document"})),"</title><style>").concat(s,'</style></head><body><div class="print-paper">').concat(n,"</div></body></html>")),i.document.close()}catch(e){console.error("Failed to write to print window",e);try{i.close()}catch(e){}W.current=!1;return}setTimeout(()=>{try{if(!i||i.closed)return;i.focus(),e&&i.print()}catch(e){console.error("Print failed",e)}finally{W.current=!1}},800)};return(0,n.jsx)(d.Z,{children:(0,n.jsxs)(r.Z,{ref:q,children:[(0,n.jsx)("style",{children:'\n          /* Screen preview shell (dialog) */\n          .doc-preview-shell{\n            padding: 14px 10px 16px;\n            background: radial-gradient(1200px 400px at 50% 0%, rgba(99,102,241,0.08), rgba(15,23,42,0) 60%),\n                        linear-gradient(180deg, rgba(15,23,42,0.02), rgba(15,23,42,0.06));\n            border-radius: 14px;\n            overflow: auto;\n          }\n          .print-paper{\n            box-sizing: border-box;\n            background: #fff;\n            border-radius: 10px;\n            box-shadow: 0 14px 32px rgba(15, 23, 42, 0.12), 0 2px 8px rgba(15, 23, 42, 0.06);\n            overflow: hidden;\n            border: 1px solid rgba(15, 23, 42, 0.08);\n            padding: 44px 42px;\n            color: #111827;\n            font: 14px/1.5 "Times New Roman", Times, serif;\n          }\n\n          .doc-topline{ height: 6px; background: #0F172A; border-radius: 999px; margin-bottom: 28px; }\n          .doc-header{ display:flex; align-items:center; justify-content:space-between; gap: 34px; }\n          .doc-header-left{ display:flex; align-items:center; gap: 16px; min-width: 180px; }\n          .doc-logo{ width: 64px; height: 64px; object-fit: contain; }\n          .doc-company{ font-weight: 700; font-size: 24px; text-align:center; flex:1; }\n          .doc-header-right{ min-width: 180px; text-align:right; font-size: 12px; color: #475569; }\n          .doc-subline{ border-top: 1px solid rgba(148, 163, 184, 0.55); margin: 18px 0 22px; }\n\n          .section-title{ font-weight: 700; font-size: 16px; margin: 0 0 8px; }\n          .meta-grid{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px 28px; margin-bottom: 18px; }\n          .meta-row{ display:flex; gap: 12px; }\n          .meta-label{ width: 140px; font-weight: 700; color: #0F172A; }\n          .meta-value{ flex:1; color: #111827; }\n          .note-box{ border: 1px solid rgba(148, 163, 184, 0.45); border-radius: 10px; padding: 12px; background: rgba(248, 250, 252, 1); white-space: pre-wrap; }\n\n          table.parts-table{ width:100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }\n          .parts-table th, .parts-table td{ border: 1px solid rgba(226, 232, 240, 1); padding: 9px 8px; vertical-align: top; }\n          .parts-table th{ background: rgba(241, 245, 249, 1); color:#0F172A; font-weight:700; text-align:left; }\n          .parts-table td{ color:#111827; }\n          .muted{ color:#64748B; }\n          .doc-footer{ margin-top: 22px; display:flex; justify-content:space-between; gap: 20px; font-size: 12px; color:#475569; }\n\n          /* Thumbnail */\n          .doc-thumb{\n            width:'.concat(350,"px;\n            height:").concat(O,"px;\n            border-radius: 12px;\n            overflow: hidden;\n            cursor: pointer;\n            position: relative;\n            background: rgba(15,23,42,0.03);\n            border: 1px solid rgba(15,23,42,0.10);\n            box-shadow: 0 10px 24px rgba(15, 23, 42, 0.10), 0 1px 6px rgba(15, 23, 42, 0.06);\n          }\n          .doc-thumb-overlay{\n            position:absolute;\n            inset:auto 6px 6px 6px;\n            display:flex;\n            align-items:center;\n            justify-content:space-between;\n            gap: 8px;\n            padding: 6px 8px;\n            border-radius: 10px;\n            background: rgba(15, 23, 42, 0.70);\n            color: #fff;\n            font: 12px/1.2 Arial, Helvetica, sans-serif;\n          }\n          .doc-thumb-overlay span{ opacity: 0.92; }\n        ")}),(0,n.jsxs)(r.Z,{sx:{p:2},children:[(0,n.jsxs)("div",{className:"doc-thumb",onClick:()=>L(!0),role:"button",tabIndex:0,children:[(0,n.jsx)("div",{style:{width:"".concat(794*R,"px"),height:"".concat(1123*R,"px")},children:(0,n.jsxs)("div",{className:"print-paper",style:{width:"".concat(794,"px"),minHeight:"".concat(1123,"px"),transform:"scale(".concat(R,")"),transformOrigin:"top left"},children:[(0,n.jsx)("div",{className:"doc-topline"}),(0,n.jsxs)("div",{className:"doc-header",children:[(0,n.jsx)("div",{className:"doc-header-left",children:(0,n.jsx)("img",{className:"doc-logo",src:"/logo.svg",alt:"Logo"})}),(0,n.jsx)("div",{className:"doc-company",children:(null==F?void 0:null===(a=F.task)||void 0===a?void 0:null===(t=a.company_detail)||void 0===t?void 0:t.name)||"—"}),(0,n.jsxs)("div",{className:"doc-header-right",children:[(0,n.jsx)("div",{className:"muted",children:String(H("tasks.view.document.fields.inputDocNumber",{defaultValue:"Incoming number"}))}),(0,n.jsxs)("div",{style:{fontWeight:700,color:"#0F172A"},children:["№",null!==(z=null==F?void 0:null===(s=F.task)||void 0===s?void 0:s.input_doc_number)&&void 0!==z?z:"—"]})]})]}),(0,n.jsx)("div",{className:"doc-subline"}),(0,n.jsx)("div",{className:"section-title",children:String(H("tasks.view.document.sections.main",{defaultValue:"Main information"}))}),(0,n.jsxs)("div",{className:"meta-grid",children:[(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(H("tasks.view.document.fields.signedBy",{defaultValue:"Signed by"}))}),(0,n.jsx)("div",{className:"meta-value",children:(null==F?void 0:null===(o=F.task)||void 0===o?void 0:null===(l=o.signed_by_detail)||void 0===l?void 0:l.fullname)||"—"})]}),(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(H("tasks.view.document.fields.signedDate",{defaultValue:"Signed date"}))}),(0,n.jsx)("div",{className:"meta-value",children:B(null==F?void 0:null===(c=F.task)||void 0===c?void 0:c.signed_date)})]}),(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(H("tasks.view.actions.partStatus",{defaultValue:"Status"}))}),(0,n.jsx)("div",{className:"meta-value",children:K(null==F?void 0:null===(u=F.task)||void 0===u?void 0:u.status)})]}),(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(H("tasks.view.actions.deadline",{defaultValue:"Deadline"}))}),(0,n.jsx)("div",{className:"meta-value",children:B(null==F?void 0:null===(x=F.task)||void 0===x?void 0:x.end_date,!0)})]})]}),(0,n.jsx)("div",{className:"section-title",children:String(H("tasks.view.document.sections.note",{defaultValue:"Note"}))}),(0,n.jsx)("div",{className:"note-box",children:(null==F?void 0:null===(h=F.task)||void 0===h?void 0:h.note)||"—"}),(0,n.jsx)("div",{style:{height:18}}),(0,n.jsx)("div",{className:"section-title",children:String(H("tasks.view.document.sections.parts",{defaultValue:"Parts"}))}),(0,n.jsxs)("table",{className:"parts-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{style:{width:"18%"},children:String(H("tasks.view.parts.table.assignee",{defaultValue:"Assignee"}))}),(0,n.jsx)("th",{style:{width:"18%"},children:String(H("tasks.view.parts.table.department",{defaultValue:"Department"}))}),(0,n.jsx)("th",{style:{width:"12%"},children:String(H("tasks.view.document.fields.startDate",{defaultValue:"Start date"}))}),(0,n.jsx)("th",{style:{width:"12%"},children:String(H("tasks.view.document.fields.endDate",{defaultValue:"End date"}))}),(0,n.jsx)("th",{style:{width:"12%"},children:String(H("tasks.view.actions.partStatus",{defaultValue:"Status"}))}),(0,n.jsx)("th",{children:String(H("tasks.form.note",{defaultValue:"Note"}))})]})}),(0,n.jsx)("tbody",{children:((null==F?void 0:F.parts)||[]).map(e=>{var t,a;return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(null===(t=e.assignee_detail)||void 0===t?void 0:t.fullname)||"—"}),(0,n.jsx)("td",{children:(null===(a=e.department_detail)||void 0===a?void 0:a.name)||"—"}),(0,n.jsx)("td",{children:B(e.start_date,!0)}),(0,n.jsx)("td",{children:B(e.end_date,!0)}),(0,n.jsx)("td",{children:K(e.status)}),(0,n.jsx)("td",{children:e.note||"—"})]},e.id)})})]}),(0,n.jsxs)("div",{className:"doc-footer",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"muted",children:String(H("common.createdAt",{defaultValue:"Created at"}))}),(0,n.jsx)("div",{children:B(null==F?void 0:null===(p=F.task)||void 0===p?void 0:p.created_time,!0)})]}),(0,n.jsxs)("div",{style:{textAlign:"right"},children:[(0,n.jsx)("div",{className:"muted",children:String(H("tasks.view.document.header.overline",{defaultValue:"Document"}))}),(0,n.jsx)("div",{style:{fontWeight:700,color:"#0F172A"},children:String(H("tasks.view.document.header.fallbackTitle",{id:null!==(V=null==F?void 0:null===(v=F.task)||void 0===v?void 0:v.id)&&void 0!==V?V:"—",defaultValue:"Task #{{id}}"}))})]})]})]})}),(0,n.jsxs)("div",{className:"doc-thumb-overlay",children:[(0,n.jsx)("span",{children:String(H("tasks.view.document.actions.openPdf",{defaultValue:"Open PDF view"}))}),(0,n.jsx)(X.JO,{icon:"tabler:zoom-in"})]})]}),(0,n.jsxs)(Z.Z,{open:E,onClose:()=>L(!1),maxWidth:"lg",fullWidth:!0,children:[(0,n.jsx)(y.Z,{children:String(H("tasks.view.document.header.overline",{defaultValue:"Document"}))}),(0,n.jsx)(k.Z,{dividers:!0,children:(0,n.jsx)(r.Z,{className:"doc-preview-shell",children:(0,n.jsx)(r.Z,{sx:{width:"".concat(Math.round(714.6),"px"),minHeight:"".concat(Math.round(1010.7),"px"),margin:"0 auto"},children:(0,n.jsx)("div",{style:{width:"".concat(714.6,"px"),minHeight:"".concat(1010.7,"px")},children:(0,n.jsxs)("div",{className:"print-paper",style:{width:"".concat(794,"px"),minHeight:"".concat(1123,"px"),transform:"scale(".concat(.9,")"),transformOrigin:"top left"},children:[(0,n.jsx)("div",{className:"doc-topline"}),(0,n.jsxs)("div",{className:"doc-header",children:[(0,n.jsx)("div",{className:"doc-header-left",children:(0,n.jsx)("img",{className:"doc-logo",src:"/logo.svg",alt:"Logo"})}),(0,n.jsx)("div",{className:"doc-company",children:(null==F?void 0:null===(j=F.task)||void 0===j?void 0:null===(g=j.company_detail)||void 0===g?void 0:g.name)||"—"}),(0,n.jsxs)("div",{className:"doc-header-right",children:[(0,n.jsx)("div",{className:"muted",children:String(H("tasks.view.document.fields.inputDocNumber",{defaultValue:"Incoming number"}))}),(0,n.jsxs)("div",{style:{fontWeight:700,color:"#0F172A"},children:["№",null!==(T=null==F?void 0:null===(f=F.task)||void 0===f?void 0:f.input_doc_number)&&void 0!==T?T:"—"]})]})]}),(0,n.jsx)("div",{className:"doc-subline"}),(0,n.jsx)("div",{className:"section-title",children:String(H("tasks.view.document.sections.main",{defaultValue:"Main information"}))}),(0,n.jsxs)("div",{className:"meta-grid",children:[(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(H("tasks.view.document.fields.signedBy",{defaultValue:"Signed by"}))}),(0,n.jsx)("div",{className:"meta-value",children:(null==F?void 0:null===(w=F.task)||void 0===w?void 0:null===(b=w.signed_by_detail)||void 0===b?void 0:b.fullname)||"—"})]}),(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(H("tasks.view.document.fields.signedDate",{defaultValue:"Signed date"}))}),(0,n.jsx)("div",{className:"meta-value",children:B(null==F?void 0:null===(S=F.task)||void 0===S?void 0:S.signed_date)})]}),(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(H("tasks.view.actions.partStatus",{defaultValue:"Status"}))}),(0,n.jsx)("div",{className:"meta-value",children:K(null==F?void 0:null===(N=F.task)||void 0===N?void 0:N.status)})]}),(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(H("tasks.view.actions.deadline",{defaultValue:"Deadline"}))}),(0,n.jsx)("div",{className:"meta-value",children:B(null==F?void 0:null===(D=F.task)||void 0===D?void 0:D.end_date,!0)})]})]}),(0,n.jsx)("div",{className:"section-title",children:String(H("tasks.view.document.sections.note",{defaultValue:"Note"}))}),(0,n.jsx)("div",{className:"note-box",children:(null==F?void 0:null===(P=F.task)||void 0===P?void 0:P.note)||"—"}),(0,n.jsx)("div",{style:{height:18}}),(0,n.jsx)("div",{className:"section-title",children:String(H("tasks.view.document.sections.parts",{defaultValue:"Parts"}))}),(0,n.jsxs)("table",{className:"parts-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{style:{width:"18%"},children:String(H("tasks.view.parts.table.assignee",{defaultValue:"Assignee"}))}),(0,n.jsx)("th",{style:{width:"18%"},children:String(H("tasks.view.parts.table.department",{defaultValue:"Department"}))}),(0,n.jsx)("th",{style:{width:"12%"},children:String(H("tasks.view.document.fields.startDate",{defaultValue:"Start date"}))}),(0,n.jsx)("th",{style:{width:"12%"},children:String(H("tasks.view.document.fields.endDate",{defaultValue:"End date"}))}),(0,n.jsx)("th",{style:{width:"12%"},children:String(H("tasks.view.actions.partStatus",{defaultValue:"Status"}))}),(0,n.jsx)("th",{children:String(H("tasks.form.note",{defaultValue:"Note"}))})]})}),(0,n.jsx)("tbody",{children:((null==F?void 0:F.parts)||[]).map(e=>{var t,a;return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(null===(t=e.assignee_detail)||void 0===t?void 0:t.fullname)||"—"}),(0,n.jsx)("td",{children:(null===(a=e.department_detail)||void 0===a?void 0:a.name)||"—"}),(0,n.jsx)("td",{children:B(e.start_date,!0)}),(0,n.jsx)("td",{children:B(e.end_date,!0)}),(0,n.jsx)("td",{children:K(e.status)}),(0,n.jsx)("td",{children:e.note||"—"})]},e.id)})})]}),(0,n.jsxs)("div",{className:"doc-footer",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"muted",children:String(H("common.createdAt",{defaultValue:"Created at"}))}),(0,n.jsx)("div",{children:B(null==F?void 0:null===(C=F.task)||void 0===C?void 0:C.created_time,!0)})]}),(0,n.jsxs)("div",{style:{textAlign:"right"},children:[(0,n.jsx)("div",{className:"muted",children:String(H("tasks.view.document.header.overline",{defaultValue:"Document"}))}),(0,n.jsx)("div",{style:{fontWeight:700,color:"#0F172A"},children:String(H("tasks.view.document.header.fallbackTitle",{id:null!==(A=null==F?void 0:null===(I=F.task)||void 0===I?void 0:I.id)&&void 0!==A?A:"—",defaultValue:"Task #{{id}}"}))})]})]})]})})})})}),(0,n.jsxs)(_.Z,{children:[(0,n.jsx)(m.Z,{onClick:()=>G(!1),startIcon:(0,n.jsx)(X.JO,{icon:"tabler:file-type-pdf"}),children:String(H("tasks.view.document.actions.openPdf",{defaultValue:"Open PDF view"}))}),(0,n.jsx)(m.Z,{onClick:()=>G(!0),variant:"contained",startIcon:(0,n.jsx)(X.JO,{icon:"tabler:printer"}),children:String(H("tasks.view.document.actions.print",{defaultValue:"Print / Save as PDF"}))}),(0,n.jsx)(m.Z,{onClick:()=>L(!1),children:String(H("common.close",{defaultValue:"Close"}))})]})]})]})]})})}var et=a(33971),ea=a(25026),en=a(93454);function ei(e){let{parts:t}=e,{t:a}=(0,M.$G)();return(0,n.jsxs)(ea.Z,{component:en.Z,sx:{boxShadow:1},children:[(0,n.jsxs)(r.Z,{sx:{p:2,borderBottom:e=>"1px solid ".concat(e.palette.divider)},children:[(0,n.jsx)(u.Z,{variant:"subtitle1",children:String(a("tasks.view.parts.title")||"Parts")}),(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:String(a("tasks.view.parts.count",{count:(null==t?void 0:t.length)||0}))})]}),(0,n.jsxs)(N.Z,{size:"small",children:[(0,n.jsx)(D.Z,{children:(0,n.jsxs)(P.Z,{children:[(0,n.jsx)(C.Z,{children:(0,n.jsx)(u.Z,{variant:"body2",sx:{fontSize:10},children:String(a("tasks.view.parts.table.assignee")||"Assignee")})}),(0,n.jsx)(C.Z,{children:(0,n.jsx)(u.Z,{variant:"body2",sx:{fontSize:10},children:String(a("tasks.view.parts.table.start")||"Show date")})}),(0,n.jsx)(C.Z,{children:(0,n.jsx)(u.Z,{variant:"body2",sx:{fontSize:10},children:String(a("tasks.view.parts.table.status")||"Is show")})})]})}),(0,n.jsx)(I.Z,{children:t&&t.length?t.map(e=>{var t;return(0,n.jsxs)(P.Z,{hover:!0,children:[(0,n.jsx)(C.Z,{children:(0,n.jsx)(u.Z,{variant:"body2",sx:{fontSize:12},children:(null===(t=e.assignee_detail)||void 0===t?void 0:t.fullname)||"—"})}),(0,n.jsx)(C.Z,{sx:{fontSize:12},children:e.show_date?Y()(e.show_date).format("DD.MM.YYYY"):"—"}),(0,n.jsx)(C.Z,{sx:{fontSize:12},children:e.show_date?(0,n.jsx)(X.JO,{icon:"tabler:eye"}):(0,n.jsx)(X.JO,{icon:"tabler:eye-off"})})]},e.id)}):(0,n.jsx)(P.Z,{children:(0,n.jsx)(C.Z,{colSpan:4,align:"center",children:(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(a("tasks.view.parts.empty")||"No parts")})})})})]})]})}var es=e=>{var t,a;let{task:s,part:l,mutate:h}=e,{t:p}=(0,M.$G)(),{user:v}=(0,A.a)(),[g,j]=i.useState(!1),f=null==s?void 0:s.id,Z=null==l?void 0:l.id,y=(0,q.NL)(),k=async()=>{try{Z&&(await y.invalidateQueries({queryKey:["task-part",Z],refetchType:"active"}),f&&(await y.invalidateQueries({queryKey:["task-comments",f,Z],refetchType:"active"}),await y.invalidateQueries({queryKey:["task-attachments",f,Z],refetchType:"active"})),await y.invalidateQueries({queryKey:["/task/with-parts/by-id/",f],refetchType:"active"}),null==h||h()),f&&(await y.invalidateQueries({queryKey:["task-comments",f,null],refetchType:"active"}),await y.invalidateQueries({queryKey:["task-attachments",f,"all"],refetchType:"active"}),await y.invalidateQueries({queryKey:["/task/with-parts/by-id/",f],refetchType:"active"}),null==h||h())}catch(e){console.error("mutateAndRefresh failed",e)}},{data:S,isLoading:_}=(0,W.a)({queryKey:["/task/with-parts/by-id/",f],queryFn:async()=>{let e={task_id:Number(f)};return(await b.Do.post("/task/with-parts/by-id/",e)).data||{parts:[],task:{id:0,title:"",description:""}}},enabled:!!f,staleTime:1e4}),N=(null==S?void 0:S.task)||s,D=i.useMemo(()=>{var e;return Z&&(null==S?void 0:null===(e=S.parts)||void 0===e?void 0:e.find(e=>e.id===Z))||l},[null==S?void 0:S.parts,l,Z]);return(0,n.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[_?(0,n.jsx)(U.Z,{variant:"rectangular",height:100}):S&&(0,n.jsx)(ee,{fullTask:S}),(0,n.jsx)(d.Z,{children:(0,n.jsx)(o.Z,{children:(0,n.jsxs)(c.Z,{spacing:2,children:[(0,n.jsx)(u.Z,{variant:"subtitle1",children:String(p("tasks.view.actions.title"))}),(0,n.jsx)(w.Z,{}),Z?(0,n.jsxs)(c.Z,{spacing:1,children:[(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:String(p("tasks.view.actions.selectedSection"))}),(0,n.jsx)(c.Z,{direction:"row",spacing:1,alignItems:"center",children:(0,n.jsx)(u.Z,{variant:"body2",children:(null==D?void 0:D.title)||String(p("common.notSet"))})}),(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:String(p("tasks.view.actions.partStatus"))}),(0,n.jsx)(c.Z,{direction:"row",spacing:1,alignItems:"center",children:(null==D?void 0:D.status)?(0,n.jsx)(x.Z,{size:"small",color:"info",variant:"outlined",label:(()=>{let e="documents.status.".concat(D.status.split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")),t=String(p(e));return t===e?D.status:t})()}):null}),(null==v?void 0:v.id)===(null==D?void 0:null===(t=D.assignee_detail)||void 0===t?void 0:t.id)&&Z&&((null==D?void 0:D.status)==="new"||(null==D?void 0:D.status)==="in_progress"||(null==D?void 0:D.status)==="returned")&&(0,n.jsx)(m.Z,{size:"small",variant:"contained",onClick:()=>j(!0),children:String(p("tasks.view.actions.ensureExecution")||"Ensure execution")}),(null==v?void 0:v.id)===(null==N?void 0:null===(a=N.signed_by_detail)||void 0===a?void 0:a.id)&&Z&&(null==D?void 0:D.status)==="on_review"&&(0,n.jsx)(m.Z,{size:"small",variant:"contained",onClick:()=>j(!0),children:String(p("tasks.view.actions.approve")||"Approve")})]}):(0,n.jsx)(c.Z,{spacing:.5,children:(0,n.jsx)(u.Z,{variant:"body2",children:String(p("tasks.view.actions.noPartSelected"))})})]})})}),(0,n.jsx)(ei,{parts:null==S?void 0:S.parts}),(0,n.jsx)(et.Z,{open:g,toggle:()=>j(e=>{let t=!e;return e&&!t&&k(),t}),taskId:f?Number(f):void 0,partId:Z?Number(Z):void 0,part:D,task:N})]})},er=a(77527),el=a(36599),ed=a(87413),eo=a(9601),ec=a(72162),eu=a(17494),em=a(51221);let ex=(0,er.ZP)(el.Z)({"& .MuiTimelineItem-root":{width:"100%","&:before":{display:"none"}}}),eh=(e,t)=>{if(!t)return"";let a="documents.status.".concat(t),n=String(e(a));return n===a?t:n},ep=e=>{switch(e){case"assigned":case"status_changed":return"info";case"part_created":case"task_created":return"primary";case"commented":case"file_added":case"part_returned":case"task_returned":return"warning";case"part_completed":case"task_completed":return"success";case"part_cancelled":case"task_cancelled":return"error";default:return"grey"}};function ev(e){let{id:t}=e,{t:a}=(0,M.$G)(),{data:i=[],isLoading:s}=(0,W.a)({queryKey:["task-events",t],queryFn:async()=>{var e;return(null===(e=(await b.Do.get(f.Z.taskEvent,{task:t,limit:50})).data)||void 0===e?void 0:e.results)||[]},staleTime:1e4});return(0,n.jsx)(d.Z,{children:(0,n.jsxs)(o.Z,{children:[(0,n.jsx)(u.Z,{variant:"subtitle2",sx:{mb:2},children:String(a("tasks.view.history.title"))}),s?(0,n.jsxs)(c.Z,{spacing:2,children:[(0,n.jsx)(U.Z,{variant:"text",width:"40%"}),(0,n.jsx)(U.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,n.jsx)(U.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,n.jsx)(U.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}})]}):i.length?(0,n.jsx)(ex,{children:i.map(e=>{var t;return(0,n.jsxs)(ed.Z,{children:[(0,n.jsxs)(eo.Z,{children:[(0,n.jsx)(eu.Z,{color:ep(e.event_type),variant:"outlined"}),(0,n.jsx)(em.Z,{})]}),(0,n.jsxs)(ec.Z,{sx:{"& svg":{verticalAlign:"bottom",mx:4}},children:[(0,n.jsxs)(r.Z,{sx:{mb:1.5,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsxs)(u.Z,{variant:"subtitle1",sx:{mr:2},children:[(null===(t=e.actor_detail)||void 0===t?void 0:t.fullname)||"—"," — ",e.message||e.event_type]}),(0,n.jsx)(u.Z,{variant:"caption",sx:{color:"text.disabled"},children:e.created_time?new Date(e.created_time).toLocaleString():""})]}),e.from_status||e.to_status?(0,n.jsx)(c.Z,{direction:"row",spacing:1,sx:{flexWrap:"wrap",rowGap:1},children:(0,n.jsx)(x.Z,{size:"small",variant:"outlined",color:"info",label:e.from_status&&e.to_status?"".concat(eh(a,e.from_status)," → ").concat(eh(a,e.to_status)):eh(a,e.to_status||e.from_status)})}):null]})]},e.id)})}):(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(a("tasks.view.history.empty"))})]})})}var eg=a(89540),ej=a(69447),ef=a(54560);let eb=(0,er.ZP)(el.Z)(e=>{let{theme:t}=e;return{"& .MuiTimelineItem-root:nth-of-type(even) .MuiTimelineContent-root":{textAlign:"left"},[t.breakpoints.down("md")]:{"& .MuiTimelineItem-root":{width:"100%","&:before":{display:"none"}}}}}),ew=e=>{switch(e){case"assigned":case"status_changed":return"info";case"part_created":case"task_created":return"primary";case"commented":case"file_added":case"part_returned":case"task_returned":return"warning";case"part_completed":case"task_completed":return"success";case"part_cancelled":case"task_cancelled":return"error";default:return"grey"}},eZ=e=>{switch(e){case"assigned":return"tabler:user-check";case"part_created":return"tabler:subtask";case"file_added":return"tabler:paperclip";case"commented":return"tabler:message-circle";case"task_created":return"tabler:file-plus";case"status_changed":return"tabler:refresh";case"part_completed":case"task_completed":return"tabler:circle-check";case"part_returned":case"task_returned":return"tabler:arrow-back-up";case"part_cancelled":case"task_cancelled":return"tabler:circle-x";default:return"tabler:info-circle"}},ey=e=>{let t=(e||"").split("?")[0].trim();if(!t)return"";try{let e=t.split("/");return decodeURIComponent(e[e.length-1]||t)}catch(e){return t}};var ek=e=>{let{id:t}=e,{t:a}=(0,M.$G)(),i=e=>{if(!e)return"";let t="documents.status.".concat(e),n=String(a(t));return n===t?e:n},{data:s=[],isLoading:l}=(0,W.a)({queryKey:["task-events",t],queryFn:async()=>{var e;return(null===(e=(await b.Do.get(f.Z.taskEvent,{task:t,limit:50})).data)||void 0===e?void 0:e.results)||[]},staleTime:1e4}),{settings:m}=(0,ef.r)(),h=(0,eg.Z)(e=>e.breakpoints.down("md")),{direction:p}=m;return l?(0,n.jsxs)(c.Z,{spacing:2,children:[(0,n.jsx)(U.Z,{variant:"text",width:"40%"}),(0,n.jsx)(U.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,n.jsx)(U.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,n.jsx)(U.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}})]}):(0,n.jsx)(d.Z,{children:(0,n.jsx)(o.Z,{children:(0,n.jsx)(eb,{position:h?"right":"alternate",children:s.length?s.map((e,t)=>{var s,l,d,o,m,h,p,v;let g=eZ(e.event_type),f=ew(e.event_type),b=(null===(s=e.actor_detail)||void 0===s?void 0:s.fullname)||"—",w=e.message||e.event_type,Z=e.created_time?new Date(e.created_time).toLocaleString():"",y=null==e?void 0:null===(l=e.extra)||void 0===l?void 0:l.file,k="".concat("https://api-doc.optivora-group.com","/").concat(y),S=ey(y);return(0,n.jsxs)(ed.Z,{children:[(0,n.jsxs)(eo.Z,{children:[(0,n.jsx)(ej.Z,{skin:"light",color:f,children:(0,n.jsx)(j.Z,{icon:g,fontSize:20})}),(0,n.jsx)(em.Z,{})]}),(0,n.jsxs)(ec.Z,{sx:{"& svg":{verticalAlign:"bottom",mx:1}},children:[(0,n.jsxs)(r.Z,{sx:{mb:1,display:"flex",gap:2,flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsxs)(u.Z,{variant:"subtitle1",sx:{mr:2},children:[b," — ",w]}),(0,n.jsx)(u.Z,{variant:"caption",sx:{color:"text.disabled"},children:Z})]}),(0,n.jsxs)(c.Z,{direction:"row",spacing:1,sx:{flexWrap:"wrap",rowGap:1},children:[y?(0,n.jsx)(x.Z,{size:"small",icon:(0,n.jsx)(j.Z,{icon:"tabler:download"}),label:S||String(a("common.file")||"File"),component:"a",href:k,target:"_blank",rel:"noopener noreferrer",clickable:!0,variant:"outlined",color:"primary"}):null,(null===(d=e.part_detail)||void 0===d?void 0:d.title)?(0,n.jsx)(x.Z,{size:"small",label:"Qism: ".concat(e.part_detail.title)}):null,(null===(m=e.part_detail)||void 0===m?void 0:null===(o=m.department_detail)||void 0===o?void 0:o.name)?(0,n.jsx)(x.Z,{size:"small",label:"Bo'lim: ".concat(e.part_detail.department_detail.name)}):null,(null===(p=e.part_detail)||void 0===p?void 0:null===(h=p.assignee_detail)||void 0===h?void 0:h.fullname)?(0,n.jsx)(x.Z,{size:"small",label:"Ijrochi: ".concat(e.part_detail.assignee_detail.fullname)}):null,e.from_status||e.to_status?(0,n.jsx)(x.Z,{size:"small",variant:"outlined",color:"info",label:e.from_status&&e.to_status?"".concat(i(e.from_status)," → ").concat(i(e.to_status)):i(e.to_status||e.from_status)}):null,null]})]})]},null!==(v=e.id)&&void 0!==v?v:t)}):(0,n.jsx)(r.Z,{sx:{py:2},children:(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(a("tasks.view.process.empty"))})})})})})},eS=()=>{var e,t,a,v;let{t:w}=(0,M.$G)(),{id:Z}=(0,s.useRouter)().query,[y,k]=(0,i.useState)(0),{user:S}=(0,A.a)(),_=(0,R.Z)(),[N,D]=(0,i.useState)(void 0),[P,C]=(0,i.useState)(!1),{data:I,refetch:z}=(0,W.a)({queryKey:["task",Z],enabled:!!Z,queryFn:async()=>(await b.Do.get(f.Z.taskById(Z))).data}),{data:V,refetch:T}=(0,W.a)({queryKey:["task-part",N],enabled:!!N,queryFn:async()=>(await b.Do.get(f.Z.taskPartById(N))).data}),F=async()=>{if(!Z||!I){_.error(String(w("errors.generic"))||"Task ID not found");return}C(!0);try{await b.Do.post(f.Z.taskSendToEmail,{task_id:I.id}),_.success(String(w("tasks.view.parts.emailSent")||"Email sent successfully"))}catch(n){var e,t;let a=(null==n?void 0:null===(t=n.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||(null==n?void 0:n.message)||String(w("errors.generic"));_.error(a)}finally{C(!1)}};return(0,n.jsx)(r.Z,{children:(0,n.jsxs)(l.ZP,{container:!0,spacing:4,children:[(0,n.jsxs)(l.ZP,{item:!0,xs:12,md:8,lg:9,children:[(0,n.jsx)(d.Z,{children:(0,n.jsxs)(o.Z,{children:[(0,n.jsxs)(c.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,n.jsx)(u.Z,{variant:"h6",children:I?String(w("tasks.view.header.titleWithId",{id:I.id,name:I.name})):String(w("tasks.view.header.title"))}),(0,n.jsxs)(c.Z,{direction:"row",spacing:1,alignItems:"center",children:[(null==S?void 0:null===(e=S.role_detail)||void 0===e?void 0:e.some(e=>"Admin"===e.name))&&(0,n.jsx)(m.Z,{size:"small",variant:"outlined",component:g(),href:Z?"/tasks/update/".concat(Z):"#",disabled:!Z,startIcon:(0,n.jsx)(j.Z,{icon:"mdi:pencil"}),children:String(w("common.edit"))}),(0,n.jsx)(x.Z,{label:String(w("tasks.view.header.status",{value:(e=>{if(!e)return"—";let t="documents.status.".concat(e.split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")),a=String(w(t));return a===t?e:a})(null==I?void 0:I.status)})),size:"small"}),(0,n.jsx)(x.Z,{label:String(w("tasks.view.header.priority",{value:(e=>{if(!e)return"—";let t="tasks.priority.".concat("orgently"===e?"orgently":"normal"===e?"ordinary":e),a=String(w(t));return a===t?e:a})(null==I?void 0:I.priority)})),size:"small"}),(0,n.jsx)(x.Z,{label:String(w("tasks.view.header.type",{value:(e=>{if(!e)return"—";let t="tasks.type.".concat(e),a=String(w(t));return a===t?e:a})(null==I?void 0:I.type)})),size:"small"}),(null==I?void 0:I.end_date)&&(0,n.jsx)(x.Z,{label:String(w("tasks.view.header.deadline",{value:Y()(I.end_date).format("DD.MM.YYYY HH:mm")})),size:"small"})]})]}),(0,n.jsxs)(r.Z,{sx:{mt:1,display:"flex",gap:3,flexWrap:"wrap",alignItems:"center"},children:[(0,n.jsxs)(r.Z,{children:[(0,n.jsxs)(u.Z,{component:"span",sx:{fontWeight:700,mr:1},children:[String(w("tasks.view.document.fields.inputDocNumber")),":"]}),(0,n.jsx)(u.Z,{component:"span",children:null!==(a=null==I?void 0:I.input_doc_number)&&void 0!==a?a:"—"})]}),(0,n.jsxs)(r.Z,{children:[(0,n.jsxs)(u.Z,{component:"span",sx:{fontWeight:700,mr:1},children:[String(w("tasks.view.document.fields.outputDocNumber")),":"]}),(0,n.jsx)(u.Z,{component:"span",children:null!==(v=null==I?void 0:I.output_doc_number)&&void 0!==v?v:"—"})]})]}),(0,n.jsxs)(h.Z,{value:y,onChange:(e,t)=>k(t),sx:{mt:2},variant:"scrollable",scrollButtons:"auto",children:[(0,n.jsx)(p.Z,{label:String(w("tasks.view.tabs.document"))}),(0,n.jsx)(p.Z,{label:String(w("tasks.view.tabs.history"))}),(0,n.jsx)(p.Z,{label:String(w("tasks.view.tabs.process"))})]})]})}),(0,n.jsxs)(r.Z,{sx:{mt:3},children:[0===y&&(0,n.jsx)(J,{task:I,selectedPartId:null!=N?N:void 0,setSelectedPartId:D}),1===y&&(0,n.jsx)(ev,{id:Z}),2===y&&(0,n.jsx)(ek,{id:Z})]})]}),(0,n.jsx)(l.ZP,{item:!0,xs:12,md:4,lg:3,children:(0,n.jsxs)(c.Z,{spacing:3,children:[(0,n.jsx)(es,{task:I,part:V,mutate:()=>{z(),T()}}),(0,n.jsx)(r.Z,{sx:{display:"flex",justifyContent:"flex-end"},children:(null==S?void 0:null===(t=S.role_detail)||void 0===t?void 0:t.some(e=>"Admin"===e.name||"Manager"===e.name))&&(null==I?void 0:I.status)==="new"&&(0,n.jsx)(m.Z,{variant:"outlined",onClick:F,disabled:P||!I,startIcon:(0,n.jsx)(j.Z,{icon:P?"mdi:loading":"mdi:email-send"}),children:String(w("tasks.view.parts.sendToEmail")||"Send to email")})})]})})]})})};function e_(){return(0,n.jsx)(eS,{})}}},function(e){e.O(0,[4885,2785,3035,9716,1421,8833,1377,7555,2888,9774,179],function(){return e(e.s=94487)}),_N_E=e.O()}]);