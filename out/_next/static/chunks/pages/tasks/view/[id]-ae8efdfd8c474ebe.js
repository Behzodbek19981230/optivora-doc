(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7749],{94487:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tasks/view/[id]",function(){return a(82090)}])},69447:function(e,t,a){"use strict";var i=a(85893),n=a(18745),r=a(17494),s=a(2339),l=a(17643);let d=e=>{let{sx:t,skin:a,color:d,variant:o}=e,c=(0,n.Z)(),u=(0,s.Z)(),m={primary:{boxShadow:"none",color:c.palette.primary.main,backgroundColor:u.primaryLight.backgroundColor},secondary:{boxShadow:"none",color:c.palette.secondary.main,backgroundColor:u.secondaryLight.backgroundColor},success:{boxShadow:"none",color:c.palette.success.main,backgroundColor:u.successLight.backgroundColor},error:{boxShadow:"none",color:c.palette.error.main,backgroundColor:u.errorLight.backgroundColor},warning:{boxShadow:"none",color:c.palette.warning.main,backgroundColor:u.warningLight.backgroundColor},info:{boxShadow:"none",color:c.palette.info.main,backgroundColor:u.infoLight.backgroundColor},grey:{boxShadow:"none",color:c.palette.grey[500],backgroundColor:(0,l.E)(c.palette.grey[500],.12)}};return(0,i.jsx)(r.Z,{...e,sx:d&&"light"===a&&"filled"===o?Object.assign(m[d],t):t})};d.defaultProps={color:"grey",variant:"filled"},t.Z=d},1652:function(e,t,a){"use strict";a.d(t,{cP:function(){return n}});var i=a(77527);let n=(0,i.ZP)("div")(e=>{let{theme:t}=e;return{"& .rdw-editor-wrapper":{border:"1px solid ".concat(t.palette.divider),"& .rdw-editor-toolbar":{border:0,marginBottom:0,background:t.palette.background.paper,borderBottom:"1px solid ".concat(t.palette.divider),"& .rdw-fontsize-dropdown":{minWidth:50},"& .rdw-link-modal":{height:"auto"},"& .rdw-colorpicker-modal, & .rdw-link-modal, & .rdw-embedded-modal, & .rdw-emoji-modal, & .rdw-image-modal":{boxShadow:t.shadows[8],borderColor:t.palette.divider,backgroundColor:t.palette.background.paper},"& .rdw-dropdown-optionwrapper":{boxShadow:t.shadows[8],borderColor:t.palette.divider,backgroundColor:t.palette.background.paper,"& .rdw-dropdownoption-highlighted":{backgroundColor:t.palette.action.hover},"& .rdw-dropdownoption-active":{backgroundColor:t.palette.action.selected}},"& .rdw-option-wrapper, & .rdw-dropdown-wrapper":{borderRadius:"4px !important",borderColor:t.palette.divider,background:t.palette.background.paper,"& .rdw-dropdown-carettoopen":{left:"auto",right:"10%",borderTopColor:t.palette.text.disabled},"& .rdw-dropdown-carettoclose":{left:"auto",right:"10%",borderBottomColor:t.palette.text.disabled},..."dark"===t.palette.mode?{"& img":{filter:"invert(1)"}}:{},"&:hover":{boxShadow:"none",backgroundColor:"rgba(".concat(t.palette.customColors.main,", 0.08)")}},"& .rdw-embedded-modal-size-input, & .rdw-image-modal-size-input":{width:"60%",minHeight:30},"& .rdw-link-modal-input, & .rdw-embedded-modal-link-input, & .rdw-image-modal-url-input":{minHeight:38},"& .rdw-link-modal-input, & .rdw-embedded-modal-link-input, & .rdw-image-modal-url-input, & .rdw-embedded-modal-size-input, & .rdw-image-modal-size-input":{background:"none",padding:t.spacing(0,3.5),color:t.palette.text.primary,borderColor:t.palette.divider,borderRadius:t.shape.borderRadius,fontSize:t.typography.body1.fontSize,"&:focus":{borderColor:t.palette.primary.main},"&::placeholder, &:-ms-input-placeholder, &::-ms-input-placeholder":{color:t.palette.text.disabled}},"& .rdw-link-modal-btn, & .rdw-embedded-modal-btn, & .rdw-image-modal-btn":{border:0,lineHeight:1.71,borderRadius:"5px",letterSpacing:"0.3px",textTransform:"uppercase",fontWeight:t.typography.fontWeightMedium,"&:first-of-type:not([disabled])":{boxShadow:t.shadows[3],color:t.palette.primary.contrastText,backgroundColor:t.palette.primary.main,"&:hover":{boxShadow:t.shadows[4],backgroundColor:t.palette.primary.dark},"&:active":{boxShadow:t.shadows[3]}},"&:last-child":{boxShadow:t.shadows[3],color:t.palette.secondary.contrastText,backgroundColor:t.palette.secondary.main,"&:hover":{boxShadow:t.shadows[4],backgroundColor:t.palette.secondary.dark},"&:active":{boxShadow:t.shadows[3]}},"&[disabled]":{cursor:"default",boxShadow:"none",color:t.palette.text.disabled,backgroundColor:t.palette.action.disabledBackground}}},"& .rdw-editor-main":{cursor:"text",padding:"0 1rem",minHeight:"10rem",color:t.palette.text.primary,..."rtl"===t.direction?{"& .public-DraftStyleDefault-block":{direction:"ltr !important",textAlign:"left !important"}}:{}}}}});(0,i.ZP)("div")(()=>({"& .rdw-editor-wrapper":{display:"flex",flexDirection:"column-reverse"}})),(0,i.ZP)("div")(()=>({"& .rdw-editor-wrapper, & .rdw-editor-toolbar":{border:"0 !important"}}))},33251:function(e,t,a){"use strict";a.d(t,{z:function(){return s}});var i=a(30202),n=a(33934),r=a(52293);let s=function(e){var t,a;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=!(arguments.length>2)||void 0===arguments[2]||arguments[2],d=(0,i.NL)(),o=["list",e,s],c=Object.fromEntries(Object.entries(s).filter(e=>{let[,t]=e;return void 0!==t})),{data:u,isLoading:m,error:p}=(0,n.a)({queryKey:o,queryFn:async()=>{var t,a,i;let n=(await r.Do.get(e,c)).data,s=Array.isArray(n)?n:null!==(a=null==n?void 0:n.results)&&void 0!==a?a:[],l=Array.isArray(n)?s.length:null!==(i=null==n?void 0:null===(t=n.pagination)||void 0===t?void 0:t.total)&&void 0!==i?i:s.length;return{items:s,total:l}},enabled:l,staleTime:3e4});return{data:null!==(t=null==u?void 0:u.items)&&void 0!==t?t:[],total:null!==(a=null==u?void 0:u.total)&&void 0!==a?a:0,loading:m,error:p,mutate:()=>{d.invalidateQueries({queryKey:o})}}}},82090:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return eG}});var i=a(85893),n=a(67294),r=a(11163),s=a(90642),l=a(68573),d=a(60762),o=a(71919),c=a(84166),u=a(96788),m=a(51015),p=a(81873),x=a(43374),h=a(28907),g=a(41664),v=a.n(g),j=a(75673),b=a(74538),f=a(52293),w=a(56912),k=a(33453),Z=a(92365),y=a(40110),S=a(46070),_=a(96727),C=a(76592),D=a(70360),N=a(46577),P=a(8863),z=a(19827),I=a(21038),F=a(52857),T=a(22120),q=a(30381),A=a.n(q),V=a(34273);function Y(e){var t;let{parts:a,selectedPartId:n,setSelectedPartId:r,onDelete:s,onAdd:l}=e,{t:x}=(0,T.$G)(),{user:h}=(0,V.a)(),g=null==h?void 0:null===(t=h.role_detail)||void 0===t?void 0:t.some(e=>"Admin"===e.name),v=e=>{switch(e){case"new":default:return"default";case"in_progress":return"info";case"on_review":case"returned":return"warning";case"done":return"success";case"cancelled":return"error"}},b=e=>{if(!e)return"—";let t="documents.status.".concat(e.split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")),a=String(x(t));return a===t?e:a};return(0,i.jsx)(d.Z,{children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.Z,{children:(0,i.jsxs)(c.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[(0,i.jsx)(u.Z,{variant:"subtitle2",children:String(x("tasks.view.parts.title"))}),(0,i.jsxs)(c.Z,{direction:"row",spacing:1,alignItems:"center",children:[(0,i.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:String(x("tasks.view.parts.count",{count:a.length}))}),g&&l&&(0,i.jsx)(m.Z,{variant:"contained",size:"small",startIcon:(0,i.jsx)(j.Z,{icon:"mdi:plus"}),onClick:l,children:String(x("common.add"))})]})]})}),a.length?(0,i.jsxs)(C.Z,{size:"small",sx:{"& .MuiTableCell-root":{py:1}},children:[(0,i.jsx)(D.Z,{children:(0,i.jsxs)(N.Z,{children:[(0,i.jsx)(P.Z,{children:String(x("tasks.view.parts.table.title"))}),(0,i.jsx)(P.Z,{children:String(x("tasks.view.parts.table.status"))}),(0,i.jsx)(P.Z,{children:String(x("tasks.view.parts.table.department"))}),(0,i.jsx)(P.Z,{children:String(x("tasks.view.parts.table.assignee"))}),(0,i.jsx)(P.Z,{children:String(x("tasks.view.parts.table.start"))}),(0,i.jsx)(P.Z,{children:String(x("tasks.view.parts.table.end"))}),g&&(0,i.jsx)(P.Z,{align:"right",children:String(x("common.actions"))})]})}),(0,i.jsx)(z.Z,{children:a.map(e=>{var t,a;let l=n===e.id;return(0,i.jsxs)(N.Z,{hover:!0,selected:l,onClick:()=>r(e.id),sx:{cursor:"pointer"},children:[(0,i.jsxs)(P.Z,{children:[(0,i.jsx)(c.Z,{direction:"row",spacing:1,alignItems:"center",children:(0,i.jsx)(u.Z,{variant:"body2",sx:{fontWeight:600},children:e.title||String(x("tasks.view.parts.partFallbackTitle",{id:e.id}))})}),!!e.note&&(0,i.jsx)(u.Z,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:e.note})]}),(0,i.jsx)(P.Z,{children:(0,i.jsx)(p.Z,{size:"small",label:b(e.status),color:v(e.status),variant:"outlined"})}),(0,i.jsx)(P.Z,{children:(null===(t=e.department_detail)||void 0===t?void 0:t.name)||e.department}),(0,i.jsx)(P.Z,{children:(null===(a=e.assignee_detail)||void 0===a?void 0:a.fullname)||e.assignee}),(0,i.jsx)(P.Z,{children:A()(e.start_date).isValid()?A()(e.start_date).format("DD.MM.YYYY HH:mm"):"—"}),(0,i.jsx)(P.Z,{children:A()(e.end_date).isValid()?A()(e.end_date).format("DD.MM.YYYY HH:mm"):"—"}),g&&(0,i.jsx)(P.Z,{align:"right",onClick:e=>e.stopPropagation(),children:(0,i.jsx)(c.Z,{direction:"row",spacing:1,justifyContent:"flex-end",children:(0,i.jsx)(I.Z,{title:String(x("common.delete")),children:(0,i.jsx)(F.Z,{size:"small",color:"error",onClick:()=>s(e.id),children:(0,i.jsx)(j.Z,{icon:"mdi:delete"})})})})})]},e.id)})})]}):(0,i.jsx)(o.Z,{children:(0,i.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(x("tasks.view.parts.empty"))})})]})})}var M=a(30202),W=a(33934),R=a(14934),E=a(47407),L=a(19304),H=a(87590),B=a(32200),G=a(61769),K=a(21201);let O=e=>{let t=(e.file||"").trim(),a=(e.link||"").trim();if(!t&&!a)return"Fayl #".concat(e.id);try{let e=(t||a).split("?")[0],i=e.split("/");return decodeURIComponent(i[i.length-1]||e)}catch(e){return t||a}},Q=e=>{let t=(e||"").toLowerCase().split("?")[0],a=t.split(".").pop();return a&&a!==t?a:""},$=e=>{switch(e){case"pdf":return"tabler:file-type-pdf";case"doc":case"docx":return"tabler:file-type-doc";case"xls":case"xlsx":return"tabler:file-type-xls";case"ppt":case"pptx":return"tabler:file-type-ppt";case"png":case"jpg":case"jpeg":case"webp":case"gif":return"tabler:photo";case"zip":case"rar":case"7z":return"tabler:archive";default:return"tabler:file"}},U=e=>{let t=(e.link||"").trim(),a=(e.file||"").trim();return t||a||"#"},J=e=>(e.link||"").trim()&&!(e.file||"").trim()?"tabler:link":$(Q(String(e.file||e.link||"")));function X(e){let{taskId:t,partId:a,isCompact:r}=e,{t:l}=(0,T.$G)(),{data:m,isLoading:x,isError:h}=(0,W.a)({queryKey:["task-attachments",t,void 0===a?"all":a],queryFn:async()=>{let e={task:t,limit:50};return void 0!==a&&(e.part=null===a?"":a),(await f.Do.get(b.Z.taskAttachment,e)).data||{results:[]}},enabled:!!t||!!a,staleTime:1e4}),g=(null==m?void 0:m.results)||[];return x?(0,i.jsxs)(c.Z,{spacing:2,children:[(0,i.jsx)(R.Z,{variant:"text",width:"30%"}),(0,i.jsx)(R.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,i.jsx)(R.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,i.jsx)(R.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}})]}):h?(0,i.jsx)(u.Z,{variant:"body2",color:"error",children:String(l("tasks.view.attachments.loadError"))}):g.length?r?(0,i.jsx)(d.Z,{variant:"outlined",sx:{mb:2},children:(0,i.jsx)(o.Z,{sx:{py:"0.75rem !important"},children:(0,i.jsxs)(c.Z,{direction:"row",spacing:3,alignItems:"center",flexWrap:"wrap",useFlexGap:!0,children:[(0,i.jsxs)(u.Z,{variant:"subtitle2",sx:{mr:2},children:[String(l("tasks.view.attachments.title")),":"]}),g.map(e=>{let t=O(e),a=J(e),n=U(e);return(0,i.jsx)(p.Z,{icon:(0,i.jsx)(j.Z,{icon:a}),label:t,component:"a",href:n,target:"_blank",clickable:!0,size:"small",variant:"outlined",color:"primary"},e.id)})]})})}):(0,i.jsx)(d.Z,{children:(0,i.jsxs)(o.Z,{children:[(0,i.jsxs)(s.Z,{sx:{mb:2,display:"flex",alignItems:"center",justifyContent:"space-between",gap:2},children:[(0,i.jsx)(u.Z,{variant:"subtitle2",children:String(l("tasks.view.attachments.title"))}),(0,i.jsx)(p.Z,{size:"small",color:"info",label:String(l("tasks.view.attachments.count",{count:g.length}))})]}),(0,i.jsx)(E.Z,{disablePadding:!0,children:g.map((e,t)=>{var a,r,s;let d=O(e),o=J(e),m=e.created_time||e.created_at||e.updated_time||e.updated_at,x=m?A()(m).format("DD.MM.YYYY HH:mm"):"",h=(null===(a=e.uploaded_by_detail)||void 0===a?void 0:a.fullname)||(null===(r=e.created_by_detail)||void 0===r?void 0:r.fullname)||("number"==typeof e.uploaded_by?"#".concat(e.uploaded_by):"number"==typeof e.created_by?"#".concat(e.created_by):""),v=U(e);return(0,i.jsxs)(n.Fragment,{children:[(0,i.jsxs)(L.ZP,{disableGutters:!0,secondaryAction:v&&"#"!==v?(0,i.jsx)(I.Z,{title:String(l("tasks.view.attachments.openOrDownload")),children:(0,i.jsx)(F.Z,{component:"a",href:v,target:"_blank",rel:"noreferrer",children:(0,i.jsx)(j.Z,{icon:"tabler:download"})})}):null,sx:{py:1.25,px:1,borderRadius:2,"&:hover":{backgroundColor:e=>e.palette.action.hover}},children:[(0,i.jsx)(H.Z,{children:(0,i.jsx)(K.Z,{variant:"rounded",sx:{width:40,height:40,bgcolor:e=>e.palette.action.selected,color:"text.primary"},children:(0,i.jsx)(j.Z,{icon:o})})}),(0,i.jsx)(B.Z,{primary:(0,i.jsxs)(c.Z,{direction:"row",spacing:1,sx:{alignItems:"center",flexWrap:"wrap",rowGap:1},children:[v&&"#"!==v?(0,i.jsx)(G.Z,{href:v,target:"_blank",rel:"noreferrer",underline:"hover",color:"inherit",children:(0,i.jsx)(u.Z,{variant:"subtitle2",sx:{fontWeight:600},children:d})}):(0,i.jsx)(u.Z,{variant:"subtitle2",sx:{fontWeight:600},children:d}),(()=>{let t=Q(String(e.file||e.link||""));return t?(0,i.jsx)(p.Z,{size:"small",variant:"outlined",label:t.toUpperCase()}):null})(),e.part?(0,i.jsx)(p.Z,{size:"small",variant:"outlined",label:String(l("tasks.view.attachments.partLabel",{id:e.part}))}):null]}),secondary:(0,i.jsxs)(c.Z,{direction:"row",spacing:1,sx:{alignItems:"center",flexWrap:"wrap",rowGap:.5},children:[x?(0,i.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:x}):null,h?(0,i.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:String(l("tasks.view.attachments.uploader",{name:h}))}):null]})})]}),t<g.length-1?(0,i.jsx)(w.Z,{sx:{my:1}}):null]},null!==(s=e.id)&&void 0!==s?s:t)})})]})}):r?null:(0,i.jsx)(d.Z,{children:(0,i.jsx)(o.Z,{children:(0,i.jsx)(s.Z,{sx:{py:2},children:(0,i.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(l("tasks.view.attachments.empty"))})})})})}let ee=e=>{var t,a;let i=(e||"").trim();if(!i)return"?";let n=i.split(" ").filter(Boolean);return(((null===(t=n[0])||void 0===t?void 0:t[0])||"")+((null===(a=n[1])||void 0===a?void 0:a[0])||"")).toUpperCase()||i[0].toUpperCase()};function et(e){let{taskId:t,partId:a}=e,{t:r}=(0,T.$G)(),{data:l,isLoading:m,isError:x}=(0,W.a)({queryKey:["task-comments",t,null!=a?a:null],queryFn:async()=>{let e={task:null!=t?t:"",limit:50};return null!=a&&(e.part=a),(await f.Do.get(b.Z.taskComment,e)).data||{results:[]}},enabled:!!t||!!a,staleTime:1e4}),h=(null==l?void 0:l.results)||[];return m?(0,i.jsxs)(c.Z,{spacing:2,children:[(0,i.jsx)(R.Z,{variant:"text",width:"25%"}),(0,i.jsx)(R.Z,{variant:"rectangular",height:72,sx:{borderRadius:2}}),(0,i.jsx)(R.Z,{variant:"rectangular",height:72,sx:{borderRadius:2}}),(0,i.jsx)(R.Z,{variant:"rectangular",height:72,sx:{borderRadius:2}})]}):x?(0,i.jsx)(u.Z,{variant:"body2",color:"error",children:String(r("tasks.view.comments.loadError"))}):h.length?(0,i.jsx)(d.Z,{children:(0,i.jsxs)(o.Z,{children:[(0,i.jsxs)(s.Z,{sx:{mb:2,display:"flex",alignItems:"center",justifyContent:"space-between",gap:2},children:[(0,i.jsx)(u.Z,{variant:"subtitle2",children:String(r("tasks.view.comments.title"))}),(0,i.jsx)(p.Z,{size:"small",color:"info",label:String(r("tasks.view.comments.count",{count:h.length}))})]}),(0,i.jsx)(E.Z,{disablePadding:!0,children:h.map((e,t)=>{var a,s;let l=e.created_at?new Date(e.created_at).toLocaleString():"",d=e.is_system?String(r("tasks.view.comments.system")):"".concat(null===(a=e.author_detail)||void 0===a?void 0:a.fullname);return(0,i.jsxs)(n.Fragment,{children:[(0,i.jsxs)(L.ZP,{disableGutters:!0,alignItems:"flex-start",sx:{py:1.25,px:1,borderRadius:2,"&:hover":{backgroundColor:e=>e.palette.action.hover}},children:[(0,i.jsx)(H.Z,{children:(0,i.jsx)(K.Z,{sx:{width:40,height:40,bgcolor:t=>e.is_system?t.palette.grey[200]:t.palette.primary.light,color:t=>e.is_system?t.palette.text.primary:t.palette.primary.contrastText},children:e.is_system?(0,i.jsx)(j.Z,{icon:"tabler:settings"}):ee(d)})}),(0,i.jsx)(B.Z,{primary:(0,i.jsxs)(c.Z,{direction:"row",spacing:1,sx:{alignItems:"center",flexWrap:"wrap",rowGap:1},children:[(0,i.jsx)(u.Z,{variant:"subtitle2",sx:{fontWeight:700},children:d}),e.is_system?(0,i.jsx)(p.Z,{size:"small",color:"default",variant:"outlined",label:String(r("tasks.view.comments.system"))}):null,e.part?(0,i.jsx)(p.Z,{size:"small",variant:"outlined",label:String(r("tasks.view.comments.partLabel",{id:e.part}))}):null,l?(0,i.jsxs)(u.Z,{variant:"caption",sx:{color:"text.disabled"},children:["• ",l]}):null]}),secondary:(0,i.jsx)(u.Z,{variant:"body2",color:"text.secondary",sx:{mt:.5,whiteSpace:"pre-wrap",wordBreak:"break-word"},children:e.text||"—"})})]}),t<h.length-1?(0,i.jsx)(w.Z,{sx:{my:1}}):null]},null!==(s=e.id)&&void 0!==s?s:t)})})]})}):(0,i.jsx)(d.Z,{children:(0,i.jsx)(o.Z,{children:(0,i.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(r("tasks.view.comments.empty"))})})})}var ea=a(7879),ei=a(33251),en=a(58898);let er=e=>String(e).padStart(2,"0"),es=e=>"".concat(e.getFullYear(),"-").concat(er(e.getMonth()+1),"-").concat(er(e.getDate()),"T").concat(er(e.getHours()),":").concat(er(e.getMinutes())),el=e=>{if(!e)return null;if(/^\d{4}-\d{2}-\d{2}$/.test(e)){let[t,a,i]=e.split("-").map(Number);return new Date(t,(a||1)-1,i||1,0,0,0,0)}let t=new Date(e);return Number.isNaN(t.getTime())?null:t},ed=e=>{let t=el(e);return t?es(t):""},eo=e=>{if(!e)return"—";let t=A()(e);return t.isValid()?t.format("DD.MM.YYYY HH:mm"):String(e)};function ec(e){var t,a,r,s,p,x;let{task:h,selectedPartId:g,setSelectedPartId:v}=e,{t:j}=(0,T.$G)(),{user:C}=(0,V.a)(),D=(0,en.Z)(),N=(0,M.NL)(),{data:P}=(0,ei.z)(b.Z.department,{page:1,limit:100}),{data:z}=(0,ei.z)(b.Z.users,{page:1,limit:100,roles__name:"Performer"}),[I,F]=(0,n.useState)(null),[q,R]=(0,n.useState)({title:"",department:0,assignee:0,start_date:"",end_date:"",note:""}),E=null==h?void 0:h.id,{data:L}=(0,W.a)({queryKey:["task-parts",null!=E?E:"none"],enabled:!!E,queryFn:async()=>{let e=(await f.Do.get(b.Z.taskPart,{task:String(E),limit:100})).data;return(null==e?void 0:e.results)||e||[]},initialData:[]}),H=async()=>{if(I&&E)try{await f.Do.put(b.Z.taskPartById(I.id),{...q,task:E}),D.success(String(j("common.saved"))),F(null),N.invalidateQueries({queryKey:["task-parts",E]})}catch(e){D.error((null==e?void 0:e.message)||String(j("errors.somethingWentWrong")))}},B=async e=>{if(window.confirm(String(j("common.confirmDelete"))))try{await f.Do.delete(b.Z.taskPartById(e)),D.success(String(j("common.deleted"))),N.invalidateQueries({queryKey:["task-parts",E]})}catch(e){D.error((null==e?void 0:e.message)||String(j("errors.somethingWentWrong")))}},G=async()=>{if(E)try{let e={};if(q.title&&q.title.trim()||(e.title=String(j("errors.required"))),(!q.department||0>=Number(q.department))&&(e.department=String(j("errors.required"))),(!q.assignee||0>=Number(q.assignee))&&(e.assignee=String(j("errors.required"))),q.start_date||(e.start_date=String(j("errors.required"))),q.end_date||(e.end_date=String(j("errors.required"))),q.start_date&&q.end_date){let t=new Date(q.start_date);new Date(q.end_date)<t&&(e.end_date=String(j("errors.endAfterStart")))}if(q.note&&String(q.note).trim()||(e.note=String(j("errors.required"))),Object.keys(e).length>0){D.error(String(j("tasks.toast.partFormRequired")));return}await f.Do.post(b.Z.taskPart,{task:E,title:q.title||"",department:q.department||0,assignee:q.assignee||0,start_date:A()(q.start_date).format("YYYY-MM-DD HH:mm")||"",end_date:A()(q.end_date).format("YYYY-MM-DD HH:mm")||"",status:"new",note:q.note||"",created_by:null==C?void 0:C.id}),D.success(String(j("tasks.toast.partCreated"))),F(null),N.invalidateQueries({queryKey:["task-parts",E]})}catch(e){D.error((null==e?void 0:e.message)||String(j("errors.somethingWentWrong")))}};if(!h)return(0,i.jsx)(d.Z,{children:(0,i.jsx)(o.Z,{children:(0,i.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(j("tasks.view.document.notFound"))})})});let K=e=>{let{label:t,value:a}=e;return(0,i.jsxs)(c.Z,{spacing:.75,children:[(0,i.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:t}),(0,i.jsx)(u.Z,{variant:"body2",sx:{wordBreak:"break-word"},children:null!=a?a:"—"})]})};return(0,i.jsxs)(l.ZP,{container:!0,spacing:4,children:[(0,i.jsx)(l.ZP,{item:!0,xs:12,md:6,children:(0,i.jsx)(d.Z,{children:(0,i.jsxs)(o.Z,{children:[(0,i.jsx)(u.Z,{variant:"subtitle1",sx:{mb:2},children:String(j("tasks.view.document.sections.main"))}),(0,i.jsxs)(l.ZP,{container:!0,spacing:3,children:[(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(K,{label:String(j("tasks.view.document.fields.company")),value:(null===(t=h.company_detail)||void 0===t?void 0:t.name)||h.company})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(K,{label:String(j("tasks.view.document.fields.department")),value:(null===(a=h.department_detail)||void 0===a?void 0:a.name)||h.department})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(K,{label:String(j("tasks.view.document.fields.taskForm")),value:(null===(r=h.task_form_detail)||void 0===r?void 0:r.name)||h.task_form})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(K,{label:String(j("tasks.view.document.fields.magazine")),value:(null===(s=h.list_of_magazine_detail)||void 0===s?void 0:s.name)||h.list_of_magazine})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(K,{label:String(j("tasks.view.document.fields.signedBy")),value:(null===(p=h.signed_by_detail)||void 0===p?void 0:p.fullname)||h.signed_by})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(K,{label:String(j("tasks.view.document.fields.responsiblePerson")),value:null!==(x=h.sending_respon_person)&&void 0!==x?x:"—"})})]})]})})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,md:6,children:(0,i.jsx)(d.Z,{children:(0,i.jsxs)(o.Z,{children:[(0,i.jsx)(u.Z,{variant:"subtitle1",sx:{mb:2},children:String(j("tasks.view.document.sections.dates"))}),(0,i.jsxs)(l.ZP,{container:!0,spacing:3,children:[(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(K,{label:String(j("tasks.view.document.fields.startDate")),value:eo(h.start_date)})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(K,{label:String(j("tasks.view.document.fields.endDate")),value:eo(h.end_date)})})]}),(0,i.jsx)(w.Z,{sx:{my:3}}),(0,i.jsx)(u.Z,{variant:"subtitle1",sx:{mb:2},children:String(j("tasks.view.document.sections.system"))}),(0,i.jsxs)(l.ZP,{container:!0,spacing:3,children:[(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(K,{label:String(j("tasks.view.document.fields.createdAt")),value:A()(h.created_time).format("DD.MM.YYYY HH:mm")})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(K,{label:String(j("tasks.view.document.fields.createdBy")),value:h.created_by})})]})]})})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,children:(0,i.jsx)(X,{taskId:h.id,partId:null,isCompact:!0})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,children:(0,i.jsx)(Y,{parts:L||[],selectedPartId:g,setSelectedPartId:v,onDelete:B,onEdit:e=>{let t=L.find(t=>t.id===e);t&&(F(t),R({title:t.title,department:t.department,assignee:t.assignee,start_date:ed(t.start_date),end_date:ed(t.end_date),note:t.note}))},onAdd:()=>{F({}),R({title:"",department:0,assignee:0,start_date:"",end_date:"",note:""})},taskId:E})}),g&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.ZP,{item:!0,xs:12,children:(0,i.jsx)(X,{taskId:null,partId:g})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,children:(0,i.jsx)(et,{taskId:null,partId:g})})]}),(0,i.jsxs)(k.Z,{open:!!I,onClose:()=>F(null),maxWidth:"sm",fullWidth:!0,children:[(0,i.jsx)(Z.Z,{children:(null==I?void 0:I.id)?String(j("tasks.parts.dialog.editTitle")):String(j("tasks.parts.dialog.title"))}),(0,i.jsx)(y.Z,{children:(0,i.jsxs)(l.ZP,{container:!0,spacing:2,sx:{mt:1},children:[(0,i.jsx)(l.ZP,{item:!0,xs:12,children:(0,i.jsx)(ea.Z,{fullWidth:!0,label:String(j("tasks.parts.form.title")),value:q.title,onChange:e=>R({...q,title:e.target.value})})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,children:(0,i.jsx)(S.Z,{fullWidth:!0,options:P||[],getOptionLabel:e=>e.name,value:(null==P?void 0:P.find(e=>e.id===q.department))||null,onChange:(e,t)=>R({...q,department:(null==t?void 0:t.id)||0}),renderInput:e=>(0,i.jsx)(ea.Z,{...e,label:String(j("tasks.parts.form.department")),placeholder:String(j("common.selectPlaceholder"))})})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,children:(0,i.jsx)(S.Z,{fullWidth:!0,options:z||[],getOptionLabel:e=>e.fullname,value:(null==z?void 0:z.find(e=>e.id===q.assignee))||null,onChange:(e,t)=>R({...q,assignee:(null==t?void 0:t.id)||0}),renderInput:e=>(0,i.jsx)(ea.Z,{...e,label:String(j("tasks.parts.form.assignee")),placeholder:String(j("common.selectPlaceholder"))})})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(ea.Z,{fullWidth:!0,type:"datetime-local",label:String(j("tasks.parts.form.startDate")),value:q.start_date,onChange:e=>R({...q,start_date:e.target.value}),InputLabelProps:{shrink:!0}})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(ea.Z,{fullWidth:!0,type:"datetime-local",label:String(j("tasks.parts.form.endDate")),value:q.end_date,onChange:e=>R({...q,end_date:e.target.value}),InputLabelProps:{shrink:!0}})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,children:(0,i.jsx)(ea.Z,{fullWidth:!0,multiline:!0,rows:3,label:String(j("tasks.parts.form.note")),value:q.note,onChange:e=>R({...q,note:e.target.value})})})]})}),(0,i.jsxs)(_.Z,{children:[(0,i.jsx)(m.Z,{onClick:()=>F(null),children:String(j("common.cancel"))}),(0,i.jsx)(m.Z,{variant:"contained",onClick:(null==I?void 0:I.id)?H:G,children:String(j("common.save"))})]})]})]})}var eu=a(1954);function em(e){var t,a,r,l,o,c,u,p,x,h,g,v,j,b,f,w,S,C,D,N,P,z,I,F,q,V;let{fullTask:Y}=e,M=(0,n.useRef)(null),W=(0,n.useRef)(!1),{t:R}=(0,T.$G)(),[E,L]=(0,n.useState)(!1),H=Math.round(495.0251889168766),B=(0,n.useMemo)(()=>Math.min(.44080604534005036,H/1123),[1123,794,H,350]),G=e=>{if(!e)return"—";let t="documents.status.".concat(e.split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")),a=String(R(t));return a===t?e:a},K=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"—";let a=A()(e);return a.isValid()?a.format(t?"DD.MM.YYYY HH:mm":"DD.MM.YYYY"):"—"},O=()=>'\n    @page { size: A4; margin: 12mm; }\n    html, body { margin: 0; padding: 0; background: #fff; }\n    body { -webkit-print-color-adjust: exact; print-color-adjust: exact; color: #111827; font: 12pt/1.45 "Times New Roman", Times, serif; }\n\n    .print-paper{\n      width:210mm; min-height:297mm; box-sizing:border-box;\n      padding:14mm 12mm; margin:0 auto; background:#fff;\n    }\n\n    .doc-topline{ height: 6px; background: #0F172A; border-radius: 999px; margin-bottom: 10mm; }\n    .doc-header{ display:flex; align-items:center; justify-content:space-between; gap: 12mm; }\n    .doc-header-left{ display:flex; align-items:center; gap: 6mm; min-width: 50mm; }\n    .doc-logo{ width: 22mm; height: 22mm; object-fit: contain; }\n    .doc-company{ font-weight: 700; font-size: 18pt; text-align:center; flex:1; }\n    .doc-header-right{ min-width: 50mm; text-align:right; font-size: 11pt; color: #334155; }\n\n    .doc-subline{ border-top: 1px solid #CBD5E1; margin: 6mm 0 8mm; }\n\n    .section-title{ font-weight: 700; font-size: 13pt; margin: 0 0 3mm; }\n    .meta-grid{ display:grid; grid-template-columns: 1fr 1fr; gap: 3mm 10mm; margin-bottom: 8mm; }\n    .meta-row{ display:flex; gap: 4mm; }\n    .meta-label{ width: 40mm; font-weight: 700; color: #0F172A; }\n    .meta-value{ flex: 1; color: #111827; }\n\n    .note-box{ border: 1px solid #E2E8F0; border-radius: 6px; padding: 4mm; background: #F8FAFC; white-space: pre-wrap; }\n\n    table.parts-table{ width:100%; border-collapse: collapse; margin-top: 4mm; font-size: 11pt; }\n    .parts-table th, .parts-table td{ border: 1px solid #E2E8F0; padding: 3mm 2.5mm; vertical-align: top; }\n    .parts-table th{ background: #F1F5F9; color:#0F172A; font-weight:700; text-align:left; }\n    .parts-table td{ color:#111827; }\n    .muted{ color:#64748B; }\n\n    .doc-footer{ margin-top: 10mm; display:flex; justify-content:space-between; gap: 10mm; font-size: 10.5pt; color:#334155; }\n    .no-print, [data-no-print] { display: none !important; }\n  ',Q=e=>{let t=M.current;if(!t||W.current)return;W.current=!0;let a=t.querySelector(".print-paper"),i=a?a.innerHTML:t.innerHTML,n=null;try{n=window.open("","_blank","height=900,width=900")}catch(e){console.error("window.open failed",e)}if(!n){W.current=!1;return}try{n.opener=null}catch(e){}let r=O();try{n.document.open(),n.document.write('<!doctype html><html><head><meta charset="utf-8"><title>'.concat(String(R("tasks.view.document.header.overline",{defaultValue:"Document"})),"</title><style>").concat(r,'</style></head><body><div class="print-paper">').concat(i,"</div></body></html>")),n.document.close()}catch(e){console.error("Failed to write to print window",e);try{n.close()}catch(e){}W.current=!1;return}setTimeout(()=>{try{if(!n||n.closed)return;n.focus(),e&&n.print()}catch(e){console.error("Print failed",e)}finally{W.current=!1}},800)};return(0,i.jsx)(d.Z,{children:(0,i.jsxs)(s.Z,{ref:M,children:[(0,i.jsx)("style",{children:'\n          /* Screen preview shell (dialog) */\n          .doc-preview-shell{\n            padding: 14px 10px 16px;\n            background: radial-gradient(1200px 400px at 50% 0%, rgba(99,102,241,0.08), rgba(15,23,42,0) 60%),\n                        linear-gradient(180deg, rgba(15,23,42,0.02), rgba(15,23,42,0.06));\n            border-radius: 14px;\n            overflow: auto;\n          }\n          .print-paper{\n            box-sizing: border-box;\n            background: #fff;\n            border-radius: 10px;\n            box-shadow: 0 14px 32px rgba(15, 23, 42, 0.12), 0 2px 8px rgba(15, 23, 42, 0.06);\n            overflow: hidden;\n            border: 1px solid rgba(15, 23, 42, 0.08);\n            padding: 44px 42px;\n            color: #111827;\n            font: 14px/1.5 "Times New Roman", Times, serif;\n          }\n\n          .doc-topline{ height: 6px; background: #0F172A; border-radius: 999px; margin-bottom: 28px; }\n          .doc-header{ display:flex; align-items:center; justify-content:space-between; gap: 34px; }\n          .doc-header-left{ display:flex; align-items:center; gap: 16px; min-width: 180px; }\n          .doc-logo{ width: 64px; height: 64px; object-fit: contain; }\n          .doc-company{ font-weight: 700; font-size: 24px; text-align:center; flex:1; }\n          .doc-header-right{ min-width: 180px; text-align:right; font-size: 12px; color: #475569; }\n          .doc-subline{ border-top: 1px solid rgba(148, 163, 184, 0.55); margin: 18px 0 22px; }\n\n          .section-title{ font-weight: 700; font-size: 16px; margin: 0 0 8px; }\n          .meta-grid{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px 28px; margin-bottom: 18px; }\n          .meta-row{ display:flex; gap: 12px; }\n          .meta-label{ width: 140px; font-weight: 700; color: #0F172A; }\n          .meta-value{ flex:1; color: #111827; }\n          .note-box{ border: 1px solid rgba(148, 163, 184, 0.45); border-radius: 10px; padding: 12px; background: rgba(248, 250, 252, 1); white-space: pre-wrap; }\n\n          table.parts-table{ width:100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }\n          .parts-table th, .parts-table td{ border: 1px solid rgba(226, 232, 240, 1); padding: 9px 8px; vertical-align: top; }\n          .parts-table th{ background: rgba(241, 245, 249, 1); color:#0F172A; font-weight:700; text-align:left; }\n          .parts-table td{ color:#111827; }\n          .muted{ color:#64748B; }\n          .doc-footer{ margin-top: 22px; display:flex; justify-content:space-between; gap: 20px; font-size: 12px; color:#475569; }\n\n          /* Thumbnail */\n          .doc-thumb{\n            width:'.concat(350,"px;\n            height:").concat(H,"px;\n            border-radius: 12px;\n            overflow: hidden;\n            cursor: pointer;\n            position: relative;\n            background: rgba(15,23,42,0.03);\n            border: 1px solid rgba(15,23,42,0.10);\n            box-shadow: 0 10px 24px rgba(15, 23, 42, 0.10), 0 1px 6px rgba(15, 23, 42, 0.06);\n          }\n          .doc-thumb-overlay{\n            position:absolute;\n            inset:auto 6px 6px 6px;\n            display:flex;\n            align-items:center;\n            justify-content:space-between;\n            gap: 8px;\n            padding: 6px 8px;\n            border-radius: 10px;\n            background: rgba(15, 23, 42, 0.70);\n            color: #fff;\n            font: 12px/1.2 Arial, Helvetica, sans-serif;\n          }\n          .doc-thumb-overlay span{ opacity: 0.92; }\n        ")}),(0,i.jsxs)(s.Z,{sx:{p:2},children:[(0,i.jsxs)("div",{className:"doc-thumb",onClick:()=>L(!0),role:"button",tabIndex:0,children:[(0,i.jsx)("div",{style:{width:"".concat(794*B,"px"),height:"".concat(1123*B,"px")},children:(0,i.jsxs)("div",{className:"print-paper",style:{width:"".concat(794,"px"),minHeight:"".concat(1123,"px"),transform:"scale(".concat(B,")"),transformOrigin:"top left"},children:[(0,i.jsx)("div",{className:"doc-topline"}),(0,i.jsxs)("div",{className:"doc-header",children:[(0,i.jsx)("div",{className:"doc-header-left",children:(0,i.jsx)("img",{className:"doc-logo",src:"/logo.svg",alt:"Logo"})}),(0,i.jsx)("div",{className:"doc-company",children:(null==Y?void 0:null===(a=Y.task)||void 0===a?void 0:null===(t=a.company_detail)||void 0===t?void 0:t.name)||"—"}),(0,i.jsxs)("div",{className:"doc-header-right",children:[(0,i.jsx)("div",{className:"muted",children:String(R("tasks.view.document.fields.inputDocNumber",{defaultValue:"Incoming number"}))}),(0,i.jsxs)("div",{style:{fontWeight:700,color:"#0F172A"},children:["№",null!==(I=null==Y?void 0:null===(r=Y.task)||void 0===r?void 0:r.input_doc_number)&&void 0!==I?I:"—"]})]})]}),(0,i.jsx)("div",{className:"doc-subline"}),(0,i.jsx)("div",{className:"section-title",children:String(R("tasks.view.document.sections.main",{defaultValue:"Main information"}))}),(0,i.jsxs)("div",{className:"meta-grid",children:[(0,i.jsxs)("div",{className:"meta-row",children:[(0,i.jsx)("div",{className:"meta-label",children:String(R("tasks.view.document.fields.signedBy",{defaultValue:"Signed by"}))}),(0,i.jsx)("div",{className:"meta-value",children:(null==Y?void 0:null===(o=Y.task)||void 0===o?void 0:null===(l=o.signed_by_detail)||void 0===l?void 0:l.fullname)||"—"})]}),(0,i.jsxs)("div",{className:"meta-row",children:[(0,i.jsx)("div",{className:"meta-label",children:String(R("tasks.view.document.fields.signedDate",{defaultValue:"Signed date"}))}),(0,i.jsx)("div",{className:"meta-value",children:K(null==Y?void 0:null===(c=Y.task)||void 0===c?void 0:c.signed_date)})]}),(0,i.jsxs)("div",{className:"meta-row",children:[(0,i.jsx)("div",{className:"meta-label",children:String(R("tasks.view.actions.partStatus",{defaultValue:"Status"}))}),(0,i.jsx)("div",{className:"meta-value",children:G(null==Y?void 0:null===(u=Y.task)||void 0===u?void 0:u.status)})]}),(0,i.jsxs)("div",{className:"meta-row",children:[(0,i.jsx)("div",{className:"meta-label",children:String(R("tasks.view.actions.deadline",{defaultValue:"Deadline"}))}),(0,i.jsx)("div",{className:"meta-value",children:K(null==Y?void 0:null===(p=Y.task)||void 0===p?void 0:p.end_date,!0)})]})]}),(0,i.jsx)("div",{className:"section-title",children:String(R("tasks.view.document.sections.note",{defaultValue:"Note"}))}),(0,i.jsx)("div",{className:"note-box",children:(null==Y?void 0:null===(x=Y.task)||void 0===x?void 0:x.note)||"—"}),(0,i.jsx)("div",{style:{height:18}}),(0,i.jsx)("div",{className:"section-title",children:String(R("tasks.view.document.sections.parts",{defaultValue:"Parts"}))}),(0,i.jsxs)("table",{className:"parts-table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{style:{width:"18%"},children:String(R("tasks.view.parts.table.assignee",{defaultValue:"Assignee"}))}),(0,i.jsx)("th",{style:{width:"18%"},children:String(R("tasks.view.parts.table.department",{defaultValue:"Department"}))}),(0,i.jsx)("th",{style:{width:"12%"},children:String(R("tasks.view.document.fields.startDate",{defaultValue:"Start date"}))}),(0,i.jsx)("th",{style:{width:"12%"},children:String(R("tasks.view.document.fields.endDate",{defaultValue:"End date"}))}),(0,i.jsx)("th",{style:{width:"12%"},children:String(R("tasks.view.actions.partStatus",{defaultValue:"Status"}))}),(0,i.jsx)("th",{children:String(R("tasks.form.note",{defaultValue:"Note"}))})]})}),(0,i.jsx)("tbody",{children:((null==Y?void 0:Y.parts)||[]).map(e=>{var t,a;return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(null===(t=e.assignee_detail)||void 0===t?void 0:t.fullname)||"—"}),(0,i.jsx)("td",{children:(null===(a=e.department_detail)||void 0===a?void 0:a.name)||"—"}),(0,i.jsx)("td",{children:K(e.start_date,!0)}),(0,i.jsx)("td",{children:K(e.end_date,!0)}),(0,i.jsx)("td",{children:G(e.status)}),(0,i.jsx)("td",{children:e.note||"—"})]},e.id)})})]}),(0,i.jsxs)("div",{className:"doc-footer",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"muted",children:String(R("common.createdAt",{defaultValue:"Created at"}))}),(0,i.jsx)("div",{children:K(null==Y?void 0:null===(h=Y.task)||void 0===h?void 0:h.created_time,!0)})]}),(0,i.jsxs)("div",{style:{textAlign:"right"},children:[(0,i.jsx)("div",{className:"muted",children:String(R("tasks.view.document.header.overline",{defaultValue:"Document"}))}),(0,i.jsx)("div",{style:{fontWeight:700,color:"#0F172A"},children:String(R("tasks.view.document.header.fallbackTitle",{id:null!==(F=null==Y?void 0:null===(g=Y.task)||void 0===g?void 0:g.id)&&void 0!==F?F:"—",defaultValue:"Task #{{id}}"}))})]})]})]})}),(0,i.jsxs)("div",{className:"doc-thumb-overlay",children:[(0,i.jsx)("span",{children:String(R("tasks.view.document.actions.openPdf",{defaultValue:"Open PDF view"}))}),(0,i.jsx)(eu.JO,{icon:"tabler:zoom-in"})]})]}),(0,i.jsxs)(k.Z,{open:E,onClose:()=>L(!1),maxWidth:"lg",fullWidth:!0,children:[(0,i.jsx)(Z.Z,{children:String(R("tasks.view.document.header.overline",{defaultValue:"Document"}))}),(0,i.jsx)(y.Z,{dividers:!0,children:(0,i.jsx)(s.Z,{className:"doc-preview-shell",children:(0,i.jsx)(s.Z,{sx:{width:"".concat(Math.round(714.6),"px"),minHeight:"".concat(Math.round(1010.7),"px"),margin:"0 auto"},children:(0,i.jsx)("div",{style:{width:"".concat(714.6,"px"),minHeight:"".concat(1010.7,"px")},children:(0,i.jsxs)("div",{className:"print-paper",style:{width:"".concat(794,"px"),minHeight:"".concat(1123,"px"),transform:"scale(".concat(.9,")"),transformOrigin:"top left"},children:[(0,i.jsx)("div",{className:"doc-topline"}),(0,i.jsxs)("div",{className:"doc-header",children:[(0,i.jsx)("div",{className:"doc-header-left",children:(0,i.jsx)("img",{className:"doc-logo",src:"/logo.svg",alt:"Logo"})}),(0,i.jsx)("div",{className:"doc-company",children:(null==Y?void 0:null===(j=Y.task)||void 0===j?void 0:null===(v=j.company_detail)||void 0===v?void 0:v.name)||"—"}),(0,i.jsxs)("div",{className:"doc-header-right",children:[(0,i.jsx)("div",{className:"muted",children:String(R("tasks.view.document.fields.inputDocNumber",{defaultValue:"Incoming number"}))}),(0,i.jsxs)("div",{style:{fontWeight:700,color:"#0F172A"},children:["№",null!==(q=null==Y?void 0:null===(b=Y.task)||void 0===b?void 0:b.input_doc_number)&&void 0!==q?q:"—"]})]})]}),(0,i.jsx)("div",{className:"doc-subline"}),(0,i.jsx)("div",{className:"section-title",children:String(R("tasks.view.document.sections.main",{defaultValue:"Main information"}))}),(0,i.jsxs)("div",{className:"meta-grid",children:[(0,i.jsxs)("div",{className:"meta-row",children:[(0,i.jsx)("div",{className:"meta-label",children:String(R("tasks.view.document.fields.signedBy",{defaultValue:"Signed by"}))}),(0,i.jsx)("div",{className:"meta-value",children:(null==Y?void 0:null===(w=Y.task)||void 0===w?void 0:null===(f=w.signed_by_detail)||void 0===f?void 0:f.fullname)||"—"})]}),(0,i.jsxs)("div",{className:"meta-row",children:[(0,i.jsx)("div",{className:"meta-label",children:String(R("tasks.view.document.fields.signedDate",{defaultValue:"Signed date"}))}),(0,i.jsx)("div",{className:"meta-value",children:K(null==Y?void 0:null===(S=Y.task)||void 0===S?void 0:S.signed_date)})]}),(0,i.jsxs)("div",{className:"meta-row",children:[(0,i.jsx)("div",{className:"meta-label",children:String(R("tasks.view.actions.partStatus",{defaultValue:"Status"}))}),(0,i.jsx)("div",{className:"meta-value",children:G(null==Y?void 0:null===(C=Y.task)||void 0===C?void 0:C.status)})]}),(0,i.jsxs)("div",{className:"meta-row",children:[(0,i.jsx)("div",{className:"meta-label",children:String(R("tasks.view.actions.deadline",{defaultValue:"Deadline"}))}),(0,i.jsx)("div",{className:"meta-value",children:K(null==Y?void 0:null===(D=Y.task)||void 0===D?void 0:D.end_date,!0)})]})]}),(0,i.jsx)("div",{className:"section-title",children:String(R("tasks.view.document.sections.note",{defaultValue:"Note"}))}),(0,i.jsx)("div",{className:"note-box",children:(null==Y?void 0:null===(N=Y.task)||void 0===N?void 0:N.note)||"—"}),(0,i.jsx)("div",{style:{height:18}}),(0,i.jsx)("div",{className:"section-title",children:String(R("tasks.view.document.sections.parts",{defaultValue:"Parts"}))}),(0,i.jsxs)("table",{className:"parts-table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{style:{width:"18%"},children:String(R("tasks.view.parts.table.assignee",{defaultValue:"Assignee"}))}),(0,i.jsx)("th",{style:{width:"18%"},children:String(R("tasks.view.parts.table.department",{defaultValue:"Department"}))}),(0,i.jsx)("th",{style:{width:"12%"},children:String(R("tasks.view.document.fields.startDate",{defaultValue:"Start date"}))}),(0,i.jsx)("th",{style:{width:"12%"},children:String(R("tasks.view.document.fields.endDate",{defaultValue:"End date"}))}),(0,i.jsx)("th",{style:{width:"12%"},children:String(R("tasks.view.actions.partStatus",{defaultValue:"Status"}))}),(0,i.jsx)("th",{children:String(R("tasks.form.note",{defaultValue:"Note"}))})]})}),(0,i.jsx)("tbody",{children:((null==Y?void 0:Y.parts)||[]).map(e=>{var t,a;return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(null===(t=e.assignee_detail)||void 0===t?void 0:t.fullname)||"—"}),(0,i.jsx)("td",{children:(null===(a=e.department_detail)||void 0===a?void 0:a.name)||"—"}),(0,i.jsx)("td",{children:K(e.start_date,!0)}),(0,i.jsx)("td",{children:K(e.end_date,!0)}),(0,i.jsx)("td",{children:G(e.status)}),(0,i.jsx)("td",{children:e.note||"—"})]},e.id)})})]}),(0,i.jsxs)("div",{className:"doc-footer",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"muted",children:String(R("common.createdAt",{defaultValue:"Created at"}))}),(0,i.jsx)("div",{children:K(null==Y?void 0:null===(P=Y.task)||void 0===P?void 0:P.created_time,!0)})]}),(0,i.jsxs)("div",{style:{textAlign:"right"},children:[(0,i.jsx)("div",{className:"muted",children:String(R("tasks.view.document.header.overline",{defaultValue:"Document"}))}),(0,i.jsx)("div",{style:{fontWeight:700,color:"#0F172A"},children:String(R("tasks.view.document.header.fallbackTitle",{id:null!==(V=null==Y?void 0:null===(z=Y.task)||void 0===z?void 0:z.id)&&void 0!==V?V:"—",defaultValue:"Task #{{id}}"}))})]})]})]})})})})}),(0,i.jsxs)(_.Z,{children:[(0,i.jsx)(m.Z,{onClick:()=>Q(!1),startIcon:(0,i.jsx)(eu.JO,{icon:"tabler:file-type-pdf"}),children:String(R("tasks.view.document.actions.openPdf",{defaultValue:"Open PDF view"}))}),(0,i.jsx)(m.Z,{onClick:()=>Q(!0),variant:"contained",startIcon:(0,i.jsx)(eu.JO,{icon:"tabler:printer"}),children:String(R("tasks.view.document.actions.print",{defaultValue:"Print / Save as PDF"}))}),(0,i.jsx)(m.Z,{onClick:()=>L(!1),children:String(R("common.close",{defaultValue:"Close"}))})]})]})]})]})})}var ep=a(37958),ex=a(77527),eh=a(86501),eg=a(65806),ev=a(13539);a(80135);var ej=a(1652),eb=a(73138),ef=a(9041);let ew=(0,ex.ZP)(s.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(6),justifyContent:"space-between"}});var ek=e=>{var t,a,r;let{open:l,toggle:d,taskId:o,partId:c,part:p,task:x}=e,{user:h}=(0,V.a)(),{t:g}=(0,T.$G)(),[v,w]=n.useState(ef.EditorState.createEmpty()),[k,Z]=n.useState([]),[y,S]=n.useState(!1),[_,q]=n.useState({comment:"",file:""}),A=e=>Z(t=>t.filter((t,a)=>a!==e)),Y=(e,t)=>Z(a=>a.map((a,i)=>i===e?{...a,isLink:t,link:t?a.link:"",file:t?null:a.file}:a)),M=(e,t)=>Z(a=>a.map((a,i)=>i===e?{...a,link:t}:a)),W=(e,t)=>Z(a=>a.map((a,i)=>i===e?{...a,file:t}:a));n.useEffect(()=>{l&&0===k.length&&Z([{isLink:!1,link:"",file:null}])},[l]);let R=()=>{w(ef.EditorState.createEmpty()),Z([]),q({comment:"",file:""})},E=async()=>{if(!o){eh.ZP.error(String(g("tasks.view.actions.toasts.taskRequired")||"Task id required"));return}let e=v.getCurrentContent().hasText(),t=k.some(e=>{var t;return e.isLink?!!(null===(t=e.link)||void 0===t?void 0:t.trim()):!!e.file});if(e)q(e=>({...e,comment:""}));else{q(e=>({...e,comment:String(g("tasks.view.actions.toasts.commentRequired")||"Comment is required")}));return}if(t)q(e=>({...e,file:""}));else{q(e=>({...e,file:String(g("tasks.view.actions.toasts.fileRequired")||"Attachment is required")}));return}try{if(S(!0),e&&await f.Do.post(b.Z.taskComment,{part:null!=c?c:null,author:null==h?void 0:h.id,text:v.getCurrentContent().getPlainText()}),t){let e=k.filter(e=>e.isLink?e.link.trim().length:!!e.file);if(!e.length){eh.ZP.error(String(g("tasks.view.actions.toasts.fileRequired")||"Attachment is required"));return}for(let t of e){var a,i;let e=new FormData;e.append("title",""),e.append("link",t.isLink?t.link.trim():""),e.append("part",c?c.toString():""),e.append("uploaded_by",null!==(i=null==h?void 0:null===(a=h.id)||void 0===a?void 0:a.toString())&&void 0!==i?i:""),!t.isLink&&t.file&&e.append("file",t.file),await f.Do.postForm(b.Z.taskAttachment,e)}}await f.Do.patch(b.Z.taskPartById(null!=c?c:null),{status:"on_review",task:o}),eh.ZP.success(String(g("tasks.view.actions.toasts.saved")||"Saved")),R(),d()}catch(e){console.error("Failed to submit combined from drawer",e),eh.ZP.error(String(g("tasks.view.actions.toasts.saveError")||"Failed to save"))}finally{S(!1),R()}},L=async()=>{if(v.getCurrentContent().hasText())q(e=>({...e,comment:""}));else{q(e=>({...e,comment:String(g("tasks.view.actions.toasts.commentRequired")||"Comment is required")}));return}try{S(!0),await f.Do.patch(b.Z.taskPartById(null!=c?c:null),{status:"returned",task:o}),eh.ZP.success(String(g("tasks.view.actions.toasts.resend")||"Resend"))}catch(e){console.error("Failed to resend combined",e),eh.ZP.error(String(g("tasks.view.actions.toasts.resendError")||"Failed to resend"))}finally{S(!1),R(),d()}},H=async()=>{if(v.getCurrentContent().hasText())q(e=>({...e,comment:""}));else{q(e=>({...e,comment:String(g("tasks.view.actions.toasts.commentRequired")||"Comment is required")}));return}try{S(!0),await f.Do.patch(b.Z.taskPartById(null!=c?c:null),{status:"cancelled",task:o}),eh.ZP.success(String(g("tasks.view.actions.toasts.cancel")||"Cancel"))}catch(e){console.error("Failed to cancel combined",e)}finally{S(!1),R(),d()}},B=async()=>{if(v.getCurrentContent().hasText())q(e=>({...e,comment:""}));else{q(e=>({...e,comment:String(g("tasks.view.actions.toasts.commentRequired")||"Comment is required")}));return}try{S(!0),await f.Do.patch(b.Z.taskPartById(null!=c?c:null),{status:"done",task:o}),eh.ZP.success(String(g("tasks.view.actions.toasts.done")||"Done"))}catch(e){console.error("Failed to complete combined",e)}finally{S(!1),R(),d()}};return(0,i.jsxs)(ep.ZP,{open:l,anchor:"right",variant:"temporary",onClose:d,sx:{"& .MuiDrawer-paper":{width:[420,760]}},ModalProps:{keepMounted:!0},children:[(0,i.jsxs)(ew,{children:[(0,i.jsx)(u.Z,{variant:"h5",children:String(g("tasks.view.actions.drawerTitle")||"Send / Execute")}),(0,i.jsx)(F.Z,{size:"small",onClick:d,sx:{p:"0.375rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:e=>"rgba(".concat(e.palette.customColors.main,", 0.16)")}},children:(0,i.jsx)(j.Z,{icon:"tabler:x",fontSize:"1.25rem"})})]}),(0,i.jsx)(s.Z,{sx:{p:e=>e.spacing(0,6,6)},children:(0,i.jsxs)(s.Z,{children:[(null==h?void 0:h.id)===(null==p?void 0:null===(t=p.assignee_detail)||void 0===t?void 0:t.id)&&c&&((null==p?void 0:p.status)==="new"||(null==p?void 0:p.status)==="in_progress"||(null==p?void 0:p.status)==="returned")&&(0,i.jsxs)(s.Z,{sx:{my:2,display:"flex",flexDirection:"column",gap:2},children:[(0,i.jsx)(u.Z,{variant:"subtitle2",children:String(g("tasks.view.actions.attachmentDialog.title")||"")}),(0,i.jsxs)(C.Z,{size:"small",children:[(0,i.jsx)(D.Z,{children:(0,i.jsxs)(N.Z,{children:[(0,i.jsx)(P.Z,{children:String(g("common.file")||"File")}),(0,i.jsx)(P.Z,{align:"right",children:String(g("common.actions")||"Actions")})]})}),(0,i.jsx)(z.Z,{children:k.map((e,t)=>(0,i.jsxs)(N.Z,{children:[(0,i.jsxs)(P.Z,{sx:{width:"90%"},children:[(0,i.jsx)(eg.Z,{control:(0,i.jsx)(ev.Z,{checked:e.isLink,onChange:e=>Y(t,e.target.checked)}),label:e.isLink?"Link":"File"}),e.isLink?(0,i.jsx)(ea.Z,{fullWidth:!0,size:"small",label:String(g("common.link",{defaultValue:"Link"})),value:e.link,onChange:e=>M(t,e.target.value)}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(m.Z,{component:"label",variant:"outlined",size:"small",startIcon:(0,i.jsx)(j.Z,{icon:"tabler:upload"}),children:[String(g("tasks.view.actions.attachmentDialog.chooseFile")||"Choose file"),(0,i.jsx)("input",{hidden:!0,type:"file",onChange:e=>{var a;return W(t,(null===(a=e.target.files)||void 0===a?void 0:a[0])||null)}})]}),(0,i.jsx)(u.Z,{variant:"caption",sx:{display:"block",mt:1},color:"text.secondary",children:e.file?e.file.name:String(g("tasks.view.actions.attachmentDialog.noFileSelected")||"No file selected")})]})]}),(0,i.jsx)(P.Z,{align:"right",children:(0,i.jsx)(I.Z,{title:String(g("common.delete")||"Delete"),children:(0,i.jsx)(F.Z,{size:"small",color:"error",onClick:()=>A(t),children:(0,i.jsx)(j.Z,{icon:"mdi:delete"})})})})]},t))})]}),(0,i.jsx)(s.Z,{children:(0,i.jsx)(m.Z,{variant:"text",size:"small",startIcon:(0,i.jsx)(j.Z,{icon:"mdi:plus"}),onClick:()=>Z(e=>[...e,{isLink:!1,link:"",file:null}]),children:String(g("tasks.view.actions.attachmentDialog.addRow")||"Add file")})}),_.file?(0,i.jsx)(u.Z,{color:"error",variant:"caption",sx:{mb:1},children:_.file}):null]}),(0,i.jsxs)(ej.cP,{children:[(0,i.jsx)("div",{style:{marginBottom:8,fontWeight:500},children:String(g("commands.form.basis"))}),(0,i.jsx)(eb.Z,{editorState:v,onEditorStateChange:e=>{w(e)}}),(0,i.jsx)(u.Z,{color:"error",variant:"caption",sx:{mb:1},children:_.comment})]}),(null==h?void 0:h.id)==(null==p?void 0:null===(a=p.assignee_detail)||void 0===a?void 0:a.id)&&c&&((null==p?void 0:p.status)==="new"||(null==p?void 0:p.status)==="in_progress"||(null==p?void 0:p.status)==="returned")&&(0,i.jsxs)(s.Z,{sx:{display:"flex",gap:2,mt:20},children:[(0,i.jsx)(m.Z,{variant:"contained",onClick:E,disabled:y,children:String(g("tasks.view.actions.drawer.executeCombined")||"Bajarish")}),(0,i.jsx)(m.Z,{variant:"outlined",color:"secondary",onClick:()=>R(),disabled:y,children:String(g("common.clear")||"Clear")})]}),(null==h?void 0:h.id)===(null==x?void 0:null===(r=x.signed_by_detail)||void 0===r?void 0:r.id)&&c&&(null==p?void 0:p.status)!=="new"&&(null==p?void 0:p.status)!=="in_progress"&&(null==p?void 0:p.status)!=="returned"&&(0,i.jsxs)(s.Z,{sx:{display:"flex",flexWrap:"wrap",gap:2,mt:20},children:[(0,i.jsx)(m.Z,{variant:"contained",color:"warning",onClick:L,disabled:y,children:String(g("tasks.view.actions.resendForReview")||"Resend for review")}),(0,i.jsx)(m.Z,{variant:"contained",color:"error",onClick:H,disabled:y,children:String(g("tasks.view.actions.cancel")||String(g("common.cancel"))||"Cancel")}),(0,i.jsx)(m.Z,{variant:"contained",onClick:B,disabled:y,children:String(g("tasks.view.actions.done")||"Done")})]})]})})]})},eZ=a(25026),ey=a(93454);function eS(e){let{parts:t}=e,{t:a}=(0,T.$G)();return(0,i.jsxs)(eZ.Z,{component:ey.Z,sx:{boxShadow:1},children:[(0,i.jsxs)(s.Z,{sx:{p:2,borderBottom:e=>"1px solid ".concat(e.palette.divider)},children:[(0,i.jsx)(u.Z,{variant:"subtitle1",children:String(a("tasks.view.parts.title")||"Parts")}),(0,i.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:String(a("tasks.view.parts.count",{count:(null==t?void 0:t.length)||0}))})]}),(0,i.jsxs)(C.Z,{size:"small",children:[(0,i.jsx)(D.Z,{children:(0,i.jsxs)(N.Z,{children:[(0,i.jsx)(P.Z,{children:(0,i.jsx)(u.Z,{variant:"body2",sx:{fontSize:10},children:String(a("tasks.view.parts.table.assignee")||"Assignee")})}),(0,i.jsx)(P.Z,{children:(0,i.jsx)(u.Z,{variant:"body2",sx:{fontSize:10},children:String(a("tasks.view.parts.table.start")||"Show date")})}),(0,i.jsx)(P.Z,{children:(0,i.jsx)(u.Z,{variant:"body2",sx:{fontSize:10},children:String(a("tasks.view.parts.table.status")||"Is show")})})]})}),(0,i.jsx)(z.Z,{children:t&&t.length?t.map(e=>{var t;return(0,i.jsxs)(N.Z,{hover:!0,children:[(0,i.jsx)(P.Z,{children:(0,i.jsx)(u.Z,{variant:"body2",sx:{fontSize:12},children:(null===(t=e.assignee_detail)||void 0===t?void 0:t.fullname)||"—"})}),(0,i.jsx)(P.Z,{sx:{fontSize:12},children:e.show_date?A()(e.show_date).format("DD.MM.YYYY"):"—"}),(0,i.jsx)(P.Z,{sx:{fontSize:12},children:e.show_date?(0,i.jsx)(eu.JO,{icon:"tabler:eye"}):(0,i.jsx)(eu.JO,{icon:"tabler:eye-off"})})]},e.id)}):(0,i.jsx)(N.Z,{children:(0,i.jsx)(P.Z,{colSpan:4,align:"center",children:(0,i.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(a("tasks.view.parts.empty")||"No parts")})})})})]})]})}var e_=e=>{var t,a;let{task:r,part:l,mutate:x}=e,{t:h}=(0,T.$G)(),{user:g}=(0,V.a)(),[v,j]=n.useState(!1),b=null==r?void 0:r.id,k=null==l?void 0:l.id,Z=(0,M.NL)(),y=async()=>{try{k&&(await Z.invalidateQueries({queryKey:["task-part",k],refetchType:"active"}),b&&(await Z.invalidateQueries({queryKey:["task-comments",b,k],refetchType:"active"}),await Z.invalidateQueries({queryKey:["task-attachments",b,k],refetchType:"active"})),await Z.invalidateQueries({queryKey:["/task/with-parts/by-id/",b],refetchType:"active"}),null==x||x()),b&&(await Z.invalidateQueries({queryKey:["task-comments",b,null],refetchType:"active"}),await Z.invalidateQueries({queryKey:["task-attachments",b,"all"],refetchType:"active"}),await Z.invalidateQueries({queryKey:["/task/with-parts/by-id/",b],refetchType:"active"}),null==x||x())}catch(e){console.error("mutateAndRefresh failed",e)}},{data:S,isLoading:_}=(0,W.a)({queryKey:["/task/with-parts/by-id/",b],queryFn:async()=>{let e={task_id:Number(b)};return(await f.Do.post("/task/with-parts/by-id/",e)).data||{parts:[],task:{id:0,title:"",description:""}}},enabled:!!b,staleTime:1e4}),C=(null==S?void 0:S.task)||r,D=n.useMemo(()=>{var e;return k&&(null==S?void 0:null===(e=S.parts)||void 0===e?void 0:e.find(e=>e.id===k))||l},[null==S?void 0:S.parts,l,k]);return(0,i.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[_?(0,i.jsx)(R.Z,{variant:"rectangular",height:100}):S&&(0,i.jsx)(em,{fullTask:S}),(0,i.jsx)(d.Z,{children:(0,i.jsx)(o.Z,{children:(0,i.jsxs)(c.Z,{spacing:2,children:[(0,i.jsx)(u.Z,{variant:"subtitle1",children:String(h("tasks.view.actions.title"))}),(0,i.jsx)(w.Z,{}),k?(0,i.jsxs)(c.Z,{spacing:1,children:[(0,i.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:String(h("tasks.view.actions.selectedSection"))}),(0,i.jsx)(c.Z,{direction:"row",spacing:1,alignItems:"center",children:(0,i.jsx)(u.Z,{variant:"body2",children:(null==D?void 0:D.title)||String(h("common.notSet"))})}),(0,i.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:String(h("tasks.view.actions.partStatus"))}),(0,i.jsx)(c.Z,{direction:"row",spacing:1,alignItems:"center",children:(null==D?void 0:D.status)?(0,i.jsx)(p.Z,{size:"small",color:"info",variant:"outlined",label:(()=>{let e="documents.status.".concat(D.status.split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")),t=String(h(e));return t===e?D.status:t})()}):null}),(null==g?void 0:g.id)===(null==D?void 0:null===(t=D.assignee_detail)||void 0===t?void 0:t.id)&&k&&((null==D?void 0:D.status)==="new"||(null==D?void 0:D.status)==="in_progress"||(null==D?void 0:D.status)==="returned")&&(0,i.jsx)(m.Z,{size:"small",variant:"contained",onClick:()=>j(!0),children:String(h("tasks.view.actions.ensureExecution")||"Ensure execution")}),(null==g?void 0:g.id)===(null==C?void 0:null===(a=C.signed_by_detail)||void 0===a?void 0:a.id)&&k&&(null==D?void 0:D.status)==="on_review"&&(0,i.jsx)(m.Z,{size:"small",variant:"contained",onClick:()=>j(!0),children:String(h("tasks.view.actions.approve")||"Approve")})]}):(0,i.jsx)(c.Z,{spacing:.5,children:(0,i.jsx)(u.Z,{variant:"body2",children:String(h("tasks.view.actions.noPartSelected"))})})]})})}),(0,i.jsx)(eS,{parts:null==S?void 0:S.parts}),(0,i.jsx)(ek,{open:v,toggle:()=>j(e=>{let t=!e;return e&&!t&&y(),t}),taskId:b?Number(b):void 0,partId:k?Number(k):void 0,part:D,task:C})]})},eC=a(36599),eD=a(87413),eN=a(9601),eP=a(72162),ez=a(17494),eI=a(51221);let eF=(0,ex.ZP)(eC.Z)({"& .MuiTimelineItem-root":{width:"100%","&:before":{display:"none"}}}),eT=(e,t)=>{if(!t)return"";let a="documents.status.".concat(t),i=String(e(a));return i===a?t:i},eq=e=>{switch(e){case"assigned":case"status_changed":return"info";case"part_created":case"task_created":return"primary";case"commented":case"file_added":case"part_returned":case"task_returned":return"warning";case"part_completed":case"task_completed":return"success";case"part_cancelled":case"task_cancelled":return"error";default:return"grey"}};function eA(e){let{id:t}=e,{t:a}=(0,T.$G)(),{data:n=[],isLoading:r}=(0,W.a)({queryKey:["task-events",t],queryFn:async()=>{var e;return(null===(e=(await f.Do.get(b.Z.taskEvent,{task:t,limit:50})).data)||void 0===e?void 0:e.results)||[]},staleTime:1e4});return(0,i.jsx)(d.Z,{children:(0,i.jsxs)(o.Z,{children:[(0,i.jsx)(u.Z,{variant:"subtitle2",sx:{mb:2},children:String(a("tasks.view.history.title"))}),r?(0,i.jsxs)(c.Z,{spacing:2,children:[(0,i.jsx)(R.Z,{variant:"text",width:"40%"}),(0,i.jsx)(R.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,i.jsx)(R.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,i.jsx)(R.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}})]}):n.length?(0,i.jsx)(eF,{children:n.map(e=>{var t;return(0,i.jsxs)(eD.Z,{children:[(0,i.jsxs)(eN.Z,{children:[(0,i.jsx)(ez.Z,{color:eq(e.event_type),variant:"outlined"}),(0,i.jsx)(eI.Z,{})]}),(0,i.jsxs)(eP.Z,{sx:{"& svg":{verticalAlign:"bottom",mx:4}},children:[(0,i.jsxs)(s.Z,{sx:{mb:1.5,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsxs)(u.Z,{variant:"subtitle1",sx:{mr:2},children:[(null===(t=e.actor_detail)||void 0===t?void 0:t.fullname)||"—"," — ",e.message||e.event_type]}),(0,i.jsx)(u.Z,{variant:"caption",sx:{color:"text.disabled"},children:e.created_time?new Date(e.created_time).toLocaleString():""})]}),e.from_status||e.to_status?(0,i.jsx)(c.Z,{direction:"row",spacing:1,sx:{flexWrap:"wrap",rowGap:1},children:(0,i.jsx)(p.Z,{size:"small",variant:"outlined",color:"info",label:e.from_status&&e.to_status?"".concat(eT(a,e.from_status)," → ").concat(eT(a,e.to_status)):eT(a,e.to_status||e.from_status)})}):null]})]},e.id)})}):(0,i.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(a("tasks.view.history.empty"))})]})})}var eV=a(89540),eY=a(69447),eM=a(54560);let eW=(0,ex.ZP)(eC.Z)(e=>{let{theme:t}=e;return{"& .MuiTimelineItem-root:nth-of-type(even) .MuiTimelineContent-root":{textAlign:"left"},[t.breakpoints.down("md")]:{"& .MuiTimelineItem-root":{width:"100%","&:before":{display:"none"}}}}}),eR=e=>{switch(e){case"assigned":case"status_changed":return"info";case"part_created":case"task_created":return"primary";case"commented":case"file_added":case"part_returned":case"task_returned":return"warning";case"part_completed":case"task_completed":return"success";case"part_cancelled":case"task_cancelled":return"error";default:return"grey"}},eE=e=>{switch(e){case"assigned":return"tabler:user-check";case"part_created":return"tabler:subtask";case"file_added":return"tabler:paperclip";case"commented":return"tabler:message-circle";case"task_created":return"tabler:file-plus";case"status_changed":return"tabler:refresh";case"part_completed":case"task_completed":return"tabler:circle-check";case"part_returned":case"task_returned":return"tabler:arrow-back-up";case"part_cancelled":case"task_cancelled":return"tabler:circle-x";default:return"tabler:info-circle"}},eL=e=>{let t=(e||"").split("?")[0].trim();if(!t)return"";try{let e=t.split("/");return decodeURIComponent(e[e.length-1]||t)}catch(e){return t}};var eH=e=>{let{id:t}=e,{t:a}=(0,T.$G)(),n=e=>{if(!e)return"";let t="documents.status.".concat(e),i=String(a(t));return i===t?e:i},{data:r=[],isLoading:l}=(0,W.a)({queryKey:["task-events",t],queryFn:async()=>{var e;return(null===(e=(await f.Do.get(b.Z.taskEvent,{task:t,limit:50})).data)||void 0===e?void 0:e.results)||[]},staleTime:1e4}),{settings:m}=(0,eM.r)(),x=(0,eV.Z)(e=>e.breakpoints.down("md")),{direction:h}=m;return l?(0,i.jsxs)(c.Z,{spacing:2,children:[(0,i.jsx)(R.Z,{variant:"text",width:"40%"}),(0,i.jsx)(R.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,i.jsx)(R.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,i.jsx)(R.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}})]}):(0,i.jsx)(d.Z,{children:(0,i.jsx)(o.Z,{children:(0,i.jsx)(eW,{position:x?"right":"alternate",children:r.length?r.map((e,t)=>{var r,l,d,o,m,x,h,g;let v=eE(e.event_type),b=eR(e.event_type),f=(null===(r=e.actor_detail)||void 0===r?void 0:r.fullname)||"—",w=e.message||e.event_type,k=e.created_time?new Date(e.created_time).toLocaleString():"",Z=null==e?void 0:null===(l=e.extra)||void 0===l?void 0:l.file,y="".concat("https://api-doc.optivora-group.com","/").concat(Z),S=eL(Z);return(0,i.jsxs)(eD.Z,{children:[(0,i.jsxs)(eN.Z,{children:[(0,i.jsx)(eY.Z,{skin:"light",color:b,children:(0,i.jsx)(j.Z,{icon:v,fontSize:20})}),(0,i.jsx)(eI.Z,{})]}),(0,i.jsxs)(eP.Z,{sx:{"& svg":{verticalAlign:"bottom",mx:1}},children:[(0,i.jsxs)(s.Z,{sx:{mb:1,display:"flex",gap:2,flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsxs)(u.Z,{variant:"subtitle1",sx:{mr:2},children:[f," — ",w]}),(0,i.jsx)(u.Z,{variant:"caption",sx:{color:"text.disabled"},children:k})]}),(0,i.jsxs)(c.Z,{direction:"row",spacing:1,sx:{flexWrap:"wrap",rowGap:1},children:[Z?(0,i.jsx)(p.Z,{size:"small",icon:(0,i.jsx)(j.Z,{icon:"tabler:download"}),label:S||String(a("common.file")||"File"),component:"a",href:y,target:"_blank",rel:"noopener noreferrer",clickable:!0,variant:"outlined",color:"primary"}):null,(null===(d=e.part_detail)||void 0===d?void 0:d.title)?(0,i.jsx)(p.Z,{size:"small",label:"Qism: ".concat(e.part_detail.title)}):null,(null===(m=e.part_detail)||void 0===m?void 0:null===(o=m.department_detail)||void 0===o?void 0:o.name)?(0,i.jsx)(p.Z,{size:"small",label:"Bo'lim: ".concat(e.part_detail.department_detail.name)}):null,(null===(h=e.part_detail)||void 0===h?void 0:null===(x=h.assignee_detail)||void 0===x?void 0:x.fullname)?(0,i.jsx)(p.Z,{size:"small",label:"Ijrochi: ".concat(e.part_detail.assignee_detail.fullname)}):null,e.from_status||e.to_status?(0,i.jsx)(p.Z,{size:"small",variant:"outlined",color:"info",label:e.from_status&&e.to_status?"".concat(n(e.from_status)," → ").concat(n(e.to_status)):n(e.to_status||e.from_status)}):null,null]})]})]},null!==(g=e.id)&&void 0!==g?g:t)}):(0,i.jsx)(s.Z,{sx:{py:2},children:(0,i.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(a("tasks.view.process.empty"))})})})})})},eB=()=>{var e,t,a,g;let{t:w}=(0,T.$G)(),{id:k}=(0,r.useRouter)().query,[Z,y]=(0,n.useState)(0),{user:S}=(0,V.a)(),_=(0,en.Z)(),[C,D]=(0,n.useState)(void 0),[N,P]=(0,n.useState)(!1),{data:z,refetch:I}=(0,W.a)({queryKey:["task",k],enabled:!!k,queryFn:async()=>(await f.Do.get(b.Z.taskById(k))).data}),{data:F,refetch:q}=(0,W.a)({queryKey:["task-part",C],enabled:!!C,queryFn:async()=>(await f.Do.get(b.Z.taskPartById(C))).data}),Y=async()=>{if(!k||!z){_.error(String(w("errors.generic"))||"Task ID not found");return}P(!0);try{await f.Do.post(b.Z.taskSendToEmail,{task_id:z.id}),_.success(String(w("tasks.view.parts.emailSent")||"Email sent successfully"))}catch(i){var e,t;let a=(null==i?void 0:null===(t=i.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||(null==i?void 0:i.message)||String(w("errors.generic"));_.error(a)}finally{P(!1)}};return(0,i.jsx)(s.Z,{children:(0,i.jsxs)(l.ZP,{container:!0,spacing:4,children:[(0,i.jsxs)(l.ZP,{item:!0,xs:12,md:8,lg:9,children:[(0,i.jsx)(d.Z,{children:(0,i.jsxs)(o.Z,{children:[(0,i.jsxs)(c.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,i.jsx)(u.Z,{variant:"h6",children:z?String(w("tasks.view.header.titleWithId",{id:z.id,name:z.name})):String(w("tasks.view.header.title"))}),(0,i.jsxs)(c.Z,{direction:"row",spacing:1,alignItems:"center",children:[(null==S?void 0:null===(e=S.role_detail)||void 0===e?void 0:e.some(e=>"Admin"===e.name))&&(0,i.jsx)(m.Z,{size:"small",variant:"outlined",component:v(),href:k?"/tasks/update/".concat(k):"#",disabled:!k,startIcon:(0,i.jsx)(j.Z,{icon:"mdi:pencil"}),children:String(w("common.edit"))}),(0,i.jsx)(p.Z,{label:String(w("tasks.view.header.status",{value:(e=>{if(!e)return"—";let t="documents.status.".concat(e.split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")),a=String(w(t));return a===t?e:a})(null==z?void 0:z.status)})),size:"small"}),(0,i.jsx)(p.Z,{label:String(w("tasks.view.header.priority",{value:(e=>{if(!e)return"—";let t="tasks.priority.".concat("orgently"===e?"orgently":"normal"===e?"ordinary":e),a=String(w(t));return a===t?e:a})(null==z?void 0:z.priority)})),size:"small"}),(0,i.jsx)(p.Z,{label:String(w("tasks.view.header.type",{value:(e=>{if(!e)return"—";let t="tasks.type.".concat(e),a=String(w(t));return a===t?e:a})(null==z?void 0:z.type)})),size:"small"}),(null==z?void 0:z.end_date)&&(0,i.jsx)(p.Z,{label:String(w("tasks.view.header.deadline",{value:A()(z.end_date).format("DD.MM.YYYY HH:mm")})),size:"small"})]})]}),(0,i.jsxs)(s.Z,{sx:{mt:1,display:"flex",gap:3,flexWrap:"wrap",alignItems:"center"},children:[(0,i.jsxs)(s.Z,{children:[(0,i.jsxs)(u.Z,{component:"span",sx:{fontWeight:700,mr:1},children:[String(w("tasks.view.document.fields.inputDocNumber")),":"]}),(0,i.jsx)(u.Z,{component:"span",children:null!==(a=null==z?void 0:z.input_doc_number)&&void 0!==a?a:"—"})]}),(0,i.jsxs)(s.Z,{children:[(0,i.jsxs)(u.Z,{component:"span",sx:{fontWeight:700,mr:1},children:[String(w("tasks.view.document.fields.outputDocNumber")),":"]}),(0,i.jsx)(u.Z,{component:"span",children:null!==(g=null==z?void 0:z.output_doc_number)&&void 0!==g?g:"—"})]})]}),(0,i.jsxs)(x.Z,{value:Z,onChange:(e,t)=>y(t),sx:{mt:2},variant:"scrollable",scrollButtons:"auto",children:[(0,i.jsx)(h.Z,{label:String(w("tasks.view.tabs.document"))}),(0,i.jsx)(h.Z,{label:String(w("tasks.view.tabs.history"))}),(0,i.jsx)(h.Z,{label:String(w("tasks.view.tabs.process"))})]})]})}),(0,i.jsxs)(s.Z,{sx:{mt:3},children:[0===Z&&(0,i.jsx)(ec,{task:z,selectedPartId:null!=C?C:void 0,setSelectedPartId:D}),1===Z&&(0,i.jsx)(eA,{id:k}),2===Z&&(0,i.jsx)(eH,{id:k})]})]}),(0,i.jsx)(l.ZP,{item:!0,xs:12,md:4,lg:3,children:(0,i.jsxs)(c.Z,{spacing:3,children:[(0,i.jsx)(e_,{task:z,part:F,mutate:()=>{I(),q()}}),(0,i.jsx)(s.Z,{sx:{display:"flex",justifyContent:"flex-end"},children:(null==S?void 0:null===(t=S.role_detail)||void 0===t?void 0:t.some(e=>"Admin"===e.name||"Manager"===e.name))&&(null==z?void 0:z.status)==="new"&&(0,i.jsx)(m.Z,{variant:"outlined",onClick:Y,disabled:N||!z,startIcon:(0,i.jsx)(j.Z,{icon:N?"mdi:loading":"mdi:email-send"}),children:String(w("tasks.view.parts.sendToEmail")||"Send to email")})})]})})]})})};function eG(){return(0,i.jsx)(eB,{})}},73138:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});var i=a(85893),n=a(5152);let r=a.n(n)()(()=>a.e(6925).then(a.t.bind(a,35108,23)).then(e=>e.Editor),{loadableGenerated:{webpack:()=>[35108]},ssr:!1});var s=e=>(0,i.jsx)(r,{editorState:e.editorState,onEditorStateChange:t=>e.onEditorStateChange(t)})}},function(e){e.O(0,[4885,2785,3035,9716,1421,8833,958,2888,9774,179],function(){return e(e.s=94487)}),_N_E=e.O()}]);