(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7749],{94487:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tasks/view/[id]",function(){return a(82090)}])},7879:function(e,t,a){"use strict";var n=a(85893),i=a(67294),r=a(77527),s=a(40492);let l=(0,r.ZP)(s.Z)(e=>{let{theme:t}=e;return{alignItems:"flex-start","& .MuiInputLabel-root":{transform:"none",lineHeight:1.154,position:"relative",marginBottom:t.spacing(1),fontSize:t.typography.body2.fontSize,color:"".concat(t.palette.text.primary," !important")},"& .MuiInputBase-root":{borderRadius:8,backgroundColor:"transparent !important",border:"1px solid rgba(".concat(t.palette.customColors.main,", 0.2)"),transition:t.transitions.create(["border-color","box-shadow"],{duration:t.transitions.duration.shorter}),"&:not(.Mui-focused):not(.Mui-disabled):not(.Mui-error):hover":{borderColor:"rgba(".concat(t.palette.customColors.main,", 0.28)")},"&:before, &:after":{display:"none"},"&.MuiInputBase-sizeSmall":{borderRadius:6},"&.Mui-error":{borderColor:t.palette.error.main},"&.Mui-focused":{boxShadow:t.shadows[2],"& .MuiInputBase-input:not(.MuiInputBase-readOnly):not([readonly])::placeholder":{transform:"translateX(4px)"},"&.MuiInputBase-colorPrimary":{borderColor:t.palette.primary.main},"&.MuiInputBase-colorSecondary":{borderColor:t.palette.secondary.main},"&.MuiInputBase-colorInfo":{borderColor:t.palette.info.main},"&.MuiInputBase-colorSuccess":{borderColor:t.palette.success.main},"&.MuiInputBase-colorWarning":{borderColor:t.palette.warning.main},"&.MuiInputBase-colorError":{borderColor:t.palette.error.main},"&.Mui-error":{borderColor:t.palette.error.main}},"&.Mui-disabled":{backgroundColor:"".concat(t.palette.action.selected," !important")},"& .MuiInputAdornment-root":{marginTop:"0 !important"}},"& .MuiInputBase-input":{color:t.palette.text.secondary,"&:not(textarea)":{padding:"15.5px 13px"},"&:not(textarea).MuiInputBase-inputSizeSmall":{padding:"7.5px 13px"},"&:not(.MuiInputBase-readOnly):not([readonly])::placeholder":{transition:t.transitions.create(["opacity","transform"],{duration:t.transitions.duration.shorter})},"&.MuiInputBase-inputAdornedStart:not(.MuiAutocomplete-input)":{paddingLeft:0},"&.MuiInputBase-inputAdornedEnd:not(.MuiAutocomplete-input)":{paddingRight:0}},"& .MuiFormHelperText-root":{lineHeight:1.154,margin:t.spacing(1,0,0),color:t.palette.text.secondary,fontSize:t.typography.body2.fontSize,"&.Mui-error":{color:t.palette.error.main}},"& .MuiSelect-select:focus, & .MuiNativeSelect-select:focus":{backgroundColor:"transparent"},"& .MuiSelect-filled .MuiChip-root":{height:22},"& .MuiAutocomplete-input":{paddingLeft:"6px !important",paddingTop:"7.5px !important",paddingBottom:"7.5px !important","&.MuiInputBase-inputSizeSmall":{paddingLeft:"6px !important",paddingTop:"2.5px !important",paddingBottom:"2.5px !important"}},"& .MuiAutocomplete-inputRoot":{paddingTop:"8px !important",paddingLeft:"8px !important",paddingBottom:"8px !important","&:not(.MuiInputBase-sizeSmall).MuiInputBase-adornedStart":{paddingLeft:"13px !important"},"&.MuiInputBase-sizeSmall":{paddingTop:"5px !important",paddingLeft:"5px !important",paddingBottom:"5px !important","& .MuiAutocomplete-tag":{margin:2,height:22}}},"& .MuiInputBase-multiline":{padding:"15.25px 13px","&.MuiInputBase-sizeSmall":{padding:"7.25px 13px"},"& textarea.MuiInputBase-inputSizeSmall:placeholder-shown":{overflowX:"hidden"}},"& + .react-datepicker__close-icon":{top:11,"&:after":{fontSize:"1.6rem !important"}}}}),o=(0,i.forwardRef)((e,t)=>{let{size:a="small",InputLabelProps:i,...r}=e;return(0,n.jsx)(l,{size:a,inputRef:t,...r,variant:"filled",InputLabelProps:{...i,shrink:!0}})});t.Z=o},69447:function(e,t,a){"use strict";var n=a(85893),i=a(18745),r=a(17494),s=a(2339),l=a(17643);let o=e=>{let{sx:t,skin:a,color:o,variant:d}=e,c=(0,i.Z)(),u=(0,s.Z)(),p={primary:{boxShadow:"none",color:c.palette.primary.main,backgroundColor:u.primaryLight.backgroundColor},secondary:{boxShadow:"none",color:c.palette.secondary.main,backgroundColor:u.secondaryLight.backgroundColor},success:{boxShadow:"none",color:c.palette.success.main,backgroundColor:u.successLight.backgroundColor},error:{boxShadow:"none",color:c.palette.error.main,backgroundColor:u.errorLight.backgroundColor},warning:{boxShadow:"none",color:c.palette.warning.main,backgroundColor:u.warningLight.backgroundColor},info:{boxShadow:"none",color:c.palette.info.main,backgroundColor:u.infoLight.backgroundColor},grey:{boxShadow:"none",color:c.palette.grey[500],backgroundColor:(0,l.E)(c.palette.grey[500],.12)}};return(0,n.jsx)(r.Z,{...e,sx:o&&"light"===a&&"filled"===d?Object.assign(p[o],t):t})};o.defaultProps={color:"grey",variant:"filled"},t.Z=o},58898:function(e,t,a){"use strict";var n=a(18745),i=a(86501);t.Z=()=>{let e=(0,n.Z)();return{success:(t,a)=>i.ZP.success(t,{style:{paddingInline:"10px",paddingBlock:"6px",color:e.palette.success.main,border:"1px solid ".concat(e.palette.success.main)},iconTheme:{primary:e.palette.success.main,secondary:e.palette.success.contrastText},...a}),error:(t,a)=>i.ZP.error(t,{style:{paddingInline:"10px",paddingBlock:"6px",color:e.palette.error.main,border:"1px solid ".concat(e.palette.error.main)},iconTheme:{primary:e.palette.error.main,secondary:e.palette.getContrastText(e.palette.error.main)},...a}),info:(t,a)=>(0,i.ZP)(t,{style:{padding:"16px",color:e.palette.info.main,border:"1px solid ".concat(e.palette.info.main)},iconTheme:{primary:e.palette.info.main,secondary:e.palette.getContrastText(e.palette.info.main)},...a})}}},1652:function(e,t,a){"use strict";a.d(t,{cP:function(){return i}});var n=a(77527);let i=(0,n.ZP)("div")(e=>{let{theme:t}=e;return{"& .rdw-editor-wrapper":{border:"1px solid ".concat(t.palette.divider),"& .rdw-editor-toolbar":{border:0,marginBottom:0,background:t.palette.background.paper,borderBottom:"1px solid ".concat(t.palette.divider),"& .rdw-fontsize-dropdown":{minWidth:50},"& .rdw-link-modal":{height:"auto"},"& .rdw-colorpicker-modal, & .rdw-link-modal, & .rdw-embedded-modal, & .rdw-emoji-modal, & .rdw-image-modal":{boxShadow:t.shadows[8],borderColor:t.palette.divider,backgroundColor:t.palette.background.paper},"& .rdw-dropdown-optionwrapper":{boxShadow:t.shadows[8],borderColor:t.palette.divider,backgroundColor:t.palette.background.paper,"& .rdw-dropdownoption-highlighted":{backgroundColor:t.palette.action.hover},"& .rdw-dropdownoption-active":{backgroundColor:t.palette.action.selected}},"& .rdw-option-wrapper, & .rdw-dropdown-wrapper":{borderRadius:"4px !important",borderColor:t.palette.divider,background:t.palette.background.paper,"& .rdw-dropdown-carettoopen":{left:"auto",right:"10%",borderTopColor:t.palette.text.disabled},"& .rdw-dropdown-carettoclose":{left:"auto",right:"10%",borderBottomColor:t.palette.text.disabled},..."dark"===t.palette.mode?{"& img":{filter:"invert(1)"}}:{},"&:hover":{boxShadow:"none",backgroundColor:"rgba(".concat(t.palette.customColors.main,", 0.08)")}},"& .rdw-embedded-modal-size-input, & .rdw-image-modal-size-input":{width:"60%",minHeight:30},"& .rdw-link-modal-input, & .rdw-embedded-modal-link-input, & .rdw-image-modal-url-input":{minHeight:38},"& .rdw-link-modal-input, & .rdw-embedded-modal-link-input, & .rdw-image-modal-url-input, & .rdw-embedded-modal-size-input, & .rdw-image-modal-size-input":{background:"none",padding:t.spacing(0,3.5),color:t.palette.text.primary,borderColor:t.palette.divider,borderRadius:t.shape.borderRadius,fontSize:t.typography.body1.fontSize,"&:focus":{borderColor:t.palette.primary.main},"&::placeholder, &:-ms-input-placeholder, &::-ms-input-placeholder":{color:t.palette.text.disabled}},"& .rdw-link-modal-btn, & .rdw-embedded-modal-btn, & .rdw-image-modal-btn":{border:0,lineHeight:1.71,borderRadius:"5px",letterSpacing:"0.3px",textTransform:"uppercase",fontWeight:t.typography.fontWeightMedium,"&:first-of-type:not([disabled])":{boxShadow:t.shadows[3],color:t.palette.primary.contrastText,backgroundColor:t.palette.primary.main,"&:hover":{boxShadow:t.shadows[4],backgroundColor:t.palette.primary.dark},"&:active":{boxShadow:t.shadows[3]}},"&:last-child":{boxShadow:t.shadows[3],color:t.palette.secondary.contrastText,backgroundColor:t.palette.secondary.main,"&:hover":{boxShadow:t.shadows[4],backgroundColor:t.palette.secondary.dark},"&:active":{boxShadow:t.shadows[3]}},"&[disabled]":{cursor:"default",boxShadow:"none",color:t.palette.text.disabled,backgroundColor:t.palette.action.disabledBackground}}},"& .rdw-editor-main":{cursor:"text",padding:"0 1rem",minHeight:"10rem",color:t.palette.text.primary,..."rtl"===t.direction?{"& .public-DraftStyleDefault-block":{direction:"ltr !important",textAlign:"left !important"}}:{}}}}});(0,n.ZP)("div")(()=>({"& .rdw-editor-wrapper":{display:"flex",flexDirection:"column-reverse"}})),(0,n.ZP)("div")(()=>({"& .rdw-editor-wrapper, & .rdw-editor-toolbar":{border:"0 !important"}}))},74538:function(e,t){"use strict";let a=e=>Array.isArray(e)?e[0]:null==e?"":String(e);t.Z={login:"/auth/token",logout:"/auth/logout",me:"/user-view",companyProfile:"/company-profile",companyProfileById:e=>"/company-profile/".concat(a(e)),companyProfileFields:"/company-profile/fields",country:"/country/",district:"/district",districtById:e=>"/district/".concat(a(e),"/"),region:"/region/",regionById:e=>"/region/".concat(a(e),"/"),countryById:e=>"/country/".concat(a(e),"/"),countryFields:"/country/fields/",command:"/command/",commandById:e=>"/command/".concat(a(e)),industries:"/industry",industryById:e=>"/industry/".concat(a(e)),industryFields:"/industry/fields",users:"/user",userById:e=>"/user/".concat(a(e)),equipmentCategories:"/equipment-category",equipmentCategoryById:e=>"/equipment-category/".concat(a(e)),services:"/service",serviceById:e=>"/service/".concat(a(e)),partners:"/partner",partnerById:e=>"/partner/".concat(a(e)),company:"/company/",companyById:e=>"/company/".concat(a(e)),replyLetter:"/reply-letter/",replyLetterById:e=>"/reply-letter/".concat(a(e)),replyLetterFile:"/reply-letter-file/",replyLetterFileById:e=>"/reply-letter-file/".concat(a(e)),documents:"/documents/",documentById:e=>"/documents/".concat(a(e)),documentForm:"/document-form/",documentFormById:e=>"/document-form/".concat(a(e)),listOfMagazine:"/list-of-magazine/",listOfMagazineById:e=>"/list-of-magazine/".concat(a(e)),task:"/task/",taskById:e=>"/task/".concat(a(e)),taskPart:"/task-part/",taskPartById:e=>"/task-part/".concat(a(e)),taskEvent:"/task-event/",taskEventById:e=>"/task-event/".concat(a(e)),taskComment:"/task-comment/",taskCommentById:e=>"/task-comment/".concat(a(e)),taskAttachment:"/task-attachment/",taskAttachmentById:e=>"/task-attachment/".concat(a(e)),department:"/department/",departmentById:e=>"/department/".concat(a(e)),position:"/position/",positionById:e=>"/position/".concat(a(e)),projects:"/project",projectById:e=>"/project/".concat(a(e)),projectDeliverables:"/project-deliverable",projectDeliverableById:e=>"/project-deliverable/".concat(a(e)),projectImages:"/project-image",projectImageById:e=>"/project-image/".concat(a(e)),stats:"/stats",statById:e=>"/stats/".concat(a(e)),faqs:"/faq",faqById:e=>"/faq/".concat(a(e)),inquiries:"/inquiry",inquiryById:e=>"/inquiry/".concat(a(e)),downloads:"/command-file/",downloadById:e=>"/command-file/".concat(a(e)),news:"/news-post",newsById:e=>"/news-post/".concat(a(e)),testimonials:"/testimonial",testimonialById:e=>"/testimonial/".concat(a(e)),ourWork:"/our-work",ourWorkById:e=>"/our-work/".concat(a(e)),applicationApprovedByID:e=>"/application-approved/".concat(a(e)),limitData:"/limit-data"}},33251:function(e,t,a){"use strict";a.d(t,{z:function(){return s}});var n=a(30202),i=a(33934),r=a(52293);let s=function(e){var t,a;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=(0,n.NL)(),o=["list",e,s],d=Object.fromEntries(Object.entries(s).filter(e=>{let[,t]=e;return void 0!==t})),{data:c,isLoading:u,error:p}=(0,i.a)({queryKey:o,queryFn:async()=>{var t,a,n;let i=(await r.Do.get(e,d)).data,s=Array.isArray(i)?i:null!==(a=null==i?void 0:i.results)&&void 0!==a?a:[],l=Array.isArray(i)?s.length:null!==(n=null==i?void 0:null===(t=i.pagination)||void 0===t?void 0:t.total)&&void 0!==n?n:s.length;return{items:s,total:l}},staleTime:3e4});return{data:null!==(t=null==c?void 0:c.items)&&void 0!==t?t:[],total:null!==(a=null==c?void 0:c.total)&&void 0!==a?a:0,loading:u,error:p,mutate:()=>{l.invalidateQueries({queryKey:o})}}}},82090:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return eM}});var n=a(85893),i=a(67294),r=a(11163),s=a(90642),l=a(68573),o=a(60762),d=a(71919),c=a(84166),u=a(96788),p=a(81873),m=a(43374),x=a(28907),h=a(74538),g=a(52293),v=a(18745),b=a(56912),j=a(33453),f=a(92365),y=a(40110),w=a(46070),k=a(96727),Z=a(51015),S=a(76592),_=a(70360),C=a(46577),I=a(8863),P=a(19827),B=a(22120);function N(e){let{parts:t,selectedPartId:a,setSelectedPartId:i,onDelete:r,onEdit:s}=e,{t:l}=(0,B.$G)(),m=e=>{switch(e){case"new":default:return"default";case"in_progress":return"info";case"on_review":case"returned":return"warning";case"done":return"success";case"cancelled":return"error"}},x=e=>{if(!e)return"—";let t="documents.status.".concat(e.split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")),a=String(l(t));return a===t?e:a};return(0,n.jsx)(o.Z,{children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d.Z,{children:(0,n.jsxs)(c.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[(0,n.jsx)(u.Z,{variant:"subtitle2",children:String(l("tasks.view.parts.title"))}),(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:String(l("tasks.view.parts.count",{count:t.length}))})]})}),t.length?(0,n.jsxs)(S.Z,{size:"small",sx:{"& .MuiTableCell-root":{py:1}},children:[(0,n.jsx)(_.Z,{children:(0,n.jsxs)(C.Z,{children:[(0,n.jsx)(I.Z,{children:String(l("tasks.view.parts.table.title"))}),(0,n.jsx)(I.Z,{children:String(l("tasks.view.parts.table.status"))}),(0,n.jsx)(I.Z,{children:String(l("tasks.view.parts.table.department"))}),(0,n.jsx)(I.Z,{children:String(l("tasks.view.parts.table.assignee"))}),(0,n.jsx)(I.Z,{children:String(l("tasks.view.parts.table.start"))}),(0,n.jsx)(I.Z,{children:String(l("tasks.view.parts.table.end"))})]})}),(0,n.jsx)(P.Z,{children:t.map(e=>{var t,r;let s=a===e.id;return(0,n.jsxs)(C.Z,{hover:!0,selected:s,onClick:()=>i(e.id),sx:{cursor:"pointer"},children:[(0,n.jsxs)(I.Z,{children:[(0,n.jsx)(c.Z,{direction:"row",spacing:1,alignItems:"center",children:(0,n.jsx)(u.Z,{variant:"body2",sx:{fontWeight:600},children:e.title||String(l("tasks.view.parts.partFallbackTitle",{id:e.id}))})}),!!e.note&&(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:e.note})]}),(0,n.jsx)(I.Z,{children:(0,n.jsx)(p.Z,{size:"small",label:x(e.status),color:m(e.status),variant:"outlined"})}),(0,n.jsx)(I.Z,{children:(null===(t=e.department_detail)||void 0===t?void 0:t.name)||e.department}),(0,n.jsx)(I.Z,{children:(null===(r=e.assignee_detail)||void 0===r?void 0:r.fullname)||e.assignee}),(0,n.jsx)(I.Z,{children:e.start_date||"—"}),(0,n.jsx)(I.Z,{children:e.end_date||"—"})]},e.id)})})]}):(0,n.jsx)(d.Z,{children:(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(l("tasks.view.parts.empty"))})})]})})}var z=a(30202),D=a(33934),M=a(14934),F=a(47407),T=a(19304),A=a(21038),q=a(52857),R=a(87590),W=a(32200),V=a(61769),L=a(21201),E=a(75673);let O=e=>{let t=(e.title||"").trim();if(t)return t;let a=(e.file||"").trim();if(!a)return"Fayl #".concat(e.id);try{let e=a.split("?")[0],t=e.split("/");return decodeURIComponent(t[t.length-1]||e)}catch(e){return a}},G=e=>{let t=(e||"").toLowerCase().split("?")[0],a=t.split(".").pop();return a&&a!==t?a:""},H=e=>{switch(e){case"pdf":return"tabler:file-type-pdf";case"doc":case"docx":return"tabler:file-type-doc";case"xls":case"xlsx":return"tabler:file-type-xls";case"ppt":case"pptx":return"tabler:file-type-ppt";case"png":case"jpg":case"jpeg":case"webp":case"gif":return"tabler:photo";case"zip":case"rar":case"7z":return"tabler:archive";default:return"tabler:file"}};function Y(e){let{taskId:t,partId:a,isCompact:r}=e,{t:l}=(0,B.$G)(),{data:m,isLoading:x,isError:v}=(0,D.a)({queryKey:["task-attachments",t,void 0===a?"all":a],queryFn:async()=>{let e={task:t,perPage:50};return void 0!==a&&(e.part=null===a?"":a),(await g.Do.get(h.Z.taskAttachment,e)).data||{results:[]}},enabled:!!t,staleTime:1e4}),j=(null==m?void 0:m.results)||[];return x?(0,n.jsxs)(c.Z,{spacing:2,children:[(0,n.jsx)(M.Z,{variant:"text",width:"30%"}),(0,n.jsx)(M.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,n.jsx)(M.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,n.jsx)(M.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}})]}):v?(0,n.jsx)(u.Z,{variant:"body2",color:"error",children:String(l("tasks.view.attachments.loadError"))}):j.length?r?(0,n.jsx)(o.Z,{variant:"outlined",sx:{mb:2},children:(0,n.jsx)(d.Z,{sx:{py:"0.75rem !important"},children:(0,n.jsxs)(c.Z,{direction:"row",spacing:3,alignItems:"center",flexWrap:"wrap",useFlexGap:!0,children:[(0,n.jsxs)(u.Z,{variant:"subtitle2",sx:{mr:2},children:[String(l("tasks.view.attachments.title")),":"]}),j.map(e=>{let t=O(e),a=H(G(e.file||e.title)),i=e.file||"#";return(0,n.jsx)(p.Z,{icon:(0,n.jsx)(E.Z,{icon:a}),label:t,component:"a",href:i,target:"_blank",clickable:!0,size:"small",variant:"outlined",color:"primary"},e.id)})]})})}):(0,n.jsx)(o.Z,{children:(0,n.jsxs)(d.Z,{children:[(0,n.jsxs)(s.Z,{sx:{mb:2,display:"flex",alignItems:"center",justifyContent:"space-between",gap:2},children:[(0,n.jsx)(u.Z,{variant:"subtitle2",children:String(l("tasks.view.attachments.title"))}),(0,n.jsx)(p.Z,{size:"small",color:"info",label:String(l("tasks.view.attachments.count",{count:j.length}))})]}),(0,n.jsx)(F.Z,{disablePadding:!0,children:j.map((e,t)=>{var a;let r=O(e),s=G(e.file||e.title),o=H(s),d=e.created_at?new Date(e.created_at).toLocaleString():"",m=e.file||"#";return(0,n.jsxs)(i.Fragment,{children:[(0,n.jsxs)(T.ZP,{disableGutters:!0,secondaryAction:m&&"#"!==m?(0,n.jsx)(A.Z,{title:String(l("tasks.view.attachments.openOrDownload")),children:(0,n.jsx)(q.Z,{component:"a",href:m,target:"_blank",rel:"noreferrer",children:(0,n.jsx)(E.Z,{icon:"tabler:download"})})}):null,sx:{py:1.25,px:1,borderRadius:2,"&:hover":{backgroundColor:e=>e.palette.action.hover}},children:[(0,n.jsx)(R.Z,{children:(0,n.jsx)(L.Z,{variant:"rounded",sx:{width:40,height:40,bgcolor:e=>e.palette.action.selected,color:"text.primary"},children:(0,n.jsx)(E.Z,{icon:o})})}),(0,n.jsx)(W.Z,{primary:(0,n.jsxs)(c.Z,{direction:"row",spacing:1,sx:{alignItems:"center",flexWrap:"wrap",rowGap:1},children:[m&&"#"!==m?(0,n.jsx)(V.Z,{href:m,target:"_blank",rel:"noreferrer",underline:"hover",color:"inherit",children:(0,n.jsx)(u.Z,{variant:"subtitle2",sx:{fontWeight:600},children:r})}):(0,n.jsx)(u.Z,{variant:"subtitle2",sx:{fontWeight:600},children:r}),s?(0,n.jsx)(p.Z,{size:"small",variant:"outlined",label:s.toUpperCase()}):null,e.part?(0,n.jsx)(p.Z,{size:"small",variant:"outlined",label:String(l("tasks.view.attachments.partLabel",{id:e.part}))}):null]}),secondary:(0,n.jsxs)(c.Z,{direction:"row",spacing:1,sx:{alignItems:"center",flexWrap:"wrap",rowGap:.5},children:[d?(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:d}):null,"number"==typeof e.uploaded_by?(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:String(l("tasks.view.attachments.uploader",{id:e.uploaded_by}))}):null]})})]}),t<j.length-1?(0,n.jsx)(b.Z,{sx:{my:1}}):null]},null!==(a=e.id)&&void 0!==a?a:t)})})]})}):r?null:(0,n.jsx)(o.Z,{children:(0,n.jsx)(d.Z,{children:(0,n.jsx)(s.Z,{sx:{py:2},children:(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(l("tasks.view.attachments.empty"))})})})})}let K=e=>{var t,a;let n=(e||"").trim();if(!n)return"?";let i=n.split(" ").filter(Boolean);return(((null===(t=i[0])||void 0===t?void 0:t[0])||"")+((null===(a=i[1])||void 0===a?void 0:a[0])||"")).toUpperCase()||n[0].toUpperCase()};function $(e){let{taskId:t,partId:a}=e,{t:r}=(0,B.$G)(),{data:l,isLoading:m,isError:x}=(0,D.a)({queryKey:["task-comments",t,null!=a?a:null],queryFn:async()=>{let e={task:t,perPage:50};return null!=a&&(e.part=a),(await g.Do.get(h.Z.taskComment,e)).data||{results:[]}},enabled:!!t,staleTime:1e4}),v=(null==l?void 0:l.results)||[];return m?(0,n.jsxs)(c.Z,{spacing:2,children:[(0,n.jsx)(M.Z,{variant:"text",width:"25%"}),(0,n.jsx)(M.Z,{variant:"rectangular",height:72,sx:{borderRadius:2}}),(0,n.jsx)(M.Z,{variant:"rectangular",height:72,sx:{borderRadius:2}}),(0,n.jsx)(M.Z,{variant:"rectangular",height:72,sx:{borderRadius:2}})]}):x?(0,n.jsx)(u.Z,{variant:"body2",color:"error",children:String(r("tasks.view.comments.loadError"))}):v.length?(0,n.jsx)(o.Z,{children:(0,n.jsxs)(d.Z,{children:[(0,n.jsxs)(s.Z,{sx:{mb:2,display:"flex",alignItems:"center",justifyContent:"space-between",gap:2},children:[(0,n.jsx)(u.Z,{variant:"subtitle2",children:String(r("tasks.view.comments.title"))}),(0,n.jsx)(p.Z,{size:"small",color:"info",label:String(r("tasks.view.comments.count",{count:v.length}))})]}),(0,n.jsx)(F.Z,{disablePadding:!0,children:v.map((e,t)=>{var a,s;let l=e.created_at?new Date(e.created_at).toLocaleString():"",o=e.is_system?String(r("tasks.view.comments.system")):"".concat(null===(a=e.author_detail)||void 0===a?void 0:a.fullname);return(0,n.jsxs)(i.Fragment,{children:[(0,n.jsxs)(T.ZP,{disableGutters:!0,alignItems:"flex-start",sx:{py:1.25,px:1,borderRadius:2,"&:hover":{backgroundColor:e=>e.palette.action.hover}},children:[(0,n.jsx)(R.Z,{children:(0,n.jsx)(L.Z,{sx:{width:40,height:40,bgcolor:t=>e.is_system?t.palette.grey[200]:t.palette.primary.light,color:t=>e.is_system?t.palette.text.primary:t.palette.primary.contrastText},children:e.is_system?(0,n.jsx)(E.Z,{icon:"tabler:settings"}):K(o)})}),(0,n.jsx)(W.Z,{primary:(0,n.jsxs)(c.Z,{direction:"row",spacing:1,sx:{alignItems:"center",flexWrap:"wrap",rowGap:1},children:[(0,n.jsx)(u.Z,{variant:"subtitle2",sx:{fontWeight:700},children:o}),e.is_system?(0,n.jsx)(p.Z,{size:"small",color:"default",variant:"outlined",label:String(r("tasks.view.comments.system"))}):null,e.part?(0,n.jsx)(p.Z,{size:"small",variant:"outlined",label:String(r("tasks.view.comments.partLabel",{id:e.part}))}):null,l?(0,n.jsxs)(u.Z,{variant:"caption",sx:{color:"text.disabled"},children:["• ",l]}):null]}),secondary:(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",sx:{mt:.5,whiteSpace:"pre-wrap",wordBreak:"break-word"},children:e.text||"—"})})]}),t<v.length-1?(0,n.jsx)(b.Z,{sx:{my:1}}):null]},null!==(s=e.id)&&void 0!==s?s:t)})})]})}):(0,n.jsx)(o.Z,{children:(0,n.jsx)(d.Z,{children:(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(r("tasks.view.comments.empty"))})})})}var U=a(30381),Q=a.n(U),J=a(7879),X=a(33251),ee=a(58898);function et(e){var t,a,r,s,p,m;let{task:x,selectedPartId:S,setSelectedPartId:_}=e,{t:C}=(0,B.$G)();(0,v.Z)();let I=(0,ee.Z)(),P=(0,z.NL)(),{data:M}=(0,X.z)(h.Z.department,{page:1,perPage:100}),{data:F}=(0,X.z)(h.Z.users,{page:1,perPage:100}),[T,A]=(0,i.useState)(null),[q,R]=(0,i.useState)({title:"",department:0,assignee:0,start_date:"",end_date:"",note:""}),W=null==x?void 0:x.id,{data:V}=(0,D.a)({queryKey:["task-parts",null!=W?W:"none"],enabled:!!W,queryFn:async()=>{let e=(await g.Do.get(h.Z.taskPart,{task:String(W),perPage:100})).data;return(null==e?void 0:e.results)||e||[]},initialData:[]}),L=async()=>{if(T&&W)try{await g.Do.put(h.Z.taskPartById(T.id),{...q,task:W}),I.success(String(C("common.saved"))),A(null),P.invalidateQueries({queryKey:["task-parts",W]})}catch(e){I.error((null==e?void 0:e.message)||String(C("errors.somethingWentWrong")))}},E=async e=>{if(window.confirm(String(C("common.confirmDelete"))))try{await g.Do.delete(h.Z.taskPartById(e)),I.success(String(C("common.deleted"))),P.invalidateQueries({queryKey:["task-parts",W]})}catch(e){I.error((null==e?void 0:e.message)||String(C("errors.somethingWentWrong")))}};if(!x)return(0,n.jsx)(o.Z,{children:(0,n.jsx)(d.Z,{children:(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(C("tasks.view.document.notFound"))})})});let O=e=>{let{label:t,value:a}=e;return(0,n.jsxs)(c.Z,{spacing:.75,children:[(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:t}),(0,n.jsx)(u.Z,{variant:"body2",sx:{wordBreak:"break-word"},children:null!=a?a:"—"})]})};return(0,n.jsxs)(l.ZP,{container:!0,spacing:4,children:[(0,n.jsx)(l.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(o.Z,{children:(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(u.Z,{variant:"subtitle1",sx:{mb:2},children:String(C("tasks.view.document.sections.main"))}),(0,n.jsxs)(l.ZP,{container:!0,spacing:3,children:[(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(O,{label:String(C("tasks.view.document.fields.company")),value:(null===(t=x.company_detail)||void 0===t?void 0:t.name)||x.company})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(O,{label:String(C("tasks.view.document.fields.department")),value:(null===(a=x.department_detail)||void 0===a?void 0:a.name)||x.department})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(O,{label:String(C("tasks.view.document.fields.taskForm")),value:(null===(r=x.task_form_detail)||void 0===r?void 0:r.name)||x.task_form})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(O,{label:String(C("tasks.view.document.fields.magazine")),value:(null===(s=x.list_of_magazine_detail)||void 0===s?void 0:s.name)||x.list_of_magazine})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(O,{label:String(C("tasks.view.document.fields.signedBy")),value:(null===(p=x.signed_by_detail)||void 0===p?void 0:p.fullname)||x.signed_by})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(O,{label:String(C("tasks.view.document.fields.responsiblePerson")),value:null!==(m=x.sending_respon_person)&&void 0!==m?m:"—"})})]})]})})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(o.Z,{children:(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(u.Z,{variant:"subtitle1",sx:{mb:2},children:String(C("tasks.view.document.sections.dates"))}),(0,n.jsxs)(l.ZP,{container:!0,spacing:3,children:[(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(O,{label:String(C("tasks.view.document.fields.startDate")),value:x.start_date})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(O,{label:String(C("tasks.view.document.fields.endDate")),value:x.end_date})})]}),(0,n.jsx)(b.Z,{sx:{my:3}}),(0,n.jsx)(u.Z,{variant:"subtitle1",sx:{mb:2},children:String(C("tasks.view.document.sections.system"))}),(0,n.jsxs)(l.ZP,{container:!0,spacing:3,children:[(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(O,{label:String(C("tasks.view.document.fields.createdAt")),value:Q()(x.created_time).format("DD.MM.YYYY HH:mm")})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(O,{label:String(C("tasks.view.document.fields.createdBy")),value:x.created_by})})]})]})})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(Y,{taskId:x.id,partId:null,isCompact:!0})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(N,{parts:V,selectedPartId:S,setSelectedPartId:_,onDelete:E,onEdit:e=>{let t=V.find(t=>t.id===e);t&&(A(t),R({title:t.title,department:t.department,assignee:t.assignee,start_date:t.start_date,end_date:t.end_date,note:t.note}))}})}),S&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(Y,{taskId:x.id,partId:S})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)($,{taskId:x.id,partId:S})})]}),(0,n.jsxs)(j.Z,{open:!!T,onClose:()=>A(null),maxWidth:"sm",fullWidth:!0,children:[(0,n.jsx)(f.Z,{children:String(C("tasks.parts.dialog.title"))}),(0,n.jsx)(y.Z,{children:(0,n.jsxs)(l.ZP,{container:!0,spacing:2,sx:{mt:1},children:[(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(J.Z,{fullWidth:!0,label:String(C("tasks.parts.form.title")),value:q.title,onChange:e=>R({...q,title:e.target.value})})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(w.Z,{fullWidth:!0,options:M||[],getOptionLabel:e=>e.name,value:(null==M?void 0:M.find(e=>e.id===q.department))||null,onChange:(e,t)=>R({...q,department:(null==t?void 0:t.id)||0}),renderInput:e=>(0,n.jsx)(J.Z,{...e,label:String(C("tasks.parts.form.department")),placeholder:String(C("common.selectPlaceholder"))})})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(w.Z,{fullWidth:!0,options:F||[],getOptionLabel:e=>e.fullname,value:(null==F?void 0:F.find(e=>e.id===q.assignee))||null,onChange:(e,t)=>R({...q,assignee:(null==t?void 0:t.id)||0}),renderInput:e=>(0,n.jsx)(J.Z,{...e,label:String(C("tasks.parts.form.assignee")),placeholder:String(C("common.selectPlaceholder"))})})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(J.Z,{fullWidth:!0,type:"date",label:String(C("tasks.parts.form.startDate")),value:q.start_date,onChange:e=>R({...q,start_date:e.target.value}),InputLabelProps:{shrink:!0}})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(J.Z,{fullWidth:!0,type:"date",label:String(C("tasks.parts.form.endDate")),value:q.end_date,onChange:e=>R({...q,end_date:e.target.value}),InputLabelProps:{shrink:!0}})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,children:(0,n.jsx)(J.Z,{fullWidth:!0,multiline:!0,rows:3,label:String(C("tasks.parts.form.note")),value:q.note,onChange:e=>R({...q,note:e.target.value})})})]})}),(0,n.jsxs)(k.Z,{children:[(0,n.jsx)(Z.Z,{onClick:()=>A(null),children:String(C("common.cancel"))}),(0,n.jsx)(Z.Z,{variant:"contained",onClick:L,children:String(C("common.save"))})]})]})]})}var ea=a(34273),en=a(1954);function ei(e){var t,a,r,l,d,c,u,p,m,x,h,g,v,b,w,S,_,C,I,P,N,z,D,M,F,T;let{fullTask:A}=e,q=(0,i.useRef)(null),R=(0,i.useRef)(!1),{t:W}=(0,B.$G)(),[V,L]=(0,i.useState)(!1),E=Math.round(495.0251889168766),O=(0,i.useMemo)(()=>Math.min(.44080604534005036,E/1123),[1123,794,E,350]),G=e=>{if(!e)return"—";let t="documents.status.".concat(e.split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")),a=String(W(t));return a===t?e:a},H=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"—";let a=Q()(e);return a.isValid()?a.format(t?"DD.MM.YYYY HH:mm":"DD.MM.YYYY"):"—"},Y=()=>'\n    @page { size: A4; margin: 12mm; }\n    html, body { margin: 0; padding: 0; background: #fff; }\n    body { -webkit-print-color-adjust: exact; print-color-adjust: exact; color: #111827; font: 12pt/1.45 "Times New Roman", Times, serif; }\n\n    .print-paper{\n      width:210mm; min-height:297mm; box-sizing:border-box;\n      padding:14mm 12mm; margin:0 auto; background:#fff;\n    }\n\n    .doc-topline{ height: 6px; background: #0F172A; border-radius: 999px; margin-bottom: 10mm; }\n    .doc-header{ display:flex; align-items:center; justify-content:space-between; gap: 12mm; }\n    .doc-header-left{ display:flex; align-items:center; gap: 6mm; min-width: 50mm; }\n    .doc-logo{ width: 22mm; height: 22mm; object-fit: contain; }\n    .doc-company{ font-weight: 700; font-size: 18pt; text-align:center; flex:1; }\n    .doc-header-right{ min-width: 50mm; text-align:right; font-size: 11pt; color: #334155; }\n\n    .doc-subline{ border-top: 1px solid #CBD5E1; margin: 6mm 0 8mm; }\n\n    .section-title{ font-weight: 700; font-size: 13pt; margin: 0 0 3mm; }\n    .meta-grid{ display:grid; grid-template-columns: 1fr 1fr; gap: 3mm 10mm; margin-bottom: 8mm; }\n    .meta-row{ display:flex; gap: 4mm; }\n    .meta-label{ width: 40mm; font-weight: 700; color: #0F172A; }\n    .meta-value{ flex: 1; color: #111827; }\n\n    .note-box{ border: 1px solid #E2E8F0; border-radius: 6px; padding: 4mm; background: #F8FAFC; white-space: pre-wrap; }\n\n    table.parts-table{ width:100%; border-collapse: collapse; margin-top: 4mm; font-size: 11pt; }\n    .parts-table th, .parts-table td{ border: 1px solid #E2E8F0; padding: 3mm 2.5mm; vertical-align: top; }\n    .parts-table th{ background: #F1F5F9; color:#0F172A; font-weight:700; text-align:left; }\n    .parts-table td{ color:#111827; }\n    .muted{ color:#64748B; }\n\n    .doc-footer{ margin-top: 10mm; display:flex; justify-content:space-between; gap: 10mm; font-size: 10.5pt; color:#334155; }\n    .no-print, [data-no-print] { display: none !important; }\n  ',K=e=>{let t=q.current;if(!t||R.current)return;R.current=!0;let a=t.querySelector(".print-paper"),n=a?a.innerHTML:t.innerHTML,i=null;try{i=window.open("","_blank","height=900,width=900")}catch(e){console.error("window.open failed",e)}if(!i){R.current=!1;return}try{i.opener=null}catch(e){}let r=Y();try{i.document.open(),i.document.write('<!doctype html><html><head><meta charset="utf-8"><title>'.concat(String(W("tasks.view.document.header.overline",{defaultValue:"Document"})),"</title><style>").concat(r,'</style></head><body><div class="print-paper">').concat(n,"</div></body></html>")),i.document.close()}catch(e){console.error("Failed to write to print window",e);try{i.close()}catch(e){}R.current=!1;return}setTimeout(()=>{try{if(!i||i.closed)return;i.focus(),e&&i.print()}catch(e){console.error("Print failed",e)}finally{R.current=!1}},800)};return(0,n.jsx)(o.Z,{children:(0,n.jsxs)(s.Z,{ref:q,children:[(0,n.jsx)("style",{children:'\n          /* Screen preview shell (dialog) */\n          .doc-preview-shell{\n            padding: 14px 10px 16px;\n            background: radial-gradient(1200px 400px at 50% 0%, rgba(99,102,241,0.08), rgba(15,23,42,0) 60%),\n                        linear-gradient(180deg, rgba(15,23,42,0.02), rgba(15,23,42,0.06));\n            border-radius: 14px;\n            overflow: auto;\n          }\n          .print-paper{\n            box-sizing: border-box;\n            background: #fff;\n            border-radius: 10px;\n            box-shadow: 0 14px 32px rgba(15, 23, 42, 0.12), 0 2px 8px rgba(15, 23, 42, 0.06);\n            overflow: hidden;\n            border: 1px solid rgba(15, 23, 42, 0.08);\n            padding: 44px 42px;\n            color: #111827;\n            font: 14px/1.5 "Times New Roman", Times, serif;\n          }\n\n          .doc-topline{ height: 6px; background: #0F172A; border-radius: 999px; margin-bottom: 28px; }\n          .doc-header{ display:flex; align-items:center; justify-content:space-between; gap: 34px; }\n          .doc-header-left{ display:flex; align-items:center; gap: 16px; min-width: 180px; }\n          .doc-logo{ width: 64px; height: 64px; object-fit: contain; }\n          .doc-company{ font-weight: 700; font-size: 24px; text-align:center; flex:1; }\n          .doc-header-right{ min-width: 180px; text-align:right; font-size: 12px; color: #475569; }\n          .doc-subline{ border-top: 1px solid rgba(148, 163, 184, 0.55); margin: 18px 0 22px; }\n\n          .section-title{ font-weight: 700; font-size: 16px; margin: 0 0 8px; }\n          .meta-grid{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px 28px; margin-bottom: 18px; }\n          .meta-row{ display:flex; gap: 12px; }\n          .meta-label{ width: 140px; font-weight: 700; color: #0F172A; }\n          .meta-value{ flex:1; color: #111827; }\n          .note-box{ border: 1px solid rgba(148, 163, 184, 0.45); border-radius: 10px; padding: 12px; background: rgba(248, 250, 252, 1); white-space: pre-wrap; }\n\n          table.parts-table{ width:100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }\n          .parts-table th, .parts-table td{ border: 1px solid rgba(226, 232, 240, 1); padding: 9px 8px; vertical-align: top; }\n          .parts-table th{ background: rgba(241, 245, 249, 1); color:#0F172A; font-weight:700; text-align:left; }\n          .parts-table td{ color:#111827; }\n          .muted{ color:#64748B; }\n          .doc-footer{ margin-top: 22px; display:flex; justify-content:space-between; gap: 20px; font-size: 12px; color:#475569; }\n\n          /* Thumbnail */\n          .doc-thumb{\n            width:'.concat(350,"px;\n            height:").concat(E,"px;\n            border-radius: 12px;\n            overflow: hidden;\n            cursor: pointer;\n            position: relative;\n            background: rgba(15,23,42,0.03);\n            border: 1px solid rgba(15,23,42,0.10);\n            box-shadow: 0 10px 24px rgba(15, 23, 42, 0.10), 0 1px 6px rgba(15, 23, 42, 0.06);\n          }\n          .doc-thumb-overlay{\n            position:absolute;\n            inset:auto 6px 6px 6px;\n            display:flex;\n            align-items:center;\n            justify-content:space-between;\n            gap: 8px;\n            padding: 6px 8px;\n            border-radius: 10px;\n            background: rgba(15, 23, 42, 0.70);\n            color: #fff;\n            font: 12px/1.2 Arial, Helvetica, sans-serif;\n          }\n          .doc-thumb-overlay span{ opacity: 0.92; }\n        ")}),(0,n.jsxs)(s.Z,{sx:{p:2},children:[(0,n.jsxs)("div",{className:"doc-thumb",onClick:()=>L(!0),role:"button",tabIndex:0,children:[(0,n.jsx)("div",{style:{width:"".concat(794*O,"px"),height:"".concat(1123*O,"px")},children:(0,n.jsxs)("div",{className:"print-paper",style:{width:"".concat(794,"px"),minHeight:"".concat(1123,"px"),transform:"scale(".concat(O,")"),transformOrigin:"top left"},children:[(0,n.jsx)("div",{className:"doc-topline"}),(0,n.jsxs)("div",{className:"doc-header",children:[(0,n.jsx)("div",{className:"doc-header-left",children:(0,n.jsx)("img",{className:"doc-logo",src:"/logo.svg",alt:"Logo"})}),(0,n.jsx)("div",{className:"doc-company",children:(null==A?void 0:null===(a=A.task)||void 0===a?void 0:null===(t=a.company_detail)||void 0===t?void 0:t.name)||"—"}),(0,n.jsxs)("div",{className:"doc-header-right",children:[(0,n.jsx)("div",{className:"muted",children:String(W("tasks.view.document.fields.inputDocNumber",{defaultValue:"Incoming number"}))}),(0,n.jsxs)("div",{style:{fontWeight:700,color:"#0F172A"},children:["№",null!==(D=null==A?void 0:null===(r=A.task)||void 0===r?void 0:r.input_doc_number)&&void 0!==D?D:"—"]})]})]}),(0,n.jsx)("div",{className:"doc-subline"}),(0,n.jsx)("div",{className:"section-title",children:String(W("tasks.view.document.sections.main",{defaultValue:"Main information"}))}),(0,n.jsxs)("div",{className:"meta-grid",children:[(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(W("tasks.view.document.fields.signedBy",{defaultValue:"Signed by"}))}),(0,n.jsx)("div",{className:"meta-value",children:(null==A?void 0:null===(d=A.task)||void 0===d?void 0:null===(l=d.signed_by_detail)||void 0===l?void 0:l.fullname)||"—"})]}),(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(W("tasks.view.document.fields.signedDate",{defaultValue:"Signed date"}))}),(0,n.jsx)("div",{className:"meta-value",children:H(null==A?void 0:null===(c=A.task)||void 0===c?void 0:c.signed_date)})]}),(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(W("tasks.view.actions.partStatus",{defaultValue:"Status"}))}),(0,n.jsx)("div",{className:"meta-value",children:G(null==A?void 0:null===(u=A.task)||void 0===u?void 0:u.status)})]}),(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(W("tasks.view.actions.deadline",{defaultValue:"Deadline"}))}),(0,n.jsx)("div",{className:"meta-value",children:H(null==A?void 0:null===(p=A.task)||void 0===p?void 0:p.end_date)})]})]}),(0,n.jsx)("div",{className:"section-title",children:String(W("tasks.view.document.sections.note",{defaultValue:"Note"}))}),(0,n.jsx)("div",{className:"note-box",children:(null==A?void 0:null===(m=A.task)||void 0===m?void 0:m.note)||"—"}),(0,n.jsx)("div",{style:{height:18}}),(0,n.jsx)("div",{className:"section-title",children:String(W("tasks.view.document.sections.parts",{defaultValue:"Parts"}))}),(0,n.jsxs)("table",{className:"parts-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{style:{width:"18%"},children:String(W("tasks.view.parts.table.assignee",{defaultValue:"Assignee"}))}),(0,n.jsx)("th",{style:{width:"18%"},children:String(W("tasks.view.parts.table.department",{defaultValue:"Department"}))}),(0,n.jsx)("th",{style:{width:"12%"},children:String(W("tasks.view.document.fields.startDate",{defaultValue:"Start date"}))}),(0,n.jsx)("th",{style:{width:"12%"},children:String(W("tasks.view.document.fields.endDate",{defaultValue:"End date"}))}),(0,n.jsx)("th",{style:{width:"12%"},children:String(W("tasks.view.actions.partStatus",{defaultValue:"Status"}))}),(0,n.jsx)("th",{children:String(W("tasks.form.note",{defaultValue:"Note"}))})]})}),(0,n.jsx)("tbody",{children:((null==A?void 0:A.parts)||[]).map(e=>{var t,a;return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(null===(t=e.assignee_detail)||void 0===t?void 0:t.fullname)||"—"}),(0,n.jsx)("td",{children:(null===(a=e.department_detail)||void 0===a?void 0:a.name)||"—"}),(0,n.jsx)("td",{children:H(e.start_date)}),(0,n.jsx)("td",{children:H(e.end_date)}),(0,n.jsx)("td",{children:G(e.status)}),(0,n.jsx)("td",{children:e.note||"—"})]},e.id)})})]}),(0,n.jsxs)("div",{className:"doc-footer",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"muted",children:String(W("common.createdAt",{defaultValue:"Created at"}))}),(0,n.jsx)("div",{children:H(null==A?void 0:null===(x=A.task)||void 0===x?void 0:x.created_time,!0)})]}),(0,n.jsxs)("div",{style:{textAlign:"right"},children:[(0,n.jsx)("div",{className:"muted",children:String(W("tasks.view.document.header.overline",{defaultValue:"Document"}))}),(0,n.jsx)("div",{style:{fontWeight:700,color:"#0F172A"},children:String(W("tasks.view.document.header.fallbackTitle",{id:null!==(M=null==A?void 0:null===(h=A.task)||void 0===h?void 0:h.id)&&void 0!==M?M:"—",defaultValue:"Task #{{id}}"}))})]})]})]})}),(0,n.jsxs)("div",{className:"doc-thumb-overlay",children:[(0,n.jsx)("span",{children:String(W("tasks.view.document.actions.openPdf",{defaultValue:"Open PDF view"}))}),(0,n.jsx)(en.JO,{icon:"tabler:zoom-in"})]})]}),(0,n.jsxs)(j.Z,{open:V,onClose:()=>L(!1),maxWidth:"lg",fullWidth:!0,children:[(0,n.jsx)(f.Z,{children:String(W("tasks.view.document.header.overline",{defaultValue:"Document"}))}),(0,n.jsx)(y.Z,{dividers:!0,children:(0,n.jsx)(s.Z,{className:"doc-preview-shell",children:(0,n.jsx)(s.Z,{sx:{width:"".concat(Math.round(714.6),"px"),minHeight:"".concat(Math.round(1010.7),"px"),margin:"0 auto"},children:(0,n.jsx)("div",{style:{width:"".concat(714.6,"px"),minHeight:"".concat(1010.7,"px")},children:(0,n.jsxs)("div",{className:"print-paper",style:{width:"".concat(794,"px"),minHeight:"".concat(1123,"px"),transform:"scale(".concat(.9,")"),transformOrigin:"top left"},children:[(0,n.jsx)("div",{className:"doc-topline"}),(0,n.jsxs)("div",{className:"doc-header",children:[(0,n.jsx)("div",{className:"doc-header-left",children:(0,n.jsx)("img",{className:"doc-logo",src:"/logo.svg",alt:"Logo"})}),(0,n.jsx)("div",{className:"doc-company",children:(null==A?void 0:null===(v=A.task)||void 0===v?void 0:null===(g=v.company_detail)||void 0===g?void 0:g.name)||"—"}),(0,n.jsxs)("div",{className:"doc-header-right",children:[(0,n.jsx)("div",{className:"muted",children:String(W("tasks.view.document.fields.inputDocNumber",{defaultValue:"Incoming number"}))}),(0,n.jsxs)("div",{style:{fontWeight:700,color:"#0F172A"},children:["№",null!==(F=null==A?void 0:null===(b=A.task)||void 0===b?void 0:b.input_doc_number)&&void 0!==F?F:"—"]})]})]}),(0,n.jsx)("div",{className:"doc-subline"}),(0,n.jsx)("div",{className:"section-title",children:String(W("tasks.view.document.sections.main",{defaultValue:"Main information"}))}),(0,n.jsxs)("div",{className:"meta-grid",children:[(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(W("tasks.view.document.fields.signedBy",{defaultValue:"Signed by"}))}),(0,n.jsx)("div",{className:"meta-value",children:(null==A?void 0:null===(S=A.task)||void 0===S?void 0:null===(w=S.signed_by_detail)||void 0===w?void 0:w.fullname)||"—"})]}),(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(W("tasks.view.document.fields.signedDate",{defaultValue:"Signed date"}))}),(0,n.jsx)("div",{className:"meta-value",children:H(null==A?void 0:null===(_=A.task)||void 0===_?void 0:_.signed_date)})]}),(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(W("tasks.view.actions.partStatus",{defaultValue:"Status"}))}),(0,n.jsx)("div",{className:"meta-value",children:G(null==A?void 0:null===(C=A.task)||void 0===C?void 0:C.status)})]}),(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsx)("div",{className:"meta-label",children:String(W("tasks.view.actions.deadline",{defaultValue:"Deadline"}))}),(0,n.jsx)("div",{className:"meta-value",children:H(null==A?void 0:null===(I=A.task)||void 0===I?void 0:I.end_date)})]})]}),(0,n.jsx)("div",{className:"section-title",children:String(W("tasks.view.document.sections.note",{defaultValue:"Note"}))}),(0,n.jsx)("div",{className:"note-box",children:(null==A?void 0:null===(P=A.task)||void 0===P?void 0:P.note)||"—"}),(0,n.jsx)("div",{style:{height:18}}),(0,n.jsx)("div",{className:"section-title",children:String(W("tasks.view.document.sections.parts",{defaultValue:"Parts"}))}),(0,n.jsxs)("table",{className:"parts-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{style:{width:"18%"},children:String(W("tasks.view.parts.table.assignee",{defaultValue:"Assignee"}))}),(0,n.jsx)("th",{style:{width:"18%"},children:String(W("tasks.view.parts.table.department",{defaultValue:"Department"}))}),(0,n.jsx)("th",{style:{width:"12%"},children:String(W("tasks.view.document.fields.startDate",{defaultValue:"Start date"}))}),(0,n.jsx)("th",{style:{width:"12%"},children:String(W("tasks.view.document.fields.endDate",{defaultValue:"End date"}))}),(0,n.jsx)("th",{style:{width:"12%"},children:String(W("tasks.view.actions.partStatus",{defaultValue:"Status"}))}),(0,n.jsx)("th",{children:String(W("tasks.form.note",{defaultValue:"Note"}))})]})}),(0,n.jsx)("tbody",{children:((null==A?void 0:A.parts)||[]).map(e=>{var t,a;return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(null===(t=e.assignee_detail)||void 0===t?void 0:t.fullname)||"—"}),(0,n.jsx)("td",{children:(null===(a=e.department_detail)||void 0===a?void 0:a.name)||"—"}),(0,n.jsx)("td",{children:H(e.start_date)}),(0,n.jsx)("td",{children:H(e.end_date)}),(0,n.jsx)("td",{children:G(e.status)}),(0,n.jsx)("td",{children:e.note||"—"})]},e.id)})})]}),(0,n.jsxs)("div",{className:"doc-footer",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"muted",children:String(W("common.createdAt",{defaultValue:"Created at"}))}),(0,n.jsx)("div",{children:H(null==A?void 0:null===(N=A.task)||void 0===N?void 0:N.created_time,!0)})]}),(0,n.jsxs)("div",{style:{textAlign:"right"},children:[(0,n.jsx)("div",{className:"muted",children:String(W("tasks.view.document.header.overline",{defaultValue:"Document"}))}),(0,n.jsx)("div",{style:{fontWeight:700,color:"#0F172A"},children:String(W("tasks.view.document.header.fallbackTitle",{id:null!==(T=null==A?void 0:null===(z=A.task)||void 0===z?void 0:z.id)&&void 0!==T?T:"—",defaultValue:"Task #{{id}}"}))})]})]})]})})})})}),(0,n.jsxs)(k.Z,{children:[(0,n.jsx)(Z.Z,{onClick:()=>K(!1),startIcon:(0,n.jsx)(en.JO,{icon:"tabler:file-type-pdf"}),children:String(W("tasks.view.document.actions.openPdf",{defaultValue:"Open PDF view"}))}),(0,n.jsx)(Z.Z,{onClick:()=>K(!0),variant:"contained",startIcon:(0,n.jsx)(en.JO,{icon:"tabler:printer"}),children:String(W("tasks.view.document.actions.print",{defaultValue:"Print / Save as PDF"}))}),(0,n.jsx)(Z.Z,{onClick:()=>L(!1),children:String(W("common.close",{defaultValue:"Close"}))})]})]})]})]})})}var er=a(37958),es=a(77527),el=a(86501);a(80135);var eo=a(1652),ed=a(73138),ec=a(9041);let eu=(0,es.ZP)(s.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(6),justifyContent:"space-between"}});var ep=e=>{var t,a,r;let{open:l,toggle:o,taskId:d,partId:c,part:m,task:x}=e,{user:v}=(0,ea.a)(),{t:b}=(0,B.$G)(),[j,f]=i.useState(ec.EditorState.createEmpty()),[y,w]=i.useState(""),[k,S]=i.useState(null),[_,C]=i.useState(!1),[I,P]=i.useState({title:"",comment:"",file:""}),N=()=>{f(ec.EditorState.createEmpty()),w(""),S(null),P({title:"",comment:"",file:""})},z=async()=>{if(!d){el.ZP.error(String(b("tasks.view.actions.toasts.taskRequired")||"Task id required"));return}let e=j.getCurrentContent().hasText(),t=!!k;if(e)P(e=>({...e,comment:""}));else{P(e=>({...e,comment:String(b("tasks.view.actions.toasts.commentRequired")||"Comment is required")}));return}if(t)P(e=>({...e,file:""}));else{P(e=>({...e,file:String(b("tasks.view.actions.toasts.fileRequired")||"File is required")}));return}if(y)P(e=>({...e,title:""}));else{P(e=>({...e,title:String(b("tasks.view.actions.toasts.titleRequired")||"Title is required")}));return}try{if(C(!0),e&&await g.Do.post(h.Z.taskComment,{part:null!=c?c:null,author:null==v?void 0:v.id,text:j.getCurrentContent().getPlainText()}),t&&k){let e=new FormData;e.append("file",k),e.append("title",y.trim()||k.name),e.append("part",c?c.toString():""),await g.Do.postForm(h.Z.taskAttachment,e)}await g.Do.patch(h.Z.taskPartById(null!=c?c:null),{status:"on_review",task:d}),el.ZP.success(String(b("tasks.view.actions.toasts.saved")||"Saved")),N(),o()}catch(e){console.error("Failed to submit combined from drawer",e),el.ZP.error(String(b("tasks.view.actions.toasts.saveError")||"Failed to save"))}finally{C(!1),N()}},D=async()=>{if(j.getCurrentContent().hasText())P(e=>({...e,comment:""}));else{P(e=>({...e,comment:String(b("tasks.view.actions.toasts.commentRequired")||"Comment is required")}));return}try{C(!0),await g.Do.patch(h.Z.taskPartById(null!=c?c:null),{status:"returned",task:d}),el.ZP.success(String(b("tasks.view.actions.toasts.resend")||"Resend"))}catch(e){console.error("Failed to resend combined",e),el.ZP.error(String(b("tasks.view.actions.toasts.resendError")||"Failed to resend"))}finally{C(!1),N(),o()}},M=async()=>{if(j.getCurrentContent().hasText())P(e=>({...e,comment:""}));else{P(e=>({...e,comment:String(b("tasks.view.actions.toasts.commentRequired")||"Comment is required")}));return}try{C(!0),await g.Do.patch(h.Z.taskPartById(null!=c?c:null),{status:"cancelled",task:d}),el.ZP.success(String(b("tasks.view.actions.toasts.cancel")||"Cancel"))}catch(e){console.error("Failed to cancel combined",e)}finally{C(!1),N(),o()}},F=async()=>{if(j.getCurrentContent().hasText())P(e=>({...e,comment:""}));else{P(e=>({...e,comment:String(b("tasks.view.actions.toasts.commentRequired")||"Comment is required")}));return}try{C(!0),await g.Do.patch(h.Z.taskPartById(null!=c?c:null),{status:"done",task:d}),el.ZP.success(String(b("tasks.view.actions.toasts.done")||"Done"))}catch(e){console.error("Failed to complete combined",e)}finally{C(!1),N(),o()}};return(0,n.jsxs)(er.ZP,{open:l,anchor:"right",variant:"temporary",onClose:o,sx:{"& .MuiDrawer-paper":{width:[300,400]}},ModalProps:{keepMounted:!0},children:[(0,n.jsxs)(eu,{children:[(0,n.jsx)(u.Z,{variant:"h5",children:String(b("tasks.view.actions.drawerTitle")||"Send / Execute")}),(0,n.jsx)(q.Z,{size:"small",onClick:o,sx:{p:"0.375rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:e=>"rgba(".concat(e.palette.customColors.main,", 0.16)")}},children:(0,n.jsx)(E.Z,{icon:"tabler:x",fontSize:"1.25rem"})})]}),(0,n.jsx)(s.Z,{sx:{p:e=>e.spacing(0,6,6)},children:(0,n.jsxs)(s.Z,{children:[(null==v?void 0:v.id)===(null==m?void 0:null===(t=m.assignee_detail)||void 0===t?void 0:t.id)&&c&&((null==m?void 0:m.status)==="new"||(null==m?void 0:m.status)==="in_progress"||(null==m?void 0:m.status)==="returned")&&(0,n.jsxs)(s.Z,{sx:{my:2,display:"flex",flexDirection:"column",gap:2},children:[(0,n.jsx)(J.Z,{fullWidth:!0,label:String(b("tasks.view.actions.attachmentDialog.titleLabel")||"Attachment title"),value:y,onChange:e=>w(e.target.value),sx:{mb:1},error:!!I.title,helperText:I.title}),(0,n.jsxs)(Z.Z,{component:"label",variant:"outlined",startIcon:(0,n.jsx)(E.Z,{icon:"tabler:upload"}),sx:{mb:1},children:[String(b("tasks.view.actions.attachmentDialog.chooseFile")||"Choose file"),(0,n.jsx)("input",{hidden:!0,type:"file",onChange:e=>{var t;return S((null===(t=e.target.files)||void 0===t?void 0:t[0])||null)}})]}),I.file?(0,n.jsx)(u.Z,{color:"error",variant:"caption",sx:{mb:1},children:I.file}):null,k?(0,n.jsx)(s.Z,{sx:{mb:1},children:(0,n.jsx)(p.Z,{label:k.name})}):null]}),(0,n.jsxs)(eo.cP,{children:[(0,n.jsx)("div",{style:{marginBottom:8,fontWeight:500},children:String(b("commands.form.basis"))}),(0,n.jsx)(ed.Z,{editorState:j,onEditorStateChange:e=>{f(e)}}),(0,n.jsx)(u.Z,{color:"error",variant:"caption",sx:{mb:1},children:I.comment})]}),(null==v?void 0:v.id)==(null==m?void 0:null===(a=m.assignee_detail)||void 0===a?void 0:a.id)&&c&&((null==m?void 0:m.status)==="new"||(null==m?void 0:m.status)==="in_progress"||(null==m?void 0:m.status)==="returned")&&(0,n.jsxs)(s.Z,{sx:{display:"flex",gap:2,mt:20},children:[(0,n.jsx)(Z.Z,{variant:"contained",onClick:z,disabled:_,children:String(b("tasks.view.actions.drawer.executeCombined")||"Bajarish")}),(0,n.jsx)(Z.Z,{variant:"outlined",color:"secondary",onClick:()=>N(),disabled:_,children:String(b("common.clear")||"Clear")})]}),(null==v?void 0:v.id)===(null==x?void 0:null===(r=x.signed_by_detail)||void 0===r?void 0:r.id)&&c&&(null==m?void 0:m.status)!=="new"&&(null==m?void 0:m.status)!=="in_progress"&&(null==m?void 0:m.status)!=="returned"&&(0,n.jsxs)(s.Z,{sx:{display:"flex",flexWrap:"wrap",gap:2,mt:20},children:[(0,n.jsx)(Z.Z,{variant:"contained",color:"warning",onClick:D,disabled:_,children:String(b("tasks.view.actions.resendForReview")||"Resend for review")}),(0,n.jsx)(Z.Z,{variant:"contained",color:"error",onClick:M,disabled:_,children:String(b("tasks.view.actions.cancel")||String(b("common.cancel"))||"Cancel")}),(0,n.jsx)(Z.Z,{variant:"contained",onClick:F,disabled:_,children:String(b("tasks.view.actions.done")||"Done")})]})]})})]})},em=a(25026),ex=a(93454);function eh(e){let{parts:t}=e,{t:a}=(0,B.$G)();return(0,n.jsxs)(em.Z,{component:ex.Z,sx:{boxShadow:1},children:[(0,n.jsxs)(s.Z,{sx:{p:2,borderBottom:e=>"1px solid ".concat(e.palette.divider)},children:[(0,n.jsx)(u.Z,{variant:"subtitle1",children:String(a("tasks.view.parts.title")||"Parts")}),(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:String(a("tasks.view.parts.count",{count:(null==t?void 0:t.length)||0}))})]}),(0,n.jsxs)(S.Z,{size:"small",children:[(0,n.jsx)(_.Z,{children:(0,n.jsxs)(C.Z,{children:[(0,n.jsx)(I.Z,{children:(0,n.jsx)(u.Z,{variant:"body2",sx:{fontSize:10},children:String(a("tasks.view.parts.table.assignee")||"Assignee")})}),(0,n.jsx)(I.Z,{children:(0,n.jsx)(u.Z,{variant:"body2",sx:{fontSize:10},children:String(a("tasks.view.parts.table.start")||"Show date")})}),(0,n.jsx)(I.Z,{children:(0,n.jsx)(u.Z,{variant:"body2",sx:{fontSize:10},children:String(a("tasks.view.parts.table.status")||"Is show")})})]})}),(0,n.jsx)(P.Z,{children:t&&t.length?t.map(e=>{var t;return(0,n.jsxs)(C.Z,{hover:!0,children:[(0,n.jsx)(I.Z,{children:(0,n.jsx)(u.Z,{variant:"body2",sx:{fontSize:12},children:(null===(t=e.assignee_detail)||void 0===t?void 0:t.fullname)||"—"})}),(0,n.jsx)(I.Z,{sx:{fontSize:12},children:e.show_date?Q()(e.show_date).format("DD.MM.YYYY"):"—"}),(0,n.jsx)(I.Z,{sx:{fontSize:12},children:e.show_date?(0,n.jsx)(en.JO,{icon:"tabler:eye"}):(0,n.jsx)(en.JO,{icon:"tabler:eye-off"})})]},e.id)}):(0,n.jsx)(C.Z,{children:(0,n.jsx)(I.Z,{colSpan:4,align:"center",children:(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(a("tasks.view.parts.empty")||"No parts")})})})})]})]})}var eg=e=>{var t,a;let{task:r,part:l,mutate:m}=e,{t:x}=(0,B.$G)(),{user:h}=(0,ea.a)(),[v,j]=i.useState(!1),f=null==r?void 0:r.id,y=null==l?void 0:l.id,w=(0,z.NL)(),k=async()=>{try{y&&await w.invalidateQueries({queryKey:["task-part",y],refetchType:"active"}),f&&(await w.invalidateQueries({queryKey:["/task/with-parts/by-id/",f],refetchType:"active"}),null==m||m())}catch(e){console.error("mutateAndRefresh failed",e)}},{data:S,isLoading:_}=(0,D.a)({queryKey:["/task/with-parts/by-id/",f],queryFn:async()=>{let e={task_id:Number(f)};return(await g.Do.post("/task/with-parts/by-id/",e)).data||{parts:[],task:{id:0,title:"",description:""}}},enabled:!!f,staleTime:1e4});return(0,n.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[_?(0,n.jsx)(M.Z,{variant:"rectangular",height:100}):S&&(0,n.jsx)(ei,{fullTask:S}),(0,n.jsx)(o.Z,{children:(0,n.jsx)(d.Z,{children:(0,n.jsxs)(c.Z,{spacing:2,children:[(0,n.jsx)(u.Z,{variant:"subtitle1",children:String(x("tasks.view.actions.title"))}),(0,n.jsx)(b.Z,{}),y?(0,n.jsxs)(c.Z,{spacing:1,children:[(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:String(x("tasks.view.actions.selectedSection"))}),(0,n.jsx)(c.Z,{direction:"row",spacing:1,alignItems:"center",children:(0,n.jsx)(u.Z,{variant:"body2",children:(null==l?void 0:l.title)||String(x("common.notSet"))})}),(0,n.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:String(x("tasks.view.actions.partStatus"))}),(0,n.jsx)(c.Z,{direction:"row",spacing:1,alignItems:"center",children:(null==l?void 0:l.status)?(0,n.jsx)(p.Z,{size:"small",color:"info",variant:"outlined",label:(()=>{let e="documents.status.".concat(l.status.split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")),t=String(x(e));return t===e?l.status:t})()}):null}),(null==h?void 0:h.id)===(null==l?void 0:null===(t=l.assignee_detail)||void 0===t?void 0:t.id)&&y&&((null==l?void 0:l.status)==="new"||(null==l?void 0:l.status)==="in_progress"||(null==l?void 0:l.status)==="returned")&&(0,n.jsx)(Z.Z,{size:"small",variant:"contained",onClick:()=>j(!0),children:String(x("tasks.view.actions.ensureExecution")||"Ensure execution")}),(null==h?void 0:h.id)===(null==r?void 0:null===(a=r.signed_by_detail)||void 0===a?void 0:a.id)&&y&&(null==l?void 0:l.status)==="on_review"&&(0,n.jsx)(Z.Z,{size:"small",variant:"contained",onClick:()=>j(!0),children:String(x("tasks.view.actions.approve")||"Approve")})]}):(0,n.jsx)(c.Z,{spacing:.5,children:(0,n.jsx)(u.Z,{variant:"body2",children:String(x("tasks.view.actions.noPartSelected"))})})]})})}),(0,n.jsx)(eh,{parts:null==S?void 0:S.parts}),(0,n.jsx)(ep,{open:v,toggle:()=>{j(!v),k()},taskId:f?Number(f):void 0,partId:y?Number(y):void 0,part:l,task:r})]})},ev=a(36599),eb=a(87413),ej=a(9601),ef=a(72162),ey=a(17494),ew=a(51221);let ek=(0,es.ZP)(ev.Z)({"& .MuiTimelineItem-root":{width:"100%","&:before":{display:"none"}}}),eZ=e=>{switch(e){case"assigned":case"status_changed":return"info";case"part_created":case"task_created":return"primary";case"commented":case"file_added":case"part_returned":case"task_returned":return"warning";case"part_completed":case"task_completed":return"success";case"part_cancelled":case"task_cancelled":return"error";default:return"grey"}};function eS(e){let{id:t}=e,{t:a}=(0,B.$G)(),{data:i=[],isLoading:r}=(0,D.a)({queryKey:["task-events",t],queryFn:async()=>{var e;return(null===(e=(await g.Do.get(h.Z.taskEvent,{task:t,perPage:50})).data)||void 0===e?void 0:e.results)||[]},staleTime:1e4});return(0,n.jsx)(o.Z,{children:(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(u.Z,{variant:"subtitle2",sx:{mb:2},children:String(a("tasks.view.history.title"))}),r?(0,n.jsxs)(c.Z,{spacing:2,children:[(0,n.jsx)(M.Z,{variant:"text",width:"40%"}),(0,n.jsx)(M.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,n.jsx)(M.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,n.jsx)(M.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}})]}):i.length?(0,n.jsx)(ek,{children:i.map(e=>{var t;return(0,n.jsxs)(eb.Z,{children:[(0,n.jsxs)(ej.Z,{children:[(0,n.jsx)(ey.Z,{color:eZ(e.event_type),variant:"outlined"}),(0,n.jsx)(ew.Z,{})]}),(0,n.jsx)(ef.Z,{sx:{"& svg":{verticalAlign:"bottom",mx:4}},children:(0,n.jsxs)(s.Z,{sx:{mb:1.5,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsxs)(u.Z,{variant:"subtitle1",sx:{mr:2},children:[(null===(t=e.actor_detail)||void 0===t?void 0:t.fullname)||"—"," — ",e.message||e.event_type]}),(0,n.jsx)(u.Z,{variant:"caption",sx:{color:"text.disabled"},children:e.created_time?new Date(e.created_time).toLocaleString():""})]})})]},e.id)})}):(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(a("tasks.view.history.empty"))})]})})}var e_=a(89540),eC=a(69447),eI=a(54560);let eP=(0,es.ZP)(ev.Z)(e=>{let{theme:t}=e;return{"& .MuiTimelineItem-root:nth-of-type(even) .MuiTimelineContent-root":{textAlign:"left"},[t.breakpoints.down("md")]:{"& .MuiTimelineItem-root":{width:"100%","&:before":{display:"none"}}}}}),eB=e=>{switch(e){case"assigned":case"status_changed":return"info";case"part_created":case"task_created":return"primary";case"commented":case"file_added":case"part_returned":case"task_returned":return"warning";case"part_completed":case"task_completed":return"success";case"part_cancelled":case"task_cancelled":return"error";default:return"grey"}},eN=e=>{switch(e){case"assigned":return"tabler:user-check";case"part_created":return"tabler:subtask";case"file_added":return"tabler:paperclip";case"commented":return"tabler:message-circle";case"task_created":return"tabler:file-plus";case"status_changed":return"tabler:refresh";case"part_completed":case"task_completed":return"tabler:circle-check";case"part_returned":case"task_returned":return"tabler:arrow-back-up";case"part_cancelled":case"task_cancelled":return"tabler:circle-x";default:return"tabler:info-circle"}};var ez=e=>{let{id:t}=e,{t:a}=(0,B.$G)(),{data:i=[],isLoading:r}=(0,D.a)({queryKey:["task-events",t],queryFn:async()=>{var e;return(null===(e=(await g.Do.get(h.Z.taskEvent,{task:t,perPage:50})).data)||void 0===e?void 0:e.results)||[]},staleTime:1e4}),{settings:l}=(0,eI.r)(),m=(0,e_.Z)(e=>e.breakpoints.down("md")),{direction:x}=l;return r?(0,n.jsxs)(c.Z,{spacing:2,children:[(0,n.jsx)(M.Z,{variant:"text",width:"40%"}),(0,n.jsx)(M.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,n.jsx)(M.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}}),(0,n.jsx)(M.Z,{variant:"rectangular",height:64,sx:{borderRadius:2}})]}):(0,n.jsx)(o.Z,{children:(0,n.jsx)(d.Z,{children:(0,n.jsx)(eP,{position:m?"right":"alternate",children:i.length?i.map((e,t)=>{var a,i,r,l,o,d,m;let x=eN(e.event_type),h=eB(e.event_type),g=(null===(a=e.actor_detail)||void 0===a?void 0:a.fullname)||"—",v=e.message||e.event_type,b=e.created_time?new Date(e.created_time).toLocaleString():"";return(0,n.jsxs)(eb.Z,{children:[(0,n.jsxs)(ej.Z,{children:[(0,n.jsx)(eC.Z,{skin:"light",color:h,children:(0,n.jsx)(E.Z,{icon:x,fontSize:20})}),(0,n.jsx)(ew.Z,{})]}),(0,n.jsxs)(ef.Z,{sx:{"& svg":{verticalAlign:"bottom",mx:1}},children:[(0,n.jsxs)(s.Z,{sx:{mb:1,display:"flex",gap:2,flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsxs)(u.Z,{variant:"subtitle1",sx:{mr:2},children:[g," — ",v]}),(0,n.jsx)(u.Z,{variant:"caption",sx:{color:"text.disabled"},children:b})]}),(0,n.jsxs)(c.Z,{direction:"row",spacing:1,sx:{flexWrap:"wrap",rowGap:1},children:[(null===(i=e.part_detail)||void 0===i?void 0:i.title)?(0,n.jsx)(p.Z,{size:"small",label:"Qism: ".concat(e.part_detail.title)}):null,(null===(l=e.part_detail)||void 0===l?void 0:null===(r=l.department_detail)||void 0===r?void 0:r.name)?(0,n.jsx)(p.Z,{size:"small",label:"Bo'lim: ".concat(e.part_detail.department_detail.name)}):null,(null===(d=e.part_detail)||void 0===d?void 0:null===(o=d.assignee_detail)||void 0===o?void 0:o.fullname)?(0,n.jsx)(p.Z,{size:"small",label:"Ijrochi: ".concat(e.part_detail.assignee_detail.fullname)}):null,null]})]})]},null!==(m=e.id)&&void 0!==m?m:t)}):(0,n.jsx)(s.Z,{sx:{py:2},children:(0,n.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String(a("tasks.view.process.empty"))})})})})})},eD=()=>{var e,t;let{t:a}=(0,B.$G)(),{id:v}=(0,r.useRouter)().query,[b,j]=(0,i.useState)(0),[f,y]=(0,i.useState)(void 0),{data:w,refetch:k}=(0,D.a)({queryKey:["task",v],enabled:!!v,queryFn:async()=>(await g.Do.get(h.Z.taskById(v))).data}),{data:Z,refetch:S}=(0,D.a)({queryKey:["task-part",f],enabled:!!f,queryFn:async()=>(await g.Do.get(h.Z.taskPartById(f))).data});return(0,n.jsx)(s.Z,{children:(0,n.jsxs)(l.ZP,{container:!0,spacing:4,children:[(0,n.jsxs)(l.ZP,{item:!0,xs:12,md:8,lg:9,children:[(0,n.jsx)(o.Z,{children:(0,n.jsxs)(d.Z,{children:[(0,n.jsxs)(c.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,n.jsx)(u.Z,{variant:"h6",children:w?String(a("tasks.view.header.titleWithId",{id:w.id,name:w.name})):String(a("tasks.view.header.title"))}),(0,n.jsxs)(c.Z,{direction:"row",spacing:1,children:[(0,n.jsx)(p.Z,{label:String(a("tasks.view.header.status",{value:(e=>{if(!e)return"—";let t="documents.status.".concat(e.split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")),n=String(a(t));return n===t?e:n})(null==w?void 0:w.status)})),size:"small"}),(0,n.jsx)(p.Z,{label:String(a("tasks.view.header.priority",{value:(e=>{if(!e)return"—";let t="tasks.priority.".concat("orgently"===e?"orgently":"normal"===e?"ordinary":e),n=String(a(t));return n===t?e:n})(null==w?void 0:w.priority)})),size:"small"}),(0,n.jsx)(p.Z,{label:String(a("tasks.view.header.type",{value:(e=>{if(!e)return"—";let t="tasks.type.".concat(e),n=String(a(t));return n===t?e:n})(null==w?void 0:w.type)})),size:"small"}),(null==w?void 0:w.end_date)&&(0,n.jsx)(p.Z,{label:String(a("tasks.view.header.deadline",{value:w.end_date})),size:"small"})]})]}),(0,n.jsxs)(s.Z,{sx:{mt:1,display:"flex",gap:3,flexWrap:"wrap",alignItems:"center"},children:[(0,n.jsxs)(s.Z,{children:[(0,n.jsxs)(u.Z,{component:"span",sx:{fontWeight:700,mr:1},children:[String(a("tasks.view.document.fields.inputDocNumber")),":"]}),(0,n.jsx)(u.Z,{component:"span",children:null!==(e=null==w?void 0:w.input_doc_number)&&void 0!==e?e:"—"})]}),(0,n.jsxs)(s.Z,{children:[(0,n.jsxs)(u.Z,{component:"span",sx:{fontWeight:700,mr:1},children:[String(a("tasks.view.document.fields.outputDocNumber")),":"]}),(0,n.jsx)(u.Z,{component:"span",children:null!==(t=null==w?void 0:w.output_doc_number)&&void 0!==t?t:"—"})]})]}),(0,n.jsxs)(m.Z,{value:b,onChange:(e,t)=>j(t),sx:{mt:2},variant:"scrollable",scrollButtons:"auto",children:[(0,n.jsx)(x.Z,{label:String(a("tasks.view.tabs.document"))}),(0,n.jsx)(x.Z,{label:String(a("tasks.view.tabs.history"))}),(0,n.jsx)(x.Z,{label:String(a("tasks.view.tabs.process"))})]})]})}),(0,n.jsxs)(s.Z,{sx:{mt:3},children:[0===b&&(0,n.jsx)(et,{task:w,selectedPartId:null!=f?f:void 0,setSelectedPartId:y}),1===b&&(0,n.jsx)(eS,{id:v}),2===b&&(0,n.jsx)(ez,{id:v})]})]}),(0,n.jsx)(l.ZP,{item:!0,xs:12,md:4,lg:3,children:(0,n.jsx)(eg,{task:w,part:Z,mutate:()=>{k(),S()}})})]})})};function eM(){return(0,n.jsx)(eD,{})}},73138:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});var n=a(85893),i=a(5152);let r=a.n(i)()(()=>a.e(6925).then(a.t.bind(a,35108,23)).then(e=>e.Editor),{loadableGenerated:{webpack:()=>[35108]},ssr:!1});var s=e=>(0,n.jsx)(r,{editorState:e.editorState,onEditorStateChange:t=>e.onEditorStateChange(t)})}},function(e){e.O(0,[4885,2785,9084,3035,6437,1421,8833,958,2888,9774,179],function(){return e(e.s=94487)}),_N_E=e.O()}]);