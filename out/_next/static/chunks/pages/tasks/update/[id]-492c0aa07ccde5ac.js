(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7478],{31865:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tasks/update/[id]",function(){return t(15493)}])},25026:function(e,r,t){"use strict";t.d(r,{Z:function(){return Z}});var n=t(87462),a=t(63366),i=t(67294),s=t(86010),l=t(94780),o=t(29567),d=t(77527),c=t(1588),u=t(34867);function m(e){return(0,u.Z)("MuiTableContainer",e)}(0,c.Z)("MuiTableContainer",["root"]);var p=t(85893);let g=["className","component"],h=e=>{let{classes:r}=e;return(0,l.Z)({root:["root"]},m,r)},x=(0,d.ZP)("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(e,r)=>r.root})({width:"100%",overflowX:"auto"});var Z=i.forwardRef(function(e,r){let t=(0,o.Z)({props:e,name:"MuiTableContainer"}),{className:i,component:l="div"}=t,d=(0,a.Z)(t,g),c=(0,n.Z)({},t,{component:l}),u=h(c);return(0,p.jsx)(x,(0,n.Z)({ref:r,as:l,className:(0,s.Z)(u.root,i),ownerState:c},d))})},58898:function(e,r,t){"use strict";var n=t(18745),a=t(86501);r.Z=()=>{let e=(0,n.Z)();return{success:(r,t)=>a.ZP.success(r,{style:{paddingInline:"10px",paddingBlock:"6px",color:e.palette.success.main,border:"1px solid ".concat(e.palette.success.main)},iconTheme:{primary:e.palette.success.main,secondary:e.palette.success.contrastText},...t}),error:(r,t)=>a.ZP.error(r,{style:{paddingInline:"10px",paddingBlock:"6px",color:e.palette.error.main,border:"1px solid ".concat(e.palette.error.main)},iconTheme:{primary:e.palette.error.main,secondary:e.palette.getContrastText(e.palette.error.main)},...t}),info:(r,t)=>(0,a.ZP)(r,{style:{padding:"16px",color:e.palette.info.main,border:"1px solid ".concat(e.palette.info.main)},iconTheme:{primary:e.palette.info.main,secondary:e.palette.getContrastText(e.palette.info.main)},...t})}}},15493:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return U}});var n=t(85893),a=t(67294),i=t(84166),s=t(68573),l=t(60762),o=t(71919),d=t(46070),c=t(6897),u=t(85533),m=t(15903),p=t(65806),g=t(12467),h=t(96788),x=t(51015),Z=t(81873),j=t(25026),v=t(93454),f=t(76592),S=t(70360),y=t(46577),_=t(8863),k=t(19827),b=t(21038),w=t(52857),P=t(33453),q=t(92365),C=t(40110),T=t(96727),D=t(90642),I=t(56912),W=t(87536),z=t(47533),O=t(16310),L=t(7879),A=t(74538),E=t(52293),M=t(58898),N=t(11163),F=t(41664),R=t.n(F);t(5843);var Q=t(81342),B=t(33251),V=t(9198),X=t.n(V),Y=t(34273),G=t(75673),$=t(22120);let H={status:"new",type:"task",name:"",task_form:0,sending_org:"",input_doc_number:"",output_doc_number:"",start_date:"",end_date:"",priority:"ordinary",department:0,signed_by:0,note:"",list_of_magazine:0},J=e=>O.Ry({type:O.Z_().oneOf(["task","application"]).required(String(e("errors.required"))),name:O.Z_().min(2,String(e("errors.minChars",{count:2}))).required(String(e("errors.required"))),task_form:O.Rx().typeError(String(e("errors.select"))).moreThan(0,String(e("errors.select"))).required(String(e("errors.required"))),sending_org:O.Z_().required(String(e("errors.required"))),input_doc_number:O.Z_().required(String(e("errors.required"))),output_doc_number:O.Z_().required(String(e("errors.required"))),start_date:O.Z_().required(String(e("errors.required"))),end_date:O.Z_().required(String(e("errors.required"))),priority:O.Z_().oneOf(["ordinary","orgently"]).required(String(e("errors.required"))),department:O.Rx().typeError(String(e("errors.select"))).moreThan(0,String(e("errors.select"))).required(String(e("errors.required"))),list_of_magazine:O.Rx().typeError(String(e("errors.select"))).moreThan(0,String(e("errors.select"))).required(String(e("errors.required"))),signed_by:O.Rx().typeError(String(e("errors.select"))).moreThan(0,String(e("errors.select"))).required(String(e("errors.required")))});var K=()=>{var e;let{t:r}=(0,$.$G)(),t=J(r),{control:O,handleSubmit:F,reset:V,getValues:K}=(0,W.cI)({defaultValues:H,resolver:(0,z.X)(t)}),U=(0,M.Z)(),ee=(0,N.useRouter)(),{id:er}=ee.query,{user:et}=(0,Y.a)(),[en,ea]=(0,a.useState)("simple"),[ei,es]=(0,a.useState)(0),[el,eo]=(0,a.useState)(null),[ed,ec]=(0,a.useState)([]),[eu,em]=(0,a.useState)(!1),[ep,eg]=(0,a.useState)({title:"",department:0,assignee:0,start_date:"",end_date:"",note:""}),[eh,ex]=(0,a.useState)({}),[eZ,ej]=(0,a.useState)(null),[ev,ef]=(0,a.useState)(!1),[eS,ey]=(0,a.useState)(null),[e_,ek]=(0,a.useState)([]),[eb,ew]=(0,a.useState)([]),[eP,eq]=(0,a.useState)(!1),{data:eC}=(0,B.z)(A.Z.department,{page:1,perPage:100}),{data:eT}=(0,B.z)(A.Z.users,{page:1,perPage:100}),{data:eD}=(0,B.z)(A.Z.users,{page:1,perPage:100,roles__name:"Performer"}),{data:eI}=(0,B.z)(A.Z.users,{page:1,perPage:100,roles__name:"Signatory"}),{data:eW}=(0,B.z)(A.Z.documentForm,{page:1,perPage:100}),ez=eW||[],{data:eO}=(0,B.z)(A.Z.listOfMagazine,{page:1,perPage:100}),eL=e=>"string"==typeof e?e:void 0,[eA,eE]=(0,a.useState)([]),[eM,eN]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{if(!er||Array.isArray(er))return;let e=(await E.Do.get(A.Z.taskById(er))).data;if(ea(e.task_type||"simple"),"simple"===e.task_type){var r,t;let e=null===(t=(await E.Do.get(A.Z.taskPart,{task:er,perPage:50})).data)||void 0===t?void 0:null===(r=t.results)||void 0===r?void 0:r[0];e?(es(e.assignee||0),eo(e.id||null)):eo(null)}V({...H,...e,priority:e.priority||"ordinary",task_form:"number"==typeof e.task_form?e.task_form:0,sending_org:e.sending_org||"",department:"number"==typeof e.department?e.department:0,signed_by:"number"==typeof e.signed_by?e.signed_by:0,list_of_magazine:"number"==typeof e.list_of_magazine?e.list_of_magazine:0,start_date:e.start_date?new Date(e.start_date).toISOString().slice(0,10):"",end_date:e.end_date?new Date(e.end_date).toISOString().slice(0,10):""})})()},[er,V]),(0,a.useEffect)(()=>{(async()=>{if(!(!er||Array.isArray(er)))try{var e;let r=await E.Do.get(A.Z.taskPart,{task:er,perPage:50});ec((null===(e=r.data)||void 0===e?void 0:e.results)||[])}catch(e){console.error("Error fetching task parts:",e)}})()},[er]);let eF=async()=>{if(!er||Array.isArray(er)||!ei)return;let{start_date:e,end_date:t,department:n}=K();try{var a,i;if(!e||!t||!n){U.error(String(r("tasks.toast.startDateRequired")));return}let s={task:Number(er),title:String(r("tasks.parts.simpleTitle")),assignee:ei,department:n,start_date:e,end_date:t,note:""};el?await E.Do.patch(A.Z.taskPartById(el),{...s,updated_by:(null==et?void 0:et.id)||1}):await E.Do.post(A.Z.taskPart,{...s,status:"new",created_by:(null==et?void 0:et.id)||1}),U.success(String(r("tasks.toast.assigneeAssigned")));let l=await E.Do.get(A.Z.taskPart,{task:er,perPage:50}),o=(null===(a=l.data)||void 0===a?void 0:a.results)||[];ec(o),(null==o?void 0:null===(i=o[0])||void 0===i?void 0:i.id)&&eo(o[0].id)}catch(e){U.error((null==e?void 0:e.message)||String(r("errors.somethingWentWrong")))}},eR=e=>{if(e){let r=ed.find(r=>r.id===e);r&&(eg({title:r.title,department:r.department,assignee:r.assignee,start_date:r.start_date,end_date:r.end_date,note:r.note}),ej(e))}else eg({title:"",department:0,assignee:0,start_date:"",end_date:"",note:""}),ej(null);ex({}),em(!0)},eQ=()=>{em(!1),ej(null)},eB=async()=>{if(!er||Array.isArray(er))return;let e={};if(ep.title&&ep.title.trim()||(e.title=String(r("errors.required"))),(!ep.department||0>=Number(ep.department))&&(e.department=String(r("errors.required"))),(!ep.assignee||0>=Number(ep.assignee))&&(e.assignee=String(r("errors.required"))),ep.start_date||(e.start_date=String(r("errors.required"))),ep.end_date||(e.end_date=String(r("errors.required"))),ep.start_date&&ep.end_date){let t=new Date(ep.start_date);new Date(ep.end_date)<t&&(e.end_date=String(r("errors.endAfterStart")))}if(ep.note&&String(ep.note).trim()||(e.note=String(r("errors.required"))),ex(e),Object.keys(e).length>0){U.error(String(r("tasks.toast.partFormRequired")));return}try{var t;eZ?(await E.Do.put(A.Z.taskPartById(eZ),{title:ep.title||"",department:ep.department||0,assignee:ep.assignee||0,start_date:ep.start_date||"",end_date:ep.end_date||"",note:ep.note||"",updated_by:(null==et?void 0:et.id)||1,task:Number(er)}),U.success(String(r("common.saved")))):(await E.Do.post(A.Z.taskPart,{task:Number(er),title:ep.title||String(r("tasks.parts.newTitleFallback")),department:ep.department||0,assignee:ep.assignee||0,start_date:ep.start_date||"",end_date:ep.end_date||"",status:"new",note:ep.note||"",created_by:(null==et?void 0:et.id)||1}),U.success(String(r("tasks.toast.partCreated")))),em(!1),ej(null);let e=await E.Do.get(A.Z.taskPart,{task:er,perPage:50});ec((null===(t=e.data)||void 0===t?void 0:t.results)||[])}catch(e){U.error((null==e?void 0:e.message)||String(r("errors.somethingWentWrong")))}},eV=async e=>{try{await E.Do.delete(A.Z.taskPartById(e)),U.success(String(r("tasks.toast.partDeleted"))),ec(ed.filter(r=>r.id!==e))}catch(e){U.error((null==e?void 0:e.message)||String(r("errors.somethingWentWrong")))}},eX=async e=>{try{let r=(await E.Do.get(A.Z.taskAttachment,{part:e})).data;ek(r.results||r||[])}catch(e){console.error("Error fetching part attachments:",e)}},eY=e=>{ey(e),ew([]),eX(e),ef(!0)},eG=()=>{ef(!1),ey(null),ek([]),ew([])},e$=e=>{ew(r=>r.filter((r,t)=>t!==e))},eH=(e,r)=>{ew(t=>t.map((t,n)=>n===e?{...t,title:r}:t))},eJ=(e,r)=>{ew(t=>t.map((t,n)=>n===e?{...t,file:r}:t))},eK=async()=>{if(!eS||!er)return;let e=eb.filter(e=>e.file&&e.title.trim().length);if(!e.length)return U.error(String(r("replyLetter.attachments.validation.fileAndTitleRequired")));try{for(let r of(eq(!0),e)){var t,n;let e=new FormData;e.append("part",eS.toString()),e.append("title",r.title),r.file&&e.append("file",r.file),e.append("uploaded_by",null!==(n=null==et?void 0:null===(t=et.id)||void 0===t?void 0:t.toString())&&void 0!==n?n:""),await E.Do.postForm(A.Z.taskAttachment,e)}U.success(String(r("tasks.attachments.attached"))),ew([]),eX(eS)}catch(e){console.error("Error uploading part attachments:",e),U.error(String(r("tasks.attachments.attachError")))}finally{eq(!1)}},eU=e=>{e.file&&window.open(String(e.file),"_blank","noopener,noreferrer")},e0=async e=>{try{if(!er||Array.isArray(er))return;eA.length&&await e1(),await E.Do.put(A.Z.taskById(er),{...e,company:null==et?void 0:et.company_id}),U.success(String(r("tasks.toast.updated")))}catch(e){U.error((null==e?void 0:e.message)||String(r("tasks.toast.updateError")))}},e1=async()=>{if(er){if(!eA.length){U.error(String(r("tasks.attachments.fileRequired")));return}try{for(let r of(eN(!0),eA)){var e,t;let n=new FormData;n.append("file",r),n.append("title",r.name),n.append("task",er.toString()),n.append("uploaded_by",null!==(t=null==et?void 0:null===(e=et.id)||void 0===e?void 0:e.toString())&&void 0!==t?t:""),await E.Do.postForm(A.Z.taskAttachment,n)}U.success(String(r("tasks.attachments.attached"))),eE([])}catch(e){console.error("Failed to create attachment",e),U.error(String(r("tasks.attachments.attachError")));return}finally{eN(!1)}}},e2=async e=>{!er||Array.isArray(er)||await E.Do.patch(A.Z.taskById(er),{task_type:e})};return(0,n.jsxs)(i.Z,{spacing:4,children:[(0,n.jsx)(Q.Z,{children:(0,n.jsx)("form",{onSubmit:F(e0),children:(0,n.jsxs)(s.ZP,{container:!0,spacing:4,alignItems:"stretch",children:[(0,n.jsx)(s.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(l.Z,{variant:"outlined",sx:{height:"100%"},children:(0,n.jsx)(o.Z,{children:(0,n.jsxs)(s.ZP,{container:!0,spacing:4,children:[(0,n.jsx)(s.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(W.Qr,{name:"type",control:O,render:e=>{let{field:t,fieldState:a}=e,i=[{value:"task",label:String(r("tasks.type.task"))},{value:"application",label:String(r("tasks.type.application"))}];return(0,n.jsx)(d.Z,{options:i,value:i.find(e=>e.value===t.value)||null,onChange:(e,r)=>t.onChange((null==r?void 0:r.value)||""),isOptionEqualToValue:(e,r)=>e.value===r.value,getOptionLabel:e=>e.label,renderInput:e=>{var t;return(0,n.jsx)(L.Z,{...e,fullWidth:!0,label:String(r("tasks.form.type")),error:!!a.error,helperText:eL(null===(t=a.error)||void 0===t?void 0:t.message)})}})}})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(W.Qr,{name:"priority",control:O,render:e=>{var t;let{field:a,fieldState:i}=e;return(0,n.jsxs)(c.Z,{error:!!i.error,children:[(0,n.jsx)(u.Z,{children:String(r("tasks.form.priority"))}),(0,n.jsxs)(m.Z,{row:!0,...a,value:a.value||"ordinary",children:[(0,n.jsx)(p.Z,{value:"ordinary",control:(0,n.jsx)(g.Z,{}),label:String(r("tasks.priority.ordinary"))}),(0,n.jsx)(p.Z,{value:"orgently",control:(0,n.jsx)(g.Z,{}),label:String(r("tasks.priority.orgently"))})]}),!!i.error&&(0,n.jsx)(h.Z,{variant:"caption",color:"error",children:eL(null===(t=i.error)||void 0===t?void 0:t.message)})]})}})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,children:(0,n.jsx)(W.Qr,{name:"name",control:O,rules:{required:String(r("errors.required"))},render:e=>{var t;let{field:a,fieldState:i}=e;return(0,n.jsx)(L.Z,{fullWidth:!0,label:String(r("tasks.form.name")),...a,error:!!i.error,helperText:eL(null===(t=i.error)||void 0===t?void 0:t.message)})}})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(W.Qr,{name:"task_form",control:O,rules:{required:String(r("errors.required"))},render:e=>{let{field:t,fieldState:a}=e;return(0,n.jsx)(d.Z,{options:ez||[],value:(ez||[]).find(e=>e.id===t.value)||null,onChange:(e,r)=>{var n;return t.onChange(null!==(n=null==r?void 0:r.id)&&void 0!==n?n:0)},isOptionEqualToValue:(e,r)=>e.id===r.id,getOptionLabel:e=>(null==e?void 0:e.name)||"",renderInput:e=>{var t;return(0,n.jsx)(L.Z,{...e,fullWidth:!0,label:String(r("tasks.form.taskForm")),error:!!a.error,helperText:eL(null===(t=a.error)||void 0===t?void 0:t.message)})}})}})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(W.Qr,{name:"sending_org",control:O,rules:{required:!0},render:e=>{var t;let{field:a,fieldState:i}=e;return(0,n.jsx)(L.Z,{fullWidth:!0,label:String(r("tasks.form.sendingOrg")),...a,error:!!i.error,helperText:eL(null===(t=i.error)||void 0===t?void 0:t.message)})}})}),(0,n.jsxs)(s.ZP,{item:!0,xs:12,sm:6,children:[(0,n.jsxs)(x.Z,{component:"label",variant:"outlined",disabled:eM,startIcon:(0,n.jsx)(G.Z,{icon:"mdi:file-upload"}),children:[String(r("tasks.attachments.chooseFiles")),(0,n.jsx)("input",{hidden:!0,type:"file",multiple:!0,onChange:e=>{let r=Array.from(e.target.files||[]);r.length&&(eE(e=>{let t=new Map;for(let r of e)t.set("".concat(r.name,"-").concat(r.size,"-").concat(r.lastModified),r);for(let e of r)t.set("".concat(e.name,"-").concat(e.size,"-").concat(e.lastModified),e);return Array.from(t.values())}),e.target.value="")}})]}),eA.length?(0,n.jsx)(i.Z,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",useFlexGap:!0,marginTop:5,children:eA.map(e=>{let r="".concat(e.name,"-").concat(e.size,"-").concat(e.lastModified);return(0,n.jsx)(Z.Z,{icon:(0,n.jsx)(G.Z,{icon:"mdi:file"}),label:e.name,variant:"outlined",onDelete:eM?void 0:()=>eE(e=>e.filter(e=>"".concat(e.name,"-").concat(e.size,"-").concat(e.lastModified)!==r))},r)})}):null]}),(0,n.jsx)(s.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(W.Qr,{name:"list_of_magazine",control:O,rules:{required:String(r("errors.required"))},render:e=>{let{field:t,fieldState:a}=e;return(0,n.jsx)(d.Z,{options:eO||[],value:(eO||[]).find(e=>e.id===t.value)||null,onChange:(e,r)=>{var n;return t.onChange(null!==(n=null==r?void 0:r.id)&&void 0!==n?n:0)},isOptionEqualToValue:(e,r)=>e.id===r.id,getOptionLabel:e=>(null==e?void 0:e.name)||"",renderInput:e=>{var t;return(0,n.jsx)(L.Z,{...e,fullWidth:!0,label:String(r("tasks.form.magazine")),error:!!a.error,helperText:eL(null===(t=a.error)||void 0===t?void 0:t.message)})}})}})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(W.Qr,{name:"output_doc_number",control:O,rules:{required:String(r("errors.required"))},render:e=>{var t;let{field:a,fieldState:i}=e;return(0,n.jsx)(L.Z,{fullWidth:!0,label:String(r("tasks.form.outputDocNumber")),...a,error:!!i.error,helperText:eL(null===(t=i.error)||void 0===t?void 0:t.message)})}})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(W.Qr,{name:"input_doc_number",control:O,rules:{required:String(r("errors.required"))},render:e=>{var t;let{field:a,fieldState:i}=e;return(0,n.jsx)(L.Z,{fullWidth:!0,label:String(r("tasks.form.inputDocNumber")),...a,error:!!i.error,helperText:eL(null===(t=i.error)||void 0===t?void 0:t.message)})}})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(W.Qr,{name:"start_date",control:O,rules:{required:String(r("errors.required"))},render:e=>{var t;let{field:a,fieldState:i}=e,s=a.value?new Date(a.value):null;return(0,n.jsx)("div",{children:(0,n.jsx)(X(),{selected:s,onChange:e=>a.onChange(e?e.toISOString().slice(0,10):""),dateFormat:"yyyy-MM-dd",showMonthDropdown:!0,showYearDropdown:!0,dropdownMode:"scroll",yearDropdownItemNumber:100,scrollableYearDropdown:!0,customInput:(0,n.jsx)(L.Z,{label:String(r("tasks.form.startDate")),fullWidth:!0,error:!!i.error,helperText:eL(null===(t=i.error)||void 0===t?void 0:t.message)}),showPopperArrow:!0,isClearable:!0})})}})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(W.Qr,{name:"end_date",control:O,rules:{required:String(r("errors.required"))},render:e=>{var t;let{field:a,fieldState:i}=e,s=a.value?new Date(a.value):null;return(0,n.jsx)("div",{children:(0,n.jsx)(X(),{selected:s,onChange:e=>a.onChange(e?e.toISOString().slice(0,10):""),dateFormat:"yyyy-MM-dd",showMonthDropdown:!0,showYearDropdown:!0,dropdownMode:"scroll",yearDropdownItemNumber:100,scrollableYearDropdown:!0,customInput:(0,n.jsx)(L.Z,{label:String(r("tasks.form.endDate")),fullWidth:!0,error:!!i.error,helperText:eL(null===(t=i.error)||void 0===t?void 0:t.message)}),showPopperArrow:!0,isClearable:!0})})}})})]})})})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(l.Z,{variant:"outlined",sx:{height:"100%"},children:(0,n.jsx)(o.Z,{children:(0,n.jsxs)(s.ZP,{container:!0,spacing:4,children:[(0,n.jsx)(s.ZP,{item:!0,xs:12,children:(0,n.jsx)(W.Qr,{name:"department",control:O,rules:{required:!0},render:e=>{let{field:t,fieldState:a}=e;return(0,n.jsx)(d.Z,{options:eC||[],value:(eC||[]).find(e=>e.id===t.value)||null,onChange:(e,r)=>{var n;return t.onChange(null!==(n=null==r?void 0:r.id)&&void 0!==n?n:0)},isOptionEqualToValue:(e,r)=>e.id===r.id,getOptionLabel:e=>(null==e?void 0:e.name)||"",renderInput:e=>{var t;return(0,n.jsx)(L.Z,{...e,fullWidth:!0,label:String(r("tasks.form.department")),error:!!a.error,helperText:eL(null===(t=a.error)||void 0===t?void 0:t.message)})}})}})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,children:(0,n.jsx)(W.Qr,{name:"signed_by",control:O,rules:{required:!0},render:e=>{let{field:t,fieldState:a}=e;return(0,n.jsx)(d.Z,{fullWidth:!0,options:eI||[],getOptionLabel:e=>e.fullname,value:(null==eI?void 0:eI.find(e=>e.id===t.value))||null,onChange:(e,r)=>t.onChange((null==r?void 0:r.id)||0),renderInput:e=>{var t;return(0,n.jsx)(L.Z,{...e,label:String(r("tasks.form.signedBy")),error:!!a.error,helperText:eL(null===(t=a.error)||void 0===t?void 0:t.message),placeholder:String(r("common.selectPlaceholder"))})}})}})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,sm:12,children:(0,n.jsx)(W.Qr,{name:"note",control:O,render:e=>{var t;let{field:a,fieldState:i}=e;return(0,n.jsx)(L.Z,{fullWidth:!0,multiline:!0,rows:3,label:String(r("tasks.form.note")),...a,error:!!i.error,helperText:eL(null===(t=i.error)||void 0===t?void 0:t.message)})}})})]})})})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,children:(0,n.jsxs)(i.Z,{direction:"row",spacing:2,justifyContent:"flex-end",children:[(0,n.jsx)(x.Z,{type:"button",variant:"outlined",onClick:()=>ee.back(),children:String(r("common.cancel"))}),(0,n.jsx)(x.Z,{type:"submit",variant:"contained",children:String(r("common.save"))})]})})]})})}),(0,n.jsxs)(l.Z,{children:[(0,n.jsxs)(o.Z,{children:[(0,n.jsxs)(c.Z,{component:"fieldset",children:[(0,n.jsx)(u.Z,{component:"legend",children:String(r("tasks.assignment.method"))}),(0,n.jsxs)(m.Z,{row:!0,value:en,onChange:e=>{ea(e.target.value),e2(e.target.value)},children:[(0,n.jsx)(p.Z,{value:"simple",control:(0,n.jsx)(g.Z,{}),label:String(r("tasks.assignment.simple"))}),(0,n.jsx)(p.Z,{value:"divide_into_parts",control:(0,n.jsx)(g.Z,{}),label:String(r("tasks.assignment.split"))})]})]}),"simple"===en?(0,n.jsxs)(i.Z,{spacing:2,sx:{mt:3},children:[(0,n.jsx)(h.Z,{variant:"subtitle2",children:String(r("tasks.assignment.chooseAssignee"))}),(0,n.jsxs)(s.ZP,{container:!0,spacing:2,alignItems:"end",children:[(0,n.jsx)(s.ZP,{item:!0,xs:12,sm:8,children:(0,n.jsx)(d.Z,{options:eD||[],value:(eD||[]).find(e=>e.id===ei)||null,onChange:(e,r)=>es((null==r?void 0:r.id)||0),isOptionEqualToValue:(e,r)=>e.id===r.id,getOptionLabel:e=>(null==e?void 0:e.fullname)||"",renderInput:e=>(0,n.jsx)(L.Z,{...e,fullWidth:!0,label:String(r("tasks.assignment.assignee")),placeholder:String(r("common.selectPlaceholder"))})})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,sm:4,children:(0,n.jsx)(x.Z,{variant:"contained",fullWidth:!0,onClick:eF,disabled:!ei,children:String(r("tasks.assignment.attach"))})})]})]}):(0,n.jsxs)(i.Z,{spacing:2,sx:{mt:3},children:[(0,n.jsxs)(i.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,n.jsx)(h.Z,{variant:"subtitle2",children:String(r("tasks.parts.title"))}),(0,n.jsx)(x.Z,{variant:"contained",size:"small",startIcon:(0,n.jsx)(G.Z,{icon:"mdi:plus"}),onClick:()=>eR(),children:String(r("common.add"))})]}),ed.length>0?(0,n.jsx)(j.Z,{component:v.Z,children:(0,n.jsxs)(f.Z,{size:"small",children:[(0,n.jsx)(S.Z,{children:(0,n.jsxs)(y.Z,{children:[(0,n.jsx)(_.Z,{children:String(r("tasks.parts.table.title"))}),(0,n.jsx)(_.Z,{children:String(r("tasks.parts.table.department"))}),(0,n.jsx)(_.Z,{children:String(r("tasks.parts.table.assignee"))}),(0,n.jsx)(_.Z,{children:String(r("tasks.parts.table.start"))}),(0,n.jsx)(_.Z,{children:String(r("tasks.parts.table.end"))}),(0,n.jsx)(_.Z,{children:String(r("tasks.parts.table.note"))}),(0,n.jsx)(_.Z,{align:"right",children:String(r("common.actions"))})]})}),(0,n.jsx)(k.Z,{children:ed.map(e=>{var t,a;return(0,n.jsxs)(y.Z,{children:[(0,n.jsx)(_.Z,{children:e.title}),(0,n.jsx)(_.Z,{children:(null==eC?void 0:null===(t=eC.find(r=>r.id===e.department))||void 0===t?void 0:t.name)||e.department}),(0,n.jsx)(_.Z,{children:(null==eT?void 0:null===(a=eT.find(r=>r.id===e.assignee))||void 0===a?void 0:a.fullname)||e.assignee}),(0,n.jsx)(_.Z,{children:e.start_date}),(0,n.jsx)(_.Z,{children:e.end_date}),(0,n.jsx)(_.Z,{children:e.note}),(0,n.jsx)(_.Z,{align:"right",children:(0,n.jsxs)(i.Z,{direction:"row",spacing:1,justifyContent:"flex-end",children:[(0,n.jsx)(b.Z,{title:String(r("task.addFile")),children:(0,n.jsx)(w.Z,{size:"small",color:"primary",onClick:()=>eY(e.id),children:(0,n.jsx)(G.Z,{icon:"tabler:paperclip"})})}),(0,n.jsx)(w.Z,{size:"small",onClick:()=>eR(e.id),children:(0,n.jsx)(G.Z,{icon:"mdi:pencil"})}),(0,n.jsx)(w.Z,{size:"small",color:"error",onClick:()=>eV(e.id),children:(0,n.jsx)(G.Z,{icon:"mdi:delete"})})]})})]},e.id)})})]})}):(0,n.jsx)(h.Z,{variant:"body2",color:"text.secondary",children:String(r("tasks.parts.empty"))})]})]}),(0,n.jsxs)(P.Z,{open:eu,onClose:eQ,maxWidth:"sm",fullWidth:!0,children:[(0,n.jsx)(q.Z,{children:eZ?"Edit Task Part":String(r("tasks.parts.dialog.title"))}),(0,n.jsx)(C.Z,{children:(0,n.jsxs)(s.ZP,{container:!0,spacing:3,sx:{mt:1},children:[(0,n.jsx)(s.ZP,{item:!0,xs:12,children:(0,n.jsx)(L.Z,{fullWidth:!0,label:String(r("tasks.parts.form.title")),value:ep.title,onChange:e=>eg({...ep,title:e.target.value}),error:!!eh.title,helperText:eh.title})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,children:(0,n.jsx)(d.Z,{fullWidth:!0,options:eC||[],getOptionLabel:e=>e.name,value:(null==eC?void 0:eC.find(e=>e.id===ep.department))||null,onChange:(e,r)=>eg({...ep,department:(null==r?void 0:r.id)||0}),renderInput:e=>(0,n.jsx)(L.Z,{...e,label:String(r("tasks.parts.form.department")),error:!!eh.department,helperText:eh.department,placeholder:String(r("common.selectPlaceholder"))})})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,children:(0,n.jsx)(d.Z,{fullWidth:!0,options:eD||[],getOptionLabel:e=>e.fullname,value:(null==eD?void 0:eD.find(e=>e.id===ep.assignee))||null,onChange:(e,r)=>eg({...ep,assignee:(null==r?void 0:r.id)||0}),renderInput:e=>(0,n.jsx)(L.Z,{...e,label:String(r("tasks.parts.form.assignee")),error:!!eh.assignee,helperText:eh.assignee,placeholder:String(r("common.selectPlaceholder"))})})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(L.Z,{fullWidth:!0,type:"date",label:String(r("tasks.parts.form.startDate")),value:ep.start_date,onChange:e=>eg({...ep,start_date:e.target.value}),InputLabelProps:{shrink:!0},error:!!eh.start_date,helperText:eh.start_date})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(L.Z,{fullWidth:!0,type:"date",label:String(r("tasks.parts.form.endDate")),value:ep.end_date,onChange:e=>eg({...ep,end_date:e.target.value}),InputLabelProps:{shrink:!0},error:!!eh.end_date,helperText:eh.end_date})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,children:(0,n.jsx)(L.Z,{fullWidth:!0,multiline:!0,rows:3,label:String(r("tasks.parts.form.note")),value:ep.note,onChange:e=>eg({...ep,note:e.target.value}),error:!!eh.note,helperText:eh.note})})]})}),(0,n.jsxs)(T.Z,{children:[(0,n.jsx)(x.Z,{onClick:eQ,children:String(r("common.cancel"))}),(0,n.jsx)(x.Z,{variant:"contained",onClick:eB,children:String(r("common.save"))})]})]}),(0,n.jsxs)(P.Z,{open:ev,onClose:eG,maxWidth:"md",fullWidth:!0,children:[(0,n.jsxs)(q.Z,{children:[String(r("replyLetter.attachments.title"))," -"," ",(null===(e=ed.find(e=>e.id===eS))||void 0===e?void 0:e.title)||String(r("tasks.parts.simpleTitle"))]}),(0,n.jsx)(C.Z,{children:(0,n.jsxs)(i.Z,{spacing:4,sx:{mt:2},children:[(0,n.jsxs)(D.Z,{children:[(0,n.jsx)(h.Z,{variant:"subtitle2",sx:{mb:2},children:String(r("replyLetter.attachments.existing"))}),e_.length>0?(0,n.jsx)(j.Z,{component:v.Z,variant:"outlined",children:(0,n.jsxs)(f.Z,{size:"small",children:[(0,n.jsx)(S.Z,{children:(0,n.jsxs)(y.Z,{children:[(0,n.jsx)(_.Z,{children:String(r("replyLetter.attachments.table.title"))}),(0,n.jsx)(_.Z,{children:String(r("replyLetter.attachments.table.file"))}),(0,n.jsx)(_.Z,{align:"right",children:String(r("replyLetter.attachments.table.actions"))})]})}),(0,n.jsx)(k.Z,{children:e_.map(e=>(0,n.jsxs)(y.Z,{children:[(0,n.jsx)(_.Z,{children:e.title}),(0,n.jsx)(_.Z,{children:e.file?e.file.split("/").pop():"-"}),(0,n.jsx)(_.Z,{align:"right",children:(0,n.jsx)(b.Z,{title:String(r("replyLetter.attachments.actions.download")),children:(0,n.jsx)(w.Z,{size:"small",onClick:()=>eU(e),children:(0,n.jsx)(G.Z,{icon:"tabler:download"})})})})]},e.id))})]})}):(0,n.jsx)(h.Z,{variant:"body2",color:"text.secondary",children:String(r("replyLetter.attachments.empty"))})]}),(0,n.jsx)(I.Z,{}),(0,n.jsxs)(D.Z,{children:[(0,n.jsx)(h.Z,{variant:"subtitle2",sx:{mb:2},children:String(r("replyLetter.attachments.addNew"))}),(0,n.jsxs)(i.Z,{spacing:2,children:[eb.map((e,t)=>(0,n.jsx)(l.Z,{variant:"outlined",children:(0,n.jsx)(o.Z,{sx:{p:"1rem !important"},children:(0,n.jsxs)(s.ZP,{container:!0,spacing:3,alignItems:"center",children:[(0,n.jsx)(s.ZP,{item:!0,xs:12,md:5,children:(0,n.jsx)(L.Z,{fullWidth:!0,label:String(r("replyLetter.attachments.form.title")),value:e.title,onChange:e=>eH(t,e.target.value)})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,md:5,children:(0,n.jsxs)(i.Z,{direction:"row",spacing:2,alignItems:"center",children:[(0,n.jsxs)(x.Z,{variant:"outlined",component:"label",size:"small",startIcon:(0,n.jsx)(G.Z,{icon:"tabler:paperclip"}),children:[String(r("replyLetter.attachments.form.attachFile")),(0,n.jsx)("input",{hidden:!0,type:"file",onChange:e=>{var r;return eJ(t,(null===(r=e.target.files)||void 0===r?void 0:r[0])||null)}})]}),(0,n.jsx)(h.Z,{variant:"caption",sx:{color:"text.secondary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.file?e.file.name:String(r("replyLetter.attachments.form.noFileSelected"))})]})}),(0,n.jsx)(s.ZP,{item:!0,xs:12,md:2,sx:{display:"flex",justifyContent:"flex-end"},children:(0,n.jsx)(w.Z,{color:"error",onClick:()=>e$(t),children:(0,n.jsx)(G.Z,{icon:"tabler:trash"})})})]})})},t)),(0,n.jsxs)(i.Z,{direction:"row",spacing:2,children:[(0,n.jsx)(x.Z,{variant:"outlined",size:"small",startIcon:(0,n.jsx)(G.Z,{icon:"tabler:plus"}),onClick:()=>{ew(e=>[...e,{title:"",file:null}])},children:String(r("replyLetter.attachments.addRow"))}),eb.length>0&&(0,n.jsx)(x.Z,{variant:"contained",color:"success",size:"small",onClick:eK,disabled:eP,startIcon:(0,n.jsx)(G.Z,{icon:"tabler:upload"}),children:eP?String(r("common.loading")):String(r("replyLetter.attachments.upload"))})]})]})]})]})}),(0,n.jsx)(T.Z,{children:(0,n.jsx)(x.Z,{onClick:eG,children:String(r("common.close"))})})]})]}),(0,n.jsx)(D.Z,{sx:{display:"flex",justifyContent:"flex-start",mt:2},children:(0,n.jsx)(x.Z,{component:R(),href:"/tasks/view/".concat(er),variant:"contained",color:"info",startIcon:(0,n.jsx)(G.Z,{icon:"tabler:file-text"}),children:String(r("common.view"))})})]})};function U(){return(0,n.jsx)(K,{})}}},function(e){e.O(0,[2785,7536,9084,6437,1980,2216,1863,2888,9774,179],function(){return e(e.s=31865)}),_N_E=e.O()}]);