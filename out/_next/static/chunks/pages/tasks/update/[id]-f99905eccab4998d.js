(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7478],{13264:function(e,r,t){"use strict";let n=(0,t(70182).ZP)();r.Z=n},31865:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tasks/update/[id]",function(){return t(15493)}])},25026:function(e,r,t){"use strict";t.d(r,{Z:function(){return Z}});var n=t(87462),i=t(63366),s=t(67294),a=t(86010),l=t(94780),o=t(29567),d=t(77527),c=t(1588),u=t(34867);function m(e){return(0,u.Z)("MuiTableContainer",e)}(0,c.Z)("MuiTableContainer",["root"]);var g=t(85893);let h=["className","component"],p=e=>{let{classes:r}=e;return(0,l.Z)({root:["root"]},m,r)},x=(0,d.ZP)("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(e,r)=>r.root})({width:"100%",overflowX:"auto"});var Z=s.forwardRef(function(e,r){let t=(0,o.Z)({props:e,name:"MuiTableContainer"}),{className:s,component:l="div"}=t,d=(0,i.Z)(t,h),c=(0,n.Z)({},t,{component:l}),u=p(c);return(0,g.jsx)(x,(0,n.Z)({ref:r,as:l,className:(0,a.Z)(u.root,s),ownerState:c},d))})},15493:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return el}});var n=t(85893),i=t(67294),s=t(84166),a=t(68573),l=t(60762),o=t(71919),d=t(46070),c=t(6897),u=t(85533),m=t(15903),g=t(65806),h=t(12467),p=t(96788),x=t(13539),Z=t(73907),j=t(52857),v=t(15972),f=t(25026),k=t(93454),S=t(76592),y=t(70360),b=t(46577),_=t(8863),w=t(19827),C=t(21038),P=t(33453),q=t(92365),D=t(40110),L=t(96727),T=t(90642),I=t(56912),W=t(87536),Y=t(47533),M=t(16310),z=t(7879),O=t(74538),H=t(52293),E=t(58898),N=t(11163),F=t(41664),A=t.n(F);t(5843);var R=t(81342),Q=t(33251),V=t(9198),B=t.n(V),X=t(34273),$=t(75673),G=t(22120),J=t(30381),K=t.n(J);let U=e=>String(e).padStart(2,"0"),ee=e=>"".concat(e.getFullYear(),"-").concat(U(e.getMonth()+1),"-").concat(U(e.getDate()),"T").concat(U(e.getHours()),":").concat(U(e.getMinutes())),er=e=>{if(!e)return null;if(/^\d{4}-\d{2}-\d{2}$/.test(e)){let[r,t,n]=e.split("-").map(Number);return new Date(r,(t||1)-1,n||1,0,0,0,0)}let r=new Date(e);return Number.isNaN(r.getTime())?null:r},et=e=>{let r=er(e);return r?ee(r):""},en=e=>{if(!e)return"—";let r=K()(e);return r.isValid()?r.format("DD.MM.YYYY HH:mm"):String(e)},ei={status:"new",type:"task",name:"",task_form:0,sending_org:"",input_doc_number:"",output_doc_number:"",start_date:"",end_date:"",priority:"ordinary",department:0,signed_by:0,note:"",list_of_magazine:0},es=e=>M.Ry({type:M.Z_().oneOf(["task","application"]).required(String(e("errors.required"))),name:M.Z_().min(2,String(e("errors.minChars",{count:2}))).required(String(e("errors.required"))),task_form:M.Rx().typeError(String(e("errors.select"))).moreThan(0,String(e("errors.select"))).required(String(e("errors.required"))),sending_org:M.Z_().required(String(e("errors.required"))),input_doc_number:M.Z_().required(String(e("errors.required"))),output_doc_number:M.Z_().required(String(e("errors.required"))),start_date:M.Z_().required(String(e("errors.required"))),end_date:M.Z_().required(String(e("errors.required"))),priority:M.Z_().oneOf(["ordinary","orgently"]).required(String(e("errors.required"))),department:M.Rx().typeError(String(e("errors.select"))).moreThan(0,String(e("errors.select"))).required(String(e("errors.required"))),list_of_magazine:M.Rx().typeError(String(e("errors.select"))).moreThan(0,String(e("errors.select"))).required(String(e("errors.required"))),signed_by:M.Rx().typeError(String(e("errors.select"))).moreThan(0,String(e("errors.select"))).required(String(e("errors.required")))});var ea=()=>{var e;let{t:r}=(0,G.$G)(),t=es(r),{control:M,handleSubmit:F,reset:V,getValues:J,setError:U,formState:{errors:ea}}=(0,W.cI)({defaultValues:ei,resolver:(0,Y.X)(t)}),el=(0,E.Z)(),eo=(0,N.useRouter)(),{id:ed}=eo.query,{user:ec}=(0,X.a)(),[eu,em]=(0,i.useState)("simple"),[eg,eh]=(0,i.useState)(0),[ep,ex]=(0,i.useState)(null),[eZ,ej]=(0,i.useState)([]),[ev,ef]=(0,i.useState)(!1),[ek,eS]=(0,i.useState)({title:"",department:0,assignee:0,start_date:"",end_date:"",note:""}),[ey,eb]=(0,i.useState)({}),[e_,ew]=(0,i.useState)(null),[eC,eP]=(0,i.useState)(!1),[eq,eD]=(0,i.useState)(null),[eL,eT]=(0,i.useState)([]),[eI,eW]=(0,i.useState)([]),[eY,eM]=(0,i.useState)(!1),{data:ez}=(0,Q.z)(O.Z.department,{page:1,limit:100}),{data:eO}=(0,Q.z)(O.Z.users,{page:1,limit:100}),{data:eH}=(0,Q.z)(O.Z.users,{page:1,limit:100,roles__name:"Performer"}),{data:eE}=(0,Q.z)(O.Z.users,{page:1,limit:100,roles__name:"Signatory"}),{data:eN}=(0,Q.z)(O.Z.documentForm,{page:1,limit:100}),eF=eN||[],{data:eA}=(0,Q.z)(O.Z.listOfMagazine,{page:1,limit:100}),eR=e=>"string"==typeof e?e:void 0,[eQ,eV]=(0,i.useState)([]),[eB,eX]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{if(!ed||Array.isArray(ed))return;let e=(await H.Do.get(O.Z.taskById(ed))).data;if(em(e.task_type||"simple"),"simple"===e.task_type){var r,t;let e=null===(t=(await H.Do.get(O.Z.taskPart,{task:ed,limit:50})).data)||void 0===t?void 0:null===(r=t.results)||void 0===r?void 0:r[0];e?(eh(e.assignee||0),ex(e.id||null)):ex(null)}V({...ei,...e,priority:e.priority||"ordinary",task_form:"number"==typeof e.task_form?e.task_form:0,sending_org:e.sending_org||"",department:"number"==typeof e.department?e.department:0,signed_by:"number"==typeof e.signed_by?e.signed_by:0,list_of_magazine:"number"==typeof e.list_of_magazine?e.list_of_magazine:0,start_date:et(e.start_date),end_date:et(e.end_date)})})()},[ed,V]),(0,i.useEffect)(()=>{(async()=>{if(!(!ed||Array.isArray(ed)))try{var e;let r=await H.Do.get(O.Z.taskPart,{task:ed,limit:50});ej((null===(e=r.data)||void 0===e?void 0:e.results)||[])}catch(e){console.error("Error fetching task parts:",e)}})()},[ed]);let e$=async()=>{if(!ed||Array.isArray(ed)||!eg)return;let{start_date:e,end_date:t,department:n}=J();try{var i,s;if(!e||!t||!n){el.error(String(r("tasks.toast.startDateRequired")));return}let a={task:Number(ed),title:String(r("tasks.parts.simpleTitle")),assignee:eg,department:n,start_date:K()(e).format("YYYY-MM-DD HH:mm"),end_date:K()(t).format("YYYY-MM-DD HH:mm"),note:""};ep?await H.Do.patch(O.Z.taskPartById(ep),{...a,updated_by:(null==ec?void 0:ec.id)||1}):await H.Do.post(O.Z.taskPart,{...a,status:"new",created_by:(null==ec?void 0:ec.id)||1}),el.success(String(r("tasks.toast.assigneeAssigned")));let l=await H.Do.get(O.Z.taskPart,{task:ed,limit:50}),o=(null===(i=l.data)||void 0===i?void 0:i.results)||[];ej(o),(null==o?void 0:null===(s=o[0])||void 0===s?void 0:s.id)&&ex(o[0].id)}catch(e){el.error((null==e?void 0:e.message)||String(r("errors.somethingWentWrong")))}},eG=e=>{if(e){let r=eZ.find(r=>r.id===e);r&&(eS({title:r.title,department:r.department,assignee:r.assignee,start_date:et(r.start_date),end_date:et(r.end_date),note:r.note}),ew(e))}else eS({title:"",department:0,assignee:0,start_date:"",end_date:"",note:""}),ew(null);eb({}),ef(!0)},eJ=()=>{ef(!1),ew(null)},eK=async()=>{if(!ed||Array.isArray(ed))return;let e={};if(ek.title&&ek.title.trim()||(e.title=String(r("errors.required"))),(!ek.department||0>=Number(ek.department))&&(e.department=String(r("errors.required"))),(!ek.assignee||0>=Number(ek.assignee))&&(e.assignee=String(r("errors.required"))),ek.start_date||(e.start_date=String(r("errors.required"))),ek.end_date||(e.end_date=String(r("errors.required"))),ek.start_date&&ek.end_date){let t=new Date(ek.start_date);new Date(ek.end_date)<t&&(e.end_date=String(r("errors.endAfterStart")))}if(ek.note&&String(ek.note).trim()||(e.note=String(r("errors.required"))),eb(e),Object.keys(e).length>0){el.error(String(r("tasks.toast.partFormRequired")));return}try{var t;e_?(await H.Do.put(O.Z.taskPartById(e_),{title:ek.title||"",department:ek.department||0,assignee:ek.assignee||0,start_date:K()(ek.start_date).format("YYYY-MM-DD HH:mm")||"",end_date:K()(ek.end_date).format("YYYY-MM-DD HH:mm")||"",note:ek.note||"",updated_by:(null==ec?void 0:ec.id)||1,task:Number(ed)}),el.success(String(r("common.saved")))):(await H.Do.post(O.Z.taskPart,{task:Number(ed),title:ek.title||String(r("tasks.parts.newTitleFallback")),department:ek.department||0,assignee:ek.assignee||0,start_date:K()(ek.start_date).format("YYYY-MM-DD HH:mm")||"",end_date:K()(ek.end_date).format("YYYY-MM-DD HH:mm")||"",status:"new",note:ek.note||"",created_by:(null==ec?void 0:ec.id)||1}),el.success(String(r("tasks.toast.partCreated")))),ef(!1),ew(null);let e=await H.Do.get(O.Z.taskPart,{task:ed,limit:50});ej((null===(t=e.data)||void 0===t?void 0:t.results)||[])}catch(e){el.error((null==e?void 0:e.message)||String(r("errors.somethingWentWrong")))}},eU=async e=>{try{await H.Do.delete(O.Z.taskPartById(e)),el.success(String(r("tasks.toast.partDeleted"))),ej(eZ.filter(r=>r.id!==e))}catch(e){el.error((null==e?void 0:e.message)||String(r("errors.somethingWentWrong")))}},e0=async e=>{try{let r=(await H.Do.get(O.Z.taskAttachment,{part:e})).data;eT(r.results||r||[])}catch(e){console.error("Error fetching part attachments:",e)}},e1=e=>{eD(e),eW([]),e0(e),eP(!0)},e2=()=>{eP(!1),eD(null),eT([]),eW([])},e6=e=>eV(r=>r.filter((r,t)=>t!==e)),e3=(e,r)=>eV(t=>t.map((t,n)=>n===e?{...t,isLink:r,link:r?t.link:"",file:r?null:t.file}:t)),e8=(e,r)=>eV(t=>t.map((t,n)=>n===e?{...t,link:r}:t)),e7=(e,r)=>eV(t=>t.map((t,n)=>n===e?{...t,file:r}:t)),e5=e=>{eW(r=>r.filter((r,t)=>t!==e))},e4=(e,r)=>{eW(t=>t.map((t,n)=>n===e?{...t,isLink:r,link:r?t.link:"",file:r?null:t.file}:t))},e9=(e,r)=>{eW(t=>t.map((t,n)=>n===e?{...t,link:r}:t))},re=(e,r)=>{eW(t=>t.map((t,n)=>n===e?{...t,file:r}:t))},rr=async()=>{if(!eq||!ed)return;let e=eI.filter(e=>e.isLink?e.link.trim().length:!!e.file);if(!e.length)return el.error(String(r("tasks.attachments.fileRequired")));try{for(let r of(eM(!0),e)){var t,n;let e=new FormData;e.append("part",eq.toString()),e.append("title",""),e.append("link",r.isLink?r.link.trim():""),!r.isLink&&r.file&&e.append("file",r.file),e.append("uploaded_by",null!==(n=null==ec?void 0:null===(t=ec.id)||void 0===t?void 0:t.toString())&&void 0!==n?n:""),await H.Do.postForm(O.Z.taskAttachment,e)}el.success(String(r("tasks.attachments.attached"))),eW([]),e0(eq)}catch(e){console.error("Error uploading part attachments:",e),el.error(String(r("tasks.attachments.attachError")))}finally{eM(!1)}},rt=e=>{e.file&&window.open(String(e.file),"_blank","noopener,noreferrer")},rn=async e=>{try{if(!ed||Array.isArray(ed))return;eQ.some(e=>e.isLink?e.link.trim().length:!!e.file)&&await ri(),await H.Do.put(O.Z.taskById(ed),{...e,company:null==ec?void 0:ec.company_id}),el.success(String(r("tasks.toast.updated")))}catch(e){if((null==e?void 0:e.message)&&Object.keys(null==e?void 0:e.message).length)for(let r of Object.keys(null==e?void 0:e.message))U(r,{type:"server",message:String(null==e?void 0:e.message[r])})}},ri=async()=>{if(!ed)return;let e=eQ.filter(e=>e.isLink?e.link.trim().length:!!e.file);if(!e.length)return el.error(String(r("tasks.attachments.fileRequired")));try{for(let r of(eX(!0),e)){var t,n;if(r.isLink&&!r.link.trim()||!r.isLink&&!r.file)continue;let e=new FormData;e.append("task",ed.toString()),e.append("title",""),e.append("link",r.isLink?r.link.trim():""),!r.isLink&&r.file&&e.append("file",r.file),e.append("uploaded_by",null!==(n=null==ec?void 0:null===(t=ec.id)||void 0===t?void 0:t.toString())&&void 0!==n?n:""),await H.Do.postForm(O.Z.taskAttachment,e)}el.success(String(r("tasks.attachments.attached"))),eV([])}catch(e){console.error("Failed to create attachment",e),el.error(String(r("tasks.attachments.attachError")));return}finally{eX(!1)}},rs=async e=>{!ed||Array.isArray(ed)||await H.Do.patch(O.Z.taskById(ed),{task_type:e})};return(0,n.jsxs)(s.Z,{spacing:4,children:[(0,n.jsx)(R.Z,{children:(0,n.jsx)("form",{onSubmit:F(rn),children:(0,n.jsxs)(a.ZP,{container:!0,spacing:4,alignItems:"stretch",children:[(0,n.jsx)(a.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(l.Z,{variant:"outlined",sx:{height:"100%"},children:(0,n.jsx)(o.Z,{children:(0,n.jsxs)(a.ZP,{container:!0,spacing:4,children:[(0,n.jsx)(a.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(W.Qr,{name:"type",control:M,render:e=>{let{field:t,fieldState:i}=e,s=[{value:"task",label:String(r("tasks.type.task"))},{value:"application",label:String(r("tasks.type.application"))}];return(0,n.jsx)(d.Z,{options:s,value:s.find(e=>e.value===t.value)||null,onChange:(e,r)=>t.onChange((null==r?void 0:r.value)||""),isOptionEqualToValue:(e,r)=>e.value===r.value,getOptionLabel:e=>e.label,renderInput:e=>{var t;return(0,n.jsx)(z.Z,{...e,fullWidth:!0,label:String(r("tasks.form.type")),error:!!i.error,helperText:eR(null===(t=i.error)||void 0===t?void 0:t.message)})}})}})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(W.Qr,{name:"priority",control:M,render:e=>{var t;let{field:i,fieldState:s}=e;return(0,n.jsxs)(c.Z,{error:!!s.error,children:[(0,n.jsx)(u.Z,{children:String(r("tasks.form.priority"))}),(0,n.jsxs)(m.Z,{row:!0,...i,value:i.value||"ordinary",children:[(0,n.jsx)(g.Z,{value:"ordinary",control:(0,n.jsx)(h.Z,{}),label:String(r("tasks.priority.ordinary"))}),(0,n.jsx)(g.Z,{value:"orgently",control:(0,n.jsx)(h.Z,{}),label:String(r("tasks.priority.orgently"))})]}),!!s.error&&(0,n.jsx)(p.Z,{variant:"caption",color:"error",children:eR(null===(t=s.error)||void 0===t?void 0:t.message)})]})}})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(W.Qr,{name:"name",control:M,rules:{required:String(r("errors.required"))},render:e=>{var t;let{field:i}=e;return(0,n.jsx)("div",{children:(0,n.jsx)(z.Z,{fullWidth:!0,label:String(r("tasks.form.name")),...i,error:!!ea.name,helperText:eR(null===(t=ea.name)||void 0===t?void 0:t.message)})})}})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(W.Qr,{name:"task_form",control:M,rules:{required:String(r("errors.required"))},render:e=>{let{field:t,fieldState:i}=e;return(0,n.jsx)(d.Z,{options:eF||[],value:(eF||[]).find(e=>e.id===t.value)||null,onChange:(e,r)=>{var n;return t.onChange(null!==(n=null==r?void 0:r.id)&&void 0!==n?n:0)},isOptionEqualToValue:(e,r)=>e.id===r.id,getOptionLabel:e=>(null==e?void 0:e.name)||"",renderInput:e=>{var t;return(0,n.jsx)(z.Z,{...e,fullWidth:!0,label:String(r("tasks.form.taskForm")),error:!!i.error,helperText:eR(null===(t=i.error)||void 0===t?void 0:t.message)})}})}})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(W.Qr,{name:"list_of_magazine",control:M,rules:{required:String(r("errors.required"))},render:e=>{let{field:t,fieldState:i}=e;return(0,n.jsx)(d.Z,{options:eA||[],value:(eA||[]).find(e=>e.id===t.value)||null,onChange:(e,r)=>{var n;return t.onChange(null!==(n=null==r?void 0:r.id)&&void 0!==n?n:0)},isOptionEqualToValue:(e,r)=>e.id===r.id,getOptionLabel:e=>(null==e?void 0:e.name)||"",renderInput:e=>{var t;return(0,n.jsx)(z.Z,{...e,fullWidth:!0,label:String(r("tasks.form.magazine")),error:!!i.error,helperText:eR(null===(t=i.error)||void 0===t?void 0:t.message)})}})}})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsxs)(s.Z,{spacing:2,children:[eQ.map((e,t)=>(0,n.jsx)(l.Z,{variant:"outlined",children:(0,n.jsx)(o.Z,{sx:{p:"1rem !important"},children:(0,n.jsxs)(a.ZP,{container:!0,spacing:2,alignItems:"center",children:[(0,n.jsx)(a.ZP,{item:!0,xs:12,md:3,children:(0,n.jsx)(g.Z,{control:(0,n.jsx)(x.Z,{checked:e.isLink,onChange:e=>e3(t,e.target.checked)}),label:e.isLink?"Link":"File"})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,md:8,children:e.isLink?(0,n.jsx)(z.Z,{fullWidth:!0,size:"small",label:String(r("common.link",{defaultValue:"Link"})),value:e.link,onChange:e=>e8(t,e.target.value)}):(0,n.jsxs)(s.Z,{spacing:1,children:[(0,n.jsxs)(Z.Z,{variant:"outlined",component:"label",size:"small",startIcon:(0,n.jsx)($.Z,{icon:"tabler:paperclip"}),disabled:eB,children:[String(r("tasks.attachments.chooseFiles")),(0,n.jsx)("input",{hidden:!0,type:"file",onChange:e=>{var r;return e7(t,(null===(r=e.target.files)||void 0===r?void 0:r[0])||null)}})]}),(0,n.jsx)(p.Z,{variant:"caption",color:"text.secondary",children:e.file?e.file.name:String(r("replyLetter.attachments.form.noFileSelected"))})]})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,md:1,sx:{display:"flex",justifyContent:"flex-end"},children:(0,n.jsx)(j.Z,{color:"error",disabled:eB,onClick:()=>e6(t),children:(0,n.jsx)($.Z,{icon:"tabler:trash"})})})]})})},t)),(0,n.jsx)(Z.Z,{variant:"outlined",size:"small",startIcon:(0,n.jsx)($.Z,{icon:"tabler:plus"}),disabled:eB,onClick:()=>eV(e=>[...e,{isLink:!1,link:"",file:null}]),children:String(r("replyLetter.attachments.addRow"))})]})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(W.Qr,{name:"sending_org",control:M,rules:{required:!0},render:e=>{var t;let{field:i,fieldState:s}=e;return(0,n.jsx)(z.Z,{fullWidth:!0,label:String(r("tasks.form.sendingOrg")),...i,error:!!s.error,helperText:eR(null===(t=s.error)||void 0===t?void 0:t.message)})}})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(W.Qr,{name:"respon_person",control:M,render:e=>{var t;let{field:i}=e;return(0,n.jsxs)(z.Z,{fullWidth:!0,select:!0,label:String(r("tasks.view.document.fields.responsiblePerson")),...i,value:null!==(t=i.value)&&void 0!==t?t:"",onChange:e=>{let r=e.target.value;i.onChange(""===r?null:Number(r))},children:[(0,n.jsx)(v.Z,{value:"",children:String(r("common.all",{defaultValue:"—"}))}),(eO||[]).map(e=>(0,n.jsx)(v.Z,{value:e.id,children:e.fullname},e.id))]})}})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(W.Qr,{name:"output_doc_number",control:M,rules:{required:String(r("errors.required"))},render:e=>{var t;let{field:i,fieldState:s}=e;return(0,n.jsx)(z.Z,{fullWidth:!0,label:String(r("tasks.form.outputDocNumber")),...i,error:!!s.error,helperText:eR(null===(t=s.error)||void 0===t?void 0:t.message)})}})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(W.Qr,{name:"input_doc_number",control:M,rules:{required:String(r("errors.required"))},render:e=>{var t;let{field:i,fieldState:s}=e;return(0,n.jsx)(z.Z,{fullWidth:!0,label:String(r("tasks.form.inputDocNumber")),...i,error:!!s.error,helperText:eR(null===(t=s.error)||void 0===t?void 0:t.message)})}})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(W.Qr,{name:"start_date",control:M,rules:{required:String(r("errors.required"))},render:e=>{var t;let{field:i,fieldState:s}=e,a=er(i.value);return(0,n.jsx)("div",{children:(0,n.jsx)(B(),{selected:a,onChange:e=>i.onChange(e?ee(e):""),showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:5,dateFormat:"yyyy-MM-dd HH:mm",showMonthDropdown:!0,showYearDropdown:!0,dropdownMode:"scroll",yearDropdownItemNumber:100,scrollableYearDropdown:!0,customInput:(0,n.jsx)(z.Z,{label:String(r("tasks.form.startDate")),fullWidth:!0,error:!!s.error,helperText:eR(null===(t=s.error)||void 0===t?void 0:t.message)}),showPopperArrow:!0,isClearable:!0})})}})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(W.Qr,{name:"end_date",control:M,rules:{required:String(r("errors.required"))},render:e=>{var t;let{field:i,fieldState:s}=e,a=er(i.value);return(0,n.jsx)("div",{children:(0,n.jsx)(B(),{selected:a,onChange:e=>i.onChange(e?ee(e):""),showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:5,dateFormat:"yyyy-MM-dd HH:mm",showMonthDropdown:!0,showYearDropdown:!0,dropdownMode:"scroll",yearDropdownItemNumber:100,scrollableYearDropdown:!0,customInput:(0,n.jsx)(z.Z,{label:String(r("tasks.form.endDate")),fullWidth:!0,error:!!s.error,helperText:eR(null===(t=s.error)||void 0===t?void 0:t.message)}),showPopperArrow:!0,isClearable:!0})})}})})]})})})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(l.Z,{variant:"outlined",sx:{height:"100%"},children:(0,n.jsx)(o.Z,{children:(0,n.jsxs)(a.ZP,{container:!0,spacing:4,children:[(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(W.Qr,{name:"department",control:M,rules:{required:!0},render:e=>{let{field:t,fieldState:i}=e;return(0,n.jsx)(d.Z,{options:ez||[],value:(ez||[]).find(e=>e.id===t.value)||null,onChange:(e,r)=>{var n;return t.onChange(null!==(n=null==r?void 0:r.id)&&void 0!==n?n:0)},isOptionEqualToValue:(e,r)=>e.id===r.id,getOptionLabel:e=>(null==e?void 0:e.name)||"",renderInput:e=>{var t;return(0,n.jsx)(z.Z,{...e,fullWidth:!0,label:String(r("tasks.form.department")),error:!!i.error,helperText:eR(null===(t=i.error)||void 0===t?void 0:t.message)})}})}})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(W.Qr,{name:"signed_by",control:M,rules:{required:!0},render:e=>{let{field:t,fieldState:i}=e;return(0,n.jsx)(d.Z,{fullWidth:!0,options:eE||[],getOptionLabel:e=>e.fullname,value:(null==eE?void 0:eE.find(e=>e.id===t.value))||null,onChange:(e,r)=>t.onChange((null==r?void 0:r.id)||0),renderInput:e=>{var t;return(0,n.jsx)(z.Z,{...e,label:String(r("tasks.form.signedBy")),error:!!i.error,helperText:eR(null===(t=i.error)||void 0===t?void 0:t.message),placeholder:String(r("common.selectPlaceholder"))})}})}})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,sm:12,children:(0,n.jsx)(W.Qr,{name:"note",control:M,render:e=>{var t;let{field:i,fieldState:s}=e;return(0,n.jsx)(z.Z,{fullWidth:!0,multiline:!0,rows:3,label:String(r("tasks.form.note")),...i,error:!!s.error,helperText:eR(null===(t=s.error)||void 0===t?void 0:t.message)})}})})]})})})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsxs)(s.Z,{direction:"row",spacing:2,justifyContent:"flex-end",children:[(0,n.jsx)(Z.Z,{type:"button",variant:"outlined",onClick:()=>eo.back(),children:String(r("common.cancel"))}),(0,n.jsx)(Z.Z,{type:"submit",variant:"contained",children:String(r("common.save"))})]})})]})})}),(0,n.jsxs)(l.Z,{children:[(0,n.jsxs)(o.Z,{children:[(0,n.jsxs)(c.Z,{component:"fieldset",children:[(0,n.jsx)(u.Z,{component:"legend",children:String(r("tasks.assignment.method"))}),(0,n.jsxs)(m.Z,{row:!0,value:eu,onChange:e=>{em(e.target.value),rs(e.target.value)},children:[(0,n.jsx)(g.Z,{value:"simple",control:(0,n.jsx)(h.Z,{}),label:String(r("tasks.assignment.simple"))}),(0,n.jsx)(g.Z,{value:"divide_into_parts",control:(0,n.jsx)(h.Z,{}),label:String(r("tasks.assignment.split"))})]})]}),"simple"===eu?(0,n.jsxs)(s.Z,{spacing:2,sx:{mt:3},children:[(0,n.jsx)(p.Z,{variant:"subtitle2",children:String(r("tasks.assignment.chooseAssignee"))}),(0,n.jsxs)(a.ZP,{container:!0,spacing:2,alignItems:"end",children:[(0,n.jsx)(a.ZP,{item:!0,xs:12,sm:8,children:(0,n.jsx)(d.Z,{options:eH||[],value:(eH||[]).find(e=>e.id===eg)||null,onChange:(e,r)=>eh((null==r?void 0:r.id)||0),isOptionEqualToValue:(e,r)=>e.id===r.id,getOptionLabel:e=>(null==e?void 0:e.fullname)||"",renderInput:e=>(0,n.jsx)(z.Z,{...e,fullWidth:!0,label:String(r("tasks.assignment.assignee")),placeholder:String(r("common.selectPlaceholder"))})})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,sm:4,children:(0,n.jsx)(Z.Z,{variant:"contained",fullWidth:!0,onClick:e$,disabled:!eg,children:String(r("tasks.assignment.attach"))})})]})]}):(0,n.jsxs)(s.Z,{spacing:2,sx:{mt:3},children:[(0,n.jsxs)(s.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,n.jsx)(p.Z,{variant:"subtitle2",children:String(r("tasks.parts.title"))}),(0,n.jsx)(Z.Z,{variant:"contained",size:"small",startIcon:(0,n.jsx)($.Z,{icon:"mdi:plus"}),onClick:()=>eG(),children:String(r("common.add"))})]}),eZ.length>0?(0,n.jsx)(f.Z,{component:k.Z,children:(0,n.jsxs)(S.Z,{size:"small",children:[(0,n.jsx)(y.Z,{children:(0,n.jsxs)(b.Z,{children:[(0,n.jsx)(_.Z,{children:String(r("tasks.parts.table.title"))}),(0,n.jsx)(_.Z,{children:String(r("tasks.parts.table.department"))}),(0,n.jsx)(_.Z,{children:String(r("tasks.parts.table.assignee"))}),(0,n.jsx)(_.Z,{children:String(r("tasks.parts.table.start"))}),(0,n.jsx)(_.Z,{children:String(r("tasks.parts.table.end"))}),(0,n.jsx)(_.Z,{children:String(r("tasks.parts.table.note"))}),(0,n.jsx)(_.Z,{align:"right",children:String(r("common.actions"))})]})}),(0,n.jsx)(w.Z,{children:eZ.map(e=>{var t,i;return(0,n.jsxs)(b.Z,{children:[(0,n.jsx)(_.Z,{children:e.title}),(0,n.jsx)(_.Z,{children:(null==ez?void 0:null===(t=ez.find(r=>r.id===e.department))||void 0===t?void 0:t.name)||e.department}),(0,n.jsx)(_.Z,{children:(null==eO?void 0:null===(i=eO.find(r=>r.id===e.assignee))||void 0===i?void 0:i.fullname)||e.assignee}),(0,n.jsx)(_.Z,{children:en(e.start_date)}),(0,n.jsx)(_.Z,{children:en(e.end_date)}),(0,n.jsx)(_.Z,{children:e.note}),(0,n.jsx)(_.Z,{align:"right",children:(0,n.jsxs)(s.Z,{direction:"row",spacing:1,justifyContent:"flex-end",children:[(0,n.jsx)(C.Z,{title:String(r("task.addFile")),children:(0,n.jsx)(j.Z,{size:"small",color:"primary",onClick:()=>e1(e.id),children:(0,n.jsx)($.Z,{icon:"tabler:paperclip"})})}),(0,n.jsx)(j.Z,{size:"small",onClick:()=>eG(e.id),children:(0,n.jsx)($.Z,{icon:"mdi:pencil"})}),(0,n.jsx)(j.Z,{size:"small",color:"error",onClick:()=>eU(e.id),children:(0,n.jsx)($.Z,{icon:"mdi:delete"})})]})})]},e.id)})})]})}):(0,n.jsx)(p.Z,{variant:"body2",color:"text.secondary",children:String(r("tasks.parts.empty"))})]})]}),(0,n.jsxs)(P.Z,{open:ev,onClose:eJ,maxWidth:"sm",fullWidth:!0,children:[(0,n.jsx)(q.Z,{children:e_?"Edit Task Part":String(r("tasks.parts.dialog.title"))}),(0,n.jsx)(D.Z,{children:(0,n.jsxs)(a.ZP,{container:!0,spacing:3,sx:{mt:1},children:[(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(z.Z,{fullWidth:!0,label:String(r("tasks.parts.form.title")),value:ek.title,onChange:e=>eS({...ek,title:e.target.value}),error:!!ey.title,helperText:ey.title})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(d.Z,{fullWidth:!0,options:ez||[],getOptionLabel:e=>e.name,value:(null==ez?void 0:ez.find(e=>e.id===ek.department))||null,onChange:(e,r)=>eS({...ek,department:(null==r?void 0:r.id)||0}),renderInput:e=>(0,n.jsx)(z.Z,{...e,label:String(r("tasks.parts.form.department")),error:!!ey.department,helperText:ey.department,placeholder:String(r("common.selectPlaceholder"))})})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(d.Z,{fullWidth:!0,options:eH||[],getOptionLabel:e=>e.fullname,value:(null==eH?void 0:eH.find(e=>e.id===ek.assignee))||null,onChange:(e,r)=>eS({...ek,assignee:(null==r?void 0:r.id)||0}),renderInput:e=>(0,n.jsx)(z.Z,{...e,label:String(r("tasks.parts.form.assignee")),error:!!ey.assignee,helperText:ey.assignee,placeholder:String(r("common.selectPlaceholder"))})})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(z.Z,{fullWidth:!0,type:"datetime-local",label:String(r("tasks.parts.form.startDate")),value:ek.start_date,onChange:e=>eS({...ek,start_date:e.target.value}),InputLabelProps:{shrink:!0},error:!!ey.start_date,helperText:ey.start_date})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsx)(z.Z,{fullWidth:!0,type:"datetime-local",label:String(r("tasks.parts.form.endDate")),value:ek.end_date,onChange:e=>eS({...ek,end_date:e.target.value}),InputLabelProps:{shrink:!0},error:!!ey.end_date,helperText:ey.end_date})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,children:(0,n.jsx)(z.Z,{fullWidth:!0,multiline:!0,rows:3,label:String(r("tasks.parts.form.note")),value:ek.note,onChange:e=>eS({...ek,note:e.target.value}),error:!!ey.note,helperText:ey.note})})]})}),(0,n.jsxs)(L.Z,{children:[(0,n.jsx)(Z.Z,{onClick:eJ,children:String(r("common.cancel"))}),(0,n.jsx)(Z.Z,{variant:"contained",onClick:eK,children:String(r("common.save"))})]})]}),(0,n.jsxs)(P.Z,{open:eC,onClose:e2,maxWidth:"md",fullWidth:!0,children:[(0,n.jsxs)(q.Z,{children:[String(r("replyLetter.attachments.title"))," -"," ",(null===(e=eZ.find(e=>e.id===eq))||void 0===e?void 0:e.title)||String(r("tasks.parts.simpleTitle"))]}),(0,n.jsx)(D.Z,{children:(0,n.jsxs)(s.Z,{spacing:4,sx:{mt:2},children:[(0,n.jsxs)(T.Z,{children:[(0,n.jsx)(p.Z,{variant:"subtitle2",sx:{mb:2},children:String(r("replyLetter.attachments.existing"))}),eL.length>0?(0,n.jsx)(f.Z,{component:k.Z,variant:"outlined",children:(0,n.jsxs)(S.Z,{size:"small",children:[(0,n.jsx)(y.Z,{children:(0,n.jsxs)(b.Z,{children:[(0,n.jsx)(_.Z,{children:String(r("replyLetter.attachments.table.file"))}),(0,n.jsx)(_.Z,{align:"right",children:String(r("replyLetter.attachments.table.actions"))})]})}),(0,n.jsx)(w.Z,{children:eL.map(e=>(0,n.jsxs)(b.Z,{children:[(0,n.jsx)(_.Z,{children:e.link?e.link:e.file?e.file.split("/").pop():"-"}),(0,n.jsx)(_.Z,{align:"right",children:e.link?(0,n.jsx)(C.Z,{title:String(r("common.open",{defaultValue:"Open"})),children:(0,n.jsx)(j.Z,{size:"small",component:"a",href:String(e.link),target:"_blank",rel:"noreferrer",children:(0,n.jsx)($.Z,{icon:"tabler:external-link"})})}):(0,n.jsx)(C.Z,{title:String(r("replyLetter.attachments.actions.download")),children:(0,n.jsx)(j.Z,{size:"small",onClick:()=>rt(e),children:(0,n.jsx)($.Z,{icon:"tabler:download"})})})})]},e.id))})]})}):(0,n.jsx)(p.Z,{variant:"body2",color:"text.secondary",children:String(r("replyLetter.attachments.empty"))})]}),(0,n.jsx)(I.Z,{}),(0,n.jsxs)(T.Z,{children:[(0,n.jsx)(p.Z,{variant:"subtitle2",sx:{mb:2},children:String(r("replyLetter.attachments.addNew"))}),(0,n.jsxs)(s.Z,{spacing:2,children:[eI.map((e,t)=>(0,n.jsx)(l.Z,{variant:"outlined",children:(0,n.jsx)(o.Z,{sx:{p:"1rem !important"},children:(0,n.jsxs)(a.ZP,{container:!0,spacing:3,alignItems:"center",children:[(0,n.jsx)(a.ZP,{item:!0,xs:12,md:10,children:(0,n.jsxs)(s.Z,{spacing:1,children:[(0,n.jsx)(g.Z,{control:(0,n.jsx)(x.Z,{checked:e.isLink,onChange:e=>e4(t,e.target.checked)}),label:e.isLink?"Link":"File"}),e.isLink?(0,n.jsx)(z.Z,{fullWidth:!0,label:String(r("common.link",{defaultValue:"Link"})),value:e.link,onChange:e=>e9(t,e.target.value)}):(0,n.jsxs)(s.Z,{direction:"row",spacing:2,alignItems:"center",children:[(0,n.jsxs)(Z.Z,{variant:"outlined",component:"label",size:"small",startIcon:(0,n.jsx)($.Z,{icon:"tabler:paperclip"}),children:[String(r("replyLetter.attachments.form.attachFile")),(0,n.jsx)("input",{hidden:!0,type:"file",onChange:e=>{var r;return re(t,(null===(r=e.target.files)||void 0===r?void 0:r[0])||null)}})]}),(0,n.jsx)(p.Z,{variant:"caption",sx:{color:"text.secondary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.file?e.file.name:String(r("replyLetter.attachments.form.noFileSelected"))})]})]})}),(0,n.jsx)(a.ZP,{item:!0,xs:12,md:2,sx:{display:"flex",justifyContent:"flex-end"},children:(0,n.jsx)(j.Z,{color:"error",onClick:()=>e5(t),children:(0,n.jsx)($.Z,{icon:"tabler:trash"})})})]})})},t)),(0,n.jsxs)(s.Z,{direction:"row",spacing:2,children:[(0,n.jsx)(Z.Z,{variant:"outlined",size:"small",startIcon:(0,n.jsx)($.Z,{icon:"tabler:plus"}),onClick:()=>{eW(e=>[...e,{isLink:!1,link:"",file:null}])},children:String(r("replyLetter.attachments.addRow"))}),eI.length>0&&(0,n.jsx)(Z.Z,{variant:"contained",color:"success",size:"small",onClick:rr,disabled:eY,startIcon:(0,n.jsx)($.Z,{icon:"tabler:upload"}),children:eY?String(r("common.loading")):String(r("replyLetter.attachments.upload"))})]})]})]})]})}),(0,n.jsx)(L.Z,{children:(0,n.jsx)(Z.Z,{onClick:e2,children:String(r("common.close"))})})]})]}),(0,n.jsx)(T.Z,{sx:{display:"flex",justifyContent:"flex-start",mt:2},children:(0,n.jsx)(Z.Z,{component:A(),href:"/tasks/view/".concat(ed),variant:"contained",color:"info",startIcon:(0,n.jsx)($.Z,{icon:"tabler:file-text"}),children:String(r("common.view"))})})]})};function el(){return(0,n.jsx)(ea,{})}}},function(e){e.O(0,[4885,2785,7536,9716,1980,2216,6949,2888,9774,179],function(){return e(e.s=31865)}),_N_E=e.O()}]);