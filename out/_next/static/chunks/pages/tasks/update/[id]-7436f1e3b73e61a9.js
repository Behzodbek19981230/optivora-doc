(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7478],{31865:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tasks/update/[id]",function(){return t(15493)}])},58898:function(e,r,t){"use strict";var a=t(18745),i=t(86501);r.Z=()=>{let e=(0,a.Z)();return{success:(r,t)=>i.ZP.success(r,{style:{paddingInline:"10px",paddingBlock:"6px",color:e.palette.success.main,border:"1px solid ".concat(e.palette.success.main)},iconTheme:{primary:e.palette.success.main,secondary:e.palette.success.contrastText},...t}),error:(r,t)=>i.ZP.error(r,{style:{paddingInline:"10px",paddingBlock:"6px",color:e.palette.error.main,border:"1px solid ".concat(e.palette.error.main)},iconTheme:{primary:e.palette.error.main,secondary:e.palette.getContrastText(e.palette.error.main)},...t}),info:(r,t)=>(0,i.ZP)(r,{style:{padding:"16px",color:e.palette.info.main,border:"1px solid ".concat(e.palette.info.main)},iconTheme:{primary:e.palette.info.main,secondary:e.palette.getContrastText(e.palette.info.main)},...t})}}},15493:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return H}});var a=t(85893),i=t(67294),n=t(60762),s=t(71919),l=t(68573),d=t(15972),o=t(84166),u=t(73907),c=t(6897),m=t(85533),h=t(15903),x=t(65806),j=t(12467),p=t(96788),y=t(25026),Z=t(93454),g=t(76592),v=t(70360),_=t(46577),b=t(8863),f=t(19827),k=t(52857),P=t(33453),T=t(92365),q=t(40110),w=t(96727),M=t(87536),C=t(47533),I=t(16310),z=t(7879),W=t(74538),S=t(52293),D=t(58898),Q=t(11163);t(5843);var B=t(81342),A=t(33251),O=t(9198),N=t.n(O),E=t(34273),R=t(75673);let X={status:"new",type:"task",name:"",task_form:0,sending_org:0,input_doc_number:"",output_doc_number:"",start_date:"",end_date:"",priority:"ordinary",department:0,signed_by:0,note:"",list_of_magazine:0},F=I.Ry({type:I.Z_().oneOf(["task","application"]).required("Majburiy maydon"),name:I.Z_().min(2,"Kamida 2 ta belgi").required("Majburiy maydon"),task_form:I.Rx().typeError("Tanlang").required("Majburiy maydon"),sending_org:I.Rx().required("Majburiy maydon"),input_doc_number:I.Z_().required("Majburiy maydon"),output_doc_number:I.Z_().required("Majburiy maydon"),start_date:I.Z_().required("Majburiy maydon"),end_date:I.Z_().optional().default("").test("end-after-start","Tugash sanasi boshlanishdan keyin bo‘lsin",function(e){let{start_date:r}=this.parent;return!r||!e||new Date(e)>=new Date(r)}),priority:I.Z_().oneOf(["ordinary","orgently"]).required("Majburiy maydon"),department:I.Rx().required("Majburiy maydon"),note:I.Z_().required("Majburiy maydon"),list_of_magazine:I.Rx().required("Majburiy maydon"),signed_by:I.Rx().required("Majburiy maydon")});var L=()=>{let{control:e,handleSubmit:r,reset:t}=(0,M.cI)({defaultValues:X,resolver:(0,C.X)(F)}),I=(0,D.Z)(),O=(0,Q.useRouter)(),{id:L}=O.query,{user:H}=(0,E.a)(),[K,Y]=(0,i.useState)("simple"),[J,U]=(0,i.useState)(0),[V,G]=(0,i.useState)([]),[$,ee]=(0,i.useState)(!1),[er,et]=(0,i.useState)({title:"",department:0,assignee:0,start_date:"",end_date:"",note:""}),[ea,ei]=(0,i.useState)({}),{data:en}=(0,A.z)(W.Z.department,{page:1,perPage:100}),{data:es}=(0,A.z)(W.Z.users,{page:1,perPage:100}),{data:el}=(0,A.z)(W.Z.company,{page:1,perPage:100}),{data:ed}=(0,A.z)(W.Z.documentForm,{page:1,perPage:100}),eo=ed||[],{data:eu}=(0,A.z)(W.Z.listOfMagazine,{page:1,perPage:100}),ec=e=>"string"==typeof e?e:void 0;(0,i.useEffect)(()=>{(async()=>{if(!L||Array.isArray(L))return;let e=(await S.Do.get(W.Z.taskById(L))).data;t({...X,...e,task_form:"number"==typeof e.task_form?e.task_form:0,sending_org:e.sending_org||0,department:"number"==typeof e.department?e.department:0,signed_by:"number"==typeof e.signed_by?e.signed_by:0,list_of_magazine:"number"==typeof e.list_of_magazine?e.list_of_magazine:0,start_date:e.start_date?new Date(e.start_date).toISOString().slice(0,10):"",end_date:e.end_date?new Date(e.end_date).toISOString().slice(0,10):""})})()},[L,t]),(0,i.useEffect)(()=>{(async()=>{if(!(!L||Array.isArray(L)))try{var e;let r=await S.Do.get(W.Z.taskPart,{task:L,perPage:50});G((null===(e=r.data)||void 0===e?void 0:e.results)||[])}catch(e){console.error("Error fetching task parts:",e)}})()},[L]);let em=async()=>{if(!(!L||Array.isArray(L))&&J)try{var e;await S.Do.post(W.Z.taskPart,{task:Number(L),title:"Oddiy topshiriq",department:0,assignee:J,start_date:"",end_date:"",status:"new",note:"",created_by:(null==H?void 0:H.id)||1,updated_by:(null==H?void 0:H.id)||1}),I.success("Ijrochi biriktirildi");let r=await S.Do.get(W.Z.taskPart,{task:L,perPage:50});G((null===(e=r.data)||void 0===e?void 0:e.results)||[])}catch(e){I.error((null==e?void 0:e.message)||"Xatolik yuz berdi")}},eh=()=>{ee(!1)},ex=async()=>{if(!L||Array.isArray(L))return;let e={};if(er.title&&er.title.trim()||(e.title="Majburiy maydon"),(!er.department||0>=Number(er.department))&&(e.department="Majburiy maydon"),(!er.assignee||0>=Number(er.assignee))&&(e.assignee="Majburiy maydon"),er.start_date||(e.start_date="Majburiy maydon"),er.end_date||(e.end_date="Majburiy maydon"),er.start_date&&er.end_date){let r=new Date(er.start_date);new Date(er.end_date)<r&&(e.end_date="Tugash sanasi boshlanishdan keyin bo‘lsin")}if(er.note&&String(er.note).trim()||(e.note="Majburiy maydon"),ei(e),Object.keys(e).length>0){I.error("Qismlar formasi to‘ldirilishi shart");return}try{var r;await S.Do.post(W.Z.taskPart,{task:Number(L),title:er.title||"Yangi qism",department:er.department||0,assignee:er.assignee||0,start_date:er.start_date||"",end_date:er.end_date||"",status:"new",note:er.note||"",created_by:(null==H?void 0:H.id)||1,updated_by:(null==H?void 0:H.id)||1}),I.success("Task part yaratildi"),ee(!1);let e=await S.Do.get(W.Z.taskPart,{task:L,perPage:50});G((null===(r=e.data)||void 0===r?void 0:r.results)||[])}catch(e){I.error((null==e?void 0:e.message)||"Xatolik yuz berdi")}},ej=async e=>{try{await S.Do.delete(W.Z.taskPartById(e)),I.success("Task part o'chirildi"),G(V.filter(r=>r.id!==e))}catch(e){I.error((null==e?void 0:e.message)||"Xatolik yuz berdi")}},ep=async e=>{try{if(!L||Array.isArray(L))return;await S.Do.put(W.Z.taskById(L),{...e,company:null==H?void 0:H.company_id}),I.success("Task updated"),O.push("/tasks/view/".concat(L))}catch(e){I.error((null==e?void 0:e.message)||"Error creating task")}};return(0,a.jsxs)(n.Z,{children:[(0,a.jsx)(s.Z,{children:(0,a.jsx)(B.Z,{children:(0,a.jsx)("form",{onSubmit:r(ep),children:(0,a.jsxs)(l.ZP,{container:!0,spacing:4,children:[(0,a.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(M.Qr,{name:"type",control:e,render:e=>{let{field:r}=e;return(0,a.jsxs)(z.Z,{select:!0,fullWidth:!0,label:"Tip (Type)",...r,children:[(0,a.jsx)(d.Z,{value:"task",children:"Task"}),(0,a.jsx)(d.Z,{value:"application",children:"Application"})]})}})}),(0,a.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(M.Qr,{name:"priority",control:e,render:e=>{let{field:r}=e;return(0,a.jsxs)(z.Z,{select:!0,fullWidth:!0,label:"Prioritet (Priority)",...r,children:[(0,a.jsx)(d.Z,{value:"ordinary",children:"Ordinary"}),(0,a.jsx)(d.Z,{value:"orgently",children:"Urgently"})]})}})}),(0,a.jsx)(l.ZP,{item:!0,xs:12,children:(0,a.jsx)(M.Qr,{name:"name",control:e,rules:{required:"Majburiy maydon"},render:e=>{var r;let{field:t,fieldState:i}=e;return(0,a.jsx)(z.Z,{fullWidth:!0,label:"Task raqami/nomi",...t,error:!!i.error,helperText:ec(null===(r=i.error)||void 0===r?void 0:r.message)})}})}),(0,a.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(M.Qr,{name:"task_form",control:e,rules:{required:"Majburiy maydon"},render:e=>{var r;let{field:t,fieldState:i}=e;return(0,a.jsxs)(z.Z,{select:!0,fullWidth:!0,label:"Hujjat shakli",...t,error:!!i.error,helperText:ec(null===(r=i.error)||void 0===r?void 0:r.message),children:[(0,a.jsx)(d.Z,{value:0,children:"---"}),(eo||[]).map(e=>(0,a.jsx)(d.Z,{value:e.id,children:e.name},e.id))]})}})}),(0,a.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(M.Qr,{name:"sending_org",control:e,rules:{required:!0},render:e=>{var r;let{field:t,fieldState:i}=e;return(0,a.jsxs)(z.Z,{fullWidth:!0,select:!0,label:"Yuboruvchi (sending_org)",...t,error:!!i.error,helperText:null===(r=i.error)||void 0===r?void 0:r.message,children:[(0,a.jsx)(d.Z,{value:0,children:"---"}),(el||[]).map(e=>(0,a.jsx)(d.Z,{value:e.id,children:e.name},e.id))]})}})}),(0,a.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(M.Qr,{name:"input_doc_number",control:e,rules:{required:"Majburiy maydon"},render:e=>{var r;let{field:t,fieldState:i}=e;return(0,a.jsx)(z.Z,{fullWidth:!0,label:"Kirish raqami (input_doc_number)",...t,error:!!i.error,helperText:ec(null===(r=i.error)||void 0===r?void 0:r.message)})}})}),(0,a.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(M.Qr,{name:"output_doc_number",control:e,rules:{required:"Majburiy maydon"},render:e=>{var r;let{field:t,fieldState:i}=e;return(0,a.jsx)(z.Z,{fullWidth:!0,label:"Chiqish raqami (output_doc_number)",...t,error:!!i.error,helperText:ec(null===(r=i.error)||void 0===r?void 0:r.message)})}})}),(0,a.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(M.Qr,{name:"start_date",control:e,rules:{required:"Majburiy maydon"},render:e=>{var r;let{field:t,fieldState:i}=e,n=t.value?new Date(t.value):null;return(0,a.jsx)("div",{children:(0,a.jsx)(N(),{selected:n,onChange:e=>t.onChange(e?e.toISOString().slice(0,10):""),dateFormat:"yyyy-MM-dd",customInput:(0,a.jsx)(z.Z,{label:"Boshlanish sanasi",fullWidth:!0,error:!!i.error,helperText:ec(null===(r=i.error)||void 0===r?void 0:r.message)}),showPopperArrow:!0,isClearable:!0})})}})}),(0,a.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(M.Qr,{name:"end_date",control:e,rules:{required:"Majburiy maydon"},render:e=>{var r;let{field:t,fieldState:i}=e,n=t.value?new Date(t.value):null;return(0,a.jsx)("div",{children:(0,a.jsx)(N(),{selected:n,onChange:e=>t.onChange(e?e.toISOString().slice(0,10):""),dateFormat:"yyyy-MM-dd",customInput:(0,a.jsx)(z.Z,{label:"Tugash sanasi",fullWidth:!0,error:!!i.error,helperText:ec(null===(r=i.error)||void 0===r?void 0:r.message)}),showPopperArrow:!0,isClearable:!0})})}})}),(0,a.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(M.Qr,{name:"department",control:e,rules:{required:"Majburiy maydon"},render:e=>{var r;let{field:t,fieldState:i}=e;return(0,a.jsxs)(z.Z,{select:!0,fullWidth:!0,label:"Bo'lim (department)",...t,error:!!i.error,helperText:null===(r=i.error)||void 0===r?void 0:r.message,children:[(0,a.jsx)(d.Z,{value:0,children:"---"}),(en||[]).map(e=>(0,a.jsx)(d.Z,{value:e.id,children:e.name},e.id))]})}})}),(0,a.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(M.Qr,{name:"signed_by",control:e,rules:{required:"Majburiy maydon"},render:e=>{var r;let{field:t,fieldState:i}=e;return(0,a.jsxs)(z.Z,{select:!0,fullWidth:!0,label:"Imzolovchi (signed_by)",...t,error:!!i.error,helperText:null===(r=i.error)||void 0===r?void 0:r.message,children:[(0,a.jsx)(d.Z,{value:0,children:"---"}),(es||[]).map(e=>(0,a.jsx)(d.Z,{value:e.id,children:e.fullname},e.id))]})}})}),(0,a.jsx)(l.ZP,{item:!0,xs:12,children:(0,a.jsx)(M.Qr,{name:"note",control:e,render:e=>{var r;let{field:t,fieldState:i}=e;return(0,a.jsx)(z.Z,{fullWidth:!0,multiline:!0,rows:3,label:"Izoh (note)",...t,error:!!i.error,helperText:ec(null===(r=i.error)||void 0===r?void 0:r.message)})}})}),(0,a.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(M.Qr,{name:"list_of_magazine",control:e,rules:{required:"Majburiy maydon"},render:e=>{var r;let{field:t,fieldState:i}=e;return(0,a.jsxs)(z.Z,{select:!0,fullWidth:!0,label:"Jurnal (List of Magazine)",...t,error:!!i.error,helperText:null===(r=i.error)||void 0===r?void 0:r.message,children:[(0,a.jsx)(d.Z,{value:0,children:"---"}),(eu||[]).map(e=>(0,a.jsx)(d.Z,{value:e.id,children:e.name},e.id))]})}})}),(0,a.jsx)(l.ZP,{item:!0,xs:12,children:(0,a.jsxs)(o.Z,{direction:"row",spacing:2,justifyContent:"flex-end",children:[(0,a.jsx)(u.Z,{type:"button",variant:"outlined",onClick:()=>O.back(),children:"Bekor qilish"}),(0,a.jsx)(u.Z,{type:"submit",variant:"contained",children:"Saqlash"})]})})]})})})}),(0,a.jsxs)(s.Z,{children:[(0,a.jsxs)(c.Z,{component:"fieldset",children:[(0,a.jsx)(m.Z,{component:"legend",children:"Ijrochi biriktiruvi usuli"}),(0,a.jsxs)(h.Z,{row:!0,value:K,onChange:e=>Y(e.target.value),children:[(0,a.jsx)(x.Z,{value:"simple",control:(0,a.jsx)(j.Z,{}),label:"Oddiy biriktirish"}),(0,a.jsx)(x.Z,{value:"split",control:(0,a.jsx)(j.Z,{}),label:"Qismlarga bo'lish"})]})]}),"simple"===K?(0,a.jsxs)(o.Z,{spacing:2,sx:{mt:3},children:[(0,a.jsx)(p.Z,{variant:"subtitle2",children:"Bitta ijrochi tanlang:"}),(0,a.jsxs)(l.ZP,{container:!0,spacing:2,alignItems:"end",children:[(0,a.jsx)(l.ZP,{item:!0,xs:12,sm:8,children:(0,a.jsxs)(z.Z,{select:!0,fullWidth:!0,label:"Ijrochi",value:J,onChange:e=>U(Number(e.target.value)),children:[(0,a.jsx)(d.Z,{value:0,children:"---"}),(es||[]).map(e=>(0,a.jsx)(d.Z,{value:e.id,children:e.fullname},e.id))]})}),(0,a.jsx)(l.ZP,{item:!0,xs:12,sm:4,children:(0,a.jsx)(u.Z,{variant:"contained",fullWidth:!0,onClick:em,disabled:!J,children:"Biriktirish"})})]})]}):(0,a.jsxs)(o.Z,{spacing:2,sx:{mt:3},children:[(0,a.jsxs)(o.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,a.jsx)(p.Z,{variant:"subtitle2",children:"Task qismlari:"}),(0,a.jsx)(u.Z,{variant:"contained",size:"small",startIcon:(0,a.jsx)(R.Z,{icon:"mdi:plus"}),onClick:()=>{et({title:"",department:0,assignee:0,start_date:"",end_date:"",note:""}),ei({}),ee(!0)},children:"Qo'shish"})]}),V.length>0?(0,a.jsx)(y.Z,{component:Z.Z,children:(0,a.jsxs)(g.Z,{size:"small",children:[(0,a.jsx)(v.Z,{children:(0,a.jsxs)(_.Z,{children:[(0,a.jsx)(b.Z,{children:"Sarlavha"}),(0,a.jsx)(b.Z,{children:"Bo'lim"}),(0,a.jsx)(b.Z,{children:"Ijrochi"}),(0,a.jsx)(b.Z,{children:"Bosh. sanasi"}),(0,a.jsx)(b.Z,{children:"Tug. sanasi"}),(0,a.jsx)(b.Z,{children:"Izoh"}),(0,a.jsx)(b.Z,{align:"right",children:"Amal"})]})}),(0,a.jsx)(f.Z,{children:V.map(e=>{var r,t;return(0,a.jsxs)(_.Z,{children:[(0,a.jsx)(b.Z,{children:e.title}),(0,a.jsx)(b.Z,{children:(null==en?void 0:null===(r=en.find(r=>r.id===e.department))||void 0===r?void 0:r.name)||e.department}),(0,a.jsx)(b.Z,{children:(null==es?void 0:null===(t=es.find(r=>r.id===e.assignee))||void 0===t?void 0:t.fullname)||e.assignee}),(0,a.jsx)(b.Z,{children:e.start_date}),(0,a.jsx)(b.Z,{children:e.end_date}),(0,a.jsx)(b.Z,{children:e.note}),(0,a.jsx)(b.Z,{align:"right",children:(0,a.jsx)(k.Z,{size:"small",color:"error",onClick:()=>ej(e.id),children:(0,a.jsx)(R.Z,{icon:"mdi:delete"})})})]},e.id)})})]})}):(0,a.jsx)(p.Z,{variant:"body2",color:"text.secondary",children:"Hali qismlar qo'shilmagan"})]})]}),(0,a.jsxs)(P.Z,{open:$,onClose:eh,maxWidth:"sm",fullWidth:!0,children:[(0,a.jsx)(T.Z,{children:"Task part qo'shish"}),(0,a.jsx)(q.Z,{children:(0,a.jsxs)(l.ZP,{container:!0,spacing:3,sx:{mt:1},children:[(0,a.jsx)(l.ZP,{item:!0,xs:12,children:(0,a.jsx)(z.Z,{fullWidth:!0,label:"Sarlavha",value:er.title,onChange:e=>et({...er,title:e.target.value}),error:!!ea.title,helperText:ea.title})}),(0,a.jsx)(l.ZP,{item:!0,xs:12,children:(0,a.jsxs)(z.Z,{select:!0,fullWidth:!0,label:"Bo'lim",value:er.department,onChange:e=>et({...er,department:Number(e.target.value)}),error:!!ea.department,helperText:ea.department,children:[(0,a.jsx)(d.Z,{value:0,children:"---"}),(en||[]).map(e=>(0,a.jsx)(d.Z,{value:e.id,children:e.name},e.id))]})}),(0,a.jsx)(l.ZP,{item:!0,xs:12,children:(0,a.jsxs)(z.Z,{select:!0,fullWidth:!0,label:"Ijrochi",value:er.assignee,onChange:e=>et({...er,assignee:Number(e.target.value)}),error:!!ea.assignee,helperText:ea.assignee,children:[(0,a.jsx)(d.Z,{value:0,children:"---"}),(es||[]).map(e=>(0,a.jsx)(d.Z,{value:e.id,children:e.fullname},e.id))]})}),(0,a.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(z.Z,{fullWidth:!0,type:"date",label:"Boshlanish sanasi",value:er.start_date,onChange:e=>et({...er,start_date:e.target.value}),InputLabelProps:{shrink:!0},error:!!ea.start_date,helperText:ea.start_date})}),(0,a.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(z.Z,{fullWidth:!0,type:"date",label:"Tugash sanasi",value:er.end_date,onChange:e=>et({...er,end_date:e.target.value}),InputLabelProps:{shrink:!0},error:!!ea.end_date,helperText:ea.end_date})}),(0,a.jsx)(l.ZP,{item:!0,xs:12,children:(0,a.jsx)(z.Z,{fullWidth:!0,multiline:!0,rows:3,label:"Izoh",value:er.note,onChange:e=>et({...er,note:e.target.value}),error:!!ea.note,helperText:ea.note})})]})}),(0,a.jsxs)(w.Z,{children:[(0,a.jsx)(u.Z,{onClick:eh,children:"Bekor qilish"}),(0,a.jsx)(u.Z,{variant:"contained",onClick:ex,children:"Saqlash"})]})]})]})};function H(){return(0,a.jsx)(L,{})}}},function(e){e.O(0,[7536,2712,7008,4021,2216,3275,1863,2888,9774,179],function(){return e(e.s=31865)}),_N_E=e.O()}]);