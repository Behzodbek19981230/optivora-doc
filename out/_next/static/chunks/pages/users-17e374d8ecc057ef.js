(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2892],{66249:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/users",function(){return t(69644)}])},34375:function(e,r,t){"use strict";t.d(r,{Z:function(){return y}});var n=t(63366),i=t(87462),a=t(67294),s=t(86010),l=t(94780),o=t(96788),d=t(29567),c=t(77527),m=t(1588),u=t(34867);function x(e){return(0,u.Z)("MuiCardHeader",e)}let h=(0,m.Z)("MuiCardHeader",["root","avatar","action","content","title","subheader"]);var g=t(85893);let p=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],j=e=>{let{classes:r}=e;return(0,l.Z)({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},x,r)},f=(0,c.ZP)("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(e,r)=>(0,i.Z)({["& .".concat(h.title)]:r.title,["& .".concat(h.subheader)]:r.subheader},r.root)})({display:"flex",alignItems:"center",padding:16}),Z=(0,c.ZP)("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(e,r)=>r.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),v=(0,c.ZP)("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(e,r)=>r.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),b=(0,c.ZP)("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(e,r)=>r.content})({flex:"1 1 auto"});var y=a.forwardRef(function(e,r){let t=(0,d.Z)({props:e,name:"MuiCardHeader"}),{action:a,avatar:l,className:c,component:m="div",disableTypography:u=!1,subheader:x,subheaderTypographyProps:h,title:y,titleTypographyProps:S}=t,w=(0,n.Z)(t,p),_=(0,i.Z)({},t,{component:m,disableTypography:u}),W=j(_),P=y;null==P||P.type===o.Z||u||(P=(0,g.jsx)(o.Z,(0,i.Z)({variant:l?"body2":"h5",className:W.title,component:"span",display:"block"},S,{children:P})));let C=x;return null==C||C.type===o.Z||u||(C=(0,g.jsx)(o.Z,(0,i.Z)({variant:l?"body2":"body1",className:W.subheader,color:"text.secondary",component:"span",display:"block"},h,{children:C}))),(0,g.jsxs)(f,(0,i.Z)({className:(0,s.Z)(W.root,c),as:m,ref:r,ownerState:_},w,{children:[l&&(0,g.jsx)(Z,{className:W.avatar,ownerState:_,children:l}),(0,g.jsxs)(b,{className:W.content,ownerState:_,children:[P,C]}),a&&(0,g.jsx)(v,{className:W.action,ownerState:_,children:a})]}))})},82071:function(e,r,t){"use strict";t.d(r,{x:function(){return n}});let n=e=>({noRowsLabel:String(e("common.datagrid.noRows",{defaultValue:"No rows"})),MuiTablePagination:{labelRowsPerPage:String(e("common.datagrid.rowsPerPage",{defaultValue:"Rows per page:"})),labelDisplayedRows:r=>{let{from:t,to:n,count:i}=r;return"".concat(t,"–").concat(n," ").concat(String(e("common.datagrid.of",{defaultValue:"of"}))," ").concat(-1!==i?i:">".concat(n))}}})},69644:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return X}});var n=t(85893),i=t(67294),a=t(21038),s=t(81873),l=t(52857),o=t(60762),d=t(34375),c=t(51015),m=t(33453),u=t(92365),x=t(40110),h=t(96727),g=t(16127),p=t(90142),j=t(75673),f=t(33251),Z=t(74538),v=t(52293),b=t(9198),y=t.n(b);t(5843);var S=t(87536),w=t(68573),_=t(12467),W=t(15903),P=t(6897),C=t(85533),z=t(12283),R=t(15972),k=t(13539),N=t(65806),D=t(7879),M=t(86501),I=t(81342),Q=t(34273),T=t(55421),q=t(22120),E=t(20788);let F={username:"",fullname:"",is_active:!0,date_of_birthday:"",gender:"",phone_number:"",avatar:"",email:"",role:[],password:"",region:0,district:0,address:"",companies:[],roles_detail:[]};var H=e=>{let{open:r,onClose:t,onSaved:a,mode:s,item:l}=e,{t:o}=(0,q.$G)(),{control:d,handleSubmit:g,reset:j,watch:b,formState:{isSubmitting:H,errors:Y}}=(0,S.cI)({defaultValues:F});(0,Q.a)();let{data:O=[]}=(0,f.z)(Z.Z.region,{limit:100}),A=b("region"),V=A?"".concat(Z.Z.district,"?region=").concat(A):Z.Z.district,{data:L=[]}=(0,f.z)(V,{limit:200}),{data:U=[]}=(0,f.z)(Z.Z.company,{limit:200}),[G,B]=(0,i.useState)(null),$=(0,i.useRef)(null),[X,J]=(0,i.useState)("");(0,i.useEffect)(()=>{if("edit"===s&&l){var e;j({...l,password:"",role:(null===(e=l.roles_detail)||void 0===e?void 0:e.map(e=>String(e.id)))||[]}),J(l.avatar||"")}else j(F),J("")},[s,l,j]),(0,i.useEffect)(()=>{if(G){let e=URL.createObjectURL(G);return J(e),()=>URL.revokeObjectURL(e)}},[G]);let K=async e=>{try{let r={...e};if(r.password||delete r.password,"create"===s){let r=new FormData;G&&r.append("avatar",G),Object.keys(e).forEach(t=>{if("roles"!=t){if("role"==t){var n;null===(n=e.role)||void 0===n||n.forEach(e=>{r.append("roles",String(e))});return}"companies"==t?e.companies.forEach(e=>{r.append("companies",e.toString())}):r.append(t,e[t])}}),await v.Do.postForm(Z.Z.users,r)}else if("edit"===s&&(null==l?void 0:l.id)){if(G){let r=new FormData;Object.keys(e).forEach(t=>{if("roles"!=t){if("role"==t){var n;null===(n=e.role)||void 0===n||n.forEach(e=>{r.append("roles",String(e))});return}if("companies"==t)e.companies.forEach(e=>{r.append("companies",e.toString())});else{if("avatar"==t)return;r.append(t,e[t])}}}),r.append("avatar",G),await v.Do.putForm(Z.Z.userById(l.id),r)}else{let r={...e};delete r.role,delete r.roles_detail,delete r.avatar,r.roles=(e.role||[]).map(e=>Number(e)),await v.Do.put(Z.Z.userById(l.id),r)}}M.ZP.success(String(o("users.toast.saved"))),a(),t()}catch(e){console.error("Failed to save user:",e),M.ZP.error(String(o("users.toast.saveError")))}};return(0,n.jsxs)(m.Z,{open:r,onClose:H?void 0:t,fullWidth:!0,maxWidth:"md",children:[(0,n.jsx)(u.Z,{children:"create"===s?String(o("users.create.title")):String(o("users.edit.title"))}),(0,n.jsxs)("form",{onSubmit:g(K),children:[(0,n.jsx)(x.Z,{children:(0,n.jsx)(I.Z,{children:(0,n.jsxs)(w.ZP,{container:!0,spacing:4,children:[(0,n.jsx)(w.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(S.Qr,{name:"fullname",control:d,rules:{required:String(o("errors.required"))},render:e=>{var r;let{field:t}=e;return(0,n.jsx)(D.Z,{fullWidth:!0,label:String(o("users.form.fullname")),...t,error:!!Y.fullname,helperText:null===(r=Y.fullname)||void 0===r?void 0:r.message})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(S.Qr,{name:"email",control:d,rules:{required:String(o("errors.required"))},render:e=>{var r;let{field:t}=e;return(0,n.jsx)(D.Z,{fullWidth:!0,type:"email",label:String(o("users.form.email")),...t,error:!!Y.email,helperText:null===(r=Y.email)||void 0===r?void 0:r.message})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(S.Qr,{name:"phone_number",control:d,render:e=>{let{field:r}=e;return(0,n.jsx)(D.Z,{fullWidth:!0,label:String(o("users.form.phone")),...r})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(S.Qr,{name:"date_of_birthday",control:d,render:e=>{let{field:r}=e,t=r.value?new Date(r.value):null;return(0,n.jsx)("div",{children:(0,n.jsx)(y(),{selected:t,onChange:e=>r.onChange(e?e.toISOString().slice(0,10):""),dateFormat:"yyyy-MM-dd",showMonthDropdown:!0,showYearDropdown:!0,dropdownMode:"scroll",yearDropdownItemNumber:100,scrollableYearDropdown:!0,customInput:(0,n.jsx)(D.Z,{label:String(o("users.form.birthDate")),fullWidth:!0}),showPopperArrow:!0,isClearable:!0})})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(S.Qr,{name:"gender",control:d,rules:{required:String(o("errors.required"))},render:e=>{let{field:r}=e;return(0,n.jsxs)(P.Z,{error:!!Y.gender,children:[(0,n.jsx)(C.Z,{children:String(o("users.form.gender"))}),(0,n.jsxs)(W.Z,{row:!0,...r,children:[(0,n.jsx)(N.Z,{value:"male",control:(0,n.jsx)(_.Z,{}),label:String(o("users.gender.male"))}),(0,n.jsx)(N.Z,{value:"female",control:(0,n.jsx)(_.Z,{}),label:String(o("users.gender.female"))})]}),Y.gender&&(0,n.jsx)(z.Z,{children:Y.gender.message})]})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(S.Qr,{name:"role",control:d,rules:"create"===s?{required:String(o("errors.required"))}:{},render:e=>{var r;let{field:t}=e;return(0,n.jsx)(D.Z,{select:!0,fullWidth:!0,label:String(o("users.form.role")),SelectProps:{multiple:!0},value:Array.isArray(t.value)?t.value:t.value?[t.value]:[],onChange:e=>{let r=e.target.value;t.onChange("string"==typeof r?r.split(","):r)},error:!!Y.role,helperText:null===(r=Y.role)||void 0===r?void 0:r.message,children:E.e.map(e=>(0,n.jsx)(R.Z,{value:e.value,children:o("users.roles.".concat(e.label.toLowerCase()))},e.value))})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(S.Qr,{name:"username",control:d,rules:{required:String(o("errors.required"))},render:e=>{var r;let{field:t}=e;return(0,n.jsx)(D.Z,{fullWidth:!0,label:String(o("users.form.username")),...t,error:!!Y.username,helperText:null===(r=Y.username)||void 0===r?void 0:r.message})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(S.Qr,{name:"password",control:d,render:e=>{let{field:r}=e;return(0,n.jsx)(D.Z,{fullWidth:!0,type:"password",label:String(o("users.form.password")),...r,autoComplete:"new-password"})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(S.Qr,{name:"region",control:d,rules:{required:String(o("errors.required"))},render:e=>{var r;let{field:t}=e;return(0,n.jsx)(D.Z,{select:!0,fullWidth:!0,label:String(o("users.form.region")),...t,error:!!Y.region,helperText:null===(r=Y.region)||void 0===r?void 0:r.message,children:O.map(e=>(0,n.jsx)(R.Z,{value:e.id,children:e.name_uz||e.name},e.id))})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(S.Qr,{name:"district",control:d,rules:{required:String(o("errors.required"))},render:e=>{var r;let{field:t}=e;return(0,n.jsx)(D.Z,{select:!0,fullWidth:!0,label:String(o("users.form.district")),...t,error:!!Y.district,helperText:null===(r=Y.district)||void 0===r?void 0:r.message,children:L.map(e=>(0,n.jsx)(R.Z,{value:e.id,children:e.name_uz||e.name},e.id))})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,children:(0,n.jsx)(S.Qr,{name:"address",control:d,render:e=>{let{field:r}=e;return(0,n.jsx)(D.Z,{fullWidth:!0,label:String(o("users.form.address")),...r})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,children:(0,n.jsx)(S.Qr,{name:"companies",control:d,render:e=>{let{field:r}=e;return(0,n.jsx)(D.Z,{select:!0,fullWidth:!0,label:String(o("users.form.companies")),...r,SelectProps:{multiple:!0},children:U.map(e=>(0,n.jsx)(R.Z,{value:e.id,children:e.name},e.id))})}})}),(0,n.jsxs)(w.ZP,{item:!0,xs:6,children:[(0,n.jsx)("input",{ref:$,hidden:!0,type:"file",accept:"image/*",onChange:e=>{var r;return B((null===(r=e.target.files)||void 0===r?void 0:r[0])||null)}}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,n.jsx)(p.Z,{src:X||void 0,variant:"circular",onClick:()=>{var e;return null===(e=$.current)||void 0===e?void 0:e.click()},sx:{width:96,height:96,cursor:"pointer",borderRadius:"50%","& img":{width:"100%",height:"100%",objectFit:"cover"}},children:(0,T.Q)(b("fullname")||b("username")||"U")}),(0,n.jsx)(c.Z,{variant:"outlined",onClick:()=>{var e;return null===(e=$.current)||void 0===e?void 0:e.click()},children:String(o("users.form.uploadAvatar"))})]})]}),(0,n.jsx)(w.ZP,{item:!0,xs:6,children:(0,n.jsx)(S.Qr,{name:"is_active",control:d,render:e=>{let{field:r}=e;return(0,n.jsx)(N.Z,{control:(0,n.jsx)(k.Z,{checked:!!r.value,onChange:(e,t)=>r.onChange(t)}),label:String(o("users.form.active"))})}})})]})})}),(0,n.jsxs)(h.Z,{children:[(0,n.jsx)(c.Z,{type:"button",variant:"tonal",color:"secondary",onClick:t,disabled:H,children:String(o("common.cancel"))}),(0,n.jsx)(c.Z,{type:"submit",disabled:H,children:H?String(o("common.saving")):String(o("common.save"))})]})]})]})},Y=t(96788),O=t(90642),A=t(30381),V=t.n(A),L=t(56912),U=t(84166),G=e=>{var r,t,i,o;let{open:d,onClose:g,user:f}=e,{t:Z,i18n:v}=(0,q.$G)(),b=e=>{if(!e)return"—";let r=v.language;return r.startsWith("uz")?e.name_uz||e.name||"—":r.startsWith("ru")?e.name_ru||e.name||"—":r.startsWith("en")?e.name_en||e.name||"—":e.name||e.name_uz||e.name_ru||e.name_en||"—"},y=e=>{if(null==e)return"—";let r=String(e).trim();return r.length?r:"—"};return(0,n.jsxs)(m.Z,{open:d,onClose:g,maxWidth:"md",fullWidth:!0,children:[(0,n.jsx)(u.Z,{sx:{pr:12},children:(0,n.jsxs)(O.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:2},children:[(0,n.jsx)(Y.Z,{variant:"h6",children:String(Z("users.view.title",{defaultValue:"User details"}))}),(0,n.jsx)(a.Z,{title:String(Z("common.close")),children:(0,n.jsx)(l.Z,{onClick:g,"aria-label":"close",children:(0,n.jsx)(j.Z,{icon:"tabler:x"})})})]})}),(0,n.jsx)(x.Z,{children:f?(0,n.jsxs)(O.Z,{sx:{pb:2},children:[(0,n.jsxs)(O.Z,{sx:{display:"flex",alignItems:{xs:"flex-start",sm:"center"},justifyContent:"space-between",gap:4,flexDirection:{xs:"column",sm:"row"}},children:[(0,n.jsxs)(O.Z,{sx:{display:"flex",alignItems:"center",gap:3,minWidth:0},children:[(0,n.jsx)(p.Z,{src:f.avatar,variant:"circular",sx:{width:88,height:88,borderRadius:"50%","& img":{width:"100%",height:"100%",objectFit:"cover"}}}),(0,n.jsxs)(O.Z,{sx:{minWidth:0},children:[(0,n.jsx)(Y.Z,{variant:"h6",sx:{fontWeight:700},noWrap:!0,children:y(f.fullname||f.username)}),(0,n.jsx)(Y.Z,{variant:"body2",color:"text.secondary",noWrap:!0,children:y(f.email)}),(0,n.jsxs)(Y.Z,{variant:"caption",color:"text.secondary",noWrap:!0,children:["@",y(f.username)]})]})]}),(0,n.jsxs)(U.Z,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:[(0,n.jsx)(s.Z,{size:"small",color:f.is_active?"success":"default",variant:f.is_active?"filled":"outlined",label:f.is_active?String(Z("common.yes")):String(Z("common.no"))}),null===(r=f.roles_detail)||void 0===r?void 0:r.slice(0,4).map(e=>(0,n.jsx)(s.Z,{label:e.name,size:"small",variant:"outlined"},e.id)),f.roles_detail&&f.roles_detail.length>4?(0,n.jsx)(s.Z,{size:"small",variant:"outlined",label:"+".concat(f.roles_detail.length-4),"aria-label":"more roles"}):null]})]}),(0,n.jsx)(L.Z,{sx:{my:4}}),(0,n.jsxs)(w.ZP,{container:!0,spacing:4,children:[(0,n.jsxs)(w.ZP,{item:!0,xs:12,md:6,children:[(0,n.jsx)(Y.Z,{variant:"subtitle1",sx:{fontWeight:700,mb:2},children:String(Z("users.view.sections.contact",{defaultValue:"Contact"}))}),(0,n.jsxs)(U.Z,{spacing:2,children:[(0,n.jsxs)(O.Z,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[(0,n.jsx)(j.Z,{icon:"tabler:mail",fontSize:"1.25rem"}),(0,n.jsxs)(O.Z,{sx:{minWidth:0},children:[(0,n.jsx)(Y.Z,{variant:"body2",color:"text.secondary",children:String(Z("users.form.email"))}),(0,n.jsx)(Y.Z,{variant:"body1",noWrap:!0,children:y(f.email)})]})]}),(0,n.jsxs)(O.Z,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[(0,n.jsx)(j.Z,{icon:"tabler:phone",fontSize:"1.25rem"}),(0,n.jsxs)(O.Z,{sx:{minWidth:0},children:[(0,n.jsx)(Y.Z,{variant:"body2",color:"text.secondary",children:String(Z("users.form.phone"))}),(0,n.jsx)(Y.Z,{variant:"body1",noWrap:!0,children:y(f.phone_number)})]})]}),(0,n.jsxs)(O.Z,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[(0,n.jsx)(j.Z,{icon:"tabler:map-pin",fontSize:"1.25rem"}),(0,n.jsxs)(O.Z,{sx:{minWidth:0},children:[(0,n.jsx)(Y.Z,{variant:"body2",color:"text.secondary",children:String(Z("users.form.address"))}),(0,n.jsx)(Y.Z,{variant:"body1",children:y(f.address)})]})]})]})]}),(0,n.jsxs)(w.ZP,{item:!0,xs:12,md:6,children:[(0,n.jsx)(Y.Z,{variant:"subtitle1",sx:{fontWeight:700,mb:2},children:String(Z("users.view.sections.meta",{defaultValue:"Details"}))}),(0,n.jsxs)(w.ZP,{container:!0,spacing:2,children:[(0,n.jsxs)(w.ZP,{item:!0,xs:12,sm:6,children:[(0,n.jsx)(Y.Z,{variant:"body2",color:"text.secondary",children:String(Z("users.form.fullname"))}),(0,n.jsx)(Y.Z,{variant:"body1",children:y(f.fullname)})]}),(0,n.jsxs)(w.ZP,{item:!0,xs:12,sm:6,children:[(0,n.jsx)(Y.Z,{variant:"body2",color:"text.secondary",children:String(Z("users.form.username"))}),(0,n.jsx)(Y.Z,{variant:"body1",children:y(f.username)})]}),(0,n.jsxs)(w.ZP,{item:!0,xs:12,sm:6,children:[(0,n.jsx)(Y.Z,{variant:"body2",color:"text.secondary",children:String(Z("users.form.gender"))}),(0,n.jsx)(Y.Z,{variant:"body1",children:"male"===(o=f.gender)?String(Z("users.gender.male",{defaultValue:"Male"})):"female"===o?String(Z("users.gender.female",{defaultValue:"Female"})):o||"—"})]}),(0,n.jsxs)(w.ZP,{item:!0,xs:12,sm:6,children:[(0,n.jsx)(Y.Z,{variant:"body2",color:"text.secondary",children:String(Z("users.form.birthDate"))}),(0,n.jsx)(Y.Z,{variant:"body1",children:f.date_of_birthday?V()(f.date_of_birthday).format("DD.MM.YYYY"):"—"})]}),(0,n.jsxs)(w.ZP,{item:!0,xs:12,sm:6,children:[(0,n.jsx)(Y.Z,{variant:"body2",color:"text.secondary",children:String(Z("users.form.region"))}),(0,n.jsx)(Y.Z,{variant:"body1",children:b(f.region_detail)})]}),(0,n.jsxs)(w.ZP,{item:!0,xs:12,sm:6,children:[(0,n.jsx)(Y.Z,{variant:"body2",color:"text.secondary",children:String(Z("users.form.district"))}),(0,n.jsx)(Y.Z,{variant:"body1",children:b(f.district_detail)})]}),(0,n.jsxs)(w.ZP,{item:!0,xs:12,children:[(0,n.jsx)(Y.Z,{variant:"body2",color:"text.secondary",children:String(Z("common.createdAt"))}),(0,n.jsx)(Y.Z,{variant:"body1",children:V()(f.date_joined).format("DD.MM.YYYY HH:mm")})]})]})]}),(0,n.jsx)(w.ZP,{item:!0,xs:12,children:(0,n.jsx)(L.Z,{sx:{my:1}})}),(0,n.jsxs)(w.ZP,{item:!0,xs:12,md:6,children:[(0,n.jsx)(Y.Z,{variant:"subtitle1",sx:{fontWeight:700,mb:2},children:String(Z("users.form.role"))}),(0,n.jsx)(O.Z,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:(null===(t=f.roles_detail)||void 0===t?void 0:t.length)?f.roles_detail.map(e=>(0,n.jsx)(s.Z,{label:e.name,size:"small"},e.id)):(0,n.jsx)(Y.Z,{variant:"body2",color:"text.secondary",children:"—"})})]}),(0,n.jsxs)(w.ZP,{item:!0,xs:12,md:6,children:[(0,n.jsx)(Y.Z,{variant:"subtitle1",sx:{fontWeight:700,mb:2},children:String(Z("users.form.companies"))}),(0,n.jsx)(O.Z,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:(null===(i=f.companies_detail)||void 0===i?void 0:i.length)?f.companies_detail.map(e=>(0,n.jsx)(s.Z,{label:e.name,size:"small"},e.id)):(0,n.jsx)(Y.Z,{variant:"body2",color:"text.secondary",children:"—"})})]})]})]}):(0,n.jsx)(Y.Z,{color:"text.secondary",children:String(Z("common.notFound"))})}),(0,n.jsx)(h.Z,{children:(0,n.jsx)(c.Z,{onClick:g,children:String(Z("common.close"))})})]})},B=t(82071),$=()=>{let{t:e}=(0,q.$G)(),[r,t]=(0,i.useState)({page:0,pageSize:10}),{data:b=[],loading:y,total:S,mutate:w}=(0,f.z)(Z.Z.users,{limit:r.pageSize,page:r.page+1});console.log(S);let[_,W]=(0,i.useState)(!1),[P,C]=(0,i.useState)(null),[z,R]=(0,i.useState)(!1),[k,N]=(0,i.useState)(null),[D,M]=(0,i.useState)(!1),[I,Q]=(0,i.useState)(null),E=e=>{C(e),W(!0)},F=async e=>{await v.Do.delete(Z.Z.userById(e)),w()},Y=e=>e.avatar?(0,n.jsx)(p.Z,{src:e.avatar,variant:"circular",sx:{mr:2.5,width:38,height:38,borderRadius:"50%","& img":{width:"100%",height:"100%",objectFit:"cover"},cursor:"pointer"},onClick:()=>{N(e.avatar),R(!0)}}):(0,n.jsx)(p.Z,{skin:"light",color:"primary",sx:{mr:2.5,width:38,height:38,fontWeight:500},children:(0,T.Q)(e.fullname||e.username)}),O=[{field:"fullname",headerName:String(e("users.table.fullname")),flex:.35,minWidth:300,renderCell:e=>{let r=e.row;return(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[Y(r),(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,n.jsx)("span",{style:{flexWrap:"wrap",fontWeight:500},children:r.fullname||r.username}),(0,n.jsx)("span",{style:{color:"gray",fontSize:12},children:r.email})]})]})}},{field:"username",headerName:String(e("users.table.username")),flex:.15,minWidth:140},{field:"role",headerName:String(e("users.table.role")),flex:.12,minWidth:200,valueGetter:r=>{let t=r.row.roles_detail||[];return 0===t.length?"":t.map(r=>e("users.roles.".concat(r.name.toLowerCase()))).join(", ")}},{field:"phone_number",headerName:String(e("users.table.phone")),flex:.18,minWidth:160},{field:"is_active",headerName:String(e("users.table.active")),flex:.1,minWidth:100,valueGetter:r=>r.row.is_active?String(e("common.yes")):String(e("common.no"))},{field:"companies_detail",headerName:String(e("users.table.companies")),flex:.35,minWidth:260,sortable:!1,renderCell:e=>{let r=e.row.companies_detail||[];if(!r.length)return(0,n.jsx)("span",{style:{color:"gray"},children:"—"});let t=r.slice(0,3).map((e,r)=>{let t,i=r;if("string"==typeof e)t=e;else if("number"==typeof e)t=String(e);else{var l;i=null!==(l=e.id)&&void 0!==l?l:r,t=e.name||e.company_name||e.title||"#".concat(e.id)}return(0,n.jsx)(a.Z,{title:t,arrow:!0,children:(0,n.jsx)(s.Z,{size:"small",label:t.length>18?t.slice(0,15)+"…":t,sx:{fontWeight:500,fontSize:12,borderRadius:2,textTransform:"capitalize",color:"#1976d2"}})},i)}),i=r.length-3;return(0,n.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"4px",padding:"2px 0"},children:[t,i>0&&(0,n.jsx)(a.Z,{title:r.slice(3).map(e=>"string"==typeof e||"number"==typeof e?String(e):e.name||e.company_name||e.title||"#".concat(e.id)).join(", "),arrow:!0,children:(0,n.jsx)(s.Z,{size:"small",label:"+".concat(i),sx:{mb:1,fontWeight:500,fontSize:13,borderRadius:2}})})]})}},{field:"actions",headerName:String(e("common.actions")),flex:.18,minWidth:160,sortable:!1,renderCell:e=>{let r=e.row;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.Z,{"aria-label":"view",onClick:()=>{Q(r),M(!0)},children:(0,n.jsx)(j.Z,{icon:"tabler:eye"})}),(0,n.jsx)(l.Z,{"aria-label":"edit",onClick:()=>E(r),children:(0,n.jsx)(j.Z,{icon:"tabler:edit"})}),(0,n.jsx)(l.Z,{"aria-label":"delete",color:"error",onClick:()=>F(r.id),children:(0,n.jsx)(j.Z,{icon:"tabler:trash"})})]})}}];return(0,n.jsxs)(o.Z,{children:[(0,n.jsx)(d.Z,{title:String(e("users.title")),action:(0,n.jsx)(c.Z,{variant:"contained",onClick:()=>{C(null),W(!0)},children:String(e("common.create"))})}),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(g._,{autoHeight:!0,rowHeight:56,rows:b,columns:O,loading:y,disableRowSelectionOnClick:!0,pageSizeOptions:[10,25,50],paginationModel:r,onPaginationModelChange:t,getRowId:e=>e.id,paginationMode:"server",rowCount:S||0,localeText:(0,B.x)(e)})}),_&&(0,n.jsx)(H,{open:_,onClose:()=>W(!1),onSaved:w,mode:P?"edit":"create",item:P?{...P,companies:(P.companies||[]).map(e=>"string"==typeof e?Number(e):e)}:void 0}),(0,n.jsxs)(m.Z,{open:z,onClose:()=>R(!1),maxWidth:"sm",fullWidth:!0,children:[(0,n.jsx)(u.Z,{children:String(e("users.avatar.title"))}),(0,n.jsx)(x.Z,{children:k&&(0,n.jsx)("img",{src:k,alt:"User Avatar",style:{width:"100%",height:"auto",borderRadius:"8px"}})}),(0,n.jsx)(h.Z,{children:(0,n.jsx)(c.Z,{onClick:()=>R(!1),children:String(e("common.close"))})})]}),(0,n.jsx)(G,{open:D,onClose:()=>M(!1),user:I})]})},X=()=>(0,n.jsx)($,{})}},function(e){e.O(0,[4885,2785,7536,6127,1980,6949,2888,9774,179],function(){return e(e.s=66249)}),_N_E=e.O()}]);