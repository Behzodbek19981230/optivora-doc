(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3679],{8615:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/task-parts/view/[id]",function(){return s(12656)}])},12656:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return M}});var i=s(85893),n=s(11163),a=s(90642),r=s(96788),l=s(68573),d=s(60762),c=s(71919),o=s(84166),u=s(81873),x=s(56912),m=s(73907),v=s(41664),h=s.n(v),j=s(75673),Z=s(74538),g=s(52293),b=s(33934),f=s(22120),p=s(30381),_=s.n(p),k=s(96145),w=s(15822),y=s(67294),S=s(30202),P=s(34273),Y=s(33971),D=e=>{var t,s,n,v,h,j,p,k,w,D,W,M;let{task:I,part:z,mutate:H}=e,{t:N}=(0,f.$G)(),{user:q}=(0,P.a)(),[C,E]=y.useState(!1),B=null==z?void 0:z.id,T=(0,S.NL)(),A=(null==z?void 0:null===(t=z.task_detail)||void 0===t?void 0:t.id)||(null==I?void 0:I.id),{data:F}=(0,b.a)({queryKey:["task",A],enabled:!!A,queryFn:async()=>(await g.Do.get(Z.Z.taskById(String(A)))).data}),K=F||I||(null==z?void 0:z.task_detail),Q=async()=>{try{B&&(await T.invalidateQueries({queryKey:["task-part",B],refetchType:"active"}),A&&(await T.invalidateQueries({queryKey:["task-comments",A,B],refetchType:"active"}),await T.invalidateQueries({queryKey:["task-attachments",A,B],refetchType:"active"})),null==H||H())}catch(e){console.error("mutateAndRefresh failed",e)}},G=e=>{if(!e)return"—";let t=_()(e);return t.isValid()?t.format("DD.MM.YYYY HH:mm"):String(e)},O=e=>{let{label:t,value:s}=e;return(0,i.jsxs)(o.Z,{spacing:.75,children:[(0,i.jsx)(r.Z,{variant:"caption",color:"text.secondary",children:t}),(0,i.jsx)(r.Z,{variant:"body2",sx:{wordBreak:"break-word"},children:s||"—"})]})};return(0,i.jsxs)(a.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[K&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.Z,{children:(0,i.jsxs)(c.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle1",sx:{mb:2},children:String(N("tasks.view.document.sections.main"))}),(0,i.jsxs)(l.ZP,{container:!0,spacing:3,children:[(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(O,{label:String(N("tasks.view.document.fields.company")),value:(null===(s=K.company_detail)||void 0===s?void 0:s.name)||K.company})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(O,{label:String(N("tasks.view.document.fields.department")),value:(null===(n=K.department_detail)||void 0===n?void 0:n.name)||K.department})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(O,{label:String(N("tasks.view.document.fields.taskForm")),value:(null===(v=K.task_form_detail)||void 0===v?void 0:v.name)||K.task_form})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(O,{label:String(N("tasks.view.document.fields.magazine")),value:(null===(h=K.list_of_magazine_detail)||void 0===h?void 0:h.name)||K.list_of_magazine})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(O,{label:String(N("tasks.view.document.fields.signedBy")),value:(null===(j=K.signed_by_detail)||void 0===j?void 0:j.fullname)||K.signed_by})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(O,{label:String(N("tasks.view.document.fields.responsiblePerson")),value:null!==(D=K.sending_respon_person)&&void 0!==D?D:"—"})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(O,{label:String(N("tasks.view.document.fields.inputDocNumber")),value:null!==(W=K.input_doc_number)&&void 0!==W?W:"—"})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(O,{label:String(N("tasks.view.document.fields.outputDocNumber")),value:null!==(M=K.output_doc_number)&&void 0!==M?M:"—"})})]})]})}),(0,i.jsx)(d.Z,{children:(0,i.jsxs)(c.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle1",sx:{mb:2},children:String(N("tasks.view.document.sections.dates"))}),(0,i.jsxs)(l.ZP,{container:!0,spacing:3,children:[(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(O,{label:String(N("tasks.view.document.fields.startDate")),value:G(K.start_date)})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(O,{label:String(N("tasks.view.document.fields.endDate")),value:G(K.end_date)})})]}),(0,i.jsx)(x.Z,{sx:{my:3}}),(0,i.jsx)(r.Z,{variant:"subtitle1",sx:{mb:2},children:String(N("tasks.view.document.sections.system"))}),(0,i.jsxs)(l.ZP,{container:!0,spacing:3,children:[(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(O,{label:String(N("tasks.view.document.fields.createdAt")),value:K.created_time?_()(K.created_time).format("DD.MM.YYYY HH:mm"):"—"})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(O,{label:String(N("tasks.view.document.fields.createdBy")),value:(null===(p=K.created_by_detail)||void 0===p?void 0:p.fullname)||K.created_by})})]})]})})]}),(0,i.jsx)(d.Z,{children:(0,i.jsx)(c.Z,{children:(0,i.jsxs)(o.Z,{spacing:2,children:[(0,i.jsx)(r.Z,{variant:"subtitle1",children:String(N("tasks.view.actions.title"))}),(0,i.jsx)(x.Z,{}),B?(0,i.jsxs)(o.Z,{spacing:1,children:[(0,i.jsx)(r.Z,{variant:"caption",color:"text.secondary",children:String(N("tasks.view.actions.selectedSection"))}),(0,i.jsx)(o.Z,{direction:"row",spacing:1,alignItems:"center",children:(0,i.jsx)(r.Z,{variant:"body2",children:(null==z?void 0:z.title)||String(N("common.notSet"))})}),(0,i.jsx)(r.Z,{variant:"caption",color:"text.secondary",children:String(N("tasks.view.actions.partStatus"))}),(0,i.jsx)(o.Z,{direction:"row",spacing:1,alignItems:"center",children:(null==z?void 0:z.status)?(0,i.jsx)(u.Z,{size:"small",color:"info",variant:"outlined",label:(()=>{let e="documents.status.".concat(z.status.split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")),t=String(N(e));return t===e?z.status:t})()}):null}),(null==q?void 0:q.id)===(null==z?void 0:null===(k=z.assignee_detail)||void 0===k?void 0:k.id)&&B&&((null==z?void 0:z.status)==="new"||(null==z?void 0:z.status)==="in_progress"||(null==z?void 0:z.status)==="returned")&&(0,i.jsx)(m.Z,{size:"small",variant:"contained",onClick:()=>E(!0),children:String(N("tasks.view.actions.ensureExecution")||"Ensure execution")}),(null==q?void 0:q.id)===(null==K?void 0:null===(w=K.signed_by_detail)||void 0===w?void 0:w.id)&&B&&(null==z?void 0:z.status)==="on_review"&&(0,i.jsx)(m.Z,{size:"small",variant:"contained",onClick:()=>E(!0),children:String(N("tasks.view.actions.approve")||"Approve")})]}):(0,i.jsx)(o.Z,{spacing:.5,children:(0,i.jsx)(r.Z,{variant:"body2",children:String(N("tasks.view.actions.noPartSelected"))})})]})})}),(0,i.jsx)(Y.Z,{open:C,toggle:()=>E(e=>{let t=!e;return e&&!t&&Q(),t}),taskId:A?Number(A):void 0,partId:B?Number(B):void 0,part:z,task:K})]})},W=()=>{var e,t;let{t:s}=(0,f.$G)(),{id:v}=(0,n.useRouter)().query,{user:p}=(0,P.a)(),{data:y,refetch:S}=(0,b.a)({queryKey:["task-part",v],enabled:!!v,queryFn:async()=>(await g.Do.get(Z.Z.taskPartById(v))).data}),Y=(null==y?void 0:y.task_detail)||void 0,W=(null==Y?void 0:Y.id)||(null==y?void 0:y.task),M=e=>{if(!e)return"—";let t="documents.status.".concat(e.split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")),i=String(s(t));return i===t?e:i};return y?(0,i.jsx)(a.Z,{children:(0,i.jsxs)(l.ZP,{container:!0,spacing:4,children:[(0,i.jsx)(l.ZP,{item:!0,xs:12,md:8,lg:9,children:(0,i.jsx)(d.Z,{children:(0,i.jsxs)(c.Z,{children:[(0,i.jsxs)(o.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,i.jsx)(r.Z,{variant:"h6",children:y.title||String(s("taskParts.view.title"))}),(0,i.jsxs)(o.Z,{direction:"row",spacing:1,alignItems:"center",children:[(0,i.jsx)(u.Z,{label:String(s("taskParts.view.status",{value:M(y.status)})),size:"small"}),y.start_date&&(0,i.jsx)(u.Z,{label:String(s("taskParts.view.startDate",{value:_()(y.start_date).format("DD.MM.YYYY HH:mm")})),size:"small"}),y.end_date&&(0,i.jsx)(u.Z,{label:String(s("taskParts.view.endDate",{value:_()(y.end_date).format("DD.MM.YYYY HH:mm")})),size:"small"})]})]}),(0,i.jsx)(x.Z,{sx:{my:3}}),(0,i.jsxs)(o.Z,{spacing:3,children:[(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.title"))}),(0,i.jsx)(r.Z,{children:y.title||"—"})]}),(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.department"))}),(0,i.jsx)(r.Z,{children:(null===(e=y.department_detail)||void 0===e?void 0:e.name)||"—"})]}),(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.assignee"))}),(0,i.jsx)(r.Z,{children:(null===(t=y.assignee_detail)||void 0===t?void 0:t.fullname)||"—"})]}),(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.status"))}),(0,i.jsx)(u.Z,{label:M(y.status),size:"small",color:"done"===y.status?"success":"cancelled"===y.status?"error":"in_progress"===y.status?"primary":"default"})]}),y.start_date&&(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.startDate"))}),(0,i.jsx)(r.Z,{children:_()(y.start_date).format("DD.MM.YYYY HH:mm")})]}),y.end_date&&(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.endDate"))}),(0,i.jsx)(r.Z,{children:_()(y.end_date).format("DD.MM.YYYY HH:mm")})]}),y.note&&(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.note"))}),(0,i.jsx)(r.Z,{children:y.note})]})]}),(0,i.jsx)(x.Z,{sx:{my:3}}),y.id&&(0,i.jsxs)(o.Z,{spacing:3,children:[(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"h6",sx:{mb:2},children:String(s("tasks.view.comments.title"))}),(0,i.jsx)(k.Z,{taskId:null,partId:y.id})]}),(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"h6",sx:{mb:2},children:String(s("tasks.view.attachments.title"))}),(0,i.jsx)(w.Z,{taskId:null,partId:y.id})]})]})]})})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,md:4,lg:3,children:(0,i.jsxs)(o.Z,{spacing:3,children:[(0,i.jsx)(d.Z,{children:(0,i.jsx)(c.Z,{children:(0,i.jsxs)(o.Z,{spacing:2,children:[(0,i.jsxs)(o.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,i.jsx)(r.Z,{variant:"subtitle1",children:String(s("taskParts.view.relatedTask"))}),W&&y.assignee!==(null==p?void 0:p.id)&&(0,i.jsx)(m.Z,{size:"small",variant:"outlined",component:h(),href:"/tasks/view/".concat(W),startIcon:(0,i.jsx)(j.Z,{icon:"mdi:eye"}),children:String(s("common.view"))})]}),(0,i.jsx)(x.Z,{}),Y?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.name"))}),(0,i.jsx)(r.Z,{children:Y.name||"—"})]}),(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.status"))}),(0,i.jsx)(u.Z,{label:M(Y.status),size:"small",color:"done"===Y.status?"success":"cancelled"===Y.status?"error":"in_progress"===Y.status?"primary":"default"})]}),(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.type"))}),(0,i.jsx)(r.Z,{children:(e=>{if(!e)return"—";let t="tasks.type.".concat(e),i=String(s(t));return i===t?e:i})(Y.type)})]}),(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.priority"))}),(0,i.jsx)(r.Z,{children:(e=>{if(!e)return"—";let t="tasks.priority.".concat("orgently"===e?"orgently":"normal"===e?"ordinary":e),i=String(s(t));return i===t?e:i})(Y.priority)})]}),Y.input_doc_number&&(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.inputDocNumber"))}),(0,i.jsx)(r.Z,{children:Y.input_doc_number})]}),Y.output_doc_number&&(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.outputDocNumber"))}),(0,i.jsx)(r.Z,{children:Y.output_doc_number})]}),Y.start_date&&(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.startDate"))}),(0,i.jsx)(r.Z,{children:_()(Y.start_date).format("DD.MM.YYYY")})]}),Y.end_date&&(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.endDate"))}),(0,i.jsx)(r.Z,{children:_()(Y.end_date).format("DD.MM.YYYY")})]}),Y.signed_by_detail&&(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.signedBy"))}),(0,i.jsx)(r.Z,{children:Y.signed_by_detail.fullname})]}),Y.department_detail&&(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.department"))}),(0,i.jsx)(r.Z,{children:Y.department_detail.name})]})]}):(0,i.jsx)(r.Z,{variant:"body2",color:"text.secondary",children:String(s("common.loading"))})]})})}),(0,i.jsx)(D,{task:Y,part:y,mutate:()=>{S()}})]})})]})}):(0,i.jsx)(a.Z,{children:(0,i.jsx)(r.Z,{children:String(s("common.loading"))})})};function M(){return(0,i.jsx)(W,{})}}},function(e){e.O(0,[4885,2785,9716,1421,3812,7555,2888,9774,179],function(){return e(e.s=8615)}),_N_E=e.O()}]);