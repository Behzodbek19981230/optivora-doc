(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3679],{8615:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/task-parts/view/[id]",function(){return s(12656)}])},12656:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return H}});var i=s(85893),n=s(11163),a=s(90642),r=s(96788),l=s(68573),d=s(60762),c=s(71919),o=s(84166),u=s(81873),x=s(56912),m=s(73907),v=s(41664),h=s.n(v),j=s(75673),Z=s(74538),g=s(52293),p=s(33934),b=s(22120),f=s(30381),k=s.n(f),y=s(96145),_=s(15822),w=s(47407),S=s(52311),P=s(32200),D=s(67294),Y=s(30202),W=s(34273),I=s(33971),M=e=>{var t,s,n,v,h,j,f,y,M,z,H,N;let{task:q,part:C,mutate:E}=e,{t:T}=(0,b.$G)(),{user:B}=(0,W.a)(),[F,K]=D.useState(!1),A=null==C?void 0:C.id,Q=(0,Y.NL)(),R=(null==C?void 0:null===(t=C.task_detail)||void 0===t?void 0:t.id)||(null==q?void 0:q.id),{data:G}=(0,p.a)({queryKey:["task",R],enabled:!!R,queryFn:async()=>(await g.Do.get(Z.Z.taskById(String(R)))).data}),O=G||q||(null==C?void 0:C.task_detail),{data:U}=(0,p.a)({queryKey:["task-parts",null!=R?R:"none"],enabled:!!R,queryFn:async()=>{let e=(await g.Do.get(Z.Z.taskPart,{task:String(R),limit:200})).data;return(null==e?void 0:e.results)||e||[]},initialData:[]}),X=(U||[]).filter(e=>(null==e?void 0:e.status)==="done"),[$,L]=D.useState(null);D.useEffect(()=>{null==$&&X.length&&L(X[0].id)},[X,$]);let V=async()=>{try{A&&(await Q.invalidateQueries({queryKey:["task-part",A],refetchType:"active"}),R&&(await Q.invalidateQueries({queryKey:["task-comments",R,A],refetchType:"active"}),await Q.invalidateQueries({queryKey:["task-attachments",R,A],refetchType:"active"})),null==E||E())}catch(e){console.error("mutateAndRefresh failed",e)}},J=e=>{if(!e)return"—";let t=k()(e);return t.isValid()?t.format("DD.MM.YYYY HH:mm"):String(e)},ee=e=>{let{label:t,value:s}=e;return(0,i.jsxs)(o.Z,{spacing:.75,children:[(0,i.jsx)(r.Z,{variant:"caption",color:"text.secondary",children:t}),(0,i.jsx)(r.Z,{variant:"body2",sx:{wordBreak:"break-word"},children:s||"—"})]})};return(0,i.jsxs)(a.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[O&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.Z,{children:(0,i.jsxs)(c.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle1",sx:{mb:2},children:String(T("tasks.view.document.sections.main"))}),(0,i.jsxs)(l.ZP,{container:!0,spacing:3,children:[(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(ee,{label:String(T("tasks.view.document.fields.company")),value:(null===(s=O.company_detail)||void 0===s?void 0:s.name)||O.company})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(ee,{label:String(T("tasks.view.document.fields.department")),value:(null===(n=O.department_detail)||void 0===n?void 0:n.name)||O.department})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(ee,{label:String(T("tasks.view.document.fields.taskForm")),value:(null===(v=O.task_form_detail)||void 0===v?void 0:v.name)||O.task_form})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(ee,{label:String(T("tasks.view.document.fields.magazine")),value:(null===(h=O.list_of_magazine_detail)||void 0===h?void 0:h.name)||O.list_of_magazine})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(ee,{label:String(T("tasks.view.document.fields.signedBy")),value:(null===(j=O.signed_by_detail)||void 0===j?void 0:j.fullname)||O.signed_by})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(ee,{label:String(T("tasks.view.document.fields.responsiblePerson")),value:null!==(z=O.respon_person)&&void 0!==z?z:"—"})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(ee,{label:String(T("tasks.view.document.fields.inputDocNumber")),value:null!==(H=O.input_doc_number)&&void 0!==H?H:"—"})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(ee,{label:String(T("tasks.view.document.fields.outputDocNumber")),value:null!==(N=O.output_doc_number)&&void 0!==N?N:"—"})})]})]})}),(0,i.jsx)(d.Z,{children:(0,i.jsxs)(c.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle1",sx:{mb:2},children:String(T("tasks.view.document.sections.dates"))}),(0,i.jsxs)(l.ZP,{container:!0,spacing:3,children:[(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(ee,{label:String(T("tasks.view.document.fields.startDate")),value:J(O.start_date)})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(ee,{label:String(T("tasks.view.document.fields.endDate")),value:J(O.end_date)})})]}),(0,i.jsx)(x.Z,{sx:{my:3}}),(0,i.jsx)(r.Z,{variant:"subtitle1",sx:{mb:2},children:String(T("tasks.view.document.sections.system"))}),(0,i.jsxs)(l.ZP,{container:!0,spacing:3,children:[(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(ee,{label:String(T("tasks.view.document.fields.createdAt")),value:O.created_time?k()(O.created_time).format("DD.MM.YYYY HH:mm"):"—"})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(ee,{label:String(T("tasks.view.document.fields.createdBy")),value:(null===(f=O.created_by_detail)||void 0===f?void 0:f.fullname)||O.created_by})})]})]})})]}),(0,i.jsx)(d.Z,{children:(0,i.jsx)(c.Z,{children:(0,i.jsxs)(o.Z,{spacing:2,children:[(0,i.jsx)(r.Z,{variant:"subtitle1",children:String(T("tasks.view.actions.title"))}),(0,i.jsx)(x.Z,{}),A?(0,i.jsxs)(o.Z,{spacing:1,children:[(0,i.jsx)(r.Z,{variant:"caption",color:"text.secondary",children:String(T("tasks.view.actions.selectedSection"))}),(0,i.jsx)(o.Z,{direction:"row",spacing:1,alignItems:"center",children:(0,i.jsx)(r.Z,{variant:"body2",children:(null==C?void 0:C.title)||String(T("common.notSet"))})}),(0,i.jsx)(r.Z,{variant:"caption",color:"text.secondary",children:String(T("tasks.view.actions.partStatus"))}),(0,i.jsx)(o.Z,{direction:"row",spacing:1,alignItems:"center",children:(null==C?void 0:C.status)?(0,i.jsx)(u.Z,{size:"small",color:"info",variant:"outlined",label:(()=>{let e="documents.status.".concat(C.status.split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")),t=String(T(e));return t===e?C.status:t})()}):null}),(null==B?void 0:B.id)===(null==C?void 0:null===(y=C.assignee_detail)||void 0===y?void 0:y.id)&&A&&((null==C?void 0:C.status)==="new"||(null==C?void 0:C.status)==="in_progress"||(null==C?void 0:C.status)==="returned")&&(0,i.jsx)(m.Z,{size:"small",variant:"contained",onClick:()=>K(!0),children:String(T("tasks.view.actions.ensureExecution")||"Ensure execution")}),(null==B?void 0:B.id)===(null==O?void 0:null===(M=O.signed_by_detail)||void 0===M?void 0:M.id)&&A&&(null==C?void 0:C.status)==="on_review"&&(0,i.jsx)(m.Z,{size:"small",variant:"contained",onClick:()=>K(!0),children:String(T("tasks.view.actions.approve")||"Approve")})]}):(0,i.jsx)(o.Z,{spacing:.5,children:(0,i.jsx)(r.Z,{variant:"body2",children:String(T("tasks.view.actions.noPartSelected"))})})]})})}),R?(0,i.jsx)(d.Z,{children:(0,i.jsx)(c.Z,{children:(0,i.jsxs)(o.Z,{spacing:2,children:[(0,i.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:2},children:[(0,i.jsxs)(r.Z,{variant:"subtitle1",children:[String(T("documents.status.done"))," ",String(T("tasks.view.actions.selectedSection"))]}),(0,i.jsx)(u.Z,{size:"small",color:"success",variant:"outlined",label:X.length})]}),X.length?(0,i.jsx)(w.Z,{dense:!0,disablePadding:!0,children:X.map(e=>{var t,s;let n=(null===(t=e.department_detail)||void 0===t?void 0:t.name)||String(e.department),a=(null===(s=e.assignee_detail)||void 0===s?void 0:s.fullname)||String(e.assignee);return(0,i.jsx)(S.Z,{selected:e.id===$,onClick:()=>L(e.id),sx:{borderRadius:2,mb:.5},children:(0,i.jsx)(P.Z,{primary:e.title||"#".concat(e.id),secondary:"".concat(n," • ").concat(a),primaryTypographyProps:{variant:"body2",fontWeight:700},secondaryTypographyProps:{variant:"caption",color:"text.secondary"}})},e.id)})}):(0,i.jsx)(r.Z,{variant:"body2",color:"text.secondary",children:String(T("tasks.view.actions.noPartSelected"))}),$?(0,i.jsx)(_.Z,{taskId:R,partId:$}):(0,i.jsx)(r.Z,{variant:"body2",color:"text.secondary",children:String(T("tasks.view.attachments.empty"))})]})})}):null,(0,i.jsx)(I.Z,{open:F,toggle:()=>K(e=>{let t=!e;return e&&!t&&V(),t}),taskId:R?Number(R):void 0,partId:A?Number(A):void 0,part:C,task:O})]})},z=()=>{var e,t;let{t:s}=(0,b.$G)(),{id:v}=(0,n.useRouter)().query,{user:f}=(0,W.a)(),{data:w,refetch:S}=(0,p.a)({queryKey:["task-part",v],enabled:!!v,queryFn:async()=>(await g.Do.get(Z.Z.taskPartById(v))).data}),P=(null==w?void 0:w.task_detail)||void 0,D=(null==P?void 0:P.id)||(null==w?void 0:w.task),Y=e=>{if(!e)return"—";let t="documents.status.".concat(e.split("_").map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")),i=String(s(t));return i===t?e:i};return w?(0,i.jsx)(a.Z,{children:(0,i.jsxs)(l.ZP,{container:!0,spacing:4,children:[(0,i.jsx)(l.ZP,{item:!0,xs:12,md:8,lg:9,children:(0,i.jsx)(d.Z,{children:(0,i.jsxs)(c.Z,{children:[(0,i.jsxs)(o.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,i.jsx)(r.Z,{variant:"h6",children:w.title||String(s("taskParts.view.title"))}),(0,i.jsxs)(o.Z,{direction:"row",spacing:1,alignItems:"center",children:[(0,i.jsx)(u.Z,{label:String(s("taskParts.view.status",{value:Y(w.status)})),size:"small"}),w.start_date&&(0,i.jsx)(u.Z,{label:String(s("taskParts.view.startDate",{value:k()(w.start_date).format("DD.MM.YYYY HH:mm")})),size:"small"}),w.end_date&&(0,i.jsx)(u.Z,{label:String(s("taskParts.view.endDate",{value:k()(w.end_date).format("DD.MM.YYYY HH:mm")})),size:"small"})]})]}),(0,i.jsx)(x.Z,{sx:{my:3}}),(0,i.jsxs)(o.Z,{spacing:3,children:[(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.title"))}),(0,i.jsx)(r.Z,{children:w.title||"—"})]}),(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.department"))}),(0,i.jsx)(r.Z,{children:(null===(e=w.department_detail)||void 0===e?void 0:e.name)||"—"})]}),(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.assignee"))}),(0,i.jsx)(r.Z,{children:(null===(t=w.assignee_detail)||void 0===t?void 0:t.fullname)||"—"})]}),(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.status"))}),(0,i.jsx)(u.Z,{label:Y(w.status),size:"small",color:"done"===w.status?"success":"cancelled"===w.status?"error":"in_progress"===w.status?"primary":"default"})]}),w.start_date&&(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.startDate"))}),(0,i.jsx)(r.Z,{children:k()(w.start_date).format("DD.MM.YYYY HH:mm")})]}),w.end_date&&(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.endDate"))}),(0,i.jsx)(r.Z,{children:k()(w.end_date).format("DD.MM.YYYY HH:mm")})]}),w.note&&(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.note"))}),(0,i.jsx)(r.Z,{children:w.note})]})]}),(0,i.jsx)(x.Z,{sx:{my:3}}),w.id&&(0,i.jsxs)(o.Z,{spacing:3,children:[(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"h6",sx:{mb:2},children:String(s("tasks.view.comments.title"))}),(0,i.jsx)(y.Z,{taskId:null,partId:w.id})]}),(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"h6",sx:{mb:2},children:String(s("tasks.view.attachments.title"))}),(0,i.jsx)(_.Z,{taskId:null,partId:w.id})]})]})]})})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,md:4,lg:3,children:(0,i.jsxs)(o.Z,{spacing:3,children:[(0,i.jsx)(d.Z,{children:(0,i.jsx)(c.Z,{children:(0,i.jsxs)(o.Z,{spacing:2,children:[(0,i.jsxs)(o.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,i.jsx)(r.Z,{variant:"subtitle1",children:String(s("taskParts.view.relatedTask"))}),D&&w.assignee!==(null==f?void 0:f.id)&&(0,i.jsx)(m.Z,{size:"small",variant:"outlined",component:h(),href:"/tasks/view/".concat(D),startIcon:(0,i.jsx)(j.Z,{icon:"mdi:eye"}),children:String(s("common.view"))})]}),(0,i.jsx)(x.Z,{}),P?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.name"))}),(0,i.jsx)(r.Z,{children:P.name||"—"})]}),(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.status"))}),(0,i.jsx)(u.Z,{label:Y(P.status),size:"small",color:"done"===P.status?"success":"cancelled"===P.status?"error":"in_progress"===P.status?"primary":"default"})]}),(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.type"))}),(0,i.jsx)(r.Z,{children:(e=>{if(!e)return"—";let t="tasks.type.".concat(e),i=String(s(t));return i===t?e:i})(P.type)})]}),(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.priority"))}),(0,i.jsx)(r.Z,{children:(e=>{if(!e)return"—";let t="tasks.priority.".concat("orgently"===e?"orgently":"normal"===e?"ordinary":e),i=String(s(t));return i===t?e:i})(P.priority)})]}),P.input_doc_number&&(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.inputDocNumber"))}),(0,i.jsx)(r.Z,{children:P.input_doc_number})]}),P.output_doc_number&&(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.outputDocNumber"))}),(0,i.jsx)(r.Z,{children:P.output_doc_number})]}),P.start_date&&(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.startDate"))}),(0,i.jsx)(r.Z,{children:k()(P.start_date).format("DD.MM.YYYY")})]}),P.end_date&&(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.endDate"))}),(0,i.jsx)(r.Z,{children:k()(P.end_date).format("DD.MM.YYYY")})]}),P.signed_by_detail&&(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.signedBy"))}),(0,i.jsx)(r.Z,{children:P.signed_by_detail.fullname})]}),P.department_detail&&(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(r.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.department"))}),(0,i.jsx)(r.Z,{children:P.department_detail.name})]})]}):(0,i.jsx)(r.Z,{variant:"body2",color:"text.secondary",children:String(s("common.loading"))})]})})}),(0,i.jsx)(M,{task:P,part:w,mutate:()=>{S()}})]})})]})}):(0,i.jsx)(a.Z,{children:(0,i.jsx)(r.Z,{children:String(s("common.loading"))})})};function H(){return(0,i.jsx)(z,{})}}},function(e){e.O(0,[4885,2785,9716,1421,1377,7555,2888,9774,179],function(){return e(e.s=8615)}),_N_E=e.O()}]);