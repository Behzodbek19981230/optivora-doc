(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3679],{8615:function(t,e,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/task-parts/view/[id]",function(){return s(12656)}])},12656:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return I}});var i=s(85893),n=s(11163),r=s(90642),a=s(96788),l=s(68573),d=s(60762),c=s(71919),o=s(84166),u=s(81873),x=s(56912),h=s(73907),j=s(41664),m=s.n(j),v=s(75673),Z=s(74538),g=s(52293),f=s(33934),p=s(22120),b=s(30381),k=s.n(b),w=s(96145),_=s(15822),y=s(67294),S=s(30202),Y=s(34273),D=s(33971),P=t=>{var e,s;let{task:n,part:l,mutate:j}=t,{t:m}=(0,p.$G)(),{user:v}=(0,Y.a)(),[Z,g]=y.useState(!1),f=null==n?void 0:n.id,b=null==l?void 0:l.id,k=(0,S.NL)(),w=async()=>{try{b&&(await k.invalidateQueries({queryKey:["task-part",b],refetchType:"active"}),f&&(await k.invalidateQueries({queryKey:["task-comments",f,b],refetchType:"active"}),await k.invalidateQueries({queryKey:["task-attachments",f,b],refetchType:"active"})),null==j||j())}catch(t){console.error("mutateAndRefresh failed",t)}};return(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,i.jsx)(d.Z,{children:(0,i.jsx)(c.Z,{children:(0,i.jsxs)(o.Z,{spacing:2,children:[(0,i.jsx)(a.Z,{variant:"subtitle1",children:String(m("tasks.view.actions.title"))}),(0,i.jsx)(x.Z,{}),b?(0,i.jsxs)(o.Z,{spacing:1,children:[(0,i.jsx)(a.Z,{variant:"caption",color:"text.secondary",children:String(m("tasks.view.actions.selectedSection"))}),(0,i.jsx)(o.Z,{direction:"row",spacing:1,alignItems:"center",children:(0,i.jsx)(a.Z,{variant:"body2",children:(null==l?void 0:l.title)||String(m("common.notSet"))})}),(0,i.jsx)(a.Z,{variant:"caption",color:"text.secondary",children:String(m("tasks.view.actions.partStatus"))}),(0,i.jsx)(o.Z,{direction:"row",spacing:1,alignItems:"center",children:(null==l?void 0:l.status)?(0,i.jsx)(u.Z,{size:"small",color:"info",variant:"outlined",label:(()=>{let t="documents.status.".concat(l.status.split("_").map((t,e)=>0===e?t:t.charAt(0).toUpperCase()+t.slice(1)).join("")),e=String(m(t));return e===t?l.status:e})()}):null}),(null==v?void 0:v.id)===(null==l?void 0:null===(e=l.assignee_detail)||void 0===e?void 0:e.id)&&b&&((null==l?void 0:l.status)==="new"||(null==l?void 0:l.status)==="in_progress"||(null==l?void 0:l.status)==="returned")&&(0,i.jsx)(h.Z,{size:"small",variant:"contained",onClick:()=>g(!0),children:String(m("tasks.view.actions.ensureExecution")||"Ensure execution")}),(null==v?void 0:v.id)===(null==n?void 0:null===(s=n.signed_by_detail)||void 0===s?void 0:s.id)&&b&&(null==l?void 0:l.status)==="on_review"&&(0,i.jsx)(h.Z,{size:"small",variant:"contained",onClick:()=>g(!0),children:String(m("tasks.view.actions.approve")||"Approve")})]}):(0,i.jsx)(o.Z,{spacing:.5,children:(0,i.jsx)(a.Z,{variant:"body2",children:String(m("tasks.view.actions.noPartSelected"))})})]})})}),(0,i.jsx)(D.Z,{open:Z,toggle:()=>g(t=>{let e=!t;return t&&!e&&w(),e}),taskId:void 0,partId:b?Number(b):void 0,part:l,task:n})]})},W=()=>{var t,e;let{t:s}=(0,p.$G)(),{id:j}=(0,n.useRouter)().query,{data:b,refetch:y}=(0,f.a)({queryKey:["task-part",j],enabled:!!j,queryFn:async()=>(await g.Do.get(Z.Z.taskPartById(j))).data}),S=(null==b?void 0:b.task_detail)||void 0,Y=(null==S?void 0:S.id)||(null==b?void 0:b.task),D=t=>{if(!t)return"—";let e="documents.status.".concat(t.split("_").map((t,e)=>0===e?t:t.charAt(0).toUpperCase()+t.slice(1)).join("")),i=String(s(e));return i===e?t:i};return b?(0,i.jsx)(r.Z,{children:(0,i.jsxs)(l.ZP,{container:!0,spacing:4,children:[(0,i.jsx)(l.ZP,{item:!0,xs:12,md:8,lg:9,children:(0,i.jsx)(d.Z,{children:(0,i.jsxs)(c.Z,{children:[(0,i.jsxs)(o.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,i.jsx)(a.Z,{variant:"h6",children:b.title||String(s("taskParts.view.title"))}),(0,i.jsxs)(o.Z,{direction:"row",spacing:1,alignItems:"center",children:[(0,i.jsx)(u.Z,{label:String(s("taskParts.view.status",{value:D(b.status)})),size:"small"}),b.start_date&&(0,i.jsx)(u.Z,{label:String(s("taskParts.view.startDate",{value:k()(b.start_date).format("DD.MM.YYYY HH:mm")})),size:"small"}),b.end_date&&(0,i.jsx)(u.Z,{label:String(s("taskParts.view.endDate",{value:k()(b.end_date).format("DD.MM.YYYY HH:mm")})),size:"small"})]})]}),(0,i.jsx)(x.Z,{sx:{my:3}}),(0,i.jsxs)(o.Z,{spacing:3,children:[(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.title"))}),(0,i.jsx)(a.Z,{children:b.title||"—"})]}),(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.department"))}),(0,i.jsx)(a.Z,{children:(null===(t=b.department_detail)||void 0===t?void 0:t.name)||"—"})]}),(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.assignee"))}),(0,i.jsx)(a.Z,{children:(null===(e=b.assignee_detail)||void 0===e?void 0:e.fullname)||"—"})]}),(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.status"))}),(0,i.jsx)(u.Z,{label:D(b.status),size:"small",color:"done"===b.status?"success":"cancelled"===b.status?"error":"in_progress"===b.status?"primary":"default"})]}),b.start_date&&(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.startDate"))}),(0,i.jsx)(a.Z,{children:k()(b.start_date).format("DD.MM.YYYY HH:mm")})]}),b.end_date&&(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.endDate"))}),(0,i.jsx)(a.Z,{children:k()(b.end_date).format("DD.MM.YYYY HH:mm")})]}),b.note&&(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("taskParts.view.fields.note"))}),(0,i.jsx)(a.Z,{children:b.note})]})]}),(0,i.jsx)(x.Z,{sx:{my:3}}),b.id&&(0,i.jsxs)(o.Z,{spacing:3,children:[(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{variant:"h6",sx:{mb:2},children:String(s("tasks.view.comments.title"))}),(0,i.jsx)(w.Z,{taskId:null,partId:b.id})]}),(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{variant:"h6",sx:{mb:2},children:String(s("tasks.view.attachments.title"))}),(0,i.jsx)(_.Z,{taskId:null,partId:b.id})]})]})]})})}),(0,i.jsx)(l.ZP,{item:!0,xs:12,md:4,lg:3,children:(0,i.jsxs)(o.Z,{spacing:3,children:[(0,i.jsx)(d.Z,{children:(0,i.jsx)(c.Z,{children:(0,i.jsxs)(o.Z,{spacing:2,children:[(0,i.jsxs)(o.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,i.jsx)(a.Z,{variant:"subtitle1",children:String(s("taskParts.view.relatedTask"))}),Y&&(0,i.jsx)(h.Z,{size:"small",variant:"outlined",component:m(),href:"/tasks/view/".concat(Y),startIcon:(0,i.jsx)(v.Z,{icon:"mdi:eye"}),children:String(s("common.view"))})]}),(0,i.jsx)(x.Z,{}),S?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.name"))}),(0,i.jsx)(a.Z,{children:S.name||"—"})]}),(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.status"))}),(0,i.jsx)(u.Z,{label:D(S.status),size:"small",color:"done"===S.status?"success":"cancelled"===S.status?"error":"in_progress"===S.status?"primary":"default"})]}),(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.type"))}),(0,i.jsx)(a.Z,{children:(t=>{if(!t)return"—";let e="tasks.type.".concat(t),i=String(s(e));return i===e?t:i})(S.type)})]}),(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.priority"))}),(0,i.jsx)(a.Z,{children:(t=>{if(!t)return"—";let e="tasks.priority.".concat("orgently"===t?"orgently":"normal"===t?"ordinary":t),i=String(s(e));return i===e?t:i})(S.priority)})]}),S.input_doc_number&&(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.inputDocNumber"))}),(0,i.jsx)(a.Z,{children:S.input_doc_number})]}),S.output_doc_number&&(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.outputDocNumber"))}),(0,i.jsx)(a.Z,{children:S.output_doc_number})]}),S.start_date&&(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.startDate"))}),(0,i.jsx)(a.Z,{children:k()(S.start_date).format("DD.MM.YYYY")})]}),S.end_date&&(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.endDate"))}),(0,i.jsx)(a.Z,{children:k()(S.end_date).format("DD.MM.YYYY")})]}),S.signed_by_detail&&(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.signedBy"))}),(0,i.jsx)(a.Z,{children:S.signed_by_detail.fullname})]}),S.department_detail&&(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{variant:"subtitle2",sx:{mb:1,fontWeight:700},children:String(s("tasks.view.document.fields.department"))}),(0,i.jsx)(a.Z,{children:S.department_detail.name})]})]}):(0,i.jsx)(a.Z,{variant:"body2",color:"text.secondary",children:String(s("common.loading"))})]})})}),(0,i.jsx)(P,{task:S,part:b,mutate:()=>{y()}})]})})]})}):(0,i.jsx)(r.Z,{children:(0,i.jsx)(a.Z,{children:String(s("common.loading"))})})};function I(){return(0,i.jsx)(W,{})}}},function(t){t.O(0,[4885,2785,9716,1421,3812,7555,2888,9774,179],function(){return t(t.s=8615)}),_N_E=t.O()}]);