(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2892],{66249:function(e,r,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/users",function(){return i(2986)}])},96727:function(e,r,i){"use strict";i.d(r,{Z:function(){return v}});var l=i(63366),n=i(87462),a=i(67294),t=i(86010),o=i(94780),s=i(77527),d=i(29567),c=i(1588),u=i(34867);function m(e){return(0,u.Z)("MuiDialogActions",e)}(0,c.Z)("MuiDialogActions",["root","spacing"]);var h=i(85893);let x=["className","disableSpacing"],p=e=>{let{classes:r,disableSpacing:i}=e;return(0,o.Z)({root:["root",!i&&"spacing"]},m,r)},f=(0,s.ZP)("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(e,r)=>{let{ownerState:i}=e;return[r.root,!i.disableSpacing&&r.spacing]}})(e=>{let{ownerState:r}=e;return(0,n.Z)({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto"},!r.disableSpacing&&{"& > :not(:first-of-type)":{marginLeft:8}})});var v=a.forwardRef(function(e,r){let i=(0,d.Z)({props:e,name:"MuiDialogActions"}),{className:a,disableSpacing:o=!1}=i,s=(0,l.Z)(i,x),c=(0,n.Z)({},i,{disableSpacing:o}),u=p(c);return(0,h.jsx)(f,(0,n.Z)({className:(0,t.Z)(u.root,a),ownerState:c,ref:r},s))})},40110:function(e,r,i){"use strict";i.d(r,{Z:function(){return j}});var l=i(63366),n=i(87462),a=i(67294),t=i(86010),o=i(94780),s=i(77527),d=i(29567),c=i(1588),u=i(34867);function m(e){return(0,u.Z)("MuiDialogContent",e)}(0,c.Z)("MuiDialogContent",["root","dividers"]);var h=i(67184),x=i(85893);let p=["className","dividers"],f=e=>{let{classes:r,dividers:i}=e;return(0,o.Z)({root:["root",i&&"dividers"]},m,r)},v=(0,s.ZP)("div",{name:"MuiDialogContent",slot:"Root",overridesResolver:(e,r)=>{let{ownerState:i}=e;return[r.root,i.dividers&&r.dividers]}})(e=>{let{theme:r,ownerState:i}=e;return(0,n.Z)({flex:"1 1 auto",WebkitOverflowScrolling:"touch",overflowY:"auto",padding:"20px 24px"},i.dividers?{padding:"16px 24px",borderTop:"1px solid ".concat((r.vars||r).palette.divider),borderBottom:"1px solid ".concat((r.vars||r).palette.divider)}:{[".".concat(h.Z.root," + &")]:{paddingTop:0}})});var j=a.forwardRef(function(e,r){let i=(0,d.Z)({props:e,name:"MuiDialogContent"}),{className:a,dividers:o=!1}=i,s=(0,l.Z)(i,p),c=(0,n.Z)({},i,{dividers:o}),u=f(c);return(0,x.jsx)(v,(0,n.Z)({className:(0,t.Z)(u.root,a),ownerState:c,ref:r},s))})},92365:function(e,r,i){"use strict";var l=i(87462),n=i(63366),a=i(67294),t=i(86010),o=i(94780),s=i(96788),d=i(77527),c=i(29567),u=i(67184),m=i(8984),h=i(85893);let x=["className","id"],p=e=>{let{classes:r}=e;return(0,o.Z)({root:["root"]},u.a,r)},f=(0,d.ZP)(s.Z,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(e,r)=>r.root})({padding:"16px 24px",flex:"0 0 auto"}),v=a.forwardRef(function(e,r){let i=(0,c.Z)({props:e,name:"MuiDialogTitle"}),{className:o,id:s}=i,d=(0,n.Z)(i,x),u=p(i),{titleId:v=s}=a.useContext(m.Z);return(0,h.jsx)(f,(0,l.Z)({component:"h2",className:(0,t.Z)(u.root,o),ownerState:i,ref:r,variant:"h6",id:null!=s?s:v},d))});r.Z=v},67184:function(e,r,i){"use strict";i.d(r,{a:function(){return a}});var l=i(1588),n=i(34867);function a(e){return(0,n.Z)("MuiDialogTitle",e)}let t=(0,l.Z)("MuiDialogTitle",["root"]);r.Z=t},2986:function(e,r,i){"use strict";i.r(r),i.d(r,{default:function(){return O}});var l=i(85893),n=i(67294),a=i(11163),t=i(81873),o=i(52857),s=i(60762),d=i(34375),c=i(73907),u=i(28634),m=i(90142),h=i(75673),x=i(33251),p=i(74538),f=i(52293),v=i(9198),j=i.n(v);i(5843);var Z=i(87536),g=i(33453),y=i(92365),b=i(40110),w=i(96727),S=i(68573),P=i(12467),C=i(15903),_=i(6897),k=i(85533),M=i(12283),W=i(15972),R=i(13539),D=i(65806),N=i(7879),F=i(86501),T=i(81342),q=i(34273),Q=i(55421);let z={username:"",fullname:"",is_active:!0,date_of_birthday:"",gender:"",phone_number:"",avatar:"",email:"",role:"user",password:"",region:0,district:0,address:"",companies:[]};var E=e=>{let{open:r,onClose:i,onSaved:a,mode:t,item:o}=e,{control:s,handleSubmit:d,reset:u,watch:h,formState:{isSubmitting:v,errors:E}}=(0,Z.cI)({defaultValues:z}),{user:I}=(0,q.a)(),{data:O=[]}=(0,x.z)(p.Z.region,{perPage:100}),A=h("region"),L=A?"".concat(p.Z.district,"?region=").concat(A):p.Z.district,{data:U=[]}=(0,x.z)(L,{perPage:200}),{data:B=[]}=(0,x.z)(p.Z.company,{perPage:200}),[H,Y]=(0,n.useState)(null),K=(0,n.useRef)(null),[X,G]=(0,n.useState)("");(0,n.useEffect)(()=>{"edit"===t&&o?(u({...o,password:""}),G(o.avatar||"")):(u(z),G(""))},[t,o,u]),(0,n.useEffect)(()=>{if(H){let e=URL.createObjectURL(H);return G(e),()=>URL.revokeObjectURL(e)}},[H]);let J=async e=>{try{console.log(H);let r={...e};if(r.password||delete r.password,"create"===t){let r=new FormData;H&&r.append("avatar",H),Object.keys(e).forEach(i=>{"companies"==i?e.companies.forEach(e=>{r.append("companies",e.toString())}):r.append(i,e[i])}),await f.Do.postForm(p.Z.users,r)}else if("edit"===t&&(null==o?void 0:o.id)){let r=new FormData;Object.keys(e).forEach(i=>{if("companies"==i)e.companies.forEach((e,i)=>{r.append("companies",e.toString())});else{if("avatar"==i)return;r.append(i,e[i])}}),H&&r.append("avatar",H),await f.Do.putForm(p.Z.userById(o.id),r)}F.ZP.success("Foydalanuvchi saqlandi"),a(),i()}catch(e){console.error("Failed to save user:",e),F.ZP.error("Saqlashda xato")}};return(0,l.jsxs)(g.Z,{open:r,onClose:v?void 0:i,fullWidth:!0,maxWidth:"md",children:[(0,l.jsx)(y.Z,{children:"create"===t?"Foydalanuvchi qo‘shish":"Foydalanuvchini tahrirlash"}),(0,l.jsxs)("form",{onSubmit:d(J),children:[(0,l.jsx)(b.Z,{children:(0,l.jsx)(T.Z,{children:(0,l.jsxs)(S.ZP,{container:!0,spacing:4,children:[(0,l.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,l.jsx)(Z.Qr,{name:"username",control:s,rules:{required:"Majburiy maydon"},render:e=>{var r;let{field:i}=e;return(0,l.jsx)(N.Z,{fullWidth:!0,label:"Login",...i,error:!!E.username,helperText:null===(r=E.username)||void 0===r?void 0:r.message})}})}),(0,l.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,l.jsx)(Z.Qr,{name:"fullname",control:s,rules:{required:"Majburiy maydon"},render:e=>{var r;let{field:i}=e;return(0,l.jsx)(N.Z,{fullWidth:!0,label:"F.I.Sh",...i,error:!!E.fullname,helperText:null===(r=E.fullname)||void 0===r?void 0:r.message})}})}),(0,l.jsx)(S.ZP,{item:!0,xs:12,children:(0,l.jsx)(Z.Qr,{name:"is_active",control:s,render:e=>{let{field:r}=e;return(0,l.jsx)(D.Z,{control:(0,l.jsx)(R.Z,{checked:!!r.value,onChange:(e,i)=>r.onChange(i)}),label:"Faol"})}})}),(0,l.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,l.jsx)(Z.Qr,{name:"email",control:s,rules:{required:"Majburiy maydon"},render:e=>{var r;let{field:i}=e;return(0,l.jsx)(N.Z,{fullWidth:!0,type:"email",label:"Email",...i,error:!!E.email,helperText:null===(r=E.email)||void 0===r?void 0:r.message})}})}),(0,l.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,l.jsx)(Z.Qr,{name:"phone_number",control:s,render:e=>{let{field:r}=e;return(0,l.jsx)(N.Z,{fullWidth:!0,label:"Telefon",...r})}})}),(0,l.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,l.jsx)(Z.Qr,{name:"date_of_birthday",control:s,render:e=>{let{field:r}=e,i=r.value?new Date(r.value):null;return(0,l.jsx)("div",{children:(0,l.jsx)(j(),{selected:i,onChange:e=>r.onChange(e?e.toISOString().slice(0,10):""),dateFormat:"yyyy-MM-dd",customInput:(0,l.jsx)(N.Z,{label:"Tug‘ilgan sana",fullWidth:!0}),showPopperArrow:!0,isClearable:!0})})}})}),(0,l.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,l.jsx)(Z.Qr,{name:"gender",control:s,rules:{required:"Majburiy maydon"},render:e=>{let{field:r}=e;return(0,l.jsxs)(_.Z,{error:!!E.gender,children:[(0,l.jsx)(k.Z,{children:"Jinsi"}),(0,l.jsxs)(C.Z,{row:!0,...r,children:[(0,l.jsx)(D.Z,{value:"male",control:(0,l.jsx)(P.Z,{}),label:"Erkak"}),(0,l.jsx)(D.Z,{value:"female",control:(0,l.jsx)(P.Z,{}),label:"Ayol"})]}),E.gender&&(0,l.jsx)(M.Z,{children:E.gender.message})]})}})}),(0,l.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,l.jsx)(Z.Qr,{name:"role",control:s,rules:{required:"Majburiy maydon"},render:e=>{var r;let{field:i}=e;return(0,l.jsxs)(N.Z,{select:!0,fullWidth:!0,label:"Rol",...i,error:!!E.role,helperText:null===(r=E.role)||void 0===r?void 0:r.message,children:[(0,l.jsx)(W.Z,{value:"1",children:"Admin"}),(0,l.jsx)(W.Z,{value:"2",children:"Manager"}),(0,l.jsx)(W.Z,{value:"3",children:"User"})]})}})}),(0,l.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,l.jsx)(Z.Qr,{name:"password",control:s,render:e=>{let{field:r}=e;return(0,l.jsx)(N.Z,{fullWidth:!0,type:"password",label:"Parol",...r})}})}),(0,l.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,l.jsx)(Z.Qr,{name:"region",control:s,rules:{required:"Majburiy maydon"},render:e=>{var r;let{field:i}=e;return(0,l.jsx)(N.Z,{select:!0,fullWidth:!0,label:"Viloyat",...i,error:!!E.region,helperText:null===(r=E.region)||void 0===r?void 0:r.message,children:O.map(e=>(0,l.jsx)(W.Z,{value:e.id,children:e.name_uz||e.name},e.id))})}})}),(0,l.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,l.jsx)(Z.Qr,{name:"district",control:s,rules:{required:"Majburiy maydon"},render:e=>{var r;let{field:i}=e;return(0,l.jsx)(N.Z,{select:!0,fullWidth:!0,label:"Tuman",...i,error:!!E.district,helperText:null===(r=E.district)||void 0===r?void 0:r.message,children:U.map(e=>(0,l.jsx)(W.Z,{value:e.id,children:e.name_uz||e.name},e.id))})}})}),(0,l.jsx)(S.ZP,{item:!0,xs:12,children:(0,l.jsx)(Z.Qr,{name:"address",control:s,render:e=>{let{field:r}=e;return(0,l.jsx)(N.Z,{fullWidth:!0,label:"Manzil",...r})}})}),(0,l.jsx)(S.ZP,{item:!0,xs:12,children:(0,l.jsx)(Z.Qr,{name:"companies",control:s,render:e=>{let{field:r}=e;return(0,l.jsx)(N.Z,{select:!0,fullWidth:!0,label:"Kompaniyalar",...r,SelectProps:{multiple:!0},children:B.map(e=>(0,l.jsx)(W.Z,{value:e.id,children:e.name},e.id))})}})}),(0,l.jsxs)(S.ZP,{item:!0,xs:12,children:[(0,l.jsx)("input",{ref:K,hidden:!0,type:"file",accept:"image/*",onChange:e=>{var r;return Y((null===(r=e.target.files)||void 0===r?void 0:r[0])||null)}}),(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,l.jsx)(m.Z,{src:X||void 0,variant:"circular",onClick:()=>{var e;return null===(e=K.current)||void 0===e?void 0:e.click()},sx:{width:96,height:96,cursor:"pointer",borderRadius:"50%","& img":{width:"100%",height:"100%",objectFit:"cover"}},children:(0,Q.Q)(h("fullname")||h("username")||"U")}),(0,l.jsx)(c.Z,{variant:"outlined",onClick:()=>{var e;return null===(e=K.current)||void 0===e?void 0:e.click()},children:"Rasmni yuklash"}),X&&(0,l.jsx)(c.Z,{variant:"text",color:"secondary",onClick:()=>{Y(null),G((null==o?void 0:o.avatar)||"")},children:"Bekor qilish"})]})]})]})})}),(0,l.jsxs)(w.Z,{children:[(0,l.jsx)(c.Z,{type:"button",variant:"tonal",color:"secondary",onClick:i,disabled:v,children:"Bekor qilish"}),(0,l.jsx)(c.Z,{type:"submit",disabled:v,children:v?"Saqlanmoqda…":"Saqlash"})]})]})]})},I=()=>{let e=(0,a.useRouter)(),[r,i]=(0,n.useState)({page:0,pageSize:10}),{data:v=[],loading:j,mutate:Z}=(0,x.z)(p.Z.users,{perPage:r.pageSize,page:r.page+1}),[g,y]=(0,n.useState)(!1),[b,w]=(0,n.useState)(null),S=e=>{w(e),y(!0)},P=async e=>{await f.Do.delete(p.Z.userById(e)),Z()},C=e=>e.avatar?(0,l.jsx)(m.Z,{src:e.avatar,variant:"circular",sx:{mr:2.5,width:38,height:38,borderRadius:"50%","& img":{width:"100%",height:"100%",objectFit:"cover"}}}):(0,l.jsx)(m.Z,{skin:"light",color:"primary",sx:{mr:2.5,width:38,height:38,fontWeight:500},children:(0,Q.Q)(e.fullname||e.username)}),_=[{field:"fullname",headerName:"F.I.Sh",flex:.25,minWidth:220,renderCell:e=>{let r=e.row;return(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[C(r),(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,l.jsx)("span",{style:{fontWeight:500},children:r.fullname||r.username}),(0,l.jsx)("span",{style:{color:"gray",fontSize:12},children:r.email})]})]})}},{field:"username",headerName:"Login",flex:.15,minWidth:140},{field:"role",headerName:"Rol",flex:.12,minWidth:120},{field:"phone_number",headerName:"Telefon",flex:.18,minWidth:160},{field:"is_active",headerName:"Faol",flex:.1,minWidth:100,valueGetter:e=>e.row.is_active?"Ha":"Yo‘q"},{field:"companies_detail",headerName:"Kompaniyalar",flex:.35,minWidth:260,sortable:!1,renderCell:e=>{let r=e.row.companies_detail||[];if(!r.length)return(0,l.jsx)("span",{style:{color:"gray"},children:"—"});let i=r.slice(0,3).map((e,r)=>{let i,n=r;if("string"==typeof e)i=e;else if("number"==typeof e)i=String(e);else{var a;n=null!==(a=e.id)&&void 0!==a?a:r,i=e.name||e.company_name||e.title||"#".concat(e.id)}return(0,l.jsx)(t.Z,{size:"small",label:i,sx:{mr:1,mb:1}},n)}),n=r.length-3;return(0,l.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center"},children:[i,n>0&&(0,l.jsx)(t.Z,{size:"small",label:"+".concat(n),sx:{mb:1}})]})}},{field:"actions",headerName:"Amallar",flex:.18,minWidth:160,sortable:!1,renderCell:r=>{let i=r.row;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.Z,{"aria-label":"view",onClick:()=>e.push("/users/view?id=".concat(i.id)),children:(0,l.jsx)(h.Z,{icon:"tabler:eye"})}),(0,l.jsx)(o.Z,{"aria-label":"edit",onClick:()=>S(i),children:(0,l.jsx)(h.Z,{icon:"tabler:edit"})}),(0,l.jsx)(o.Z,{"aria-label":"delete",color:"error",onClick:()=>P(i.id),children:(0,l.jsx)(h.Z,{icon:"tabler:trash"})})]})}}];return(0,l.jsxs)(s.Z,{children:[(0,l.jsx)(d.Z,{title:"Foydalanuvchilar",action:(0,l.jsx)(c.Z,{variant:"contained",onClick:()=>{w(null),y(!0)},children:"Yaratish"})}),(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(u._,{autoHeight:!0,rowHeight:56,rows:v,columns:_,loading:j,disableRowSelectionOnClick:!0,pageSizeOptions:[10,25,50],paginationModel:r,onPaginationModelChange:i,getRowId:e=>e.id})}),g&&(0,l.jsx)(E,{open:g,onClose:()=>y(!1),onSaved:Z,mode:b?"edit":"create",item:b?{...b,companies:(b.companies||[]).map(e=>"string"==typeof e?Number(e):e)}:void 0})]})},O=()=>(0,l.jsx)(I,{})}},function(e){e.O(0,[7536,2712,6717,4021,1863,2888,9774,179],function(){return e(e.s=66249)}),_N_E=e.O()}]);