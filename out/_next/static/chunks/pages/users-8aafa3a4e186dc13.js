(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2892],{66249:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/users",function(){return t(2986)}])},34375:function(e,r,t){"use strict";t.d(r,{Z:function(){return S}});var n=t(63366),i=t(87462),a=t(67294),l=t(86010),s=t(94780),o=t(96788),d=t(29567),c=t(77527),u=t(1588),m=t(34867);function h(e){return(0,m.Z)("MuiCardHeader",e)}let x=(0,u.Z)("MuiCardHeader",["root","avatar","action","content","title","subheader"]);var g=t(85893);let p=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],f=e=>{let{classes:r}=e;return(0,s.Z)({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},h,r)},v=(0,c.ZP)("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(e,r)=>(0,i.Z)({["& .".concat(x.title)]:r.title,["& .".concat(x.subheader)]:r.subheader},r.root)})({display:"flex",alignItems:"center",padding:16}),j=(0,c.ZP)("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(e,r)=>r.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),Z=(0,c.ZP)("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(e,r)=>r.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),b=(0,c.ZP)("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(e,r)=>r.content})({flex:"1 1 auto"});var S=a.forwardRef(function(e,r){let t=(0,d.Z)({props:e,name:"MuiCardHeader"}),{action:a,avatar:s,className:c,component:u="div",disableTypography:m=!1,subheader:h,subheaderTypographyProps:x,title:S,titleTypographyProps:y}=t,w=(0,n.Z)(t,p),P=(0,i.Z)({},t,{component:u,disableTypography:m}),C=f(P),_=S;null==_||_.type===o.Z||m||(_=(0,g.jsx)(o.Z,(0,i.Z)({variant:s?"body2":"h5",className:C.title,component:"span",display:"block"},y,{children:_})));let W=h;return null==W||W.type===o.Z||m||(W=(0,g.jsx)(o.Z,(0,i.Z)({variant:s?"body2":"body1",className:C.subheader,color:"text.secondary",component:"span",display:"block"},x,{children:W}))),(0,g.jsxs)(v,(0,i.Z)({className:(0,l.Z)(C.root,c),as:u,ref:r,ownerState:P},w,{children:[s&&(0,g.jsx)(j,{className:C.avatar,ownerState:P,children:s}),(0,g.jsxs)(b,{className:C.content,ownerState:P,children:[_,W]}),a&&(0,g.jsx)(Z,{className:C.action,ownerState:P,children:a})]}))})},2986:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return D}});var n=t(85893),i=t(67294),a=t(11163),l=t(81873),s=t(52857),o=t(60762),d=t(34375),c=t(73907),u=t(28634),m=t(90142),h=t(75673),x=t(33251),g=t(74538),p=t(52293),f=t(9198),v=t.n(f);t(5843);var j=t(87536),Z=t(33453),b=t(92365),S=t(40110),y=t(96727),w=t(68573),P=t(12467),C=t(15903),_=t(6897),W=t(85533),k=t(12283),N=t(15972),R=t(13539),Q=t(65806),q=t(7879),z=t(86501),E=t(81342),T=t(34273),M=t(55421),F=t(22120);let I={username:"",fullname:"",is_active:!0,date_of_birthday:"",gender:"",phone_number:"",avatar:"",email:"",role:"user",password:"",region:0,district:0,address:"",companies:[]};var H=e=>{let{open:r,onClose:t,onSaved:a,mode:l,item:s}=e,{t:o}=(0,F.$G)(),{control:d,handleSubmit:u,reset:h,watch:f,formState:{isSubmitting:H,errors:O}}=(0,j.cI)({defaultValues:I}),{user:D}=(0,T.a)(),{data:U=[]}=(0,x.z)(g.Z.region,{perPage:100}),A=f("region"),L=A?"".concat(g.Z.district,"?region=").concat(A):g.Z.district,{data:B=[]}=(0,x.z)(L,{perPage:200}),{data:G=[]}=(0,x.z)(g.Z.company,{perPage:200}),[X,$]=(0,i.useState)(null),J=(0,i.useRef)(null),[K,V]=(0,i.useState)("");(0,i.useEffect)(()=>{"edit"===l&&s?(h({...s,password:""}),V(s.avatar||"")):(h(I),V(""))},[l,s,h]),(0,i.useEffect)(()=>{if(X){let e=URL.createObjectURL(X);return V(e),()=>URL.revokeObjectURL(e)}},[X]);let Y=async e=>{try{console.log(X);let r={...e};if(r.password||delete r.password,"create"===l){let r=new FormData;X&&r.append("avatar",X),Object.keys(e).forEach(t=>{"companies"==t?e.companies.forEach(e=>{r.append("companies",e.toString())}):r.append(t,e[t])}),await p.Do.postForm(g.Z.users,r)}else if("edit"===l&&(null==s?void 0:s.id)){let r=new FormData;Object.keys(e).forEach(t=>{if("companies"==t)e.companies.forEach((e,t)=>{r.append("companies",e.toString())});else{if("avatar"==t)return;r.append(t,e[t])}}),X&&r.append("avatar",X),await p.Do.putForm(g.Z.userById(s.id),r)}z.ZP.success(String(o("users.toast.saved"))),a(),t()}catch(e){console.error("Failed to save user:",e),z.ZP.error(String(o("users.toast.saveError")))}};return(0,n.jsxs)(Z.Z,{open:r,onClose:H?void 0:t,fullWidth:!0,maxWidth:"md",children:[(0,n.jsx)(b.Z,{children:"create"===l?String(o("users.create.title")):String(o("users.edit.title"))}),(0,n.jsxs)("form",{onSubmit:u(Y),children:[(0,n.jsx)(S.Z,{children:(0,n.jsx)(E.Z,{children:(0,n.jsxs)(w.ZP,{container:!0,spacing:4,children:[(0,n.jsx)(w.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(j.Qr,{name:"username",control:d,rules:{required:String(o("errors.required"))},render:e=>{var r;let{field:t}=e;return(0,n.jsx)(q.Z,{fullWidth:!0,label:String(o("users.form.username")),...t,error:!!O.username,helperText:null===(r=O.username)||void 0===r?void 0:r.message})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(j.Qr,{name:"fullname",control:d,rules:{required:String(o("errors.required"))},render:e=>{var r;let{field:t}=e;return(0,n.jsx)(q.Z,{fullWidth:!0,label:String(o("users.form.fullname")),...t,error:!!O.fullname,helperText:null===(r=O.fullname)||void 0===r?void 0:r.message})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,children:(0,n.jsx)(j.Qr,{name:"is_active",control:d,render:e=>{let{field:r}=e;return(0,n.jsx)(Q.Z,{control:(0,n.jsx)(R.Z,{checked:!!r.value,onChange:(e,t)=>r.onChange(t)}),label:String(o("users.form.active"))})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(j.Qr,{name:"email",control:d,rules:{required:String(o("errors.required"))},render:e=>{var r;let{field:t}=e;return(0,n.jsx)(q.Z,{fullWidth:!0,type:"email",label:String(o("users.form.email")),...t,error:!!O.email,helperText:null===(r=O.email)||void 0===r?void 0:r.message})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(j.Qr,{name:"phone_number",control:d,render:e=>{let{field:r}=e;return(0,n.jsx)(q.Z,{fullWidth:!0,label:String(o("users.form.phone")),...r})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(j.Qr,{name:"date_of_birthday",control:d,render:e=>{let{field:r}=e,t=r.value?new Date(r.value):null;return(0,n.jsx)("div",{children:(0,n.jsx)(v(),{selected:t,onChange:e=>r.onChange(e?e.toISOString().slice(0,10):""),dateFormat:"yyyy-MM-dd",customInput:(0,n.jsx)(q.Z,{label:String(o("users.form.birthDate")),fullWidth:!0}),showPopperArrow:!0,isClearable:!0})})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(j.Qr,{name:"gender",control:d,rules:{required:String(o("errors.required"))},render:e=>{let{field:r}=e;return(0,n.jsxs)(_.Z,{error:!!O.gender,children:[(0,n.jsx)(W.Z,{children:String(o("users.form.gender"))}),(0,n.jsxs)(C.Z,{row:!0,...r,children:[(0,n.jsx)(Q.Z,{value:"male",control:(0,n.jsx)(P.Z,{}),label:String(o("users.gender.male"))}),(0,n.jsx)(Q.Z,{value:"female",control:(0,n.jsx)(P.Z,{}),label:String(o("users.gender.female"))})]}),O.gender&&(0,n.jsx)(k.Z,{children:O.gender.message})]})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(j.Qr,{name:"role",control:d,rules:{required:String(o("errors.required"))},render:e=>{var r;let{field:t}=e;return(0,n.jsxs)(q.Z,{select:!0,fullWidth:!0,label:String(o("users.form.role")),...t,error:!!O.role,helperText:null===(r=O.role)||void 0===r?void 0:r.message,children:[(0,n.jsx)(N.Z,{value:"1",children:String(o("users.roles.admin"))}),(0,n.jsx)(N.Z,{value:"2",children:String(o("users.roles.manager"))}),(0,n.jsx)(N.Z,{value:"3",children:String(o("users.roles.user"))})]})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(j.Qr,{name:"password",control:d,render:e=>{let{field:r}=e;return(0,n.jsx)(q.Z,{fullWidth:!0,type:"password",label:String(o("users.form.password")),...r})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(j.Qr,{name:"region",control:d,rules:{required:String(o("errors.required"))},render:e=>{var r;let{field:t}=e;return(0,n.jsx)(q.Z,{select:!0,fullWidth:!0,label:String(o("users.form.region")),...t,error:!!O.region,helperText:null===(r=O.region)||void 0===r?void 0:r.message,children:U.map(e=>(0,n.jsx)(N.Z,{value:e.id,children:e.name_uz||e.name},e.id))})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(j.Qr,{name:"district",control:d,rules:{required:String(o("errors.required"))},render:e=>{var r;let{field:t}=e;return(0,n.jsx)(q.Z,{select:!0,fullWidth:!0,label:String(o("users.form.district")),...t,error:!!O.district,helperText:null===(r=O.district)||void 0===r?void 0:r.message,children:B.map(e=>(0,n.jsx)(N.Z,{value:e.id,children:e.name_uz||e.name},e.id))})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,children:(0,n.jsx)(j.Qr,{name:"address",control:d,render:e=>{let{field:r}=e;return(0,n.jsx)(q.Z,{fullWidth:!0,label:String(o("users.form.address")),...r})}})}),(0,n.jsx)(w.ZP,{item:!0,xs:12,children:(0,n.jsx)(j.Qr,{name:"companies",control:d,render:e=>{let{field:r}=e;return(0,n.jsx)(q.Z,{select:!0,fullWidth:!0,label:String(o("users.form.companies")),...r,SelectProps:{multiple:!0},children:G.map(e=>(0,n.jsx)(N.Z,{value:e.id,children:e.name},e.id))})}})}),(0,n.jsxs)(w.ZP,{item:!0,xs:12,children:[(0,n.jsx)("input",{ref:J,hidden:!0,type:"file",accept:"image/*",onChange:e=>{var r;return $((null===(r=e.target.files)||void 0===r?void 0:r[0])||null)}}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,n.jsx)(m.Z,{src:K||void 0,variant:"circular",onClick:()=>{var e;return null===(e=J.current)||void 0===e?void 0:e.click()},sx:{width:96,height:96,cursor:"pointer",borderRadius:"50%","& img":{width:"100%",height:"100%",objectFit:"cover"}},children:(0,M.Q)(f("fullname")||f("username")||"U")}),(0,n.jsx)(c.Z,{variant:"outlined",onClick:()=>{var e;return null===(e=J.current)||void 0===e?void 0:e.click()},children:String(o("users.form.uploadAvatar"))}),K&&(0,n.jsx)(c.Z,{variant:"text",color:"secondary",onClick:()=>{$(null),V((null==s?void 0:s.avatar)||"")},children:String(o("common.cancel"))})]})]})]})})}),(0,n.jsxs)(y.Z,{children:[(0,n.jsx)(c.Z,{type:"button",variant:"tonal",color:"secondary",onClick:t,disabled:H,children:String(o("common.cancel"))}),(0,n.jsx)(c.Z,{type:"submit",disabled:H,children:H?String(o("common.saving")):String(o("common.save"))})]})]})]})},O=()=>{let e=(0,a.useRouter)(),{t:r}=(0,F.$G)(),[t,f]=(0,i.useState)({page:0,pageSize:10}),{data:v=[],loading:j,mutate:Z}=(0,x.z)(g.Z.users,{perPage:t.pageSize,page:t.page+1}),[b,S]=(0,i.useState)(!1),[y,w]=(0,i.useState)(null),P=e=>{w(e),S(!0)},C=async e=>{await p.Do.delete(g.Z.userById(e)),Z()},_=e=>e.avatar?(0,n.jsx)(m.Z,{src:e.avatar,variant:"circular",sx:{mr:2.5,width:38,height:38,borderRadius:"50%","& img":{width:"100%",height:"100%",objectFit:"cover"}}}):(0,n.jsx)(m.Z,{skin:"light",color:"primary",sx:{mr:2.5,width:38,height:38,fontWeight:500},children:(0,M.Q)(e.fullname||e.username)}),W=[{field:"fullname",headerName:String(r("users.table.fullname")),flex:.25,minWidth:220,renderCell:e=>{let r=e.row;return(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[_(r),(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,n.jsx)("span",{style:{fontWeight:500},children:r.fullname||r.username}),(0,n.jsx)("span",{style:{color:"gray",fontSize:12},children:r.email})]})]})}},{field:"username",headerName:String(r("users.table.username")),flex:.15,minWidth:140},{field:"role",headerName:String(r("users.table.role")),flex:.12,minWidth:120},{field:"phone_number",headerName:String(r("users.table.phone")),flex:.18,minWidth:160},{field:"is_active",headerName:String(r("users.table.active")),flex:.1,minWidth:100,valueGetter:e=>e.row.is_active?String(r("common.yes")):String(r("common.no"))},{field:"companies_detail",headerName:String(r("users.table.companies")),flex:.35,minWidth:260,sortable:!1,renderCell:e=>{let r=e.row.companies_detail||[];if(!r.length)return(0,n.jsx)("span",{style:{color:"gray"},children:"â€”"});let t=r.slice(0,3).map((e,r)=>{let t,i=r;if("string"==typeof e)t=e;else if("number"==typeof e)t=String(e);else{var a;i=null!==(a=e.id)&&void 0!==a?a:r,t=e.name||e.company_name||e.title||"#".concat(e.id)}return(0,n.jsx)(l.Z,{size:"small",label:t,sx:{mr:1,mb:1}},i)}),i=r.length-3;return(0,n.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center"},children:[t,i>0&&(0,n.jsx)(l.Z,{size:"small",label:"+".concat(i),sx:{mb:1}})]})}},{field:"actions",headerName:String(r("common.actions")),flex:.18,minWidth:160,sortable:!1,renderCell:r=>{let t=r.row;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.Z,{"aria-label":"view",onClick:()=>e.push("/users/view?id=".concat(t.id)),children:(0,n.jsx)(h.Z,{icon:"tabler:eye"})}),(0,n.jsx)(s.Z,{"aria-label":"edit",onClick:()=>P(t),children:(0,n.jsx)(h.Z,{icon:"tabler:edit"})}),(0,n.jsx)(s.Z,{"aria-label":"delete",color:"error",onClick:()=>C(t.id),children:(0,n.jsx)(h.Z,{icon:"tabler:trash"})})]})}}];return(0,n.jsxs)(o.Z,{children:[(0,n.jsx)(d.Z,{title:String(r("users.title")),action:(0,n.jsx)(c.Z,{variant:"contained",onClick:()=>{w(null),S(!0)},children:String(r("common.create"))})}),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(u._,{autoHeight:!0,rowHeight:56,rows:v,columns:W,loading:j,disableRowSelectionOnClick:!0,pageSizeOptions:[10,25,50],paginationModel:t,onPaginationModelChange:f,getRowId:e=>e.id})}),b&&(0,n.jsx)(H,{open:b,onClose:()=>S(!1),onSaved:Z,mode:y?"edit":"create",item:y?{...y,companies:(y.companies||[]).map(e=>"string"==typeof e?Number(e):e)}:void 0})]})},D=()=>(0,n.jsx)(O,{})}},function(e){e.O(0,[7536,2712,1440,8634,4021,1863,2888,9774,179],function(){return e(e.s=66249)}),_N_E=e.O()}]);