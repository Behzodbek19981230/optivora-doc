"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8201],{60762:function(e,t,r){r.d(t,{Z:function(){return f}});var a=r(87462),o=r(63366),n=r(67294),i=r(86010),l=r(94780),d=r(77527),s=r(29567),c=r(93454),p=r(1588),u=r(34867);function m(e){return(0,u.Z)("MuiCard",e)}(0,p.Z)("MuiCard",["root"]);var h=r(85893);let g=["className","raised"],b=e=>{let{classes:t}=e;return(0,l.Z)({root:["root"]},m,t)},x=(0,d.ZP)(c.Z,{name:"MuiCard",slot:"Root",overridesResolver:(e,t)=>t.root})(()=>({overflow:"hidden"}));var f=n.forwardRef(function(e,t){let r=(0,s.Z)({props:e,name:"MuiCard"}),{className:n,raised:l=!1}=r,d=(0,o.Z)(r,g),c=(0,a.Z)({},r,{raised:l}),p=b(c);return(0,h.jsx)(x,(0,a.Z)({className:(0,i.Z)(p.root,n),elevation:l?8:void 0,ref:t,ownerState:c},d))})},4952:function(e,t,r){r.d(t,{Z:function(){return x}});var a=r(63366),o=r(87462),n=r(67294),i=r(86010),l=r(94780),d=r(77527),s=r(29567),c=r(1588),p=r(34867);function u(e){return(0,p.Z)("MuiCardActions",e)}(0,c.Z)("MuiCardActions",["root","spacing"]);var m=r(85893);let h=["disableSpacing","className"],g=e=>{let{classes:t,disableSpacing:r}=e;return(0,l.Z)({root:["root",!r&&"spacing"]},u,t)},b=(0,d.ZP)("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:r}=e;return[t.root,!r.disableSpacing&&t.spacing]}})(e=>{let{ownerState:t}=e;return(0,o.Z)({display:"flex",alignItems:"center",padding:8},!t.disableSpacing&&{"& > :not(:first-of-type)":{marginLeft:8}})});var x=n.forwardRef(function(e,t){let r=(0,s.Z)({props:e,name:"MuiCardActions"}),{disableSpacing:n=!1,className:l}=r,d=(0,a.Z)(r,h),c=(0,o.Z)({},r,{disableSpacing:n}),p=g(c);return(0,m.jsx)(b,(0,o.Z)({className:(0,i.Z)(p.root,l),ownerState:c,ref:t},d))})},34375:function(e,t,r){r.d(t,{Z:function(){return w}});var a=r(63366),o=r(87462),n=r(67294),i=r(86010),l=r(94780),d=r(96788),s=r(29567),c=r(77527),p=r(1588),u=r(34867);function m(e){return(0,u.Z)("MuiCardHeader",e)}let h=(0,p.Z)("MuiCardHeader",["root","avatar","action","content","title","subheader"]);var g=r(85893);let b=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],x=e=>{let{classes:t}=e;return(0,l.Z)({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},m,t)},f=(0,c.ZP)("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(e,t)=>(0,o.Z)({["& .".concat(h.title)]:t.title,["& .".concat(h.subheader)]:t.subheader},t.root)})({display:"flex",alignItems:"center",padding:16}),Z=(0,c.ZP)("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(e,t)=>t.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),y=(0,c.ZP)("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(e,t)=>t.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),v=(0,c.ZP)("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(e,t)=>t.content})({flex:"1 1 auto"});var w=n.forwardRef(function(e,t){let r=(0,s.Z)({props:e,name:"MuiCardHeader"}),{action:n,avatar:l,className:c,component:p="div",disableTypography:u=!1,subheader:m,subheaderTypographyProps:h,title:w,titleTypographyProps:S}=r,j=(0,a.Z)(r,b),C=(0,o.Z)({},r,{component:p,disableTypography:u}),k=x(C),L=w;null==L||L.type===d.Z||u||(L=(0,g.jsx)(d.Z,(0,o.Z)({variant:l?"body2":"h5",className:k.title,component:"span",display:"block"},S,{children:L})));let P=m;return null==P||P.type===d.Z||u||(P=(0,g.jsx)(d.Z,(0,o.Z)({variant:l?"body2":"body1",className:k.subheader,color:"text.secondary",component:"span",display:"block"},h,{children:P}))),(0,g.jsxs)(f,(0,o.Z)({className:(0,i.Z)(k.root,c),as:p,ref:t,ownerState:C},j,{children:[l&&(0,g.jsx)(Z,{className:k.avatar,ownerState:C,children:l}),(0,g.jsxs)(v,{className:k.content,ownerState:C,children:[L,P]}),n&&(0,g.jsx)(y,{className:k.action,ownerState:C,children:n})]}))})},1652:function(e,t,r){r.d(t,{cP:function(){return o}});var a=r(77527);let o=(0,a.ZP)("div")(e=>{let{theme:t}=e;return{"& .rdw-editor-wrapper":{border:"1px solid ".concat(t.palette.divider),"& .rdw-editor-toolbar":{border:0,marginBottom:0,background:t.palette.background.paper,borderBottom:"1px solid ".concat(t.palette.divider),"& .rdw-fontsize-dropdown":{minWidth:50},"& .rdw-link-modal":{height:"auto"},"& .rdw-colorpicker-modal, & .rdw-link-modal, & .rdw-embedded-modal, & .rdw-emoji-modal, & .rdw-image-modal":{boxShadow:t.shadows[8],borderColor:t.palette.divider,backgroundColor:t.palette.background.paper},"& .rdw-dropdown-optionwrapper":{boxShadow:t.shadows[8],borderColor:t.palette.divider,backgroundColor:t.palette.background.paper,"& .rdw-dropdownoption-highlighted":{backgroundColor:t.palette.action.hover},"& .rdw-dropdownoption-active":{backgroundColor:t.palette.action.selected}},"& .rdw-option-wrapper, & .rdw-dropdown-wrapper":{borderRadius:"4px !important",borderColor:t.palette.divider,background:t.palette.background.paper,"& .rdw-dropdown-carettoopen":{left:"auto",right:"10%",borderTopColor:t.palette.text.disabled},"& .rdw-dropdown-carettoclose":{left:"auto",right:"10%",borderBottomColor:t.palette.text.disabled},..."dark"===t.palette.mode?{"& img":{filter:"invert(1)"}}:{},"&:hover":{boxShadow:"none",backgroundColor:"rgba(".concat(t.palette.customColors.main,", 0.08)")}},"& .rdw-embedded-modal-size-input, & .rdw-image-modal-size-input":{width:"60%",minHeight:30},"& .rdw-link-modal-input, & .rdw-embedded-modal-link-input, & .rdw-image-modal-url-input":{minHeight:38},"& .rdw-link-modal-input, & .rdw-embedded-modal-link-input, & .rdw-image-modal-url-input, & .rdw-embedded-modal-size-input, & .rdw-image-modal-size-input":{background:"none",padding:t.spacing(0,3.5),color:t.palette.text.primary,borderColor:t.palette.divider,borderRadius:t.shape.borderRadius,fontSize:t.typography.body1.fontSize,"&:focus":{borderColor:t.palette.primary.main},"&::placeholder, &:-ms-input-placeholder, &::-ms-input-placeholder":{color:t.palette.text.disabled}},"& .rdw-link-modal-btn, & .rdw-embedded-modal-btn, & .rdw-image-modal-btn":{border:0,lineHeight:1.71,borderRadius:"5px",letterSpacing:"0.3px",textTransform:"uppercase",fontWeight:t.typography.fontWeightMedium,"&:first-of-type:not([disabled])":{boxShadow:t.shadows[3],color:t.palette.primary.contrastText,backgroundColor:t.palette.primary.main,"&:hover":{boxShadow:t.shadows[4],backgroundColor:t.palette.primary.dark},"&:active":{boxShadow:t.shadows[3]}},"&:last-child":{boxShadow:t.shadows[3],color:t.palette.secondary.contrastText,backgroundColor:t.palette.secondary.main,"&:hover":{boxShadow:t.shadows[4],backgroundColor:t.palette.secondary.dark},"&:active":{boxShadow:t.shadows[3]}},"&[disabled]":{cursor:"default",boxShadow:"none",color:t.palette.text.disabled,backgroundColor:t.palette.action.disabledBackground}}},"& .rdw-editor-main":{cursor:"text",padding:"0 1rem",minHeight:"10rem",color:t.palette.text.primary,..."rtl"===t.direction?{"& .public-DraftStyleDefault-block":{direction:"ltr !important",textAlign:"left !important"}}:{}}}}});(0,a.ZP)("div")(()=>({"& .rdw-editor-wrapper":{display:"flex",flexDirection:"column-reverse"}})),(0,a.ZP)("div")(()=>({"& .rdw-editor-wrapper, & .rdw-editor-toolbar":{border:"0 !important"}}))},73138:function(e,t,r){r.d(t,{Z:function(){return i}});var a=r(85893),o=r(5152);let n=r.n(o)()(()=>r.e(6925).then(r.t.bind(r,35108,23)).then(e=>e.Editor),{loadableGenerated:{webpack:()=>[35108]},ssr:!1});var i=e=>(0,a.jsx)(n,{editorState:e.editorState,onEditorStateChange:t=>e.onEditorStateChange(t)})},28201:function(e,t,r){var a=r(85893),o=r(67294),n=r(87536),i=r(11163),l=r(60762),d=r(34375),s=r(71919),c=r(68573),p=r(46070),u=r(84166),m=r(96788),h=r(76592),g=r(70360),b=r(46577),x=r(8863),f=r(19827),Z=r(21038),y=r(52857),v=r(56912),w=r(51015),S=r(4952),j=r(7879),C=r(52293),k=r(74538),L=r(86501),P=r(75673),N=r(22120),R=r(73138),_=r(9041),E=r(1652);r(80135);var M=r(34273);let D={company:0,letter_number:"",responsible_person:0,basis:"",comment:"",organization:""};t.Z=()=>{let e=(0,i.useRouter)(),{t}=(0,N.$G)(),{id:r}=e.query,F=r?"edit":"create",z=r?Number(r):null,{user:A}=(0,M.a)(),{control:H,handleSubmit:T,reset:I,formState:{isSubmitting:B}}=(0,n.cI)({defaultValues:D}),[V,W]=(0,o.useState)([]),[Q,q]=(0,o.useState)(_.EditorState.createEmpty());(0,o.useEffect)(()=>{(async()=>{try{let e=(await C.Do.get(k.Z.users+"?perPage=200")).data;W(e.results||e||[])}catch(e){}})()},[]),(0,o.useEffect)(()=>{(async()=>{if("edit"===F&&z){let e=(await C.Do.get(k.Z.replyLetterById(z))).data;I(e),q(_.EditorState.createWithContent(_.ContentState.createFromText(String((null==e?void 0:e.comment)||""))))}else I(D),q(_.EditorState.createEmpty())})()},[F,z,I]);let O=async r=>{try{let a={...r,company:null==A?void 0:A.company_id};if("create"===F){let r=await C.Do.post(k.Z.replyLetter,a);L.ZP.success(String(t("replyLetter.toast.created"))),e.push("/reply-letter/".concat(r.data.id))}else"edit"===F&&z&&(await C.Do.put(k.Z.replyLetterById(z),a),L.ZP.success(String(t("replyLetter.toast.saved"))))}catch(e){console.error(e),L.ZP.error(String(t("replyLetter.toast.saveError")))}},[G,$]=(0,o.useState)([]),[J,K]=(0,o.useState)([]),[U,X]=(0,o.useState)(!1);(0,o.useEffect)(()=>{(async()=>{if("edit"===F&&z)try{let e=(await C.Do.get(k.Z.replyLetterFile+"?reply_letter=".concat(z))).data,t=e.results||e||[];$(t.map(e=>{var t,r,a;return{id:Number(e.id),title:String(e.title||""),file:null!==(a=null!==(r=null!==(t=e.file)&&void 0!==t?t:e.file_url)&&void 0!==r?r:e.url)&&void 0!==a?a:null,created_time:e.created_time}}))}catch(e){console.error(e)}})()},[F,z]);let Y=e=>K(t=>t.filter((t,r)=>r!==e)),ee=(e,t)=>K(r=>r.map((r,a)=>a===e?{...r,file:t}:r)),et=async e=>{try{if(e.file){window.open(String(e.file),"_blank","noopener,noreferrer");return}await C.Do.downloadFile(k.Z.replyLetterFileById(e.id),e.title||"reply-letter-file-".concat(e.id))}catch(e){console.error(e),L.ZP.error(String(t("replyLetter.attachments.toast.downloadError",{defaultValue:"Failed to download file"})))}},er=async()=>{if(!z)return;let e=J.filter(e=>e.file);if(!e.length)return L.ZP.error(String(t("replyLetter.attachments.validation.fileRequired")));try{for(let t of(X(!0),e)){let e=new FormData;e.append("reply_letter",String(z)),e.append("title",""),t.file&&e.append("file",t.file),await C.Do.postForm(k.Z.replyLetterFile,e)}L.ZP.success(String(t("replyLetter.attachments.toast.uploaded"))),K([]);let r=(await C.Do.get(k.Z.replyLetterFile+"?reply_letter=".concat(z))).data,a=r.results||r||[];$(a.map(e=>{var t,r,a;return{id:Number(e.id),title:String(e.title||""),file:null!==(a=null!==(r=null!==(t=e.file)&&void 0!==t?t:e.file_url)&&void 0!==r?r:e.url)&&void 0!==a?a:null,created_time:e.created_time}}))}catch(e){console.error(e),L.ZP.error(String(t("replyLetter.attachments.toast.uploadError")))}finally{X(!1)}};return(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(d.Z,{title:"create"===F?String(t("replyLetter.create.title")):String(t("replyLetter.edit.title"))}),(0,a.jsxs)("form",{onSubmit:T(O),children:[(0,a.jsx)(s.Z,{children:(0,a.jsxs)(c.ZP,{container:!0,spacing:4,children:[(0,a.jsx)(c.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(n.Qr,{name:"organization",control:H,render:e=>{let{field:r}=e;return(0,a.jsx)(j.Z,{fullWidth:!0,label:String(t("replyLetter.form.company")),...r})}})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(n.Qr,{name:"letter_number",control:H,render:e=>{let{field:r}=e;return(0,a.jsx)(j.Z,{fullWidth:!0,label:String(t("replyLetter.form.letterNumber")),...r})}})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(n.Qr,{name:"responsible_person",control:H,render:e=>{let{field:r}=e;return(0,a.jsx)(p.Z,{options:V||[],value:V.find(e=>Number(e.id)===Number(r.value))||null,onChange:(e,t)=>r.onChange((null==t?void 0:t.id)?Number(t.id):0),isOptionEqualToValue:(e,t)=>Number(e.id)===Number(null==t?void 0:t.id),getOptionLabel:e=>(null==e?void 0:e.fullname)||(null==e?void 0:e.username)||String((null==e?void 0:e.id)||""),renderInput:e=>(0,a.jsx)(j.Z,{...e,fullWidth:!0,label:String(t("replyLetter.form.responsiblePerson")),placeholder:String(t("common.search",{defaultValue:"Search"}))})})}})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,children:(0,a.jsx)(n.Qr,{name:"basis",control:H,render:e=>{let{field:r}=e;return(0,a.jsx)(j.Z,{fullWidth:!0,label:String(t("replyLetter.form.basis")),...r})}})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,children:(0,a.jsx)(n.Qr,{name:"comment",control:H,render:e=>{let{field:r}=e;return(0,a.jsxs)(E.cP,{children:[(0,a.jsx)("div",{style:{marginBottom:8,fontWeight:500},children:String(t("replyLetter.form.comment"))}),(0,a.jsx)(R.Z,{editorState:Q,onEditorStateChange:e=>{q(e),r.onChange(e.getCurrentContent().getPlainText())}})]})}})})]})}),"edit"===F?(0,a.jsx)(s.Z,{children:(0,a.jsxs)(l.Z,{variant:"outlined",children:[(0,a.jsx)(d.Z,{title:String(t("replyLetter.attachments.title")),subheader:String(t("replyLetter.attachments.subtitle"))}),(0,a.jsx)(s.Z,{children:(0,a.jsxs)(u.Z,{spacing:3,children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(m.Z,{variant:"subtitle2",sx:{mb:1},children:String(t("replyLetter.attachments.existing",{defaultValue:"Attached files"}))}),G.length?(0,a.jsxs)(h.Z,{size:"small",children:[(0,a.jsx)(g.Z,{children:(0,a.jsxs)(b.Z,{children:[(0,a.jsx)(x.Z,{children:String(t("replyLetter.attachments.table.file",{defaultValue:"File"}))}),(0,a.jsx)(x.Z,{align:"right",children:String(t("replyLetter.attachments.table.actions",{defaultValue:"Actions"}))})]})}),(0,a.jsx)(f.Z,{children:G.map(e=>(0,a.jsxs)(b.Z,{children:[(0,a.jsx)(x.Z,{children:e.file?String(e.file).split("/").pop():"â€”"}),(0,a.jsx)(x.Z,{align:"right",children:(0,a.jsx)(Z.Z,{title:String(t("replyLetter.attachments.actions.download",{defaultValue:"Open / download"})),children:(0,a.jsx)(y.Z,{size:"small",onClick:()=>et(e),children:(0,a.jsx)(P.Z,{icon:"tabler:download"})})})})]},e.id))})]}):(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:String(t("replyLetter.attachments.empty",{defaultValue:"No attached files"}))})]}),(0,a.jsx)(v.Z,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)(m.Z,{variant:"subtitle2",sx:{mb:1},children:String(t("replyLetter.attachments.addNew",{defaultValue:"Add new files"}))}),(0,a.jsxs)(u.Z,{spacing:2,children:[J.map((e,r)=>(0,a.jsx)(l.Z,{variant:"outlined",children:(0,a.jsx)(s.Z,{children:(0,a.jsxs)(c.ZP,{container:!0,spacing:3,alignItems:"end",children:[(0,a.jsx)(c.ZP,{item:!0,xs:12,md:10,children:(0,a.jsxs)(u.Z,{direction:"row",spacing:2,alignItems:"end",children:[(0,a.jsxs)(w.Z,{variant:"outlined",component:"label",startIcon:(0,a.jsx)(P.Z,{icon:"tabler:paperclip"}),children:[String(t("replyLetter.attachments.form.attachFile")),(0,a.jsx)("input",{hidden:!0,type:"file",onChange:e=>{var t;return ee(r,(null===(t=e.target.files)||void 0===t?void 0:t[0])||null)}})]}),(0,a.jsx)("span",{style:{color:"rgba(0,0,0,0.6)"},children:e.file?e.file.name:String(t("replyLetter.attachments.form.noFileSelected"))})]})}),(0,a.jsx)(c.ZP,{item:!0,xs:12,md:2,sx:{textAlign:"right"},children:(0,a.jsx)(y.Z,{"aria-label":"remove",color:"error",onClick:()=>Y(r),children:(0,a.jsx)(P.Z,{icon:"tabler:trash"})})})]})})},r)),(0,a.jsxs)(u.Z,{direction:"row",spacing:2,children:[(0,a.jsx)(w.Z,{type:"button",variant:"contained",color:"primary",onClick:()=>K(e=>[...e,{file:null}]),children:String(t("replyLetter.attachments.addRow"))}),(0,a.jsx)(w.Z,{type:"button",variant:"outlined",color:"success",onClick:er,disabled:U,children:U?String(t("common.loading")):String(t("replyLetter.attachments.upload"))})]})]})]})]})})]})}):null,(0,a.jsx)(S.Z,{children:(0,a.jsxs)(u.Z,{direction:"row",spacing:2,sx:{p:2},children:[(0,a.jsx)(w.Z,{type:"submit",variant:"contained",disabled:B,children:B?String(t("common.saving")):String(t("common.save"))}),(0,a.jsx)(w.Z,{variant:"tonal",onClick:()=>e.push("/reply-letter"),children:String(t("common.cancel"))})]})})]})]})}}}]);